<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>墨香笔记@技术博客</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="墨香笔记@技术博客"><meta name="msapplication-TileImage" content="https://cdn.jsdelivr.net/gh/removeif/removeif-demo@latest/img/favicon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="墨香笔记@技术博客"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="罗宇"><meta property="og:url" content="https://removeif.github.io/"><meta property="og:site_name" content="罗宇"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://removeif.github.io/img/avatar.png"><meta property="article:author" content="removeif"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://removeif.github.io/img/avatar.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"墨香笔记@技术博客","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"罗宇"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject"}},"description":""}</script><link rel="icon" href="https://cdn.jsdelivr.net/gh/removeif/removeif-demo@latest/img/favicon.png"><meta name="referrer" content="no-referrer-when-downgrade"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/6.0.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/11.7.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="/js/globalUtils.js"></script><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdnjs.loli.net/ajax/libs/pace/1.2.4/pace.min.js"></script><link rel="stylesheet" href="/live2d/waifu.css"><script type="text/javascript" async src="/live2d/autoload.js"></script><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://cdn.jsdelivr.net/gh/removeif/removeif-demo@latest/img/logo.png" alt="墨香笔记@技术博客" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item is-active" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/media">影音</a><a class="navbar-item" href="/album">相册</a><a class="navbar-item" href="/friend">友链</a><a class="navbar-item" href="/message">留言</a><a class="navbar-item" href="/about">关于我</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Join Gitter" href="https://gitter.im/hexo-theme-amazing/community"><i class="fab fa-gitter"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/removeif/hexo-theme-amazing"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card widget">
            <div class="card-content">
                <h3 class="menu-label">热门推荐</h3><span id="index_hot_div">加载中，请稍等...</span>
            </div>
        </div><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2025-04-16  <a class="commentCountImg" href="/2025/04/16/hello-world/#comment-container"><span class="display-none-class">212d5e6f12a4c2d724f97255199c93a3</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="212d5e6f12a4c2d724f97255199c93a3">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>1 分钟  <i class="fas fa-pencil-alt"> </i>0.1 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/04/16/hello-world/">Hello World</a></h1><div class="content"><p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
</div><div class="index-category-tag">  <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2025-04-15  <a class="commentCountImg" href="/2025/04/15/Linux%E5%9F%BA%E7%A1%80/#comment-container"><span class="display-none-class">55c798e75e105f274874c82d3d8fe66f</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="55c798e75e105f274874c82d3d8fe66f">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>2 小时  <i class="fas fa-pencil-alt"> </i>15.8 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/04/15/Linux%E5%9F%BA%E7%A1%80/">Linux基本使用</a></h1><div class="content"><h1 id="1-访问命令行"><a href="#1-访问命令行" class="headerlink" title="1 访问命令行"></a>1 访问命令行</h1><h2 id="1-1-登录Linux系统"><a href="#1-1-登录Linux系统" class="headerlink" title="1.1 登录Linux系统"></a>1.1 登录Linux系统</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">图形化</span><br><span class="line">​   系统菜单-注销-或切换用户</span><br><span class="line"></span><br><span class="line">字符界面</span><br><span class="line">​   Ctrl+alt+F2-F6   </span><br><span class="line">在本机上切换用户给</span><br><span class="line"></span><br><span class="line">su - root 切换用户</span><br><span class="line">ctrl+d 退出登录(ctrl+d or <span class="built_in">exit</span> or <span class="built_in">logout</span>)</span><br><span class="line"></span><br><span class="line">网络登录</span><br><span class="line">​     ssh  ip 或 主机名</span><br><span class="line">[kiosk@foundation0 ~]$ ssh servera</span><br><span class="line">​     ssh  用户名@ip/主机名</span><br><span class="line">[kiosk@foundation0 ~]$ ssh root@servera</span><br><span class="line">[kiosk@foundation0 ~]$ ssh student@servera</span><br></pre></td></tr></table></figure>

<h2 id="1-2-终端切换"><a href="#1-2-终端切换" class="headerlink" title="1.2 终端切换"></a>1.2 终端切换</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CLI   Ctrl+alt+Fx   xin （2，6）</span><br><span class="line">GUI   Ctrl+alt+F1  </span><br></pre></td></tr></table></figure>

<hr>
<h2 id="1-3-Shell简介"><a href="#1-3-Shell简介" class="headerlink" title="1.3 Shell简介"></a>1.3 Shell简介</h2><p>​        是一个解释器，可以帮助用户将指令信息传递内核</p>
<p>​        红帽企业Linux中为用户提供默认shell是bash，bash是与UNIX类似的系统上使用的其中一个最成功的shell改进版本</p>
<h2 id="1-4-基本组成"><a href="#1-4-基本组成" class="headerlink" title="1.4 基本组成"></a>1.4 基本组成</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[kiosk@foundation0 ~]$                    #$普通用户</span><br><span class="line"></span><br><span class="line">[kiosk@foundation0 ~]$ su - root          #切换用户：su - 用户名</span><br><span class="line">Password:                                 #输入用户登录密码</span><br><span class="line">Last login: Sat Feb 22 15:11:13 CST 2020 on tty3</span><br><span class="line">[root@foundation0 ~]#                    #超级用户</span><br><span class="line"></span><br><span class="line">ctrl+d or exit                           退出登录</span><br></pre></td></tr></table></figure>

<p>注：bash shell在概念上与微软的cmd相似，但bash具有更加复杂的脚本语言</p>
<p>​       与win系统powershell类似、mac的管理终端使用工具也是使用的bash shell</p>
<h2 id="1-5-GNOME-Shell"><a href="#1-5-GNOME-Shell" class="headerlink" title="1.5 GNOME Shell"></a>1.5 GNOME Shell</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ALT+F2  输入 gnome-terminal    # 启动终端</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">锁定 win+l</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭和重启</span></span><br><span class="line">  init 0               init 6</span><br><span class="line">  poweroff             reboot</span><br><span class="line">  systemctl poweroff   systemctl reboot</span><br><span class="line">  shutdown -h 20：00   shutdown -r 0</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">工作区切换</span></span><br><span class="line">  ctrl+alt 上\|下 箭头 </span><br></pre></td></tr></table></figure>

<h2 id="1-6-Shell的特性"><a href="#1-6-Shell的特性" class="headerlink" title="1.6 Shell的特性"></a>1.6 Shell的特性</h2><h3 id="linux命令语法"><a href="#linux命令语法" class="headerlink" title="linux命令语法"></a>linux命令语法</h3><p>完成具体功能的命令、扩展该命令功能的选项、命令要操作的对象</p>
<p>cmd 【-option】 【arg1】 【arg2】</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">简单的命令示例：</span><br><span class="line">whoami</span><br><span class="line">date</span><br><span class="line">touch file1；mkdir dir1</span><br><span class="line"></span><br><span class="line">完成某些工作的指令</span><br><span class="line">扩展命令功能的选项</span><br><span class="line">参数</span><br><span class="line"></span><br><span class="line">ls</span><br><span class="line">ls -a    </span><br><span class="line">ls -a    ~/.bashrc</span><br><span class="line">ls -a  -l  ~/.bashrc</span><br><span class="line">ls -al  ~/.bashrc</span><br></pre></td></tr></table></figure>

<h3 id="回显式命令"><a href="#回显式命令" class="headerlink" title="回显式命令"></a>回显式命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">date +%Y%m%d</span><br><span class="line">date +%Y-%m-%d</span><br></pre></td></tr></table></figure>

<h3 id="交互式命令"><a href="#交互式命令" class="headerlink" title="交互式命令"></a>交互式命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd</span><br></pre></td></tr></table></figure>

<h3 id="tab补全"><a href="#tab补全" class="headerlink" title="tab补全"></a>tab补全</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">按一下是补全</span><br><span class="line">按两下列出可用命令</span><br><span class="line">tab键  输入单词或命令前面几个首字母后，保证唯一可补全，不唯一可列出能选择的命令</span><br></pre></td></tr></table></figure>

<h3 id="历史命令-history"><a href="#历史命令-history" class="headerlink" title="历史命令-history"></a>历史命令-history</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">env--能容纳1000条</span><br><span class="line">[root@servera ~]# env | grep SIZE</span><br><span class="line">HISTSIZE=1000</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@servera ~]# history -w </span><br><span class="line">[root@servera ~]# vim ~/.bash_history     记录历史命令文件，vim是一个文本工具，可以打开后面的文件，进入后:q退出</span><br><span class="line">[root@servera ~]# history -c   清除</span><br><span class="line">[root@servera ~]# history </span><br><span class="line">history的其他方法：</span><br><span class="line">！！</span><br><span class="line">！23    历史命令的编号</span><br><span class="line">！h      命令首字母</span><br><span class="line"></span><br><span class="line">当前历史命令支持的最大条数</span><br><span class="line">[root@foundation0 /]# grep ^HISTSIZE /etc/profile</span><br><span class="line">HISTSIZE=1000</span><br><span class="line"></span><br><span class="line">历史命令存放文件路径</span><br><span class="line">[root@foundation0 /]# set | grep HISTFILE</span><br><span class="line">HISTFILE=/root/.bash_history</span><br><span class="line">vim /etc/profile</span><br><span class="line">export HISTFILE=/root/.newfile</span><br><span class="line">source /etc/profile</span><br><span class="line">history -w</span><br><span class="line">cat /root/.newfile</span><br><span class="line"></span><br><span class="line">ctrl+R 搜索历史命令</span><br></pre></td></tr></table></figure>

<h2 id="1-7-命令行快捷键"><a href="#1-7-命令行快捷键" class="headerlink" title="1.7 命令行快捷键"></a>1.7 命令行快捷键</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ctrl+shift+t               #当前画面添加一个标签</span><br><span class="line">ctrl+shift+n               #打开一个新的标签</span><br><span class="line">alt+1，alt+2               #切换标签</span><br><span class="line">ctrl+shift+ =，ctrl+ -     #扩大终端字体，缩小字体</span><br><span class="line">ctrl+shift+w               #关闭标签</span><br></pre></td></tr></table></figure>

<h2 id="1-8-Bash-Shell常用的快捷键"><a href="#1-8-Bash-Shell常用的快捷键" class="headerlink" title="1.8 Bash Shell常用的快捷键"></a>1.8 Bash Shell常用的快捷键</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ctrl+a     #光标跳至行首</span><br><span class="line">ctrl+e     #光标跳至行尾</span><br><span class="line">ctrl+u     #从光标所在位置清空至行首</span><br><span class="line">ctrl+k           #从光标所在位置清空至行末</span><br><span class="line">ctrl+左箭头      #光标向左跳一个单词</span><br><span class="line">ctrl+右箭头      #光标向右跳一个单词</span><br><span class="line">ctrl+w                   #回删一个单词</span><br><span class="line">alt+d                    #删除光标后一个单词</span><br><span class="line">esc + . 或 alt + .       #调用之前使用过的路径，alt+.一直点可以向上翻阅路径</span><br></pre></td></tr></table></figure>

<h1 id="2-从命令行管理文件"><a href="#2-从命令行管理文件" class="headerlink" title="2 从命令行管理文件"></a>2 从命令行管理文件</h1><h2 id="2-1-Linux系统目录结构"><a href="#2-1-Linux系统目录结构" class="headerlink" title="2.1 Linux系统目录结构"></a>2.1 Linux系统目录结构</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">/目录下每个目录的作用:</span><br><span class="line">bin 用户可执行目录(命令 root 和 普通)</span><br><span class="line">sbin 系统可执行目录(命令 root)</span><br><span class="line">lib 库文件目录(32位)</span><br><span class="line">lib64 库文件目录(64位)</span><br><span class="line">dev 设备文件目录dev 设备文件目</span><br><span class="line">usr 应用程序目录</span><br><span class="line">var 服务器数据目录(数据 日志)</span><br><span class="line">srv 服务器数据目录</span><br><span class="line">etc 配置文件目录</span><br><span class="line">tmp 临时文件目录</span><br><span class="line">boot 服务器启动目录(内核和启动文件)</span><br><span class="line">media 媒介目录(u盘,cdrom)</span><br><span class="line">mnt 其他挂载点</span><br><span class="line">opt 第三方应用程序目录</span><br><span class="line">proc 伪文件系统(内核参数,进程信息,硬件信息)</span><br><span class="line">sys 伪文件系统(c 配置文件目录 内核参数,进程信息,硬件信息)</span><br><span class="line">run 进程锁目录</span><br><span class="line">root root管理员家目录</span><br><span class="line">home 普通用户家目录</span><br></pre></td></tr></table></figure>

<h2 id="2-2-文件类型"><a href="#2-2-文件类型" class="headerlink" title="2.2 文件类型"></a>2.2 文件类型</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">文件类型:(7种)</span><br><span class="line">- 普通文件 file</span><br><span class="line">d 目录文件 directory</span><br><span class="line">c 字符设备文件 character</span><br><span class="line">b 块设备文件 block</span><br><span class="line">s 套接字文件 socket</span><br><span class="line">p 管道文件 pipe</span><br><span class="line">l 符号链接文件(软链接) symbolic</span><br></pre></td></tr></table></figure>

<h2 id="2-3-通过文件名定位文件"><a href="#2-3-通过文件名定位文件" class="headerlink" title="2.3 通过文件名定位文件"></a>2.3 通过文件名定位文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@foundation0 home]# <span class="built_in">cd</span> /</span><br><span class="line">[root@foundation0 /]# <span class="built_in">cd</span> /etc/</span><br></pre></td></tr></table></figure>

<h2 id="2-4-路径的表示"><a href="#2-4-路径的表示" class="headerlink" title="2.4 路径的表示"></a>2.4 路径的表示</h2><pre><code>绝对路径 ,通常以/开头
例子：
根开头    cd /etc/sysconfig
相对路径
非根开头 cd  ..
</code></pre>
<h2 id="2-5-导航路径"><a href="#2-5-导航路径" class="headerlink" title="2.5 导航路径"></a>2.5 导航路径</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">pwd</span></span></span><br><span class="line">[root@foundation0 yum.repos.d]# pwd</span><br><span class="line">/etc/yum.repos.d</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd</span></span><br><span class="line"><span class="built_in">cd</span> -   返回之前的目录</span><br><span class="line"><span class="built_in">cd</span> or <span class="built_in">cd</span> ~  家目录</span><br><span class="line"><span class="built_in">cd</span> .    当前目录</span><br><span class="line"><span class="built_in">cd</span> ..    上一级目录</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">ls</span></span></span><br><span class="line">ls</span><br><span class="line">ls -a </span><br><span class="line">ls -a /home </span><br><span class="line">ls -a -l </span><br><span class="line">ls -al</span><br><span class="line">[root@foundation0 ~]# ls -a .viminfo</span><br><span class="line">.viminfo</span><br><span class="line">[root@foundation0 ~]# ls -a -l .viminfo</span><br><span class="line">-rw-------. 1 root root 2545 Mar 13 13:12 .viminfo</span><br><span class="line">[root@foundation0 ~]# ls -al .viminfo</span><br><span class="line">-rw-------. 1 root root 2545 Mar 13 13:12 .viminfo</span><br><span class="line">[root@foundation0 /]# ls -l -d /home</span><br><span class="line">drwxr-xr-x. 4 root root 30 Mar 13 11:38 /home</span><br><span class="line"></span><br><span class="line">ls -ld /opt</span><br><span class="line">ll -d  /opt</span><br><span class="line"></span><br><span class="line">alias</span><br></pre></td></tr></table></figure>

<h2 id="2-6-查看文件内容"><a href="#2-6-查看文件内容" class="headerlink" title="2.6 查看文件内容"></a>2.6 查看文件内容</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat    cat /etc/passwd                 将文件内容打印到屏幕上</span><br><span class="line">tail   tail /var/log/message            默认查看文件后10行。-F （追踪）指定文件不存在时再创建相同名称文件</span><br><span class="line">       tail -n 5 或 tail -5 /var/log/message   </span><br><span class="line">head   head /var/log/message  默认查看文件头10行</span><br><span class="line">       head -5 /var/log/message                </span><br><span class="line">less   less /var/log/message           </span><br><span class="line">more   more /var/log/message         </span><br><span class="line">vim    vim /etc/passwd                 文本编辑器</span><br></pre></td></tr></table></figure>

<h2 id="2-7-使用命令行管理文件-目录"><a href="#2-7-使用命令行管理文件-目录" class="headerlink" title="2.7 使用命令行管理文件&#x2F;目录"></a>2.7 使用命令行管理文件&#x2F;目录</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> 创建   touch   mkdir -p</span><br><span class="line"> 改名   mv      mv</span><br><span class="line"> 移动   mv      mv</span><br><span class="line"> 拷贝   cp      cp -r</span><br><span class="line"> 删除   rm      rm -r</span><br><span class="line">touch、mkdir、rm、cp、mv</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">touch：</span><br><span class="line">[root@servera ~]# cd /opt/</span><br><span class="line">[root@servera opt]# pwd</span><br><span class="line">/opt</span><br><span class="line">[root@servera opt]# ls</span><br><span class="line">[root@servera opt]# man touch</span><br><span class="line">[root@servera opt]# touch file1</span><br><span class="line">[root@servera opt]# ls</span><br><span class="line">file1</span><br><span class="line">[root@servera opt]# touch file2 file3</span><br><span class="line">[root@servera opt]# ls</span><br><span class="line">file1  file2  file3</span><br><span class="line">[root@servera opt]# touch /file4 /tmp/file5</span><br><span class="line">[root@servera opt]# ls /file4;ls /tmp/file5</span><br><span class="line">/file4</span><br><span class="line">/tmp/file5</span><br><span class="line">[root@servera opt]# touch file&#123;10..20&#125;</span><br><span class="line">[root@servera opt]# ls</span><br><span class="line">file1   file11  file13  file15  file17  file19  file20</span><br><span class="line">file10  file12  file14  file16  file18  file2   file3</span><br><span class="line">a1.txt a2.txt a3.txt b1.txt.....c3.txt</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">mkdir</span><br><span class="line">选项：</span><br><span class="line">-p：递归创建</span><br><span class="line">-v：显示过程</span><br><span class="line">[root@servera opt]# rm -f file* </span><br><span class="line">[root@servera opt]# ls</span><br><span class="line">[root@servera opt]# man mkdir</span><br><span class="line">[root@servera opt]# mkdir dir1</span><br><span class="line">[root@servera opt]# ls</span><br><span class="line">dir1</span><br><span class="line">[root@servera opt]# mkdir dir2 /dir3</span><br><span class="line">[root@servera opt]# ls</span><br><span class="line">dir1  dir2</span><br><span class="line">[root@servera opt]# ls /</span><br><span class="line">bin   dir3   home   media  proc  sbin  tmp</span><br><span class="line">boot  etc    lib    mnt    root  srv   usr</span><br><span class="line">dev   file4  lib64  opt    run   sys   var</span><br><span class="line">[root@servera opt]# ls</span><br><span class="line">dir1  dir2</span><br><span class="line">[root@servera opt]# mkdir dir3/dir4</span><br><span class="line">mkdir: cannot create directory ‘dir3/dir4’: No such file or directory</span><br><span class="line">[root@servera opt]# mkdir -pv dir3/dir4</span><br><span class="line">mkdir: created directory &#x27;dir3&#x27;</span><br><span class="line">mkdir: created directory &#x27;dir3/dir4&#x27;</span><br><span class="line">[root@servera opt]# ls -R dir3  #-R递归查看，可以查看多级目录内容</span><br><span class="line">dir3:</span><br><span class="line">dir4</span><br><span class="line"></span><br><span class="line">dir3/dir4:</span><br><span class="line">[root@servera opt]# ll -R dir3/dir4</span><br><span class="line">dir3/dir4:</span><br><span class="line">total 0</span><br><span class="line">[root@servera opt]# ll  dir3</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x. 2 root root 6 Mar 13 22:23 dir4</span><br><span class="line">[root@servera opt]# ll  dir3/dir4/</span><br><span class="line">total 0</span><br><span class="line">[root@servera opt]# ll  dir3/dir4/ -d</span><br><span class="line">drwxr-xr-x. 2 root root 6 Mar 13 22:23 dir3/dir4/</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">rm</span><br><span class="line">[root@servera opt]# man rm</span><br><span class="line">[root@servera opt]# ls</span><br><span class="line">dir1  dir2  dir3  file1  file2  file3</span><br><span class="line">[root@servera opt]# rm file1</span><br><span class="line">rm: remove regular empty file &#x27;file1&#x27;? y    询问是否删除y删除n不删除</span><br><span class="line">[root@servera opt]# ls</span><br><span class="line">dir1  dir2  dir3  file2  file3</span><br><span class="line">[root@servera opt]# rm file2</span><br><span class="line">rm: remove regular empty file &#x27;file2&#x27;? n</span><br><span class="line">[root@servera opt]# rm -f file2         强制删除不询问</span><br><span class="line">[root@servera opt]# ls</span><br><span class="line">dir1  dir2  dir3  file3</span><br><span class="line">[root@servera opt]# rm -f file*         *代表一个或多个字符</span><br><span class="line">[root@servera opt]# ls</span><br><span class="line">dir1  dir2  dir3</span><br><span class="line">[root@servera opt]# rm dir1             </span><br><span class="line">rm: cannot remove &#x27;dir1&#x27;: Is a directory</span><br><span class="line">[root@servera opt]# rm -r dir1          删除目录需要-r表示递归</span><br><span class="line">rm: remove directory &#x27;dir1&#x27;? y</span><br><span class="line">[root@servera opt]# rm -rf dir2</span><br><span class="line">[root@servera opt]# ls</span><br><span class="line">dir3</span><br><span class="line"></span><br><span class="line">copy</span><br><span class="line">[root@servera opt]# ls</span><br><span class="line">dir1  dir2  file1  file2  file3</span><br><span class="line">[root@servera opt]# cp file1 /tmp/</span><br><span class="line">[root@servera opt]# ls /tmp/file1</span><br><span class="line">/tmp/file1</span><br><span class="line">[root@servera opt]# cp file1 /tmp/file10</span><br><span class="line">[root@servera opt]# ls /tmp/file10</span><br><span class="line">/tmp/file10</span><br><span class="line">[root@servera opt]# cp /etc/man_db.conf .</span><br><span class="line">[root@servera opt]# ls</span><br><span class="line">dir1  dir2  file1  file2  file3  man_db.conf</span><br><span class="line">[root@servera opt]# cp file2 file3 /tmp/</span><br><span class="line">[root@servera opt]# ls /tmp/file*</span><br><span class="line">/tmp/file1   /tmp/file2  /tmp/file5</span><br><span class="line">/tmp/file10  /tmp/file3</span><br><span class="line">[root@servera opt]# cp -r dir1 /tmp/</span><br><span class="line">[root@servera opt]# cp -r dir1 /tmp/di10</span><br><span class="line"></span><br><span class="line">[root@servera opt]# cp /home/student/.bashrc  /opt/</span><br><span class="line">[root@servera opt]# ll -a </span><br><span class="line">[root@servera opt]# cp -p /home/student/.bashrc ./.bashrc1</span><br><span class="line">[root@servera opt]# ll -a</span><br><span class="line"></span><br><span class="line">mv</span><br><span class="line">[root@servera opt]# ls</span><br><span class="line">dir1  dir2  file1  file2  file3  man_db.conf</span><br><span class="line">[root@servera opt]# mv file1 /</span><br><span class="line">[root@servera opt]# ls</span><br><span class="line">dir1  dir2  file2  file3  man_db.conf</span><br><span class="line">[root@servera opt]# mv file2 /file20</span><br><span class="line">[root@servera opt]# ls</span><br><span class="line">dir1  dir2  file3  man_db.conf</span><br><span class="line">[root@servera opt]# mv file3 file30</span><br><span class="line">[root@servera opt]# ls</span><br><span class="line">dir1  dir2  file30  man_db.conf</span><br><span class="line">[root@servera opt]# mv dir1 /</span><br><span class="line">[root@servera opt]# ls</span><br><span class="line">dir2  file30  man_db.conf</span><br><span class="line">[root@servera opt]# mv dir2 dir20</span><br><span class="line">[root@servera opt]# ls</span><br><span class="line">dir20  file30  man_db.conf</span><br></pre></td></tr></table></figure>

<h2 id="2-8-通配符"><a href="#2-8-通配符" class="headerlink" title="2.8 通配符"></a>2.8 通配符</h2><p>通配符</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通配符规则</span></span><br><span class="line">*       匹配0个或多个任意字符</span><br><span class="line">？      匹配1个任意字符</span><br><span class="line">[ ]     匹配中括号内一个字符</span><br><span class="line">[ - ]   匹配中括号内连续范围的一个字符</span><br><span class="line">[ ^ ]   取反。匹配非中括号内的字符，表示一定有一个字符，但不是中括号内出现的。【^ab】</span><br><span class="line">&#123;a,b&#125;或&#123;a..c&#125;     匹配号中的字符，或连续的字符</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@servera opt]# rm -rf *</span><br><span class="line">[root@servera opt]# touch &#123;a..c&#125;&#123;1..3&#125;.txt</span><br><span class="line">[root@servera opt]# ls</span><br><span class="line">a1.txt  a3.txt  b2.txt  c1.txt  c3.txt</span><br><span class="line">a2.txt  b1.txt  b3.txt  c2.txt</span><br><span class="line">[root@servera opt]# ls *.txt</span><br><span class="line">a1.txt  a3.txt  b2.txt  c1.txt  c3.txt</span><br><span class="line">a2.txt  b1.txt  b3.txt  c2.txt</span><br><span class="line">[root@servera opt]# ls a*</span><br><span class="line">a1.txt  a2.txt  a3.txt</span><br><span class="line">[root@servera opt]# ls a?.txt</span><br><span class="line">a1.txt  a2.txt  a3.txt</span><br><span class="line">[root@servera opt]# ls ?2*</span><br><span class="line">a2.txt  b2.txt  c2.txt</span><br><span class="line">[root@servera opt]# ls ?[23]*</span><br><span class="line">a2.txt  a3.txt  b2.txt  b3.txt  c2.txt  c3.txt</span><br><span class="line">[root@servera opt]# ls ?[^23]*</span><br><span class="line">a1.txt  b1.txt  c1.txt</span><br><span class="line">[root@servera opt]# ls ?[!23]*</span><br><span class="line">a1.txt  b1.txt  c1.txt</span><br><span class="line">[root@servera opt]# ls &#123;a1,b1&#125;*</span><br><span class="line">a1.txt  b1.txt</span><br><span class="line">[root@servera opt]# ls &#123;a..c&#125;*</span><br><span class="line">a1.txt  a3.txt  b2.txt  c1.txt  c3.txt</span><br><span class="line">a2.txt  b1.txt  b3.txt  c2.txt</span><br><span class="line">[root@servera opt]# ls [[:alpha:]]*</span><br><span class="line">a1.txt  a3.txt  b2.txt  c1.txt  c3.txt</span><br><span class="line">a2.txt  b1.txt  b3.txt  c2.txt</span><br><span class="line">[root@servera opt]# ls [a-z]*</span><br><span class="line">a1.txt  a3.txt  b2.txt  c1.txt  c3.txt</span><br><span class="line">a2.txt  b1.txt  b3.txt  c2.txt</span><br><span class="line">[root@servera opt]# ls [A-Z]*</span><br><span class="line">b1.txt  b2.txt  b3.txt  c1.txt  c2.txt  c3.txt</span><br></pre></td></tr></table></figure>

<h1 id="3-在线获取帮助"><a href="#3-在线获取帮助" class="headerlink" title="3 在线获取帮助"></a>3 在线获取帮助</h1><h2 id="3-1-MAN帮助手册"><a href="#3-1-MAN帮助手册" class="headerlink" title="3.1 MAN帮助手册"></a>3.1 MAN帮助手册</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">man 1 用户命令 *</span><br><span class="line">man 2 系统调用</span><br><span class="line">man 3 库调用</span><br><span class="line">man 4 特殊文件</span><br><span class="line">man 5 配置文件 *</span><br><span class="line">man 6 游戏</span><br><span class="line">man 7 杂项</span><br><span class="line">man 8 系统命令 *</span><br></pre></td></tr></table></figure>

<h2 id="3-2-–help"><a href="#3-2-–help" class="headerlink" title="3.2 –help"></a>3.2 –help</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">man passwd</span><br><span class="line">man -k passwd </span><br><span class="line">mandb</span><br><span class="line">man -k passwd</span><br><span class="line">man 1 passwd</span><br><span class="line">man 5 passwd</span><br><span class="line">  </span><br><span class="line"><span class="built_in">ls</span> --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">man tar</span><br><span class="line">man setfacl | grep lisa</span><br><span class="line">man setfacl | grep -B 1  lisa</span><br><span class="line">setfacl --<span class="built_in">help</span> | grep \\-a</span><br><span class="line">setfacl --<span class="built_in">help</span> | grep -w \\-a  </span><br></pre></td></tr></table></figure>

<h2 id="3-3-Pinfo"><a href="#3-3-Pinfo" class="headerlink" title="3.3 Pinfo"></a>3.3 Pinfo</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">info</span><br><span class="line">pinfo   回车  u</span><br><span class="line">pinfo  ls</span><br></pre></td></tr></table></figure>

<h2 id="3-4-rpm包中提供帮助"><a href="#3-4-rpm包中提供帮助" class="headerlink" title="3.4 rpm包中提供帮助"></a>3.4 rpm包中提供帮助</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">yum install -y httpd</span><br><span class="line"></span><br><span class="line">rpm -qa | grep httpd</span><br><span class="line">rpm -ql 软件包名称</span><br><span class="line">rpm -qc</span><br><span class="line"></span><br><span class="line">http tools install </span><br><span class="line">servera</span><br><span class="line">classroom和bastion</span><br><span class="line">yum install -y httpd-manual</span><br><span class="line">systemctl start servera</span><br><span class="line">允许http，或关闭防火墙</span><br><span class="line"></span><br><span class="line">found：http：//172.25.250.10/manual</span><br></pre></td></tr></table></figure>

<h2 id="3-5-在线帮助"><a href="#3-5-在线帮助" class="headerlink" title="3.5 在线帮助"></a>3.5 在线帮助</h2><p><a target="_blank" rel="noopener" href="https://access.redhat.com/">https://access.redhat.com/</a></p>
<h1 id="4-创建、查看编辑文本"><a href="#4-创建、查看编辑文本" class="headerlink" title="4 创建、查看编辑文本"></a>4 创建、查看编辑文本</h1><h2 id="4-1-VIM文本编辑器"><a href="#4-1-VIM文本编辑器" class="headerlink" title="4.1 VIM文本编辑器"></a>4.1 VIM文本编辑器</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">  模式       功能</span>                 </span><br><span class="line">  命令模式   光标移动、复制删除   cmd</span><br><span class="line">  输入模式   输入文本内容         a</span><br><span class="line">  末行模式   保存退出、设置环境   </span><br></pre></td></tr></table></figure>

<h2 id="4-2-命令模式"><a href="#4-2-命令模式" class="headerlink" title="4.2 命令模式"></a>4.2 命令模式</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 命令          解释</span></span><br><span class="line">  h j k l       左下上右</span><br><span class="line">  方向键        上下左右</span><br><span class="line">  1G、nG        n代表一个数字，去第1行或n行</span><br><span class="line">  gg            将光标定位到文章的顶端</span><br><span class="line">  G             将光标定位到文章的底端</span><br><span class="line">                （\$定位光标到行尾，0和\^定位光标到行首）</span><br><span class="line">  x，X          向后删除，向前删除一个字符</span><br><span class="line">  dd ， ndd     删除1行，n是一个数字，n行 。 例子：dgg dG d\$ d0 D</span><br><span class="line">  yy，nyy       复制1行，n行</span><br><span class="line">  p，P          粘贴到下一行，粘贴到上一行</span><br><span class="line">  u             撤销</span><br><span class="line">  ZZ            保存退出 按键ZZ</span><br></pre></td></tr></table></figure>

<h2 id="4-3-插入模式"><a href="#4-3-插入模式" class="headerlink" title="4.3 插入模式"></a>4.3 插入模式</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a   字符后进入插入模式</span><br><span class="line">i   当前字符位置进入插入模式</span><br><span class="line">o   在下一行新创建一行进入插入模式</span><br><span class="line">A   在行尾进入插入模式</span><br><span class="line">I   在行首进入插入模式</span><br><span class="line">O   在上一行新创建一行进入插入模式</span><br><span class="line">s   删除光标位置字符并进入插入模式</span><br><span class="line">S   删除光标所在行并进入插入模式</span><br></pre></td></tr></table></figure>

<h2 id="4-4-末行模式"><a href="#4-4-末行模式" class="headerlink" title="4.4 末行模式"></a>4.4 末行模式</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">w              保存</span><br><span class="line">q              退出</span><br><span class="line">wq             退出并保存</span><br><span class="line">q！            强制退出</span><br><span class="line">x              保存退出</span><br><span class="line">set nu         设置行号</span><br><span class="line">set nonu       取消行号</span><br><span class="line">：w /newfile   另存为其他文件 例子：&quot;:w /man.txt&quot;</span><br><span class="line">：r /newfile   读取/newfile到本文件中 例子： &quot;:r /etc/passwd&quot;</span><br><span class="line">：！ command   vim编辑过程中，查询linux &quot;:! ls /&quot;</span><br><span class="line">: e！          重新读取文件</span><br></pre></td></tr></table></figure>

<h2 id="4-5-其他模式"><a href="#4-5-其他模式" class="headerlink" title="4.5 其他模式"></a>4.5 其他模式</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">v、V或Ctrl+V    可视模式</span><br><span class="line">R               替换模式</span><br><span class="line">/word，？word   /向下查找，？向上查找</span><br><span class="line">n，N            定位到下一个匹配字符，定位到上一个匹配字符</span><br></pre></td></tr></table></figure>

<h2 id="4-6-视图模式"><a href="#4-6-视图模式" class="headerlink" title="4.6 视图模式"></a>4.6 视图模式</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">视图模式修改方法：</span><br><span class="line">ctrl+v ， jjj，I，  写入#号，esc</span><br></pre></td></tr></table></figure>

<h2 id="4-7-缩进-永久保存"><a href="#4-7-缩进-永久保存" class="headerlink" title="4.7 缩进+永久保存"></a>4.7 缩进+永久保存</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">：set all         查看末行模式的帮助</span><br><span class="line">：set autoindent  保存上下缩进</span><br><span class="line">：set tabstop=2   调整tab键缩进</span><br><span class="line">：set nu          设置行号</span><br><span class="line"></span><br><span class="line">[root@foundation0 ~]# vim ~/.vimrc    仅对当前用户生效</span><br><span class="line"></span><br><span class="line">set nu</span><br><span class="line">set tabstop=2</span><br><span class="line"></span><br><span class="line">[root@foundation0 ~]# vim /etc/vimrc  全局设置，每个用户使用vim工具都有行号</span><br><span class="line"></span><br><span class="line">set nu</span><br></pre></td></tr></table></figure>

<h2 id="4-8-替换"><a href="#4-8-替换" class="headerlink" title="4.8 替换"></a>4.8 替换</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">:s///   @@@  AAA  ; ;;</span><br><span class="line">:s/old/new/</span><br><span class="line">:s/old/new/g</span><br><span class="line">:#,#s/old/new/g     <span class="comment">#井号代表一个数字比如：1,5s/old/new/g</span></span><br><span class="line">:%s/old/new/g</span><br><span class="line">:#,<span class="variable">$s</span>/old/new/g    <span class="comment">#井号代表数字，比如1，$s ，$代表末行，该命令为1行至末行</span></span><br><span class="line"></span><br><span class="line">修改某一段ip地址: %s/192.168.1/172.25.250/g</span><br><span class="line"></span><br><span class="line">取消文本中某个字段：:%s/10.10.10.10//g</span><br></pre></td></tr></table></figure>

<h2 id="4-9-重定向"><a href="#4-9-重定向" class="headerlink" title="4.9 重定向"></a>4.9 重定向</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">1=stand，2=error，&amp;=1+2</span><br><span class="line"><span class="built_in">pwd</span></span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line"><span class="built_in">echo</span> hello</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$SHELL</span></span><br><span class="line"><span class="built_in">echo</span> 12345</span><br><span class="line"><span class="built_in">echo</span> 123456 &gt; file1</span><br><span class="line"><span class="built_in">cat</span> file1</span><br><span class="line">grep root /etc/passwd</span><br><span class="line">grep root /etc/passwd &gt; /opt/a.txt</span><br><span class="line"><span class="built_in">cat</span> /opt/a.txt</span><br><span class="line">grep apache /etc/passwd</span><br><span class="line">grep apache /etc/passwd &gt; /opt/a.txt</span><br><span class="line"><span class="built_in">cat</span> a.txt</span><br><span class="line"><span class="built_in">echo</span> 123456</span><br><span class="line"><span class="built_in">echo</span> 123456 &gt;&gt; a.txt</span><br><span class="line"><span class="built_in">cat</span> a.txt</span><br><span class="line"><span class="built_in">echo</span> abcd 1&gt;&gt; a.txt</span><br><span class="line"><span class="built_in">cat</span> a.txt</span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line"><span class="built_in">cd</span> dir1</span><br><span class="line"><span class="built_in">cd</span> dir1 2&gt;  err</span><br><span class="line"><span class="built_in">cat</span> err</span><br><span class="line"><span class="built_in">cd</span> dir1 2&gt;  /dev/null</span><br><span class="line">find / -user studnet</span><br><span class="line">find / -user student</span><br><span class="line">find / -user student 2&gt; err</span><br><span class="line">vim err</span><br><span class="line">find / -user student 2&gt; err &gt; sta</span><br><span class="line">vim sta</span><br><span class="line">find / -user student &amp;&gt; share</span><br><span class="line">vim share</span><br><span class="line">grep na /etc/resolv.conf</span><br><span class="line">vim /etc/resolv.conf</span><br><span class="line">grep ^$ /etc/resolv.conf</span><br><span class="line"><span class="built_in">cat</span> -n /etc/resolv.conf</span><br><span class="line"><span class="built_in">cat</span> -n /etc/resolv.conf  | grep ^$</span><br><span class="line"><span class="built_in">cat</span> -n /etc/resolv.conf</span><br><span class="line">vim ~/.vimrc</span><br><span class="line"><span class="built_in">cat</span> -n /etc/resolv.conf</span><br><span class="line"><span class="built_in">cat</span>  /etc/resolv.conf</span><br><span class="line">grep -n ^$ /etc/resolv.conf</span><br><span class="line">grep na /etc/resolv.conf</span><br><span class="line"><span class="built_in">ls</span> /root/</span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">grep na /etc/resolv.conf</span><br><span class="line">grep na /etc/resolv.conf   &gt; /root/lines.txt</span><br><span class="line"><span class="built_in">cat</span> /root/lines.txt</span><br><span class="line"><span class="built_in">history</span> -w</span><br><span class="line">tc/resolv.conf   &gt; /root/lines.txt</span><br><span class="line"><span class="built_in">cat</span> /root/lines.txt                   </span><br></pre></td></tr></table></figure>

<h1 id="5-管理本地用户和组"><a href="#5-管理本地用户和组" class="headerlink" title="5 管理本地用户和组"></a>5 管理本地用户和组</h1><h2 id="5-1-USER-用户"><a href="#5-1-USER-用户" class="headerlink" title="5.1 USER-用户"></a>5.1 USER-用户</h2><p>基本概念：用户用于访问计算机资源</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0          超级用户 </span><br><span class="line">1000以下   系统用户</span><br><span class="line">1000以上   普通用户 </span><br><span class="line">组与用户ID对应(自然创建)</span><br></pre></td></tr></table></figure>

<h3 id="useradd-添加用户"><a href="#useradd-添加用户" class="headerlink" title="useradd-添加用户"></a>useradd-添加用户</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">语法:useradd 选项 选项参数 用户名</span><br><span class="line"></span><br><span class="line">option：</span><br><span class="line">-u：指定用户uid</span><br><span class="line">-g：指定主要群组</span><br><span class="line">-G：指定附加群组</span><br><span class="line">-s：指定shell环境 /bin/bash /sbin/nolgoin /bin/false</span><br><span class="line">-c：指定描述</span><br><span class="line">-d：指定用户家目录(通常不更改，如果设置，需要是未存在的目录)</span><br><span class="line"></span><br><span class="line">例：</span><br><span class="line">useradd user1   创建user1</span><br><span class="line">passwd user1    为user1设置密码</span><br><span class="line"><span class="built_in">id</span> user1        查询用户信息</span><br></pre></td></tr></table></figure>

<h3 id="用户配置文件"><a href="#用户配置文件" class="headerlink" title="用户配置文件"></a>用户配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">用户配置文件路径:/etc/passwd</span><br><span class="line">[kiosk@foundation0 ~]$ vim /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">用户名：密码占位符：UID：GID：描述：家目录：shell环境</span><br><span class="line"></span><br><span class="line">练习1：   </span><br><span class="line">[root@servera /]# useradd -u 2000 user1</span><br><span class="line">[root@servera /]# <span class="built_in">id</span> user1</span><br><span class="line"></span><br><span class="line">[root@servera /]# groupadd group1</span><br><span class="line">[root@servera /]# <span class="built_in">tail</span> -1 /etc/group</span><br><span class="line">[root@servera /]# useradd -g group1 user2</span><br><span class="line">[root@servera /]# <span class="built_in">tail</span> -1 /etc/passwd</span><br><span class="line"></span><br><span class="line">[root@servera /]# useradd -G wheel user3</span><br><span class="line">[root@servera /]# useradd -c student -d /user4dir -s /sbin/nologin user4</span><br><span class="line">[root@servera /]# <span class="built_in">tail</span> -1 /etc/passwd</span><br><span class="line"></span><br><span class="line">[root@servera /]# su - user1</span><br><span class="line">[user1@servera /]# ctrl+d</span><br><span class="line">[root@servera /]# su - user1</span><br><span class="line">[root@servera /]# su - user2  需要密码</span><br><span class="line">[root@servera /]# ctrl+d  退出用户</span><br><span class="line"></span><br><span class="line">[root@servera /]# passwd user2  超级用户设置密码</span><br><span class="line">123456</span><br><span class="line">123456</span><br><span class="line">[root@servera /]# su - user1</span><br><span class="line">[root@servera /]# su - user2  输入密码</span><br><span class="line">[root@servera /]# useradd -G root,tom user5   <span class="comment">#将user5同时加入到组root和tom组中</span></span><br><span class="line"></span><br><span class="line">练习2：tom10，uid 3000 ，gid devops，shell环境为/bin/false,描述 student，家目录/tom10dir,附加组 root。</span><br><span class="line">答案：</span><br><span class="line">useradd -u 3000 -g devops -s /bin/false -c student -d /tom10dir -G root  tom10</span><br></pre></td></tr></table></figure>

<h3 id="usermod-修改用户"><a href="#usermod-修改用户" class="headerlink" title="usermod-修改用户"></a>usermod-修改用户</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">语法：usermod 选项 选项参数 用户名</span><br><span class="line"></span><br><span class="line">option：</span><br><span class="line">-u：指定用户uid</span><br><span class="line">-g：指定主要群组</span><br><span class="line">-G：指定附加群组</span><br><span class="line">-s：指定shell环境 /bin/bash  /sbin/nolgoin /bin/false</span><br><span class="line">-c：指定描述</span><br><span class="line">-d：指定用户家目录（通常不更改，且如设置需要是未存在的目录）</span><br><span class="line">-a：额外指定附加组</span><br><span class="line"></span><br><span class="line">练习1:</span><br><span class="line">[root@servera /]# usermod -u 3000 user1</span><br><span class="line">[root@servera /]# usermod -g group1 user1</span><br><span class="line">[root@servera /]# usermod -G root user1</span><br><span class="line">[root@servera /]# grep user1 /etc/group</span><br><span class="line">[root@servera /]# usermod -G root,wheel user1</span><br><span class="line">[root@servera /]# grep user1 /etc/group</span><br><span class="line">[root@servera /]# groupadd group2</span><br><span class="line">[root@servera /]# usermod -a -G group2 user1</span><br><span class="line">[root@servera /]# grep user1 /etc/group</span><br><span class="line">[root@servera /]# usermod -s /bin/false user1    <span class="comment">#shell环境为/bin/false的用户和系统无任何交互</span></span><br><span class="line">[root@servera /]# su - user1</span><br><span class="line">[root@servera /]# usermod -c heihei user1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">练习2：tom11的附加组，root。想额外添加一个附加组为devops。</span><br><span class="line">答案：</span><br><span class="line">[root@servera opt]# usermod -a -G root tom11</span><br><span class="line">[root@servera opt]# usermod -G root,devops tom11</span><br></pre></td></tr></table></figure>

<h3 id="userdel-删除用户"><a href="#userdel-删除用户" class="headerlink" title="userdel-删除用户"></a>userdel-删除用户</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">语法：userdel 选项 选项参数  用户名</span><br><span class="line"></span><br><span class="line">option：</span><br><span class="line">-r：删除用户同时删除邮箱和家目录</span><br><span class="line"></span><br><span class="line">练习:</span><br><span class="line">[root@servera /]# useradd user5</span><br><span class="line">[root@servera /]# find / -user user5</span><br><span class="line">[root@servera /]# userdel -r user5</span><br><span class="line">[root@servera /]# find / -user user5</span><br></pre></td></tr></table></figure>

<h2 id="5-2-PASSWORD-密码"><a href="#5-2-PASSWORD-密码" class="headerlink" title="5.2 PASSWORD-密码"></a>5.2 PASSWORD-密码</h2><h3 id="passwd"><a href="#passwd" class="headerlink" title="passwd"></a>passwd</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">语法:passwd 用户名</span><br><span class="line">方法1：</span><br><span class="line">[root@foundation0 /]# useradd zhangsan   #创建用户</span><br><span class="line">[root@foundation0 /]# echo 123456 | passwd --stdin zhangsan  非交互式</span><br><span class="line">Changing password for user zhangsan.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line">方法2：</span><br><span class="line">[root@foundation0 /]# passwd zhangsan  交互式</span><br></pre></td></tr></table></figure>

<h3 id="密码配置文件"><a href="#密码配置文件" class="headerlink" title="密码配置文件"></a>密码配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">路径:/etc/shadow</span><br><span class="line">user2:$6$9R47OYVVaxga34EJ<span class="variable">$Y3pGf5EnHpn6vfiBk5ZU1U89d7UiySOsnAs</span>/fkFMuPRyhCZAvv0a6UXRVLGXqRUKwP34Sg0W/CYb1VQp7H08L0:20015:0:99999:7:::</span><br><span class="line"></span><br><span class="line">说明:</span><br><span class="line">第一列: 用户名</span><br><span class="line">第二列: 密码(有密码状态,无密码状态,!!帐号锁定,* 该帐号永久不能登陆系统)</span><br><span class="line">第三列: 密码的最后一次修改时间（从1970年1月1日至今的天数）18834=今天</span><br><span class="line">第四列: 密码的最小时间(和第三列比较，密码修改相隔时间，或理解为密码自最后一次修改后多少天内不能再重复修改)</span><br><span class="line">第五列: 密码的最大时间(密码有效期) 99999表示永久不过期(和第3列比，相当于自最后一次修改多久后必须变更密码，否则过期)</span><br><span class="line">第六列: 密码过期前警告时间（和第5列比，在过n天你的密码就过期了，需要重设密码。）</span><br><span class="line">第七列: 密码过期后帐号（宽限时间，第五列密码的最大时间到期后，还可以使用系统的宽限时间，该期间中可以继续使用系统，但是再次登入系统时强制修改密码，否则无法进入）</span><br><span class="line">第八列: 帐号有效期（账号失效后，无论密码是否过期都不能使用。）</span><br><span class="line">第九列: 保留列</span><br><span class="line"></span><br><span class="line">练习:</span><br><span class="line">设置密码：</span><br><span class="line">1.交互式</span><br><span class="line">语法：passwd 用户名</span><br><span class="line">[root@servera /]# passwd user1</span><br><span class="line"></span><br><span class="line">2.非交互式</span><br><span class="line">语法：<span class="built_in">echo</span> xxx | passwd --stdin username </span><br><span class="line">[root@servera /]# <span class="built_in">echo</span> 123456 | passwd --stdin user1</span><br><span class="line">Changing password <span class="keyword">for</span> user user1.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br></pre></td></tr></table></figure>

<h2 id="5-3-GROUP-用户组"><a href="#5-3-GROUP-用户组" class="headerlink" title="5.3 GROUP-用户组"></a>5.3 GROUP-用户组</h2><h3 id="groupadd"><a href="#groupadd" class="headerlink" title="groupadd"></a>groupadd</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line">groupadd 选项 选项参数 组名</span><br><span class="line">-g：指定组ID</span><br><span class="line">例：</span><br><span class="line">[root@servera /]# groupadd group10</span><br><span class="line">[root@servera /]# groupadd -g 3000 group11</span><br></pre></td></tr></table></figure>

<h3 id="groupmod"><a href="#groupmod" class="headerlink" title="groupmod"></a>groupmod</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line">groupmod 选项 选项参数 组名</span><br><span class="line">-n：更改组名 groupmod -n 新组名 旧组名</span><br><span class="line">例：</span><br><span class="line">[root@servera /]# groupmod -n group100 group10</span><br><span class="line">[root@servera /]# </span><br></pre></td></tr></table></figure>

<h3 id="groupdel"><a href="#groupdel" class="headerlink" title="groupdel"></a>groupdel</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除组信息</span></span><br><span class="line">groupdel groupname</span><br><span class="line">[root@foundation0 ~]# groupdel haha1</span><br><span class="line">[root@foundation0 ~]# grep haha1 /etc/group</span><br></pre></td></tr></table></figure>

<h3 id="gpasswd"><a href="#gpasswd" class="headerlink" title="gpasswd"></a>gpasswd</h3><p>加入群组与清除群组成员</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">gpasswd</span><br><span class="line">-a：添加用户到群组</span><br><span class="line">-d：从组中清除用户</span><br><span class="line"></span><br><span class="line">[root@foundation0 ~]# useradd -G upup user5  添加用户时指定附加组（次要群组）</span><br><span class="line">[root@foundation0 ~]# usermod -G upup user1  修改用户时指定附加组（次要群组） </span><br><span class="line">[root@foundation0 ~]# gpasswd -a user2 root</span><br><span class="line">Adding user user2 to group root</span><br><span class="line">[root@foundation0 ~]# gpasswd -d user2 root</span><br><span class="line">Removing user user2 from group root</span><br></pre></td></tr></table></figure>

<h3 id="用户组配置文件"><a href="#用户组配置文件" class="headerlink" title="用户组配置文件"></a>用户组配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">路径:/etc/group</span><br><span class="line">[root@localhost ~]# vim /etc/group</span><br><span class="line">upup:x:2006:</span><br><span class="line">第一段: 组名</span><br><span class="line">第二段: 组密码占位符号</span><br><span class="line">第三段: gid</span><br><span class="line">第四段: 用户列表</span><br></pre></td></tr></table></figure>

<h3 id="su-切换用户"><a href="#su-切换用户" class="headerlink" title="su-切换用户"></a>su-切换用户</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">su  -</span><br><span class="line">su  - root</span><br><span class="line">su  - user1     su - user2  需要密码</span><br></pre></td></tr></table></figure>

<h3 id="模拟练习"><a href="#模拟练习" class="headerlink" title="模拟练习"></a>模拟练习</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">groupadd sysmgrs</span><br><span class="line">useradd -G    sysmgrs  natasha</span><br><span class="line">useradd -G    sysmgrs  harry</span><br><span class="line">useradd -s /bin/false sarah</span><br><span class="line"><span class="built_in">echo</span>  flectrag  | passwd --stdin natahsa</span><br><span class="line"><span class="built_in">echo</span>  flectrag  | passwd --stdin harry</span><br><span class="line"><span class="built_in">echo</span>  flectrag  | passwd --stdin sarah</span><br><span class="line"></span><br><span class="line">验证方式：通过切换用户，<span class="built_in">id</span> username，vim /etc/passwd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">修改密码重设默认天数：</span><br><span class="line">[root@servera ~]# useradd user10</span><br><span class="line">[root@servera ~]# chage -l user10</span><br><span class="line">Maximum number of days between password change      : 99999</span><br><span class="line">[root@servera ~]# vim /etc/login.defs </span><br><span class="line">PASS_MAX_DAYS   20</span><br><span class="line">[root@servera ~]# useradd user20</span><br><span class="line">[root@servera ~]# chage -l user20</span><br><span class="line">Maximum number of days between password change      : 20</span><br></pre></td></tr></table></figure>

<h2 id="5-4-重点总结"><a href="#5-4-重点总结" class="headerlink" title="5.4 重点总结"></a>5.4 重点总结</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">useradd  usermod userdel  ，<span class="built_in">id</span> 用户名，<span class="built_in">cat</span> /etc/passwd，</span><br><span class="line">groupadd groupmod  groupdel </span><br><span class="line">gpasswd -a   , -d  </span><br><span class="line"></span><br><span class="line">passwd 用户名  </span><br><span class="line"><span class="built_in">echo</span> xxx | passwd --stdin username </span><br><span class="line"></span><br><span class="line">用户 /etc/passwd, 用户组，/etc/group 密码 /etc/shadow</span><br><span class="line">创建用户时的一些默认设置，/etc/default/useradd </span><br><span class="line">/etc/login.defs </span><br></pre></td></tr></table></figure>

<h1 id="6-控制对文件的访问"><a href="#6-控制对文件的访问" class="headerlink" title="6 控制对文件的访问"></a>6 控制对文件的访问</h1><h2 id="6-1-关于系统安全的技术点对比"><a href="#6-1-关于系统安全的技术点对比" class="headerlink" title="6.1 关于系统安全的技术点对比"></a><strong>6.1 关于系统安全的技术点对比</strong></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Linux操作系统涉及的安全部分:           </span><br><span class="line">  防火墙                                semanage port ，</span><br><span class="line">  selinux                               semanage ...</span><br><span class="line">  软件app                               semanage boolean</span><br><span class="line">  文件系统权限 特殊权限 facl 隐藏权限    semanage fcontext</span><br></pre></td></tr></table></figure>

<h2 id="6-2-Linux文件权限"><a href="#6-2-Linux文件权限" class="headerlink" title="6.2 Linux文件权限"></a>6.2 Linux文件权限</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">权限分类：   </span><br><span class="line"> r      <span class="built_in">read</span>(读)</span><br><span class="line"> w      write(写)</span><br><span class="line"> x      execute(执行)</span><br></pre></td></tr></table></figure>

<h2 id="6-3-Linux系统的权限表示"><a href="#6-3-Linux系统的权限表示" class="headerlink" title="6.3 Linux系统的权限表示"></a>6.3 Linux系统的权限表示</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ls -l test</span></span><br><span class="line">-rw-r--r--. 1 stu1 class1 35 May 21 14:09 <span class="built_in">test</span></span><br><span class="line">rw-r--r--   <span class="comment">#中间9位是权限，逻辑分三组，所有者 所属组 其他人权限</span></span><br><span class="line">stu1   所有者</span><br><span class="line">class1 所属组</span><br></pre></td></tr></table></figure>

<h2 id="6-4-Linux系统权限的作用"><a href="#6-4-Linux系统权限的作用" class="headerlink" title="6.4 Linux系统权限的作用"></a>6.4 Linux系统权限的作用</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">权限   对文件的影响   对目录的影响</span><br><span class="line"> r      <span class="built_in">cat</span>            <span class="built_in">ls</span></span><br><span class="line"> w      vim            <span class="built_in">touch</span>，<span class="built_in">rm</span>，<span class="built_in">mkdir</span></span><br><span class="line"> x      ./script       <span class="built_in">cd</span></span><br></pre></td></tr></table></figure>

<h2 id="6-5-使用符号方式修改文件权限"><a href="#6-5-使用符号方式修改文件权限" class="headerlink" title="6.5 使用符号方式修改文件权限"></a>6.5 使用符号方式修改文件权限</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">对象       设置方式     权限</span><br><span class="line">u(user)    \+ (添加)    r</span><br><span class="line">g(group)   \- (减去）   w</span><br><span class="line">o(other)   = (设置）    x</span><br><span class="line">a(all)                  s(SUID、SGID)</span><br><span class="line">                        t(Sbit)</span><br></pre></td></tr></table></figure>

<h2 id="6-6-使用数字方式修改文件权限"><a href="#6-6-使用数字方式修改文件权限" class="headerlink" title="6.6 使用数字方式修改文件权限"></a>6.6 <strong>使用数字方式修改文件权限</strong></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rwx   8进制表示   数字表示</span><br><span class="line">----- ----------- ----------</span><br><span class="line">r--     100         4</span><br><span class="line">-w-     010         2</span><br><span class="line">--x     001         1</span><br></pre></td></tr></table></figure>

<h2 id="6-7-文件权限设置-chmod"><a href="#6-7-文件权限设置-chmod" class="headerlink" title="6.7 文件权限设置-chmod"></a>6.7 文件权限设置-chmod</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line"><span class="built_in">chmod</span> 权限 文件名</span><br><span class="line">u g o a   + - =   r w x s t</span><br><span class="line">例：</span><br><span class="line">[root@node1 /]# <span class="built_in">cd</span> /opt/</span><br><span class="line">[root@node1 opt]# <span class="built_in">ls</span></span><br><span class="line">[root@node1 opt]# <span class="built_in">touch</span> <span class="built_in">test</span></span><br><span class="line">[root@node1 opt]# ll <span class="built_in">test</span> </span><br><span class="line">-rw-r--r--. 1 root root 0 Nov 24 04:55 <span class="built_in">test</span></span><br><span class="line">[root@node1 opt]# <span class="built_in">chmod</span> u+x <span class="built_in">test</span> </span><br><span class="line">[root@node1 opt]# ll <span class="built_in">test</span> </span><br><span class="line">-rwxr--r--. 1 root root 0 Nov 24 04:55 <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<h3 id="练习1：文件权限修改"><a href="#练习1：文件权限修改" class="headerlink" title="练习1：文件权限修改"></a>练习1：文件权限修改</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">文件权限修改</span><br><span class="line">[root@node1 opt]# <span class="built_in">touch</span> aa.txt</span><br><span class="line">[root@node1 opt]# ll aa.txt   <span class="comment">#每次修改权限去自己检验查询</span></span><br><span class="line"></span><br><span class="line">[root@node1 opt]# <span class="built_in">chmod</span> u+x aa.txt</span><br><span class="line">[root@node1 opt]# <span class="built_in">chmod</span> u-rw aa.txt</span><br><span class="line">[root@node1 opt]# <span class="built_in">chmod</span> u+r,g+w,o+x aa.txt</span><br><span class="line">[root@node1 opt]# <span class="built_in">chmod</span> ug+rw aa.txt</span><br><span class="line">[root@node1 opt]# <span class="built_in">chmod</span> ugo+rwx aa.txt   <span class="comment"># chmod a+rwx , chmod a=rwx, ugo+rwx</span></span><br><span class="line">[root@node1 opt]# <span class="built_in">chmod</span> a-rwx aa.txt</span><br><span class="line">[root@node1 opt]# <span class="built_in">chmod</span> o=--- aa.txt     <span class="comment"># o=-</span></span><br><span class="line">[root@node1 opt]# <span class="built_in">chmod</span> u=r aa.txt</span><br><span class="line">[root@node1 opt]# <span class="built_in">chmod</span> u=rw aa.txt</span><br><span class="line">[root@node1 opt]# <span class="built_in">chmod</span> u=r,g=rw,o=x aa.txt</span><br><span class="line">[root@node1 opt]# <span class="built_in">chmod</span> ugo=rwx aa.txt</span><br><span class="line">[root@node1 opt]# <span class="built_in">chmod</span> a=r aa.txt</span><br></pre></td></tr></table></figure>

<h3 id="练习2：数字修改方法"><a href="#练习2：数字修改方法" class="headerlink" title="练习2：数字修改方法"></a>练习2：数字修改方法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">r  4</span><br><span class="line">w  2</span><br><span class="line">x  1</span><br><span class="line"></span><br><span class="line">[root@node1 opt]# <span class="built_in">mkdir</span> dir1</span><br><span class="line">[root@node1 opt]# ll -d dir1</span><br><span class="line">drwx r-x  r-x. 2 root root 6 Nov 24 05:04 dir1</span><br><span class="line">[root@node1 opt]# <span class="built_in">chmod</span> 775 dir1</span><br><span class="line">[root@node1 opt]# ll -d dir1</span><br><span class="line">drwxrwxr-x. 2 root root 6 Nov 24 05:04 dir1</span><br></pre></td></tr></table></figure>

<h2 id="6-8-设置文件属主和属组-chown"><a href="#6-8-设置文件属主和属组-chown" class="headerlink" title="6.8 设置文件属主和属组-chown"></a>6.8 设置文件属主和属组-chown</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line"><span class="built_in">chown</span>  所有者:所属组 文件名 </span><br><span class="line"><span class="built_in">chown</span>  该命令可以作用于文件、目录，修改时保证所有者的用户及组都是存在的。</span><br><span class="line">例:<span class="built_in">chown</span> user2:user2 newfile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 练习:</span></span><br><span class="line">[root@node1 opt]# ll <span class="built_in">test</span></span><br><span class="line">-rwxr--r--. 1 root root 0 Nov 24 04:55 <span class="built_in">test</span></span><br><span class="line">[root@node1 opt]# <span class="built_in">id</span> student</span><br><span class="line">uid=1000(student) gid=1000(student) <span class="built_in">groups</span>=1000(student),10(wheel)</span><br><span class="line"></span><br><span class="line">[root@node1 opt]# useradd harry</span><br><span class="line"></span><br><span class="line">[root@node1 opt]# <span class="built_in">chown</span> student <span class="built_in">test</span>;ll <span class="built_in">test</span></span><br><span class="line">-rwxr--r--. 1 student root 0 Nov 24 04:55 <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">[root@node1 opt]# <span class="built_in">chown</span> :harry <span class="built_in">test</span>;ll <span class="built_in">test</span></span><br><span class="line">-rwxr--r--. 1 student harry 0 Nov 24 04:55 <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">[root@node1 opt]# useradd sally</span><br><span class="line">[root@node1 opt]# <span class="built_in">chown</span> sally:sally <span class="built_in">test</span>;ll <span class="built_in">test</span></span><br><span class="line">-rwxr--r--. 1 sally sally 0 Nov 24 04:55 <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-R</span><br><span class="line">[root@node1 opt]# <span class="built_in">ls</span></span><br><span class="line">dir1  <span class="built_in">test</span></span><br><span class="line">[root@node1 opt]# <span class="built_in">touch</span> dir1/test2</span><br><span class="line">[root@node1 opt]# ll -d dir1</span><br><span class="line">drwxrwxr-x. 2 root root 19 Nov 24 05:15 dir1</span><br><span class="line">[root@node1 opt]# ll  dir1</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r--. 1 root root 0 Nov 24 05:15 test2</span><br><span class="line">[root@node1 opt]# <span class="built_in">chown</span> -R sally:sally dir1</span><br><span class="line">[root@node1 opt]# ll -d dir1</span><br><span class="line">drwxrwxr-x. 2 sally sally 19 Nov 24 05:15 dir1</span><br><span class="line"></span><br><span class="line">[root@node1 opt]# ll dir1/test2 </span><br><span class="line">-rw-r--r--. 1 sally sally 0 Nov 24 05:16 dir1/test2</span><br></pre></td></tr></table></figure>

<h2 id="6-9-文件默认权限-umask"><a href="#6-9-文件默认权限-umask" class="headerlink" title="6.9 文件默认权限-umask"></a>6.9 文件默认权限-umask</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">系统默认定义权限对于文件是666、对于目录是777</span><br><span class="line"></span><br><span class="line">查看<span class="built_in">umask</span>值方法</span><br><span class="line">[root@servera /]# <span class="built_in">umask</span></span><br><span class="line">0022</span><br><span class="line"></span><br><span class="line">修改方法<span class="built_in">umask</span></span><br><span class="line">[root@servera /]# <span class="built_in">umask</span> 0002</span><br><span class="line">修改完后，可以去文件和目录查看权限，看是否和之前不一样，看完改回来</span><br><span class="line"></span><br><span class="line">永久生效</span><br><span class="line">[root@servera /]# <span class="built_in">echo</span> <span class="string">&#x27;umask 0002&#x27;</span> &gt;&gt; ~/.bash_profile</span><br><span class="line">[root@servera /]# <span class="built_in">source</span> ~/.bash_profile  <span class="comment">#source 将后面文件中的值加载到当前shell中。系统登录会读取~/.bash_profile文件自动加载</span></span><br></pre></td></tr></table></figure>

<h3 id="umask的练习"><a href="#umask的练习" class="headerlink" title="umask的练习"></a>umask的练习</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#示例1：</span></span><br><span class="line">文件默认权限666</span><br><span class="line"><span class="built_in">umask</span>后三位022</span><br><span class="line">快捷方法：变成权限后相减</span><br><span class="line">rw-rw-rw-  =  666  文件系统默认权限</span><br><span class="line">----w--w-  =  022  <span class="built_in">umask</span>值</span><br><span class="line">------------------------------</span><br><span class="line">rw-r--r--  =  644  创建文件时的默认权限</span><br><span class="line"></span><br><span class="line">目录默认权限777</span><br><span class="line">rwxrwxrwx  =  777  目录系统默认权限</span><br><span class="line">----w--w-  =  022  <span class="built_in">umask</span>值</span><br><span class="line">------------------------------</span><br><span class="line">rwxr-xr-x  =  755  创建目录时的默认权限</span><br><span class="line">故系统中应设置为:0022</span><br><span class="line"></span><br><span class="line"><span class="comment">#示例2:</span></span><br><span class="line">文件权限是r-- --- ---， 400   文件夹是dr-x --- ---  500</span><br><span class="line"><span class="built_in">umask</span>?</span><br><span class="line"></span><br><span class="line">目录</span><br><span class="line">rwxrwxrwx =  777</span><br><span class="line">r-x------ =  500</span><br><span class="line">-------------------</span><br><span class="line">-w-rwxrwx =  277</span><br><span class="line"></span><br><span class="line">文件</span><br><span class="line">rw-rw-rw-  =  666</span><br><span class="line">-w-rwxrwx  =  <span class="built_in">umask</span>  </span><br><span class="line">------------------</span><br><span class="line">r-------   =  400</span><br><span class="line"></span><br><span class="line">参考<span class="built_in">umask</span>计算方法：https://www.cnblogs.com/wyllearning/p/16482006.html</span><br><span class="line">如果减法时目录和文件权限不一致时，以目录的为准计算<span class="built_in">umask</span>值</span><br></pre></td></tr></table></figure>

<h2 id="6-10-特殊权限"><a href="#6-10-特殊权限" class="headerlink" title="6.10 特殊权限"></a>6.10 特殊权限</h2><p>​          文件系统权限可以完成一些基本权限功能设置，但有些特殊要求是达不到的，可能需要特殊权限来完成</p>
<p>​         Linux系统中特殊权限有三个：SUID 4 、SGID 2 、SBIT 1</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">SUID  4 </span><br><span class="line">    通常设置在二进制可执行文件（命令）上，并具有执行权限的情况下</span><br><span class="line">    作用：设置了该权限的命令，被其他用户执行时，会临时获取文件所有者权限</span><br><span class="line">[student@clear ~]$ su - studnet</span><br><span class="line">[student@clear ~]$ <span class="built_in">cat</span> /etc/shadow   <span class="comment">#普通用户无法查看/etc/shadow</span></span><br><span class="line">[student@clear ~]$ su - root         <span class="comment">#切换root身份</span></span><br><span class="line">[root@clear ~]# <span class="built_in">chmod</span> u+s /usr/bin/cat   <span class="comment">#数字修改方式：chmod 4755 /usr/bin/cart</span></span><br><span class="line">[root@clear ~]# ll /usr/bin/cat</span><br><span class="line">-rwsr-xr-x. 1 root root 34512 Aug 13  2018 /usr/bin/cat</span><br><span class="line">[student@clear ~]$ su - studnet</span><br><span class="line">[student@clear ~]$ <span class="built_in">cat</span> /etc/shadow <span class="comment">#能够看见内容，临时获取拥有者权限</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> 4755 /usr/bin/cat</span><br><span class="line"></span><br><span class="line">SGID  2</span><br><span class="line">该权限通常设置在`目录`上，设置了该权限的目录，在该目录中创建`子文件及目录`时会`继承`父目录所属组。</span><br><span class="line">[root@clear ~]# <span class="built_in">cd</span> /opt/</span><br><span class="line">[root@clear opt]# <span class="built_in">ls</span></span><br><span class="line">[root@clear opt]# <span class="built_in">mkdir</span> dir1</span><br><span class="line">[root@clear opt]# <span class="built_in">chown</span> student:student dir1</span><br><span class="line">[root@clear opt]# ll -d dir1</span><br><span class="line">drwxr-xr-x. 2 student student 6 Nov 19 04:50 dir1</span><br><span class="line">[root@clear opt]# <span class="built_in">touch</span> dir1/root.txt</span><br><span class="line">[root@clear opt]# ll dir1/root.txt</span><br><span class="line">-rw-r--r--. 1 root root 0 Nov 19 04:51 dir1/root.txt</span><br><span class="line">[root@clear opt]# </span><br><span class="line">[root@clear opt]# <span class="built_in">chmod</span> g+s dir1</span><br><span class="line">[root@clear opt]# ll -d dir1</span><br><span class="line">drwxr-sr-x. 2 student student 22 Nov 19 04:51 dir1</span><br><span class="line">[root@clear opt]# <span class="built_in">touch</span> dir1/root1.txt</span><br><span class="line">[root@clear opt]# ll dir1/root1.txt</span><br><span class="line">-rw-r--r--. 1 root student 0 Nov 19 04:52 dir1/root1.txt</span><br><span class="line"></span><br><span class="line">数字修改法： <span class="built_in">chmod</span> 2755 dir1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SBIT（粘滞位） 1</span><br><span class="line">该权限通常设置在目录上，设置了该权限的目录，其他用户在该目录中只能删除所有者是自己的文件。</span><br><span class="line">[root@clear opt]# <span class="built_in">rm</span> -rf *</span><br><span class="line">[root@clear opt]# <span class="built_in">ls</span></span><br><span class="line">[root@clear opt]# <span class="built_in">mkdir</span> share</span><br><span class="line">[root@clear opt]# <span class="built_in">chmod</span> 777 share/</span><br><span class="line">[root@clear opt]# <span class="built_in">id</span> student</span><br><span class="line">uid=1000(student) gid=1000(student) <span class="built_in">groups</span>=1000(student),10(wheel)</span><br><span class="line">[root@clear opt]# useradd tom</span><br><span class="line">[root@clear opt]# <span class="built_in">id</span> tom</span><br><span class="line">uid=1005(tom) gid=1005(tom) <span class="built_in">groups</span>=1005(tom)</span><br><span class="line">[root@clear opt]# su - student</span><br><span class="line">Last login: Sat Nov 19 04:46:47 EST 2022 on pts/0</span><br><span class="line">[student@clear ~]$ <span class="built_in">touch</span> /opt/share/student.txt</span><br><span class="line">[student@clear ~]$ <span class="built_in">logout</span></span><br><span class="line">[root@clear opt]# su - tom</span><br><span class="line">[tom@clear ~]$ <span class="built_in">rm</span> -f /opt/share/student.txt</span><br><span class="line">[tom@clear ~]$ <span class="built_in">logout</span></span><br><span class="line">[root@clear opt]# <span class="built_in">chmod</span> 1777 /opt/share/</span><br><span class="line">[root@clear opt]# ll -d /opt/share/</span><br><span class="line">drwxrwxrwt. 2 root root 6 Nov 19 04:56 /opt/share/</span><br><span class="line">[root@clear opt]# su - student</span><br><span class="line">Last login: Sat Nov 19 04:55:24 EST 2022 on pts/0</span><br><span class="line">[student@clear ~]$ <span class="built_in">touch</span> /opt/share/student.txt.haha</span><br><span class="line">[student@clear ~]$ <span class="built_in">logout</span></span><br><span class="line">[root@clear opt]# su - tom</span><br><span class="line">Last login: Sat Nov 19 04:55:38 EST 2022 on pts/0</span><br><span class="line">[tom@clear ~]$ <span class="built_in">rm</span> -f /opt/share/student.txt.haha</span><br><span class="line"><span class="built_in">rm</span>: cannot remove <span class="string">&#x27;/opt/share/student.txt.haha&#x27;</span>: Operation not permitted</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">check：</span><br><span class="line">创建两个不同用户登录操作系统，进入dirt目录分别创建文件，尝试互相删除对方文件，结果应不能互相删除文件。</span><br><span class="line"></span><br><span class="line">大S和小s区别，</span><br><span class="line">执行权限位大S是，没有x</span><br><span class="line">执行权限位小s是该位，有x</span><br></pre></td></tr></table></figure>

<h1 id="7-进程监控及管理"><a href="#7-进程监控及管理" class="headerlink" title="7 进程监控及管理"></a>7 进程监控及管理</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install -y psmisc</span><br><span class="line">pstree -p</span><br><span class="line">一程序被开启会产生一个或多个进程，他们都有对应父进程与子进程，每个进程都有进程号PID</span><br><span class="line">systemd 1 不能被杀死，除非重启，关机。</span><br></pre></td></tr></table></figure>

<h2 id="7-1-ps"><a href="#7-1-ps" class="headerlink" title="7.1 ps"></a>7.1 ps</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">以静态的方式查看系统进程</span><br><span class="line">ps -l</span><br><span class="line">ps  aux  </span><br><span class="line">ps aux | grep http</span><br><span class="line"></span><br><span class="line">[root@servera ~]# ps -l</span><br><span class="line">F S   UID   PID  PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD</span><br><span class="line">4 S     0 27392 27367  0  80   0 - 85532 -      pts/0    00:00:00 su</span><br><span class="line">4 S     0 27396 27392  0  80   0 - 59008 -      pts/0    00:00:00 bash</span><br><span class="line">4 T     0 27822 27396  1  80   0 - 63962 -      pts/0    00:00:00 vim</span><br><span class="line">0 R     0 27823 27396  0  80   0 - 63625 -      pts/0    00:00:00 ps</span><br><span class="line"></span><br><span class="line"><span class="comment"># 练习：</span></span><br><span class="line">查看httpd进程</span><br><span class="line">1、【node1】：yum install -y httpd</span><br><span class="line">2、systemctl start httpd</span><br><span class="line">3、ps aux |grep httpd</span><br><span class="line">4、【foundation】</span><br><span class="line">firefox  172.25.250.10</span><br></pre></td></tr></table></figure>

<h2 id="7-2-top"><a href="#7-2-top" class="headerlink" title="7.2 top"></a>7.2 top</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">以同态的形式查看进程</span><br><span class="line">top</span><br><span class="line">M</span><br><span class="line">P</span><br><span class="line">h</span><br><span class="line">k  pid    9/15  </span><br><span class="line">q 退出</span><br></pre></td></tr></table></figure>

<h2 id="7-3-终止进程"><a href="#7-3-终止进程" class="headerlink" title="7.3 终止进程"></a>7.3 终止进程</h2><h3 id="kill命令"><a href="#kill命令" class="headerlink" title="kill命令"></a>kill命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line"><span class="built_in">kill</span> -s 信号名称 或-n 信号编号</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">-s sig  SIG is a signal name</span><br><span class="line">-n sig  SIG is a signal number</span><br><span class="line"></span><br><span class="line">例子:</span><br><span class="line"><span class="built_in">kill</span> -s SIGKILL httpd</span><br><span class="line"><span class="built_in">kill</span> -n 9 httpd   <span class="comment"># 或 kill -9 httpd</span></span><br><span class="line"></span><br><span class="line">练习：</span><br><span class="line">[root@node1 /]# <span class="built_in">kill</span> -l</span><br><span class="line"> 1) SIGHUP   2) SIGINT   3) SIGQUIT  4) SIGILL   5) SIGTRAP</span><br><span class="line"> 6) SIGABRT  7) SIGBUS   8) SIGFPE   9) SIGKILL 10) SIGUSR1</span><br><span class="line"></span><br><span class="line">[root@node1 /]# vim 1 &amp;</span><br><span class="line">[1] 1372</span><br><span class="line">[root@node1 /]# ps -l</span><br><span class="line">F S   UID     PID    PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD</span><br><span class="line">0 S     0    1313    1312  0  80   0 - 59084 -      pts/1    00:00:00 bash</span><br><span class="line">0 T     0    1372    1313  4  80   0 - 60816 -      pts/1    00:00:00 vim</span><br><span class="line">0 R     0    1373    1313  0  80   0 - 63799 -      pts/1    00:00:00 ps</span><br><span class="line"></span><br><span class="line">[1]+  Stopped                 vim 1</span><br><span class="line">[root@node1 /]# <span class="built_in">kill</span> -n 9 1372</span><br><span class="line">[root@node1 /]# ps -l</span><br><span class="line">F S   UID     PID    PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD</span><br><span class="line">0 S     0    1313    1312  0  80   0 - 59084 -      pts/1    00:00:00 bash</span><br><span class="line">0 R     0    1374    1313  0  80   0 - 63799 -      pts/1    00:00:00 ps</span><br><span class="line">[1]+  Killed                  vim 1</span><br></pre></td></tr></table></figure>

<h3 id="killall命令"><a href="#killall命令" class="headerlink" title="killall命令"></a>killall命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line">killall 守护进程名称</span><br><span class="line"></span><br><span class="line"><span class="comment">#yum install -y httpd</span></span><br><span class="line">systemctl start httpd</span><br><span class="line">ps aux | grep httpd</span><br><span class="line">killall httpd</span><br><span class="line">yum provides killall</span><br><span class="line">yum install -y psmisc-23.1-3.el8.x86_64</span><br><span class="line">killall httpd</span><br><span class="line">ps aux | grep httpd</span><br></pre></td></tr></table></figure>

<h2 id="7-4-作业控制jobs"><a href="#7-4-作业控制jobs" class="headerlink" title="7.4 作业控制jobs"></a>7.4 作业控制jobs</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@servera ~]# vim file2   （ctrl+z）</span><br><span class="line"></span><br><span class="line">[1]-  Stopped                 vim file1</span><br><span class="line"></span><br><span class="line">[2]+  Stopped                 vim file2</span><br><span class="line">[root@servera ~]# <span class="built_in">jobs</span></span><br><span class="line">[1]-  Stopped                 vim file1</span><br><span class="line">[2]+  Stopped                 vim file2</span><br><span class="line"></span><br><span class="line">[root@servera ~]# <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=./bigfile bs=1M count=1000</span><br><span class="line">ctrl + z </span><br><span class="line">[root@servera ~]# <span class="built_in">jobs</span></span><br><span class="line">[1]+  Stopped                 <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=./bigfile bs=1M count=1000</span><br><span class="line">[root@servera ~]# <span class="built_in">bg</span> ％1</span><br><span class="line">[1]+ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=./bigfile bs=1M count=1000 &amp;</span><br><span class="line">[root@servera ~]# <span class="built_in">jobs</span></span><br><span class="line">[1]+  Running                 <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=./bigfile bs=1M count=1000 &amp;</span><br><span class="line">[root@servera ~]# <span class="built_in">fg</span> %1</span><br><span class="line">[root@servera ~]# </span><br><span class="line">1000+0 records <span class="keyword">in</span></span><br><span class="line">1000+0 records out</span><br><span class="line">1048576000 bytes (1.0 GB, 1000 MiB) copied, 65.0049 s, 16.1 MB/s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@servera ~]# <span class="built_in">kill</span> -9 %2</span><br><span class="line">[2]-  Stopped                 vim file2</span><br><span class="line">[root@servera ~]# <span class="built_in">jobs</span></span><br><span class="line">[2]-  Killed                  vim file2</span><br><span class="line">[3]+  Stopped                 <span class="built_in">nice</span> -n -10 vim file4</span><br></pre></td></tr></table></figure>

<h2 id="7-5-进程优先级调整"><a href="#7-5-进程优先级调整" class="headerlink" title="7.5 进程优先级调整"></a>7.5 进程优先级调整</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nice</span>值</span><br><span class="line">超级用户root 可以修改<span class="built_in">nice</span>值范围 -20~19</span><br><span class="line">普通用户user 可以修改<span class="built_in">nice</span>值范围  0-19</span><br><span class="line"></span><br><span class="line">进程优先级数字越小，优先级越高。</span><br><span class="line">优先级不能直接改，可以通过<span class="built_in">nice</span>值来影响优先级。</span><br><span class="line"></span><br><span class="line">旧优先级 + <span class="built_in">nice</span>值 = 新优先级</span><br><span class="line">80       -10   = 70</span><br><span class="line"></span><br><span class="line">两种方法：</span><br><span class="line">一、产生新进程时，设置<span class="built_in">nice</span>值</span><br><span class="line"><span class="built_in">nice</span>  -n -5  vim file2 &amp;</span><br><span class="line">二、修改现有进程<span class="built_in">nice</span>值</span><br><span class="line">renice -n  10  PID</span><br><span class="line">ps -l 查看需要更改的进程号</span><br><span class="line">renice -n 10 28183</span><br></pre></td></tr></table></figure>

<h1 id="8-控制服务与守护进程"><a href="#8-控制服务与守护进程" class="headerlink" title="8 控制服务与守护进程"></a>8 控制服务与守护进程</h1><h2 id="8-1-服务状态关键字段"><a href="#8-1-服务状态关键字段" class="headerlink" title="8.1 服务状态关键字段"></a>8.1 服务状态关键字段</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  字段       描述</span></span><br><span class="line">---------- --------------------------------</span><br><span class="line">  Loaded     服务单元是否加载到内存</span><br><span class="line">  Active     服务单元是否在运行，运行了多久</span><br><span class="line">  Main PID   服务的主进程ID，包括命令名称</span><br><span class="line">  Status     有关该服务的其他信息</span><br></pre></td></tr></table></figure>

<h2 id="8-2-systemctl管理服务"><a href="#8-2-systemctl管理服务" class="headerlink" title="8.2 systemctl管理服务"></a>8.2 systemctl管理服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">systemctl -t <span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">列入.service扩展名，代表服务，如web服务</span><br><span class="line">systemctl list-units --<span class="built_in">type</span> service  列出当前服务器加载的服务单元</span><br><span class="line">systemctl  status  httpd.service   查看某个服务</span><br><span class="line"></span><br><span class="line"><span class="comment"># yum install -y httpd  安装apache服务</span></span><br><span class="line">服务运行状态</span><br><span class="line">[root@servera system]# systemctl status httpd</span><br><span class="line">● httpd.service - The Apache HTTP Server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/httpd.service; enabled; vendor <span class="built_in">pr</span>&gt;</span><br><span class="line">   Active: inactive (dead)</span><br><span class="line">     Docs: man:httpd.service(8)</span><br><span class="line">     </span><br><span class="line">[root@servera system]# systemctl start httpd     </span><br><span class="line">[root@servera system]# systemctl status httpd</span><br><span class="line">● httpd.service - The Apache HTTP Server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/httpd.service; enabled; vendor <span class="built_in">pr</span>&gt;</span><br><span class="line">   Active: active (running) since Sat 2020-02-29 04:34:47 CST; 1s ago</span><br><span class="line"></span><br><span class="line">查看服务是否启动</span><br><span class="line">[root@servera system]# systemctl  is-active httpd</span><br><span class="line">active</span><br><span class="line">查看服务是否开机启动</span><br><span class="line">[root@servera system]# systemctl <span class="built_in">enable</span> httpd</span><br><span class="line">[root@servera system]# systemctl is-enabled httpd</span><br><span class="line">enabled</span><br><span class="line">[root@servera system]# systemctl <span class="built_in">disable</span> httpd</span><br><span class="line">Removed /etc/systemd/system/multi-user.target.wants/httpd.service.</span><br><span class="line">[root@servera system]# systemctl is-enabled httpd</span><br><span class="line">disabled</span><br><span class="line"></span><br><span class="line">常见特征（了解）：</span><br><span class="line">1、安装  yum install -y httpd</span><br><span class="line">2、启动  systemctl  start  httpd.service （单元文件）/usr/lib/systemd/system/</span><br><span class="line">3、查进程 ps aux | grep httpd , 每个服务有自己的守护进程/usr/sbin/httpd</span><br><span class="line">4、查端口 netstat -ntlp ，找到80端口，对应Listen监听状态 对应httpd服务</span><br><span class="line"></span><br><span class="line">vim /etc/service  改文件记录了系统服务的端口和协议的对应关系</span><br></pre></td></tr></table></figure>

<h2 id="8-3-服务状态分类"><a href="#8-3-服务状态分类" class="headerlink" title="8.3 服务状态分类"></a>8.3 服务状态分类</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 关键字              描述</span></span><br><span class="line">------------------- ------------------------------------------</span><br><span class="line">  loaded              单元配置文件已处理</span><br><span class="line">  active（running）   正在通过一个或多个持续进程与运行</span><br><span class="line">  active（exited）    已成功完成一次性配置</span><br><span class="line">  active（waiting）   运行中，但正在等待事件</span><br><span class="line">  inactive            不在运行</span><br><span class="line">  enabled             在系统引导时启动</span><br><span class="line">  disabled            未设为在系统引导时启动</span><br><span class="line">  static              无法启动，但可以由某一启动的单元自动启动</span><br></pre></td></tr></table></figure>

<h2 id="8-4-管理系统服务"><a href="#8-4-管理系统服务" class="headerlink" title="8.4 管理系统服务"></a>8.4 管理系统服务</h2><p>​         语法：systemctl 管理命令 unitname   </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">管理命令                            描述</span><br><span class="line">status                              查看状态</span><br><span class="line">start                               开启</span><br><span class="line">stop                                关闭</span><br><span class="line">restart                             重启</span><br><span class="line">reload                              加载配置文件</span><br><span class="line"><span class="built_in">enable</span>                              开机启动</span><br><span class="line"><span class="built_in">disable</span>                             关闭开机启动</span><br><span class="line">is-active                           查看服务状态是否启动</span><br><span class="line">is-enabled                          查看服务是否开机自启动</span><br><span class="line">list-dependencies 【unitname】      查看单元依赖</span><br><span class="line">mask                                禁止服务，无法启动或开机 启动</span><br><span class="line">unmask                              解除ma</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">练习时，重启服务前，先关闭以下两个应用</span><br><span class="line">setenforce 0 关闭seliunx</span><br><span class="line">systemctl stop firewalld  关闭防火墙 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">yum install -y httpd</span><br><span class="line">systemctl start httpd.service</span><br><span class="line">systemctl status httpd</span><br><span class="line">ps aux |grep httpd</span><br><span class="line">netstat -ntlp</span><br><span class="line">systemctl is-active httpd</span><br><span class="line">systemctl is-enabled httpd</span><br><span class="line">systemctl status httpd</span><br><span class="line">systemctl --<span class="built_in">help</span></span><br><span class="line">systemctl --<span class="built_in">help</span> | grep \\--system</span><br><span class="line">systemctl start httpd</span><br><span class="line">systemctl --system start httpd</span><br><span class="line">systemctl --<span class="built_in">help</span>| grep \\--user</span><br><span class="line">systemctl <span class="built_in">enable</span> httpd</span><br><span class="line">systemctl status httpd</span><br><span class="line">systemctl <span class="built_in">disable</span> httpd</span><br><span class="line">systemctl status httpd</span><br><span class="line">systemctl mask httpd  注销服务</span><br><span class="line">systemctl unmask httpd  取消注销</span><br><span class="line">systemctl <span class="built_in">enable</span> --now httpd  开启服务并且开机自启动</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">可以用做练习的服务httpd，sshd，autofs，samba。</span><br><span class="line">ftp服务器服务开机自启</span><br><span class="line">1、安装 vsftpd</span><br><span class="line">2、启动  vsftpd.service</span><br><span class="line">3、设置开机自启</span><br><span class="line">  </span><br><span class="line">寻找service文件的方法：</span><br><span class="line">[root@servera ~]# rpm -qa | grep autofs</span><br><span class="line">libsss_autofs-2.4.0-9.el8.x86_64</span><br><span class="line">autofs-5.1.4-48.el8.x86_64</span><br><span class="line">[root@servera ~]# rpm -ql autofs | grep service</span><br><span class="line">[root@servera ~]# rpm -ql autofs | grep service</span><br><span class="line">/usr/lib/systemd/system/autofs.service</span><br></pre></td></tr></table></figure>

<h1 id="9-OPENSSH服务"><a href="#9-OPENSSH服务" class="headerlink" title="9 OPENSSH服务"></a>9 OPENSSH服务</h1><h2 id="9-1-ssh的常用功能"><a href="#9-1-ssh的常用功能" class="headerlink" title="9.1 ssh的常用功能"></a>9.1 ssh的常用功能</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@servera ~]# ssh serverb</span><br><span class="line">root@serverb<span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string">[root@servera ~]# vim /etc/hosts  或者系统是否做了dns,ip和域名及主机名的映射</span></span><br><span class="line"><span class="string">[root@servera ~]# ssh 172.25.250.11</span></span><br><span class="line"><span class="string">[root@servera ~]# ssh root@172.25.250.11</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@servera opt]# scp rhcetext root@172.25.250.11:/</span></span><br><span class="line"><span class="string">root@172.25.250.11&#x27;</span>s password: </span><br><span class="line">rhcetext                                                 100%    0     0.0KB/s   00:00</span><br><span class="line"></span><br><span class="line">[root@serverb /]# scp root@172.25.250.10:/opt/newfile  .</span><br><span class="line">root@172.25.250.10<span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string">newfile                                                  100%    0     0.0KB/s   00:00 </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@servera opt]# ssh root@172.25.250.11 &#x27;</span>yum install -y httpd<span class="string">&#x27;</span></span><br><span class="line"><span class="string">ssh root@172.25.250.11 &#x27;</span>yum install -y httpd<span class="string">&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="9-2-ssh免密登录"><a href="#9-2-ssh免密登录" class="headerlink" title="9.2 ssh免密登录"></a>9.2 ssh免密登录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">【servera】</span><br><span class="line">[root@servera ssh]# ssh-keygen  后面三个回车</span><br><span class="line">[root@servera ssh]# ssh-copy-id  root@serverb</span><br><span class="line">【serverb】</span><br><span class="line">[root@serverb /]# <span class="built_in">cd</span> /root/.ssh/</span><br><span class="line">[root@serverb .ssh]# <span class="built_in">ls</span></span><br><span class="line">authorized_keys  known_hosts</span><br><span class="line">【servera】</span><br><span class="line">[root@servera ssh]# ssh root@serverb</span><br><span class="line"></span><br><span class="line">a免密远程b，如果想b远程a免密，需要相同的配置</span><br><span class="line"></span><br><span class="line">课上练习：b远程免密登录a</span><br></pre></td></tr></table></figure>

<h2 id="9-3-ssh服务控制"><a href="#9-3-ssh服务控制" class="headerlink" title="9.3 ssh服务控制"></a>9.3 ssh服务控制</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拒绝root登录</span></span><br><span class="line">[root@serverb ~]# vim /etc/ssh/sshd_config</span><br><span class="line">PermitRootLogin no</span><br><span class="line">[root@serverb ~]# systemctl reload sshd（或restart）</span><br><span class="line"></span><br><span class="line">[root@servera ~]# ssh root@serverb</span><br></pre></td></tr></table></figure>

<h2 id="9-4-sudo命令"><a href="#9-4-sudo命令" class="headerlink" title="9.4 sudo命令"></a>9.4 sudo命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">一、将用户设置为特权用户</span><br><span class="line">1、</span><br><span class="line">[student@servera ~]$ yum remove -y httpd</span><br><span class="line">Error: This <span class="built_in">command</span> has to be run under the root user.</span><br><span class="line"></span><br><span class="line">2、</span><br><span class="line">[root@servera /]# vim /etc/sudoers    或者 visudo</span><br><span class="line"><span class="comment">## Allow root to run any commands anywhere </span></span><br><span class="line">root    ALL=(ALL)       ALL</span><br><span class="line">student ALL=(ALL)       ALL</span><br><span class="line"></span><br><span class="line">3、</span><br><span class="line">[student@servera ~]$ <span class="built_in">sudo</span> yum remove -y httpd</span><br><span class="line">[<span class="built_in">sudo</span>] password <span class="keyword">for</span> student: student</span><br><span class="line"></span><br><span class="line">二、将账号添加到特权用户组中，培训环境默认特权用户组是wheel组，在/etc/sudoers文件中用%wheel来表示</span><br><span class="line">usermod -G wheel tom</span><br><span class="line"></span><br><span class="line">三、练习：</span><br><span class="line">添加一个特权组admin，而且组内有一个成员是harry。最终harry账号应当为特权账号。</span><br><span class="line">[root@serverb ~]# groupadd admin</span><br><span class="line">[root@serverb ~]# visudo</span><br><span class="line">[root@serverb ~]# useradd -G admin  harry</span><br><span class="line">[root@serverb ~]# su - harry</span><br><span class="line">[harry@serverb ~]$ <span class="built_in">sudo</span> -i</span><br><span class="line">[<span class="built_in">sudo</span>] password <span class="keyword">for</span> harry: </span><br><span class="line"></span><br><span class="line">四、设置特权组中用户切换时不需要密码</span><br><span class="line">%admin  ALL=(ALL)       NOPASSWD: ALL</span><br></pre></td></tr></table></figure>

<h1 id="10-日志分析与存储"><a href="#10-日志分析与存储" class="headerlink" title="10 日志分析与存储"></a>10 日志分析与存储</h1><h2 id="10-1-系统中的日志文件"><a href="#10-1-系统中的日志文件" class="headerlink" title="10.1 系统中的日志文件"></a>10.1 系统中的日志文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  日志文件            存储的消息类型</span></span><br><span class="line">------------------- ----------------------------------------</span><br><span class="line">  /var/log/messages   大多数系统日志消息处存放处</span><br><span class="line">  /var/log/secure     与安全性和身份验证时间相关的syslog消息</span><br><span class="line">  /var/log/maillog    与邮件服务器相关的syslog消息</span><br><span class="line">  /var/log/cron       与计划任务执行相关的syslog消息</span><br><span class="line">  /var/log/boot.log   与系统启动相关的消息。</span><br></pre></td></tr></table></figure>

<h3 id="rsyslog服务管理的日志配置文件"><a href="#rsyslog服务管理的日志配置文件" class="headerlink" title="rsyslog服务管理的日志配置文件"></a>rsyslog服务管理的日志配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@haha <span class="built_in">log</span>]# yum provides /etc/rsyslog.conf  <span class="comment">#查看文件是哪个软件包提供的</span></span><br><span class="line">[root@clear <span class="built_in">log</span>]# rpm -qc rsyslog-8.1911.0-3.el8.x86_64 </span><br><span class="line">/etc/logrotate.d/syslog</span><br><span class="line">/etc/rsyslog.conf       <span class="comment">#一般服务文件以.conf结尾，改文件是日志服务的配置文件</span></span><br><span class="line">/etc/sysconfig/rsyslog</span><br><span class="line">[root@clear <span class="built_in">log</span>]# vim /etc/rsyslog.conf</span><br></pre></td></tr></table></figure>

<h3 id="记录日志的规则"><a href="#记录日志的规则" class="headerlink" title="记录日志的规则"></a>记录日志的规则</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">日志文件配置格式:</span><br><span class="line">mail.info  /var/log/vsftpd.log  <span class="comment">#.点代表包含后面级别及以上级别</span></span><br><span class="line"></span><br><span class="line">AAAA.BBBB CCCC</span><br><span class="line"></span><br><span class="line">AAAA 产生日志的设备（类别）   <span class="comment">#如何产生的日志</span></span><br><span class="line">BBBB 日志的级别              <span class="comment">#日志有不同安全级别，类似轻重缓急的严重程度，发出警告</span></span><br><span class="line">CCCC 保存日志的位置          <span class="comment">#在系统中保存日志文件的路径</span></span><br></pre></td></tr></table></figure>

<h3 id="rsyslog配置文件类别-产生日志的设备"><a href="#rsyslog配置文件类别-产生日志的设备" class="headerlink" title="rsyslog配置文件类别(产生日志的设备)"></a>rsyslog配置文件类别(产生日志的设备)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">类别(facility)   </span><br><span class="line">---------------- ---------------------</span><br><span class="line">  Kern             内核</span><br><span class="line">  authpriv         授权和安全</span><br><span class="line">  cron             计划任务</span><br><span class="line">  mail             邮件</span><br><span class="line">  daemon           系统守护进程</span><br><span class="line">  user             普通用户级别的</span><br><span class="line">  syslog           由rsyslog生成的信息</span><br><span class="line">  local0\~local7   自定义本地策略</span><br><span class="line">  \*               所有类别</span><br></pre></td></tr></table></figure>

<h3 id="日志级别"><a href="#日志级别" class="headerlink" title="日志级别"></a>日志级别</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">man 3  syslog</span><br><span class="line"><span class="comment">#   等级              解释</span></span><br><span class="line">----------------- ----------------------------</span><br><span class="line">  EMERG（紧急）     会导致主机系统不可用的情况</span><br><span class="line">  ALERT（警告）     必须马上采取措施解决的问题</span><br><span class="line">  CRIT（严重）      比较严重的情况</span><br><span class="line">  ERR（错误）       运行出现错误</span><br><span class="line">  WARNING（提醒）   可能会影响系统功能的事件</span><br><span class="line">  NOTICE（注意）    不会影响系统但值得注意</span><br><span class="line">  INFO（信息）      一般信息</span><br><span class="line">  DEBUG（调试）     程序或系统调试信息等</span><br><span class="line">  \*                所有等级</span><br><span class="line">  none              不记录日志</span><br><span class="line">  </span><br><span class="line">解释：</span><br><span class="line">*.info;mail.none;authpriv.none;cron.none                /var/log/messages</span><br><span class="line">*.info   *所有设别    .点代表后面的等级及以上等级，也就是info以上的等级全记录</span><br><span class="line">；分号是不同设备等级的分隔符号</span><br><span class="line">mail.*                                                  -/var/log/maillog</span><br><span class="line">- 代表先记录缓存，再记录硬盘，减轻硬盘i/o读写压力。</span><br></pre></td></tr></table></figure>

<h3 id="使用logger发送测试日志信息"><a href="#使用logger发送测试日志信息" class="headerlink" title="使用logger发送测试日志信息"></a>使用logger发送测试日志信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">1 查看rsyslog服务是否开启 (默认系统已开启)</span><br><span class="line">[root@servera ~]# systemctl status rsyslog</span><br><span class="line">2 编辑rsyslog配置文件</span><br><span class="line">[root@servera ~]# vim /etc/rsyslog.conf</span><br><span class="line"><span class="comment"># Save boot messages also to boot.log</span></span><br><span class="line">local7.*                                                /var/log/boot.log</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">*.debug                                                 /var/log/messages.debug</span><br><span class="line">3 重启rsyslog日志服务让配置生效</span><br><span class="line">[root@servera ~]# systemctl restart rsyslog</span><br><span class="line"></span><br><span class="line">4 开另一个窗口 ctrl+<span class="built_in">shift</span>+t</span><br><span class="line">[root@servera ~]# <span class="built_in">tail</span> -n 0 -f /var/log/messages.debug   </span><br><span class="line"></span><br><span class="line">5 使用logger命令生成一个user类别，debug级别的日志内容为“Debug <span class="built_in">test</span> messages”  <span class="comment">#（考点）</span></span><br><span class="line">[root@servera ~]# logger -p user.debug <span class="string">&quot;Debug test messages&quot;</span>    </span><br><span class="line"></span><br><span class="line">6 在第4步的窗口中查看新生成日志信息</span><br><span class="line">[root@servera ~]# <span class="built_in">tail</span> -n 0 -f /var/log/messages.debug</span><br><span class="line">Jun 18 14:45:31 servera root[29174]: messages haha</span><br></pre></td></tr></table></figure>

<h2 id="10-2-journalctl"><a href="#10-2-journalctl" class="headerlink" title="10.2 journalctl"></a>10.2 journalctl</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">传统的日志服务是rsyslog</span><br><span class="line">新添加的日志服务是systemd-journal，它也是一个日志管理服务，可以收集来自内核、系统早期启动阶段的日志，以及系统进程在启动和运行中的一些标准输出与错误输出。此日志一旦重启既消失，因为保存在了/run/log/journal/*/*.journal结尾，该文件是一个二进制日志文件，需要用journalctl命令查看。</span><br><span class="line"></span><br><span class="line"><span class="built_in">tail</span> -n 5</span><br><span class="line"></span><br><span class="line">journalctl 查看系统日志</span><br><span class="line">journalctl -n   通过q或ctrl接触观看  ，此命令显示方式类似与<span class="built_in">tail</span> -n</span><br><span class="line">journalctl -n 5 </span><br><span class="line"></span><br><span class="line">journalctl -p err  日志等级</span><br><span class="line">journalctl -f </span><br><span class="line">journalctl -p err </span><br><span class="line">journalctl -p info</span><br><span class="line">  （deubg、info、notice、warning、err、crit、alert、emerg）</span><br><span class="line"></span><br><span class="line">journalctl --since <span class="string">&quot;2020-02-28 22:53:35&quot;</span> --<span class="keyword">until</span> <span class="string">&quot;2020-02-28 22:53:40&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="journalctl常用字段"><a href="#journalctl常用字段" class="headerlink" title="journalctl常用字段"></a>journalctl常用字段</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">常用字段        含义</span><br><span class="line">--------------- -------------------------</span><br><span class="line">  \_COMM          命令名称</span><br><span class="line">  \_EXE           进程的可执行文件的路径</span><br><span class="line">  \_PID           进程的PID</span><br><span class="line">  \_UID           UID</span><br><span class="line">  \_SYSTEM_UNIT   启动该进程的systemd单元</span><br><span class="line">  </span><br><span class="line">journalctl -o verbose </span><br><span class="line">journalctl _HOSTNAME=localhost</span><br><span class="line">journalctl _HOSTNAME=localhost _PID=1</span><br></pre></td></tr></table></figure>

<h3 id="永久保存journal服务文件的方式"><a href="#永久保存journal服务文件的方式" class="headerlink" title="永久保存journal服务文件的方式"></a>永久保存journal服务文件的方式</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mandb</span><br><span class="line">man -k journal</span><br><span class="line">man 5 journald.conf  ， Storage=</span><br><span class="line"></span><br><span class="line">[root@clear journal]# ll -d /run/log/journal</span><br><span class="line">[root@clear journal]# <span class="built_in">cp</span> -a /run/log/journal/ /var/log/journal</span><br><span class="line">[root@clear journal]# ll -d /var/log/journal</span><br><span class="line">drwxr-sr-x. 4 root systemd-journal 86 Nov 19 04:30 /var/log/journal</span><br><span class="line">[root@clear journal]# systemctl restart systemd-journald</span><br><span class="line">[root@clear journal]# ll /var/log/journal/3a2b4da8dabb4729935c193e58ad052d/  <span class="comment">#字符串目录名字每个人的可能不一样。不要复制我的笔记。</span></span><br><span class="line">total 8192</span><br><span class="line">-rw-r-----. 1 root root 8388608 Nov 19 04:30 system.journal</span><br><span class="line">[root@clear journal]# journalctl</span><br></pre></td></tr></table></figure>

<h2 id="10-3-保持准确的系统时间"><a href="#10-3-保持准确的系统时间" class="headerlink" title="10.3 保持准确的系统时间"></a>10.3 保持准确的系统时间</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">RHEL6 ntp服务</span><br><span class="line">RHEL8 chrony服务</span><br><span class="line">还是使用同样的协议标准ntp（network <span class="keyword">time</span> protocol）</span><br><span class="line"></span><br><span class="line">UTC：通用协调时</span><br><span class="line">   （UTC时间0点是北京时间8点,因为中国、新加坡、马来西亚、菲律宾等国的时间与UTC的时差均为+8,也就是UTC+8,所以当UTC时间0点,北京时间即为0+8=8点）</span><br><span class="line">GMT：格林威治标准时间</span><br><span class="line">CST：中国标准时间 (China Standard Time）</span><br><span class="line">    （中国大陆、中国香港、中国澳门、中国台湾、蒙古国、新加坡、马来西亚、菲律宾、西澳大利亚州的时间与UTC的时差均为＋8，也就是UTC+8。）</span><br><span class="line">RTC：(Real-Time Clock)也称为硬件时间：RTC是芯片内置的硬件时钟，只要芯片不断电，即使操作系统关机的时候，RTC时钟也是正常在走的，所以当操作系统关机重启后，可通过读取RTC时间来更新系统时间。</span><br><span class="line">    （可通过hwclock命令来获取具体的时间 </span><br><span class="line">      -r 查看硬件时间</span><br><span class="line">      -s 硬件时间设置到系统</span><br><span class="line">      -w 系统设置到硬件 ）</span><br></pre></td></tr></table></figure>

<h3 id="timedatectl命令"><a href="#timedatectl命令" class="headerlink" title="timedatectl命令"></a>timedatectl命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@servera <span class="built_in">log</span>]# timedatectl </span><br><span class="line">               Local <span class="keyword">time</span>: Sat 2020-02-29 08:51:49 CST</span><br><span class="line">           Universal <span class="keyword">time</span>: Sat 2020-02-29 00:51:49 UTC</span><br><span class="line">                 RTC <span class="keyword">time</span>: Sat 2020-02-29 08:11:07</span><br><span class="line">                Time zone: Asia/Shanghai (CST, +0800)</span><br><span class="line">System clock synchronized: <span class="built_in">yes</span></span><br><span class="line">              NTP service: active</span><br><span class="line">          RTC <span class="keyword">in</span> <span class="built_in">local</span> TZ: no</span><br><span class="line">          </span><br><span class="line">[root@servera <span class="built_in">log</span>]# timedatectl list-timezones     </span><br><span class="line">[root@servera <span class="built_in">log</span>]# timedatectl set-timezone Asia/Hong_Kong </span><br><span class="line">[root@servera <span class="built_in">log</span>]# timedatectl </span><br><span class="line">               Local <span class="keyword">time</span>: Sat 2020-02-29 08:55:48 HKT</span><br><span class="line">           Universal <span class="keyword">time</span>: Sat 2020-02-29 00:55:48 UTC</span><br><span class="line">                 RTC <span class="keyword">time</span>: Sat 2020-02-29 08:15:06</span><br><span class="line">                Time zone: Asia/Hong_Kong (HKT, +0800)</span><br><span class="line">System clock synchronized: <span class="built_in">yes</span></span><br><span class="line">              NTP service: active</span><br><span class="line">          RTC <span class="keyword">in</span> <span class="built_in">local</span> TZ: no</span><br><span class="line"></span><br><span class="line">修改时间方法</span><br><span class="line">timedatectl set-time <span class="string">&quot;2020-02-30 10:00:00&quot;</span></span><br><span class="line">Failed to <span class="built_in">set</span> <span class="keyword">time</span>: NTP unit is active</span><br><span class="line">timedatectl set-ntp <span class="literal">false</span> </span><br><span class="line">timedatectl set-time <span class="string">&quot;2020-02-30 10:00:00&quot;</span></span><br><span class="line">timedatectl set-ntp <span class="literal">true</span> </span><br></pre></td></tr></table></figure>

<h3 id="chrony命令"><a href="#chrony命令" class="headerlink" title="chrony命令"></a>chrony命令</h3><pre><code>server
===server选项格式===
server host  [ key n ] [ version n ] [ prefer ] [ mode n ] [ minpoll n ] [ maxpoll n ] [ iburst ]
其中host是上层NTP服务器的IP地址或域名，随后所跟的参数解释如下所示：
◆ key： 表示所有发往服务器的报文包含有秘钥加密的认证信息，n是32位的整数，表示秘钥号。
◆ version： 表示发往上层服务器的报文使用的版本号，n默认是3，可以是1或者2。
◆ prefer： 如果有多个server选项，具有该参数的服务器有限使用。
◆ mode： 指定数据报文mode字段的值。
◆ minpoll： 指定与查询该服务器的最小时间间隔为2的n次方秒，n默认为6，范围为4-14。
◆ maxpoll：  指定与查询该服务器的最大时间间隔为2的n次方秒，n默认为10，范围为4-14。
◆ iburst： 当初始同步请求时，采用突发方式接连发送8个报文，时间间隔为2秒。
</code></pre>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@servera ~]# systemctl <span class="built_in">enable</span> --now chronyd    <span class="comment">#--now启动服务 enable 开机自动</span></span><br><span class="line">[root@servera ~]# systemctl status chronyd</span><br><span class="line">[root@servera ~]# vim /etc/chrony.conf   <span class="comment">#大概第7行 server 后面添加服务器&#x27;地址&#x27;或&#x27;域名&#x27;。</span></span><br><span class="line">server classroom.exmaple.com iburst</span><br><span class="line">[root@servera ~]# systemctl  restart chronyd.service</span><br><span class="line">[root@servera ~]# chronyc sources -v</span><br><span class="line">210 Number of sources = 1</span><br><span class="line"></span><br><span class="line">  .-- Source mode  <span class="string">&#x27;^&#x27;</span> = server, <span class="string">&#x27;=&#x27;</span> = peer, <span class="string">&#x27;#&#x27;</span> = <span class="built_in">local</span> clock.</span><br><span class="line"> / .- Source state <span class="string">&#x27;*&#x27;</span> = current synced, <span class="string">&#x27;+&#x27;</span> = combined , <span class="string">&#x27;-&#x27;</span> = not combined,</span><br><span class="line">| /   <span class="string">&#x27;?&#x27;</span> = unreachable, <span class="string">&#x27;x&#x27;</span> = <span class="keyword">time</span> may be <span class="keyword">in</span> error, <span class="string">&#x27;~&#x27;</span> = <span class="keyword">time</span> too variable.</span><br><span class="line">||                                                 .- xxxx [ yyyy ] +/- zzzz</span><br><span class="line">||      Reachability register (octal) -.           |  xxxx = adjusted offset,</span><br><span class="line">||      Log2(Polling interval) --.      |          |  yyyy = measured offset,</span><br><span class="line">||                                \     |          |  zzzz = estimated error.</span><br><span class="line">||                                 |    |           \</span><br><span class="line">MS Name/IP address         Stratum Poll Reach LastRx Last sample               </span><br><span class="line">===============================================================================</span><br><span class="line">^* classroom.example.com         8   6   377    25  -3837ns[  +21us] +/-  627us</span><br><span class="line"></span><br><span class="line">[root@node1 ~]# timedatectl </span><br><span class="line">               Local <span class="keyword">time</span>: Sat 2022-11-19 05:03:30 EST</span><br><span class="line">           Universal <span class="keyword">time</span>: Sat 2022-11-19 10:03:30 UTC</span><br><span class="line">                 RTC <span class="keyword">time</span>: Sat 2022-11-26 06:07:04</span><br><span class="line">                Time zone: America/New_York (EST, -0500)</span><br><span class="line">System clock synchronized: <span class="built_in">yes</span>   <span class="comment">#表示时间服务同步</span></span><br><span class="line">              NTP service: active</span><br><span class="line">          RTC <span class="keyword">in</span> <span class="built_in">local</span> TZ: no</span><br></pre></td></tr></table></figure>

<h1 id="11-RHEL网络管理"><a href="#11-RHEL网络管理" class="headerlink" title="11 RHEL网络管理"></a>11 RHEL网络管理</h1><h2 id="11-1-认识IPv4地址"><a href="#11-1-认识IPv4地址" class="headerlink" title="11.1 认识IPv4地址"></a>11.1 认识IPv4地址</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">IP/(NETMASK\|PREFIX)   172.25.0.9/255.255.0.0 \| 172.25.0.9/16</span><br><span class="line">--- ---------------------- --------------------------------------------</span><br><span class="line">GATEWAY                172.25.x.x</span><br><span class="line">DNS                    正向解析 \# host servera， 反向解析 \# host</span><br><span class="line"></span><br><span class="line">私有地址：</span><br><span class="line">A　１－１２７</span><br><span class="line">B　１２８－１９１</span><br><span class="line">C　１９２－２２３</span><br><span class="line"></span><br><span class="line">IP地址分类默认对应的子网掩码掩码：</span><br><span class="line">Ａ：２５５．０．０．０        11111111.00000000.00000000.00000000     /8</span><br><span class="line">Ｂ：２５５．２５５．０．０     11111111.11111111.00000000.00000000     /16</span><br><span class="line">Ｃ：２５５．２５５．２５５．０  11111111.11111111.11111111.00000000     /24</span><br></pre></td></tr></table></figure>

<h3 id="网段-IP与掩码二进制与运算"><a href="#网段-IP与掩码二进制与运算" class="headerlink" title="网段:IP与掩码二进制与运算"></a>网段:IP与掩码二进制与运算</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">网络地址   172.25.0.0       主机位全0</span><br><span class="line">---------- ---------------- -----------</span><br><span class="line">广播地址   172.25.255.255   主机位全1</span><br></pre></td></tr></table></figure>

<h3 id="查看ip4与ip6"><a href="#查看ip4与ip6" class="headerlink" title="查看ip4与ip6"></a>查看ip4与ip6</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">查看ip地址方法1：</span><br><span class="line">[root@servera ~]#ifconfig </span><br><span class="line">[root@servera ~]#ifconfig  eth0</span><br><span class="line">查看ip地址方法2：</span><br><span class="line">[root@servera ~]# ip addr show eth0</span><br><span class="line">[root@servera ~]# ip a  s eth0</span><br><span class="line">[root@servera ~]# ip -s <span class="built_in">link</span> show enp1s0 </span><br></pre></td></tr></table></figure>

<h3 id="ipv4-ipv6-mac"><a href="#ipv4-ipv6-mac" class="headerlink" title="ipv4 ipv6 mac"></a>ipv4 ipv6 mac</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ipv4      ipv6       mac</span><br><span class="line">二进制（位）      32       128         48</span><br><span class="line">符号（分）        .         :          :</span><br><span class="line">进制            十进制   十六进制   十六进制</span><br><span class="line">组                4         8          6</span><br></pre></td></tr></table></figure>
<h3 id="端口与服务"><a href="#端口与服务" class="headerlink" title="端口与服务"></a>端口与服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">查看服务端口是否被占用</span><br><span class="line">lsof -i:80</span><br><span class="line">或</span><br><span class="line">netstat</span><br><span class="line">-n：显示接口和端口编号</span><br><span class="line">-t：tcp信息</span><br><span class="line">-u：udp信息</span><br><span class="line">-l：监听状态信息</span><br><span class="line">-a：显示所有信息</span><br><span class="line">-p：显示协议名称而不是端口</span><br><span class="line"></span><br><span class="line">netstat -ntlp | grep 22</span><br><span class="line">netstat -ntlp | grep 80</span><br><span class="line"></span><br><span class="line">参考ss和netstat区别：https://blog.csdn.net/qq_37863891/article/details/107283415</span><br></pre></td></tr></table></figure>

<h3 id="标准服务端口"><a href="#标准服务端口" class="headerlink" title="标准服务端口"></a>标准服务端口</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/services</span><br></pre></td></tr></table></figure>

<h2 id="11-2-网络管理工具"><a href="#11-2-网络管理工具" class="headerlink" title="11.2 网络管理工具"></a>11.2 网络管理工具</h2><h3 id="nmcli概念"><a href="#nmcli概念" class="headerlink" title="nmcli概念"></a>nmcli概念</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">使用nmcli管理网络服务NetworkManager</span><br><span class="line">nmcli工具功能：查看网络设备、创建网络连接、修改网络配置</span><br><span class="line">特点及概念：</span><br><span class="line">nmcli工具可以对网卡或网卡配置文件操作</span><br><span class="line">device ---- 网卡设备</span><br><span class="line">connection --- 连接  指的就是网卡配置文件</span><br><span class="line">一个device可以拥有多个connection，同一时间只能启用一个connection，且一个connection只能属于一个device</span><br><span class="line"></span><br><span class="line">举例：</span><br><span class="line">device-----eth0</span><br><span class="line">connection1  ----  dhcp    自动获取IP  </span><br><span class="line">connection2  ----  static  静态IP  </span><br></pre></td></tr></table></figure>

<h3 id="使用nmcli管理网络"><a href="#使用nmcli管理网络" class="headerlink" title="使用nmcli管理网络"></a>使用nmcli管理网络</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">mandb</span><br><span class="line">man -k nmcli</span><br><span class="line">nmcli (1) </span><br><span class="line">nmcli-examples (7)</span><br><span class="line">man nmcli | grep -A 2 <span class="string">&#x27;nmcli connection add&#x27;</span></span><br><span class="line"></span><br><span class="line">-basic</span><br><span class="line">[root@servera ~]# nmcli connection show </span><br><span class="line">[root@servera ~]# nmcli connection show --active </span><br><span class="line">[root@servera ~]# nmcli device status </span><br><span class="line"></span><br><span class="line">-add---添加</span><br><span class="line">   dhcp方式: <span class="comment">#创建一个名为default的手动链接，绑定至eth0网卡</span></span><br><span class="line">[root@servera ~]# nmcli connection add  con-name <span class="string">&#x27;default&#x27;</span> <span class="built_in">type</span> ethernet ifname eth0  autoconnect <span class="built_in">yes</span>    </span><br><span class="line">[root@servera ~]# nmcli con show </span><br><span class="line"></span><br><span class="line">   static方式：#创建一个名为static的静态链接，绑定至eth1网卡</span><br><span class="line">[root@servera ~]# nmcli connection add con-name static <span class="built_in">type</span> ethernet ifname eth0 autoconnect <span class="built_in">yes</span> ipv4.addresses 192.168.0.1/24 ipv4.gateway 192.168.0.254 ipv4.dns 8.8.8.8 ipv4.method manual  </span><br><span class="line">[root@servera ~]# nmcli connection show</span><br><span class="line">NAME                UUID                                  TYPE      DEVICE </span><br><span class="line">Wired connection 1  1f5ad5ae-e926-3f54-9805-33174e63af47  ethernet  eth0   </span><br><span class="line">static              980f6712-86b7-4d92-bc84-62e677ccabfc  ethernet  eth1     <span class="comment">#此处</span></span><br><span class="line">dhcp                82c4a93f-1ca2-432b-94da-59a6c4f5aaca  ethernet  --     </span><br><span class="line">Wired connection 2  e801f880-78a6-3344-857f-588f7495bb26  ethernet  --     </span><br><span class="line">[root@servera /]# nmcli connection up static   启动static网卡</span><br><span class="line">[root@servera /]# ip a s eth1 | grep -w inet</span><br><span class="line"></span><br><span class="line">-modify---修改</span><br><span class="line"><span class="comment">#将链接static网络信息更改： IP：192.168.0.2  mask：/24  gw：192.168.0.200 dns：114.114.114.114</span></span><br><span class="line">[root@servera ~]# nmcli connection modify static ipv4.addresses 192.168.0.2/24 ipv4.gateway 192.168.0.200 ipv4.dns 114.114.114.114 autoconnect <span class="built_in">yes</span> ipv4.method manual</span><br><span class="line">[root@servera ~]# nmcli connection up  static</span><br><span class="line">[root@servera ~]# ip a s eth0</span><br><span class="line">    inet 192.168.0.2/24 brd 192.168.0.255 scope global noprefixroute eth1</span><br><span class="line">   </span><br><span class="line">[root@servera ~]# route -n</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         172.25.250.254  0.0.0.0         UG    100    0        0 eth0</span><br><span class="line">0.0.0.0         192.168.0.200   0.0.0.0         UG    101    0        0 eth1</span><br><span class="line"></span><br><span class="line">[root@servera ~]# <span class="built_in">cat</span> /etc/resolv.conf </span><br><span class="line"><span class="comment"># Generated by NetworkManager</span></span><br><span class="line">search lab.example.com example.com</span><br><span class="line">nameserver 172.25.250.254</span><br><span class="line">nameserver 114.114.114.114</span><br><span class="line"> </span><br><span class="line">[root@serverb ~]# nmcli connection delete static  <span class="comment">#删除一个链接</span></span><br><span class="line">Connection <span class="string">&#x27;static&#x27;</span> (b85e6a57-b8f7-421f-8d15-9ff5e27cbb85) successfully deleted.</span><br><span class="line"></span><br><span class="line">-up_down---启动与关闭网卡</span><br><span class="line">[root@servera /]# nmcli connection down static   关闭static网卡</span><br><span class="line"></span><br><span class="line">-off---关闭网络服务</span><br><span class="line">[root@servera /]# nmcli networking off       关闭网络服务，慎重使</span><br></pre></td></tr></table></figure>

<h3 id="图形化管理工具nmtui"><a href="#图形化管理工具nmtui" class="headerlink" title="图形化管理工具nmtui"></a>图形化管理工具nmtui</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nmtui-edit</span><br><span class="line">图形化管理配置</span><br><span class="line">通过点击设置--network--网卡设置，ipv4address  netmask  dns  gateway</span><br><span class="line">nmtui-edit</span><br><span class="line">[root@servera /]# nmcli connection up static</span><br></pre></td></tr></table></figure>

<h3 id="网卡配置文件"><a href="#网卡配置文件" class="headerlink" title="网卡配置文件"></a>网卡配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">-RHEL8 版本</span><br><span class="line"><span class="comment"># grep -r IPADDR /usr/share/ #找到下面手册的指令</span></span><br><span class="line">vim /usr/share/doc/initscripts/sysconfig.txt 帮助手册</span><br><span class="line"></span><br><span class="line">修改配置文件方式修改IP</span><br><span class="line">[root@servera ~]# vim /etc/sysconfig/network-scripts/ifcfg-Wired_connection_1</span><br><span class="line"></span><br><span class="line">BOOTPROTO=none       <span class="comment">#获取IP的方式  static--静态 none--不设置 dhcp--自动获取 ，手动配IP选前两个中任意一个</span></span><br><span class="line">ONBOOT=<span class="built_in">yes</span>           <span class="comment">#开机自动连接</span></span><br><span class="line">IPADDR=172.25.250.100   <span class="comment">#ip地址</span></span><br><span class="line">PREFIX=24               <span class="comment">#子网掩码  PREFIX=24(等效于255.255.255.0)，mask=255.255.255.0 netmask=255.255.255.0</span></span><br><span class="line">GATEWAY=172.25.250.254  <span class="comment">#网关</span></span><br><span class="line">DNS1=xxxx               <span class="comment">#dns，dns可以有三个 DNS1= DNS2= DNS3=</span></span><br><span class="line"></span><br><span class="line">加载网卡配置文件方法一：</span><br><span class="line">[root@serverb network-scripts]# nmcli connection reload ifcfg-Wired_connection_1 或 nmcli connection reload</span><br><span class="line">[root@serverb network-scripts]# nmcli connection up static</span><br><span class="line"></span><br><span class="line">systemctl restart NetworkManager</span><br><span class="line"></span><br><span class="line">-RHEL9版本 网卡配置文件位置</span><br><span class="line">[root@node1 system-connections]# vim /etc/NetworkManager/system-connections/System\ eth0.nmconnection</span><br></pre></td></tr></table></figure>

<h2 id="11-3-更改网络信息"><a href="#11-3-更改网络信息" class="headerlink" title="11.3 更改网络信息"></a>11.3 更改网络信息</h2><h3 id="主机名"><a href="#主机名" class="headerlink" title="主机名"></a>主机名</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@servera ~]# hostname</span><br><span class="line">servera.lab.example.com</span><br><span class="line">[root@servera ~]# hostnmae  www.example.com 临时</span><br><span class="line">[root@servera ~]# vim /etc/hostname  永久（重启系统:reboot、init 6)</span><br><span class="line">[root@servera ~]# hostnamectl set-hostname hostname　永久</span><br></pre></td></tr></table></figure>

<h3 id="配置网关-gateway"><a href="#配置网关-gateway" class="headerlink" title="配置网关(gateway)"></a>配置网关(gateway)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">一、使用nmcli</span><br><span class="line">nmcli con add con-name xxx ipv4.gateway xxx.xxx.xxx.xxx  配置网关</span><br><span class="line">nmcli con mod xxx ipv4.gateway xxx.xxx.xxx.xxx          修改网关</span><br><span class="line">以上两种改完之后，需要nmcli con up xxx</span><br><span class="line">二、修改配置文件</span><br><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-xxxx</span><br><span class="line">GATEWAY=xxx.xxx.xxx.xxx  </span><br><span class="line">修改完后要nmcli con reload ，再nmcli con up xxxx</span><br></pre></td></tr></table></figure>

<h3 id="查看路由及网关信息"><a href="#查看路由及网关信息" class="headerlink" title="查看路由及网关信息"></a>查看路由及网关信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@servera ~]# ip route </span><br><span class="line">default via 172.25.250.254 dev enp1s0 proto static metric 100 </span><br><span class="line">172.25.250.0/24 dev enp1s0 proto kernel scope <span class="built_in">link</span> src 172.25.250.10 metric 100</span><br><span class="line"></span><br><span class="line">[root@servera ~]# route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         172.25.250.254  0.0.0.0         UG    100    0        0 enp1s0</span><br><span class="line">172.25.250.0    0.0.0.0         255.255.255.0   U     100    0        0 enp1s0</span><br><span class="line"></span><br><span class="line">[root@servera ~]# nmcli connection show Wired\ connection\ 1 | grep ipv4.ga</span><br><span class="line">ipv4.gateway:                           172.25.250.254</span><br><span class="line"></span><br><span class="line">[root@servera ~]# netstat -nr</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface</span><br><span class="line">0.0.0.0         172.25.250.254  0.0.0.0         UG        0 0          0 enp1s0</span><br><span class="line">172.25.250.0    0.0.0.0         255.255.255.0   U         0 0          0 enp1s0</span><br></pre></td></tr></table></figure>

<h3 id="指定DNS"><a href="#指定DNS" class="headerlink" title="指定DNS"></a>指定DNS</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/resolv.conf   <span class="comment">#该文件指定dns和域名的 /etc/sysconfig/network-scripts/ifcfg-xxx中的DNS字段会同步到/etc/resolv.conf，后者优先。</span></span><br><span class="line">nameserver 172.25.250.254</span><br></pre></td></tr></table></figure>

<h3 id="测DNS域名解析是否正常"><a href="#测DNS域名解析是否正常" class="headerlink" title="测DNS域名解析是否正常"></a>测DNS域名解析是否正常</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@servera ~]# host classroom.example.com  （至少掌握1个）</span><br><span class="line">classroom.example.com has address 172.25.254.254</span><br><span class="line">[root@servera ~]# nslookup classroom.example.com</span><br><span class="line">Server:     172.25.250.254</span><br><span class="line">Address:    172.25.250.254#53</span><br><span class="line"></span><br><span class="line">Name:   classroom.example.com</span><br><span class="line">Address: 172.25.254.254</span><br><span class="line"></span><br><span class="line">[root@servera ~]# dig classroom.example.com</span><br></pre></td></tr></table></figure>

<h1 id="12-归档与系统间复制文件"><a href="#12-归档与系统间复制文件" class="headerlink" title="12 归档与系统间复制文件"></a>12 归档与系统间复制文件</h1><h2 id="12-1-归档及压缩"><a href="#12-1-归档及压缩" class="headerlink" title="12.1 归档及压缩"></a>12.1 归档及压缩</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line">tar 选项  归档文件名    源文件 源文件2 源文件N</span><br><span class="line">-c  创建</span><br><span class="line">-t  查看</span><br><span class="line">-f  指定文件名</span><br><span class="line">-v  显示详细信息</span><br><span class="line">-x  解包</span><br><span class="line">-C  指定解包路径</span><br><span class="line"></span><br><span class="line">例：</span><br><span class="line">man tar</span><br><span class="line">tar -cvf /root/etc.tar /etc/</span><br></pre></td></tr></table></figure>

<h3 id="文件及目录打包、解包"><a href="#文件及目录打包、解包" class="headerlink" title="文件及目录打包、解包"></a><strong>文件及目录打包、解包</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">将文件打包归档</span><br><span class="line">[root@servera opt]# <span class="built_in">touch</span> file&#123;1..3&#125;</span><br><span class="line">[root@servera opt]#</span><br><span class="line">etc.tar  file1  file2  file3</span><br><span class="line">[root@servera opt]# tar -cvf file.tar file1 file2 file3</span><br><span class="line">file1</span><br><span class="line">file2</span><br><span class="line">file3</span><br><span class="line">[root@servera opt]# tar -tf file.tar</span><br><span class="line">file1</span><br><span class="line">file2</span><br><span class="line">file3</span><br><span class="line"></span><br><span class="line">[root@servera opt]# <span class="built_in">ls</span></span><br><span class="line">etc.tar  file1  file2  file3  file.tar</span><br><span class="line"></span><br><span class="line">为文件解包</span><br><span class="line">[root@servera opt]# tar -xvf file.tar -C /tmp/</span><br><span class="line">file1</span><br><span class="line">file2</span><br><span class="line">file3</span><br><span class="line">[root@servera opt]# <span class="built_in">ls</span> /tmp/</span><br><span class="line">file1  rclocal.log</span><br><span class="line">file2  rht-bastion</span><br><span class="line">file3  rht-default</span><br><span class="line">NIC1   rht-vm-hosts</span><br><span class="line">NIC2   systemd-private-ef2feb022cd2465c9dd920878a1d962b-chronyd.service-kRKFp0</span><br><span class="line">[root@servera opt]# </span><br><span class="line"></span><br><span class="line">将目录打包归档</span><br><span class="line">[root@servera opt]# tar -cvf etc.tar /etc</span><br><span class="line">[root@servera opt]# <span class="built_in">ls</span></span><br><span class="line">etc.tar  file1  file2  file3  file.tar</span><br><span class="line">[root@servera opt]# <span class="built_in">cp</span> etc.tar /home</span><br><span class="line">[root@servera opt]# <span class="built_in">cd</span> /home </span><br><span class="line"></span><br><span class="line">为目录解包</span><br><span class="line">[root@servera opt]# tar -xvf etc.tar </span><br></pre></td></tr></table></figure>

<h3 id="文件压缩"><a href="#文件压缩" class="headerlink" title="文件压缩"></a>文件压缩</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">只压缩文件：</span><br><span class="line">[root@servera opt]# gzip file1</span><br><span class="line">[root@servera opt]# <span class="built_in">ls</span></span><br><span class="line">etc.tar  file1.gz  file2  file3  file.tar</span><br><span class="line">[root@servera opt]# file file1.gz </span><br><span class="line">file1.gz: gzip compressed data, was <span class="string">&quot;file1&quot;</span>, last modified: Sun Mar  1 05:54:06 2020, from Unix, original size 0</span><br><span class="line">[root@servera opt]# bzip2 file2</span><br><span class="line">[root@servera opt]# <span class="built_in">ls</span></span><br><span class="line">etc.tar  file1.gz  file2.bz2  file3  file.tar</span><br><span class="line">[root@servera opt]# file file2.bz2 </span><br><span class="line">file2.bz2: bzip2 compressed data, block size = 900k</span><br><span class="line">[root@servera opt]# xz file.tar </span><br><span class="line">[root@servera opt]# <span class="built_in">ls</span></span><br><span class="line">etc.tar  file1.gz  file2.bz2  file3  file.tar.xz</span><br></pre></td></tr></table></figure>

<h3 id="tar打包并压缩"><a href="#tar打包并压缩" class="headerlink" title="tar打包并压缩"></a><strong>tar打包并压缩</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">tar的压缩选项</span><br><span class="line">man tar | grep gzip</span><br><span class="line">-z  gzip</span><br><span class="line">-j  bzip2</span><br><span class="line">-J  xz</span><br><span class="line">打包并压缩</span><br><span class="line"> tar -zcvf /root/etc.tar.gz /etc/</span><br><span class="line">   47  <span class="built_in">cd</span> /root/</span><br><span class="line">   48  <span class="built_in">ls</span></span><br><span class="line">   49  file etc.tar.gz </span><br><span class="line">   50  tar -jcvf /opt.tar.bz2 /opt/</span><br><span class="line">   51  <span class="built_in">ls</span> /</span><br><span class="line">   tar -Jcvf /root/etc.tar.gz /etc/</span><br><span class="line"></span><br><span class="line">解包解压缩并指定路径</span><br><span class="line">tar -zxvf etc.tar.g </span><br><span class="line">tar -zxvf etc.tar.gz -C /opt/</span><br><span class="line">tar xf etc.tar.gz -C /opt/</span><br></pre></td></tr></table></figure>

<h2 id="12-2-远程传输"><a href="#12-2-远程传输" class="headerlink" title="12.2 远程传输"></a>12.2 远程传输</h2><h3 id="scp实现远程文件传输"><a href="#scp实现远程文件传输" class="headerlink" title="scp实现远程文件传输"></a>scp实现远程文件传输</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># scp servra.txt root@bastion:/opt/</span></span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line"><span class="comment"># scp root@bastion:/opt/bastion.txt .</span></span><br><span class="line"><span class="comment"># ls</span></span><br></pre></td></tr></table></figure>

<h3 id="sftp实现远程文件传输"><a href="#sftp实现远程文件传输" class="headerlink" title="sftp实现远程文件传输"></a>sftp实现远程文件传输</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">ID    app   roles</span><br><span class="line">---- ------- ----------------</span><br><span class="line">1     ftp    client</span><br><span class="line">2     sftp   ssh SubService</span><br><span class="line">3     vsftp  service</span><br><span class="line"></span><br><span class="line">sftp instructor@classroom.example.com</span><br><span class="line">instructor@classroom.example.com<span class="string">&#x27;s password:   Asimov</span></span><br><span class="line"><span class="string">sftp&gt; cd /tmp</span></span><br><span class="line"><span class="string">sftp&gt; ls</span></span><br><span class="line"><span class="string">NIC1                                                          NIC1.old                                                       NIC2                                                           NIC2.old                                                         </span></span><br><span class="line"><span class="string">sftp&gt; get testfile.txt </span></span><br><span class="line"><span class="string">Fetching /tmp/testfile.txt to testfile.txt</span></span><br><span class="line"><span class="string">sftp&gt; exit</span></span><br><span class="line"><span class="string">[root@servera opt]# </span></span><br><span class="line"><span class="string">[root@servera opt]# ls</span></span><br><span class="line"><span class="string">etc  testfile.txt</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@servera opt]# touch put.txt</span></span><br><span class="line"><span class="string">[root@servera opt]# sftp instructor@classroom.example.com</span></span><br><span class="line"><span class="string">instructor@classroom.example.com&#x27;</span>s password: </span><br><span class="line">Connected to instructor@classroom.example.com.</span><br><span class="line">sftp&gt; <span class="built_in">cd</span> /tmp/</span><br><span class="line">sftp&gt; put /opt/put.txt </span><br><span class="line">Uploading /opt/put.txt to /tmp/put.txt</span><br><span class="line">/opt/put.txt                                    100%    0     0.0KB/s   00:00    </span><br><span class="line">sftp&gt; <span class="built_in">ls</span></span><br><span class="line">NIC1                  </span><br><span class="line">NIC1.old                   </span><br><span class="line">NIC2</span><br><span class="line">NIC2.old</span><br><span class="line">put.txt</span><br></pre></td></tr></table></figure>

<h3 id="rsync实现同步文件内容"><a href="#rsync实现同步文件内容" class="headerlink" title="rsync实现同步文件内容"></a><strong>rsync实现同步文件内容</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-v  显示详细信息</span><br><span class="line">-a  相当于存档模式</span><br><span class="line">  </span><br><span class="line">本地同步</span><br><span class="line">[root@servera tmp]# rsync -av /var/log/* /tmp</span><br><span class="line"></span><br><span class="line">远程同步</span><br><span class="line">[root@servera tmp]# rsync -av /var/log/* serverb:/tmp</span><br><span class="line">[root@servera tmp]# ssh root@serverb <span class="built_in">ls</span> /tmp</span><br><span class="line"></span><br><span class="line">问题：将serverb上的/var/log/同步到，servera当前目录下</span><br><span class="line">[root@servera tmp]# rsync -av serverb:/var/log/  .</span><br></pre></td></tr></table></figure>

<h1 id="13-安装和升级软件包"><a href="#13-安装和升级软件包" class="headerlink" title="13 安装和升级软件包"></a>13 安装和升级软件包</h1><h2 id="13-1-RPM包管理"><a href="#13-1-RPM包管理" class="headerlink" title="13.1 RPM包管理"></a>13.1 RPM包管理</h2><h3 id="rpm包语法"><a href="#rpm包语法" class="headerlink" title="rpm包语法"></a>rpm包语法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">软件的获取方式：</span><br><span class="line">1、互联网(下载光盘镜像.iso)、直接使用网络yum源</span><br><span class="line">2、光盘</span><br><span class="line"></span><br><span class="line">rpm包语法:rpm 选项 包名</span><br><span class="line">选项：</span><br><span class="line">-i  安装</span><br><span class="line">-v  显示过程</span><br><span class="line">-h  以易读方式显示进度条</span><br><span class="line">-e  卸载</span><br><span class="line">例:rpm -ivh xxx.rpm</span><br><span class="line"></span><br><span class="line">练习:</span><br><span class="line">1. 在f0中进入软件包的存储位置</span><br><span class="line">[root@foundation0 /]# <span class="built_in">cd</span> /content/rhel8.0/x86_64/dvd/AppStream/Packages/</span><br><span class="line">[root@foundation0 Packages]# <span class="built_in">pwd</span></span><br><span class="line">/content/rhel8.0/x86_64/dvd/AppStream/Packages</span><br><span class="line">2.安装软件</span><br><span class="line">[root@foundation0 Packages]# rpm -ivh lftp-4.8.4-1.el8.x86_64.rpm</span><br></pre></td></tr></table></figure>

<h3 id="rpm包查询命令"><a href="#rpm包查询命令" class="headerlink" title="rpm包查询命令"></a>rpm包查询命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">语法:rpm -q 软件包名称</span><br><span class="line">选项：</span><br><span class="line">-q: query     查询，和其他参数配合</span><br><span class="line">-l：list      列出软件包安装后给系统带来的所有文件</span><br><span class="line">-a：all        查看所有已安装的软件包</span><br><span class="line">-c: configure 查看软件包提供的配置文件</span><br><span class="line"></span><br><span class="line">练习:</span><br><span class="line">【f0】</span><br><span class="line">[root@foundation0 dvd]# <span class="built_in">pwd</span></span><br><span class="line">/content/rhel8.4/x86_64/dvd</span><br><span class="line"></span><br><span class="line">【servera】</span><br><span class="line">[root@servera yum.repos.d]# vim /etc/yum.repos.d/rhel_dvd.repo</span><br><span class="line"> http://content.example.com/rhel8.4/x86_64/dvd/BaseOS</span><br><span class="line"> http://content.example.com/rhel8.4/x86_64/dvd/AppStream</span><br><span class="line">通过浏览器打开以上地址，可以查询到lftp或telnet相关软件，网页中ctrl+f搜索，输入lftp找到对应的软件，右键copy Link location，再到命令行中粘贴即可</span><br><span class="line">rpm -ivh http://foundation0.ilt.example.com/dvd/AppStream/Packages/telnet-0.17-73.el8.x86_64.rpme</span><br><span class="line">rpm -q telnet</span><br><span class="line">rpm -q ssh</span><br><span class="line">rpm -q openssh</span><br><span class="line">rpm -qa</span><br><span class="line">rpm -qa | grep telnet</span><br><span class="line">rpm -qa | grep ssh</span><br><span class="line">rpm -ql telnet</span><br><span class="line">rpm -qc telnet</span><br><span class="line">rpm -qc openssh</span><br><span class="line">rpm -qc openssh-server</span><br><span class="line">rpm -qa  | grep ssh</span><br><span class="line">rpm -qc openssh-server-8.0p1-4.el8_1.x86_64</span><br><span class="line">vim /etc/ssh/sshd_config</span><br><span class="line">rpm -qf /etc/ssh/sshd_config</span><br><span class="line">rpm -qi openssh-server-8.0p1-4.el8_1.x86_64</span><br><span class="line"></span><br><span class="line">卸载RPM包</span><br><span class="line">[root@node1 /]# rpm -q telnet</span><br><span class="line">telnet-0.17-73.el8.x86_64</span><br><span class="line">[root@node1 /]# rpm -e telnet-0.17-73.el8.x86_64</span><br><span class="line">[root@node1 /]# rpm -q telnet</span><br><span class="line">package telnet is not installed</span><br></pre></td></tr></table></figure>

<h2 id="13-2-YUM工具"><a href="#13-2-YUM工具" class="headerlink" title="13.2 YUM工具"></a>13.2 YUM工具</h2><h3 id="管理yum源文件"><a href="#管理yum源文件" class="headerlink" title="管理yum源文件"></a>管理yum源文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">yum源软件配置方式:</span><br><span class="line">[root@servera /]# <span class="built_in">cd</span> /etc/yum.repos.d/</span><br><span class="line">[root@servera yum.repos.d]# <span class="built_in">mkdir</span> old</span><br><span class="line">[root@servera yum.repos.d]# <span class="built_in">mv</span> * old     <span class="comment">#将系统默认的yum源文件移动到old中，可以在该文件中查看原来的yum源路径</span></span><br><span class="line">[root@servera yum.repos.d]# man 5 yum.conf</span><br><span class="line">[root@servera yum.repos.d]# vim rhel.repo</span><br><span class="line">[AppStream]      <span class="comment">#id名称自定义</span></span><br><span class="line">name=AppStream   <span class="comment">#描述自定义，和id不必一样</span></span><br><span class="line">baseurl=http://content.example.com/rhel8.4/x86_64/dvd/AppStream   <span class="comment">#file:///中://是url格式，第三个/是根目录</span></span><br><span class="line">gpgcheck=0   <span class="comment">#gpgchek=1 要进行公钥验证，需要再添加选项gpgkey=http://content.example.com/rhel8.4/x86_64/dvd/RPM-GPG-KEY-redhat-release</span></span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">[BaseOS]</span><br><span class="line">name=BaseOS</span><br><span class="line">baseurl=http://content.example.com/rhel8.4/x86_64/dvd/BaseOS</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">[root@servera yum.repos.d]# yum clean all           <span class="comment">#清除缓存，避免沿用之前缓存的软件</span></span><br><span class="line">[root@servera yum.repos.d]# yum makecache           <span class="comment">#和当前yum源建立缓存关联</span></span><br><span class="line">[root@servera yum.repos.d]# yum repolist all        <span class="comment">#查看当前yum源状态</span></span><br><span class="line">[root@servera yum.repos.d]# yum install -y telnet   <span class="comment">#测试安装软件telnet</span></span><br><span class="line">[root@servera yum.repos.d]# rpm -q telnet           <span class="comment">#使用rpm方式查询测试</span></span><br></pre></td></tr></table></figure>

<h3 id="yum源的命令配置方法"><a href="#yum源的命令配置方法" class="headerlink" title="yum源的命令配置方法"></a>yum源的命令配置方法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">1 找到提供yum-config-manager命令的软件包名称</span><br><span class="line">[foundation0]</span><br><span class="line">[kiosk@foundation0 ~]$ yum provides yum-config-manager</span><br><span class="line">dnf-utils-4.0.2.2-3.el8.noarch <span class="comment">#发现提供yum-config-manager命令的包叫dnf-utils(8.0版本里的名字)，如果8.4版本名称为yum-utils</span></span><br><span class="line"></span><br><span class="line">2 安装yum-utils软件</span><br><span class="line">打开浏览器输入yum源仓库地址，找到yum-utils的软件包，并且通过rpm命令安装网络上的yum-utils软件包，来提通yum-config-manager命令</span><br><span class="line">[root@servera ]# rpm -ivh http://content.example.com/rhel8.4/x86_64/dvd/BaseOS/Packages/yum-utils-4.0.18-4.el8.noarch.rpm</span><br><span class="line"></span><br><span class="line">3  通过yum-config-manager命令部署yum源</span><br><span class="line">[root@servera ]# yum-config-manager --<span class="built_in">help</span></span><br><span class="line">[root@servera ]# yum-config-manager --add-repo=http://content.example.com/rhel8.4/x86_64/dvd/AppStream</span><br><span class="line">[root@servera ]# yum-config-manager --add-repo=http://content.example.com/rhel8.4/x86_64/dvd/BaseOS</span><br><span class="line"></span><br><span class="line">4 命令制作的yum源中没有gpgcheck选项，如何配置？可以通过以下三种方法：</span><br><span class="line">   1、此处可以在/etc/yum.repos.d/xx.repo文件里添加 gpgcheck=0 （推荐方案）</span><br><span class="line">   2、或者配置/etc/yum.conf,配置gpgcheck=1，改为0 （只在练习考试时使用）</span><br><span class="line">   3、或者rpm --import ‘公钥地址’   导入公钥`  （推荐方案）</span><br><span class="line">[root@servera yum.repos.d]# rpm --import http://content.example.com/rhel8.4/x86_64/dvd/RPM-GPG- KEY-redhat-release  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">培训环境里/etc/pki/rpm-gpg/保存了公钥</span><br><span class="line">[root@servera ]# find / -name *KEY*</span><br><span class="line">[root@servera ]# rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release</span><br><span class="line">[root@servera ]# yum clean all</span><br><span class="line">[root@servera ]# yum repolist all</span><br><span class="line"></span><br><span class="line">对称</span><br><span class="line">非对称加密</span><br><span class="line">公钥（解密）  私钥（加密）红帽发布软件包到互联网</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">开启或关闭</span><br><span class="line">[root@servera /]# yum-config-manager --<span class="built_in">disable</span> rhel-8.0-for-x86_64-appstream-rpms（yum 池ID）</span><br><span class="line">[root@servera /]# yum repolist all</span><br><span class="line">[root@servera /]# yum-config-manager --<span class="built_in">enable</span> rhel-8.0-for-x86_64-appstream-rpms</span><br><span class="line">[root@servera /]# yum repolist all</span><br></pre></td></tr></table></figure>

<h3 id="YUM命令的练习"><a href="#YUM命令的练习" class="headerlink" title="YUM命令的练习"></a>YUM命令的练习</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">yum常见命令</span><br><span class="line"></span><br><span class="line">yum list httpd</span><br><span class="line">yum list http*</span><br><span class="line">yum search httpd</span><br><span class="line">yum search ssh</span><br><span class="line">yum info httpd-manual</span><br><span class="line">[root@servera /]# yum provides /var/www/html</span><br><span class="line">yum update</span><br><span class="line">yum install  包名</span><br><span class="line">yum remove   包名</span><br><span class="line">yum install -y httpd</span><br><span class="line"></span><br><span class="line">[root@servera /]# yum install  -y autofs</span><br><span class="line">[root@servera /]# yum remove -y autofs</span><br><span class="line">[root@servera /]# yum <span class="built_in">history</span></span><br><span class="line">yum clean all 清除缓存</span><br><span class="line">yum list</span><br><span class="line">yum repolist </span><br><span class="line">yum repolist all</span><br><span class="line">servera:</span><br><span class="line">yum group list</span><br><span class="line">yum groupinfo <span class="string">&#x27;Server with GUI&#x27;</span></span><br><span class="line">yum groupinstall -y <span class="string">&#x27;Server with GUI&#x27;</span></span><br><span class="line">startx 切图形</span><br></pre></td></tr></table></figure>

<h2 id="13-3-第三方YUM源"><a href="#13-3-第三方YUM源" class="headerlink" title="13.3 第三方YUM源"></a>13.3 第三方YUM源</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">【基础环境foundation】</span><br><span class="line">1.虚拟机联网</span><br><span class="line">虚拟机设置里面NAT选择已连接</span><br><span class="line">nmcli connection up ens192</span><br><span class="line">2.百度搜索（阿里源、华为源...），将.repo文件下载到系统</span><br><span class="line">curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-vault-8.5.2111.repo</span><br><span class="line">3.验证</span><br><span class="line"><span class="built_in">cd</span> /etc/yum.repos.d/;<span class="built_in">ls</span></span><br><span class="line">yum repolist all</span><br><span class="line">yum install -y vsftpd</span><br></pre></td></tr></table></figure>

<h1 id="14-访问Linux文件系统"><a href="#14-访问Linux文件系统" class="headerlink" title="14 访问Linux文件系统"></a>14 访问Linux文件系统</h1><h2 id="14-1-存储管理概念"><a href="#14-1-存储管理概念" class="headerlink" title="14.1 存储管理概念"></a>14.1 存储管理概念</h2><h3 id="文件系统、存储和块设备"><a href="#文件系统、存储和块设备" class="headerlink" title="文件系统、存储和块设备"></a>文件系统、存储和块设备</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">块设备命名</span><br><span class="line">-------------------------------- --------------------------------- --</span><br><span class="line">/dev/sda、/dev/sdb               STAT/SAS（新SCSI技术）/USB   附加存储                          </span><br><span class="line">/dev/vda、/dev/vdb               virtio-blk      超虚拟化存储（部分虚拟机）        </span><br><span class="line">/dev/nvme0，/dev/nvme1           附加存储 （SSD）                  </span><br><span class="line">/dev/mmcblk0、/dev/mmcblk1       SD卡  </span><br></pre></td></tr></table></figure>

<h3 id="磁盘分区"><a href="#磁盘分区" class="headerlink" title="磁盘分区"></a>磁盘分区</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">分区（可选）--格式化--挂载--使用</span><br><span class="line">mount命令挂载是临时的，意味着重启系统后将取消挂载。需要手动重新挂载。永久挂载需要将挂载项记入/etc/fstab中（下次基本存储课讲）</span><br><span class="line"></span><br><span class="line">1 分区，gpt方案 ，分2个区，每个1G</span><br><span class="line">[root@servera ~]# fdisk /dev/vdb</span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): m</span><br><span class="line">   d   delete a partition    <span class="comment">#删除分区</span></span><br><span class="line">   n   add a new partition   <span class="comment">#创建分区</span></span><br><span class="line">   p   <span class="built_in">print</span> the partition table  <span class="comment">#打印分区表</span></span><br><span class="line">   w   write table to disk and <span class="built_in">exit</span>   <span class="comment">#保存并退出</span></span><br><span class="line">  Create a new label</span><br><span class="line">   g   create a new empty GPT partition table  <span class="comment">#指定分区方案gpt，分区前指定一次即可 </span></span><br><span class="line">   o   create a new empty DOS partition table  <span class="comment">#指定分区方位mbr</span></span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): g   <span class="comment">#指定分区方案gpt</span></span><br><span class="line">Created a new GPT disklabel (GUID: D29B3E19-BA51-1042-BFE6-0FD975D1B7DB).</span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): n</span><br><span class="line">Partition number (1-128, default 1): <span class="comment">#回车</span></span><br><span class="line">First sector (2048-10485726, default 2048):  <span class="comment">#回车</span></span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G,T,P&#125; (2048-10485726, default 10485726): +1G  <span class="comment">#指定分区大小1G</span></span><br><span class="line"></span><br><span class="line">Created a new partition 1 of <span class="built_in">type</span> <span class="string">&#x27;Linux filesystem&#x27;</span> and of size 1 GiB.</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): p</span><br><span class="line">Disklabel <span class="built_in">type</span>: gpt  <span class="comment">#查看分区方案</span></span><br><span class="line"></span><br><span class="line">Device     Start     End Sectors Size Type  <span class="comment">#分区表</span></span><br><span class="line">/dev/vdb1   2048 2099199 2097152   1G Linux filesystem  <span class="comment">#/dev/vdb 分区为1G</span></span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): n   <span class="comment">#创建第二个分区</span></span><br><span class="line">Partition number (2-128, default 2): </span><br><span class="line">First sector (2099200-10485726, default 2099200): </span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G,T,P&#125; (2099200-10485726, default 10485726): +1G</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): p</span><br><span class="line">Device       Start     End Sectors Size Type</span><br><span class="line">/dev/vdb1     2048 2099199 2097152   1G Linux filesystem</span><br><span class="line">/dev/vdb2  2099200 4196351 2097152   1G Linux filesystem</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): w  <span class="comment">#保存退出</span></span><br><span class="line">[root@servera ~]# fdisk -l /dev/vdb  <span class="comment">#查看/dev/vdb分区表</span></span><br><span class="line">Device       Start     End Sectors Size Type</span><br><span class="line">/dev/vdb1     2048 2099199 2097152   1G Linux filesystem</span><br><span class="line">/dev/vdb2  2099200 4196351 2097152   1G Linux filesystem</span><br><span class="line"></span><br><span class="line">[root@servera ~]# lsblk /dev/vdb   <span class="comment">#lsblk查看块设备</span></span><br><span class="line">NAME   MAJ:MIN RM SIZE RO TYPE MOUNTPOINT</span><br><span class="line">vdb    252:16   0   5G  0 disk </span><br><span class="line">├─vdb1 252:17   0   1G  0 part </span><br><span class="line">└─vdb2 252:18   0   1G  0 part </span><br><span class="line">[root@servera ~]# </span><br><span class="line"></span><br><span class="line">2 格式化，将两个分区分别格式化为ext4和xfs文件系统</span><br><span class="line"></span><br><span class="line">语法：</span><br><span class="line">mkfs 选项  设备名</span><br><span class="line">-t 指定文件系统类型</span><br><span class="line">例子：</span><br><span class="line">mkfs -t ext4 /dev/vdb1  <span class="comment">#方法1</span></span><br><span class="line">mkfs.ext4 /dev/vdb1     <span class="comment">#方法2</span></span><br><span class="line"></span><br><span class="line">[root@servera /]# mkfs -t ext4 /dev/vdb1   <span class="comment">#mkfs格式化 ext4是文件系统类型 /dev/vdb1是要格式化的磁盘分区</span></span><br><span class="line">[root@servera /]# <span class="built_in">echo</span> $?  <span class="comment">#    $?是看上一条命令返回值，0为正确，非0为错误</span></span><br><span class="line">0</span><br><span class="line">[root@servera /]# mkfs.xfs /dev/vdb2</span><br><span class="line">[root@servera /]# <span class="built_in">echo</span> $?</span><br><span class="line">0</span><br><span class="line">[root@servera ~]# lsblk -f</span><br><span class="line">[root@servera ~]# lsblk -f /dev/vdb  <span class="comment">#查看文件系统类型，</span></span><br><span class="line">NAME   FSTYPE LABEL UUID                                 MOUNTPOINT</span><br><span class="line">vdb                                                      </span><br><span class="line">├─vdb1 ext4         ecb332da-5bf4-4b86-b92e-d9da25f22a07 </span><br><span class="line">└─vdb2 xfs          b538bf38-2b33-4d53-a785-372627587c52 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3 挂载</span><br><span class="line">创建挂载点</span><br><span class="line"><span class="built_in">mkdir</span> /mnt/disk1</span><br><span class="line">文件系统：格式化后的设备或分区</span><br><span class="line">挂载点：linux中的空目录</span><br><span class="line"></span><br><span class="line">语法：</span><br><span class="line">挂载</span><br><span class="line">mount  文件系统  挂载点</span><br><span class="line">mount  /dev/vdb1  /mnt/disk1</span><br><span class="line">卸载</span><br><span class="line">umount 文件系统/挂载点</span><br><span class="line">umount /dev/vdb1 or umount /mnt/disk1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#挂载</span></span><br><span class="line">[root@servera ~]# lsblk -f /dev/vdb</span><br><span class="line">NAME   FSTYPE LABEL UUID                                 MOUNTPOINT</span><br><span class="line">vdb                                                      </span><br><span class="line">├─vdb1 ext4         ecb332da-5bf4-4b86-b92e-d9da25f22a07 </span><br><span class="line">└─vdb2 xfs          b538bf38-2b33-4d53-a785-372627587c52 </span><br><span class="line">[root@servera ~]# <span class="built_in">mkdir</span> /mnt/&#123;disk1,disk2&#125;  <span class="comment"># 创建挂载点</span></span><br><span class="line">[root@servera ~]# <span class="built_in">ls</span> /mnt</span><br><span class="line">disk1  disk2</span><br><span class="line">[root@servera ~]# mount /dev/vdb1 /mnt/disk1  <span class="comment">#将/dev/vdb1 挂载到/mnt/disk1目录上</span></span><br><span class="line">[root@servera ~]# <span class="built_in">df</span> </span><br><span class="line">[root@servera ~]# <span class="built_in">df</span> -Th  <span class="comment">#-T 显示文件系统，-h以易读单位显示</span></span><br><span class="line">Filesystem     Type      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/vdb1      ext4      976M  2.6M  907M   1% /mnt/disk1</span><br><span class="line">/dev/vdb2      xfs      1014M   40M  975M   4% /mnt/disk2</span><br><span class="line">[root@servera ~]# tree /mnt/</span><br><span class="line">/mnt/</span><br><span class="line">├── disk1</span><br><span class="line">│   ├── haha.txt</span><br><span class="line">│   └── lost+found</span><br><span class="line">└── disk2</span><br><span class="line">    └── heihei.txt</span><br><span class="line"> 卸载   </span><br><span class="line">[root@servera ~]# <span class="built_in">cd</span> /mnt/disk2</span><br><span class="line">[root@servera disk2]# umount /dev/vdb2      <span class="comment">#使用时不能卸载</span></span><br><span class="line">umount: /mnt/disk2: target is busy.</span><br><span class="line">[root@servera disk2]# <span class="built_in">cd</span> /    <span class="comment">#需要退出挂载点</span></span><br><span class="line">[root@servera /]# umount /dev/vdb2   <span class="comment">#卸载</span></span><br><span class="line">[root@servera /]# <span class="built_in">df</span> -h | <span class="built_in">tail</span> -2</span><br><span class="line">tmpfs           183M     0  183M   0% /run/user/0</span><br><span class="line">/dev/vdb1       976M  2.6M  907M   1% /mnt/disk1</span><br></pre></td></tr></table></figure>

<h3 id="检查文件系统"><a href="#检查文件系统" class="headerlink" title="检查文件系统"></a><strong>检查文件系统</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">df</span> 查看系统挂载状态</span><br><span class="line">-T 查看文件系统类型</span><br><span class="line">-h 以易读方式列出容量单位</span><br><span class="line"></span><br><span class="line"><span class="built_in">du</span> 查看文件大小</span><br><span class="line">[root@servera /]# <span class="built_in">du</span> /etc/</span><br><span class="line">[root@servera /]# <span class="built_in">du</span> -h /etc/</span><br><span class="line">[root@servera /]# <span class="built_in">du</span> -sh  /etc/</span><br><span class="line">24M /etc/</span><br><span class="line"></span><br><span class="line">[root@servera /]# <span class="built_in">du</span> /etc/man_db.conf </span><br><span class="line">8   /etc/man_db.conf</span><br><span class="line">[root@servera /]# <span class="built_in">du</span> /etc/man_db.conf  -h  <span class="comment">#占用了的块大小，linux默认一个块4k</span></span><br><span class="line">8.0K    /etc/man_db.conf</span><br><span class="line">[root@servera /]# ll /etc/man_db.conf </span><br><span class="line">-rw-r--r--. 1 root root 5165 Nov  7  2018 /etc/man_db.conf</span><br></pre></td></tr></table></figure>

<h2 id="14-2-文件查找-locate和find"><a href="#14-2-文件查找-locate和find" class="headerlink" title="14.2 文件查找-locate和find"></a>14.2 文件查找-locate和find</h2><h4 id="locate"><a href="#locate" class="headerlink" title="locate"></a><strong>locate</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">locate</span><br><span class="line">updatedb    <span class="comment">#收集所有文件元数据</span></span><br><span class="line">locate passwd</span><br><span class="line">locate -i image</span><br><span class="line">locate -n 5  image   <span class="comment">#显示前5行</span></span><br></pre></td></tr></table></figure>

<h4 id="find"><a href="#find" class="headerlink" title="find"></a><strong>find</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line">find  查找范围  查找条件   动作(可选)</span><br><span class="line"></span><br><span class="line">例：</span><br><span class="line">find /  -name  passwd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">选项：</span><br><span class="line">-name： 以文件名的形式查找</span><br><span class="line">-size： 根据文件大小 -size 1k ：大小为1k的文件，+1k大于1k的文件，-1k小于1k的文件</span><br><span class="line">-user /  -uid： 文件所有者   -user studnet  ：student是用户名，查找student拥有的文件</span><br><span class="line">-group / -gid</span><br><span class="line">-perm： 权限查找     -perm 700 ：搜索权限为700的文件</span><br><span class="line">-<span class="built_in">type</span>： 按文件类型   -<span class="built_in">type</span> f ： f表示文件，d表示目录</span><br><span class="line">动作：</span><br><span class="line">-<span class="built_in">exec</span>： 选项后接Linux指令，操作查找到的文件  <span class="built_in">command</span> &#123;&#125; ; </span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">find / -name sshd_config</span><br><span class="line">find /etc -name sshd_config</span><br><span class="line">find /etc -name <span class="string">&#x27;*pass*&#x27;</span></span><br><span class="line">find / -iname <span class="string">&#x27;*pass*&#x27;</span> -iname 不区分大小写</span><br><span class="line">find / -user student</span><br><span class="line">find / -group student</span><br><span class="line">find /home -uid 1000</span><br><span class="line">find /home/ -gid 1000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">find / -user student | xargs <span class="built_in">ls</span> -l</span><br><span class="line">find / -perm 700 | xargs <span class="built_in">ls</span> -l</span><br><span class="line">ll -d /usr/share/selinux/targeted/default/active/modules/disabled</span><br><span class="line">find / -perm 700 -<span class="built_in">type</span> f</span><br><span class="line">ll /boot/efi/EFI/redhat/shimx64.efi</span><br><span class="line">find / -perm 700 -<span class="built_in">type</span> d -user student</span><br><span class="line">find / -perm 700 -<span class="built_in">type</span> d -user student | xargs <span class="built_in">ls</span> -ld</span><br><span class="line">find / -<span class="built_in">type</span> f -size +10k</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /home</span><br><span class="line">find /home/ -perm 700</span><br><span class="line"></span><br><span class="line">find /etc/ -size 10M</span><br><span class="line">find /etc/ -size +10M</span><br><span class="line">find /etc/ -size -10M</span><br><span class="line">查找一个‘文件’，大于3k小于10k</span><br><span class="line">find /etc -<span class="built_in">type</span> f -size +3k  -and -size -10k</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ll -a</span><br><span class="line"><span class="built_in">cd</span> /etc/</span><br><span class="line">ll -h</span><br><span class="line">find ./ -size +1k    如果是小于1k   用-1k</span><br><span class="line"><span class="built_in">du</span> -sh man_db.conf </span><br><span class="line"></span><br><span class="line">find /etc -size +1k -and -size -10k &gt; /root/test2.txt</span><br><span class="line">find / -size +1k  -and -size -100k -<span class="built_in">type</span> f | xargs <span class="built_in">du</span> -sh</span><br><span class="line">find / -perm -g=s | xargs <span class="built_in">ls</span> -ld     </span><br><span class="line">find / -perm -4000 | xargs <span class="built_in">ls</span> -ld</span><br><span class="line"></span><br><span class="line">SUID 4     </span><br><span class="line">SGID 2</span><br><span class="line">SBIT 1</span><br><span class="line"><span class="built_in">chmod</span> 2700 <span class="built_in">dir</span></span><br><span class="line"></span><br><span class="line">rwxr-sr-- 2754</span><br><span class="line">将系统中student用户的文件复制到/root/studentdir目录中，并且保留权限</span><br><span class="line">[root@servera ~]# find / -user student -<span class="built_in">exec</span> <span class="built_in">cp</span> -a &#123;&#125; /root/studentdir/ \;</span><br><span class="line"></span><br><span class="line">将系统中student用户的文件列表保存到/root/studentdir文件中</span><br><span class="line">find / -user student &gt; /root/studentdir</span><br></pre></td></tr></table></figure>

<h2 id="14-3-ln-软链接与硬链接"><a href="#14-3-ln-软链接与硬链接" class="headerlink" title="14.3 ln 软链接与硬链接"></a>14.3 ln 软链接与硬链接</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">软链接：使用范围广，方便访问源文件</span><br><span class="line">硬链接：节省系统空间</span><br><span class="line"></span><br><span class="line">文件链接创建方式：</span><br><span class="line"></span><br><span class="line">软链接（符号链接）</span><br><span class="line"><span class="built_in">ln</span> -s 源文件   链接文件</span><br><span class="line">硬链接：</span><br><span class="line"><span class="built_in">ln</span> 源文件  链接文件</span><br></pre></td></tr></table></figure>

<h3 id="软链接"><a href="#软链接" class="headerlink" title="软链接"></a><strong>软链接</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s 源文件  链接文件</span><br><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line"><span class="built_in">touch</span> file1</span><br><span class="line"><span class="built_in">mkdir</span> <span class="built_in">dir</span></span><br><span class="line"><span class="built_in">ln</span> -s file1 linkfile1</span><br><span class="line"><span class="built_in">ln</span> -s dir1 linkdir1</span><br></pre></td></tr></table></figure>

<h3 id="硬链接"><a href="#硬链接" class="headerlink" title="硬链接"></a><strong>硬链接</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /</span><br><span class="line"></span><br><span class="line">[root@servera opt]# <span class="built_in">echo</span> 123 &gt; /opt/sou_file.txt</span><br><span class="line">[root@servera opt]# <span class="built_in">cat</span> /opt/sou_file.txt </span><br><span class="line"><span class="built_in">ln</span> /opt/sou_file.txt /opt/link_file.txt</span><br><span class="line"></span><br><span class="line">取消链接</span><br><span class="line">[root@servera opt]# <span class="built_in">unlink</span> /opt/link_file.txt</span><br><span class="line">[root@servera opt]# <span class="built_in">ls</span></span><br><span class="line">sou_file.txt</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<h3 id="软链接和硬链接区别"><a href="#软链接和硬链接区别" class="headerlink" title="软链接和硬链接区别"></a><strong>软链接和硬链接区别</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1.命令相同 参数不同</span><br><span class="line">2.硬链接的权限和源文件完全一致   </span><br><span class="line">软链接的链接文件权限永远是777 和源文件权限不同</span><br><span class="line">3.硬链接可以删除，移动源文件</span><br><span class="line">软链接不可以删除，移动源文件</span><br><span class="line">4.软链接inode和源文件不同</span><br><span class="line">硬链接的inode的源文件相同</span><br><span class="line">5.软链接可以对目录及文件生效</span><br><span class="line">硬链接只可以对文件操作</span><br><span class="line">6.软链接可以跨文件系统</span><br><span class="line">硬链接不可以跨文件系统</span><br></pre></td></tr></table></figure>

<h1 id="15-分析服务器获取支持"><a href="#15-分析服务器获取支持" class="headerlink" title="15 分析服务器获取支持"></a>15 分析服务器获取支持</h1><h2 id="15-1-cockpit"><a href="#15-1-cockpit" class="headerlink" title="15.1 cockpit"></a>15.1 cockpit</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@servera /]# yum install -y cockpit</span><br><span class="line">[root@servera /]# systemctl start cockpit</span><br><span class="line">[root@servera /]# systemctl status cockpit</span><br><span class="line"></span><br><span class="line">添加开机自启动方式：</span><br><span class="line">vim /usr/lib/systemd/system/cockpit.service</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">systemctl <span class="built_in">enable</span> cockpit</span><br><span class="line"></span><br><span class="line">[root@serveraaa /]# firewall-cmd --permanent --add-service=cockpit</span><br><span class="line">success</span><br><span class="line">[root@serveraaa /]# firewall-cmd --reload</span><br><span class="line">success</span><br><span class="line">[root@serveraaa /]# firewall-cmd --list-all</span><br><span class="line">public (active)</span><br><span class="line">  target: default</span><br><span class="line">  icmp-block-inversion: no</span><br><span class="line">  interfaces: enp1s0</span><br><span class="line">  sources: </span><br><span class="line">  services: cockpit dhcpv6-client ssh</span><br><span class="line">  ports: </span><br><span class="line">  protocols: </span><br><span class="line">  masquerade: no</span><br><span class="line">  forward-ports: </span><br><span class="line">  source-ports: </span><br><span class="line">  icmp-blocks: </span><br><span class="line">  rich rules: </span><br><span class="line"> </span><br><span class="line"> netstat -ntlp  | grep 9090</span><br><span class="line"></span><br><span class="line">连接cockpit</span><br><span class="line">foundation  连接servera</span><br><span class="line">浏览器  http：//172.25.250.10:9090</span><br><span class="line">添加信任</span><br><span class="line">输入用户名密码  root  redhat</span><br></pre></td></tr></table></figure>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/Linux/">Linux</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/Linux%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/">Linux基本使用</a></div><hr></div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2025/04/15/podman%E5%AE%B9%E5%99%A8/"><img class="fill" src="/img/podman.jpg" alt="podman容器"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2025-04-15  <a class="commentCountImg" href="/2025/04/15/podman%E5%AE%B9%E5%99%A8/#comment-container"><span class="display-none-class">954d5aafcf9d4db9278abc7309588654</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="954d5aafcf9d4db9278abc7309588654">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>2 小时  <i class="fas fa-pencil-alt"> </i>15.6 k</span></div><div class="pin-icon"><i class="fas fa-thumbtack"></i></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/04/15/podman%E5%AE%B9%E5%99%A8/">podman容器</a></h1><div class="content"><h1 id="1-容器概念"><a href="#1-容器概念" class="headerlink" title="1 容器概念"></a><strong>1 容器概念</strong></h1><p><img src="https://gitee.com/suzhen99/redhat/raw/master/images/podman.svg" alt="podman"></p>
<h2 id="容器技术介绍"><a href="#容器技术介绍" class="headerlink" title="容器技术介绍"></a><strong>容器技术介绍</strong></h2><p>​      软件应用通常依赖于运行时环境(runtimeenvironment)提供的系统库、配置文件或服务。传统上，软件应用的运行时环境安装在物理主机或虚拟机上运行的操作系统中。然后，管理员在操作系统上安装应用依赖项</p>
<p>​      在红帽企业Linux中，诸如RPM等打包系统可协助管理员管理应用依赖项。安装httpd软件包时，RPM系统会确保同时安装该软件包的正确库和其他依赖项</p>
<p>​      传统方式部署软件应用的主要弊端是这些依赖项会受到运行时环境的束缚，应用需要的支持软件的版本可能比操作系统提供的软件更旧或更新。同一系统上的两个应用可能需要同一软件互不兼容的不同版本</p>
<p>​     解决这些冲突的方式之一是将应用打包并作为容器进行部署<br>​     容器是由一个或多个与系统其余部分隔离的进程组成的集合，软件容器是打包应用以简化其部署和管理的一种方式<br>​     以实体集装箱为例。集装箱是打包和装运货物的标准方式。它作为一个箱子进行标记、装载、卸载，以及从一个位置运输到另一个位置。集装箱中的内容与其他集装箱的内容隔离，因此互不影响。这些基本原则也适用于软件容器</p>
<h2 id="容器的核心技术"><a href="#容器的核心技术" class="headerlink" title="容器的核心技术"></a><strong>容器的核心技术</strong></h2><p>  <strong>红帽企业Linux通过运用以下核心技术来支持容器:</strong></p>
<p>1.用于资源管理的控制组(cgroups)</p>
<p>2.用于进程隔离的命名空间</p>
<p>3.加强安全边界的SELinux和Seccomp安全计算模式</p>
<h2 id="容器和虚拟机的差异"><a href="#容器和虚拟机的差异" class="headerlink" title="容器和虚拟机的差异"></a><strong>容器和虚拟机的差异</strong></h2><p>1.容器提供许多与虚拟机相同的益处，如安全、存储和网络隔离等<br>2.这两种技术都将其应用库和运行时资源与主机操作系统或虚拟机监控程序隔离开，反之亦</p>
<p>3.容器和虚拟机以不同的方式与硬件和底层操作系统交互</p>
<p>** 4.虚拟机具有以下特征:</p>
<p>** 使多个操作系统能够同时在一个硬件平台上运行</p>
<p>** 使用虚拟机监控程序将硬件分为多个虚拟硬件系统</p>
<p>** 需要一个完整的操作系统环境来支持该应用</p>
<p>** 5.容器具有以下特征:</p>
<p>** 直接在操作系统上运行，从而跨系统上的所有容器共享资源</p>
<p>** 共享主机的内核，但它将应用进程与系统其余部分隔离开来</p>
<p>** 与虚拟机相比，它需要的硬件资源要少得多，因此容器的启动速度也更快</p>
<p>** 包括所有依赖项，如系统和编程依赖项，以及配置设置</p>
<h2 id="Rootless和Rootful容器"><a href="#Rootless和Rootful容器" class="headerlink" title="Rootless和Rootful容器"></a><strong>Rootless和Rootful容器</strong></h2><p><strong>在容器主机上，由特权用户运行的容器称为Rootful容器、由非特权用户运行的容器称为Rootless容器</strong></p>
<p>**<br>Rootless容器不允许使用通常为特权用户保留的系统资源，例如访问受限目录，或在受限端口(1024以下的端口)上发布网络服务。此功能可防止潜在攻击者获取容器主机上的root特权</p>
<p>**<br>如有必要，可使用root用户身份直接运行容器，但如果有漏洞允许攻击者破坏容器，这样做会削弱系统的安全性</p>
<h2 id="设计基于容器的架构"><a href="#设计基于容器的架构" class="headerlink" title="设计基于容器的架构"></a><strong>设计基于容器的架构</strong></h2><p>  <strong>容器是重复利用托管应用并使其可以移植的有效方式</strong></p>
<p>**<br><strong>容器可以轻松地从一个环境迁移到另一个环境，如从开发环境迁移到生产环境</strong></p>
<p><strong>** 可以保存一个容器的多个版本，并根据需要快速访问每个版本</strong></p>
<p><strong>**<br>容器通常是临时的，可以将运行中容器所生成的数据永久保存到持久存储中，但容器本身通常会在需要时运行，然后停止并被删除，下次需要该特定容器时，将启动新的容器进程</strong></p>
<p><strong>**<br>可以在单个容器中安装含有多个服务的复杂软件应用。例如，Web服务器可能需要使用数据库和消息传递系统。不过，将一个容器用于多个服务会难以管理</strong></p>
<p><strong>**<br>更好的设计是在单独的容器中运行每个组件、Web服务器、数据库和消息传递系统。这样，更新和维护单个应用组件不会影响其他组件或应用堆栈</strong></p>
<h2 id="容器镜像和注册表"><a href="#容器镜像和注册表" class="headerlink" title="容器镜像和注册表"></a><strong>容器镜像和注册表</strong></h2><p>  <strong>运行容器必须使用容器镜像:</strong></p>
<p>**<br>容器镜像是包含编码步骤的静态文件，它充当创建容器的蓝图。容器镜像打包应用及其所有依赖项，如系统库、编程语言运行时和库以及其他配置设置**</p>
<p>**<br>容器镜像根据规范构建，如开放容器项目(OCI)镜像格式规范。这些规范定义容器镜像的格式，以及镜像支持的容器主机操作系统和硬件架构的元数据</p>
<p>**<br>容器注册表是用于存储和检索容器镜像的存储库。开发人员将容器镜像推送或上传到容器注册表中。可以从注册表中将这些容器镜像拉取或下载到本地系统，以用于运行容器</p>
<p>** 可使用包含第三方镜像的公共注册表，也可使用贵组织控制的私有注册表</p>
<p>容器镜像来源很重要。和任何其他软件包一样，必须知道是否可以信任容器镜像中的代码。对于是否及如何提供、评估和测试提交给它们的容器镜像，不同的注册表具有不同的策略</p>
<p>**<br>红帽通过两个主容器注册表分发认证容器镜像，可以使用红帽登录凭据来访问这两个注册表:</p>
<p>** 1.utility.redhat.io: 适用于基于官方红帽产品的容器</p>
<p>** 2.utilityconnect.redhat,com:适用于基于第三方产品的容器</p>
<p>**<br>3.红帽容器目录(<a target="_blank" rel="noopener" href="https://access.redhat.com/containers)%E6%8F%90%E4%BE%9B%E4%BA%86%E4%B8%80%E4%B8%AA%E5%9F%BA%E4%BA%8EWeb%E7%9A%84%E7%95%8C%E9%9D%A2%EF%BC%8C%E9%80%9A%E8%BF%87%E5%AE%83%E5%8F%AF%E4%BB%A5%E6%90%9C%E7%B4%A2%E8%BF%99%E4%BA%9B%E6%B3%A8%E5%86%8C%E8%A1%A8%E4%B8%AD%E7%9A%84%E8%AE%A4%E8%AF%81%E5%86%85%E5%AE%B9%E3%80%82">https://access.redhat.com/containers)提供了一个基于Web的界面，通过它可以搜索这些注册表中的认证内容。</a></p>
<p>**<br>4.培训环境中添加了红帽Quay,官方为收费版，培训环境中为免费版utility.lab.example.com</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 环境中使用的镜像仓库浏览器访问为:</span></span><br><span class="line">https://utility   账号是:admin  密码:redhat321</span><br><span class="line"><span class="comment"># 镜像对应的地址为:utility.lab.example.com</span></span><br><span class="line"></span><br><span class="line">[kiosk@foundation0 ~]$ <span class="built_in">cat</span> /etc/hosts</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line"><span class="comment">### rht-vm-hosts file listing the entries to be appended to /etc/hosts</span></span><br><span class="line"></span><br><span class="line">172.25.250.254 bastion.lab.example.com bastion</span><br><span class="line">172.25.250.10  servera.lab.example.com servera</span><br><span class="line">172.25.250.11  serverb.lab.example.com serverb</span><br><span class="line">172.25.250.220 utility.lab.example.com utility</span><br><span class="line">172.25.250.9   workstation.lab.example.com workstation</span><br><span class="line"><span class="comment"># 登录servera请使用ssh方式，不要使用su切换。</span></span><br><span class="line"><span class="comment"># 安装容器:</span></span><br><span class="line">[root@foundation0 ~]# ssh root@servera</span><br><span class="line">[root@servera ~]# ssh student@localhost</span><br><span class="line">[student@servera ~]$ <span class="built_in">sudo</span> dnf -y install container-tools    <span class="comment"># 安装podman容器 </span></span><br><span class="line">[student@servera ~]$ podman --version</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录容器:</span></span><br><span class="line"><span class="comment"># 需要红帽开发人员账户才能从红帽注册表下载镜像。可以使用podman login命令对注册表进行身份验证。如果不向podman login命令提供注册表URL，它会向默认配置的注册表进行身份验证</span></span><br><span class="line">$ podman login --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录方法一(交互)：</span></span><br><span class="line">$ podman login utility.lab.example.com </span><br><span class="line">Username: admin</span><br><span class="line">Password: redhat321</span><br><span class="line">Login Succeeded!</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录方法二(非交互)： # 推荐</span></span><br><span class="line">$ podman login utility.lab.example.com -u admin -p redhat321  <span class="comment"># 生产环境中是有https验证的</span></span><br><span class="line">Login Succeeded!</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman login -u admin -p redhat321 utility.lab.example.com</span><br><span class="line">Error: authenticating creds <span class="keyword">for</span> <span class="string">&quot;utility.lab.example.com&quot;</span>: pinging container registry utility.lab.example.com: Get <span class="string">&quot;https://utility.lab.example.com/v2/&quot;</span>: tls: failed to verify certificate: x509: certificate is not valid <span class="keyword">for</span> any names, but wanted to match utility.lab.example.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果出现以上报错，是要求https验证，需要通过选项--tls-verify进行手动关闭</span></span><br><span class="line"><span class="comment"># podman login utility.lab.example.com -u admin -p redhat321 --tls-verify=false</span></span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman login --<span class="built_in">help</span></span><br><span class="line">Description:</span><br><span class="line">  Log <span class="keyword">in</span> to a container registry on a specified server.</span><br><span class="line">Usage:</span><br><span class="line">  podman login [options] [REGISTRY]</span><br><span class="line">Examples:</span><br><span class="line">  podman login quay.io</span><br><span class="line">  podman login --username ... --password ... quay.io</span><br><span class="line">  podman login --authfile <span class="built_in">dir</span>/auth.json quay.io</span><br><span class="line">Options:</span><br><span class="line">      --authfile string   path of the authentication file. Use REGISTRY_AUTH_FILE environment variable to override</span><br><span class="line">      --cert-dir string   use certificates at the specified path to access the registry</span><br><span class="line">      --get-login         Return the current login user <span class="keyword">for</span> the registry</span><br><span class="line">  -p, --password string   Password <span class="keyword">for</span> registry</span><br><span class="line">      --password-stdin    Take the password from stdin</span><br><span class="line">      --tls-verify        Require HTTPS and verify certificates when contacting registries</span><br><span class="line">  -u, --username string   Username <span class="keyword">for</span> registry</span><br><span class="line">  -v, --verbose           Write more detailed information to stdout</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman login -u admin -p redhat321 utility.lab.example.com --tls-verify=<span class="literal">false</span></span><br><span class="line">Login Succeeded!</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录方法三(非交互):</span></span><br><span class="line"><span class="comment"># 使用podman login命令的--username和--password-sdtin选项，指定用于登录注册表的用户和密码</span></span><br><span class="line"><span class="comment"># --password-stdin选项从stdin读取密码</span></span><br><span class="line"><span class="comment"># 红帽建议不要使用--password选项直接提供密码，因为此选项会将密码存储在日志文件中</span></span><br><span class="line">$ <span class="built_in">echo</span> redhat321 | podman login -u admin --password-stdin utility.lab.example.com  </span><br><span class="line">Login Succeeded!</span><br></pre></td></tr></table></figure>

<p><strong>要验证您是否已登录到某一注册表，请使用 podman login命令<br>–get-login选项。及退出登录podman logout</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ podman login --get-login   <span class="comment"># 查看登录的用户</span></span><br><span class="line">admin</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman login utility.lab.example.com --get-login    <span class="comment"># 指定仓库地址，查看登录用户</span></span><br><span class="line">admin</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman <span class="built_in">logout</span> utility.lab.example.com  <span class="comment"># 登出</span></span><br><span class="line">Removed login credentials <span class="keyword">for</span> utility.lab.example.com</span><br></pre></td></tr></table></figure>

<h3 id="配置容器注册表"><a href="#配置容器注册表" class="headerlink" title="配置容器注册表"></a><strong>配置容器注册表</strong></h3><p><strong>容器注册表的默认配置文件是 &#x2F;etc&#x2F;containers&#x2F;registries.conf 文件</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ <span class="built_in">sudo</span> vim /etc/containers/registries.conf</span><br><span class="line">[<span class="built_in">sudo</span>] password <span class="keyword">for</span> student: student</span><br><span class="line"></span><br><span class="line"><span class="comment">#第22行 指定可搜索的镜像仓库地址，如果使用完全合格域名，此处可以留空</span></span><br><span class="line">unqualified-search-registries = [<span class="string">&quot;utility.lab.example.com&quot;</span>,<span class="string">&quot;registry.access.redhat.com&quot;</span>,<span class="string">&quot;registry.redhat.io&quot;</span>,<span class="string">&quot;docker.io&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#第24行</span></span><br><span class="line">[[utility]]   解除注释开启以下功能</span><br><span class="line"></span><br><span class="line"><span class="comment">#第37行</span></span><br><span class="line">insecure = <span class="literal">true</span>    <span class="comment">#false/true 开启https安全验证/关闭安全验证</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#第40行</span></span><br><span class="line">blocked = <span class="literal">false</span>    <span class="comment">#需要过滤掉的镜像仓库地址</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#第56行</span></span><br><span class="line">location = <span class="string">&quot;utility.lab.example.com&quot;</span> 指定容器注册表位置</span><br><span class="line"></span><br><span class="line">$注意</span><br><span class="line">~/.config/containers/registries.conf目录设置会覆盖/etc/containers/registries.conf</span><br><span class="line"></span><br><span class="line">推荐：</span><br><span class="line">【student】</span><br><span class="line">$ <span class="built_in">mkdir</span> -p ~/.config/containers</span><br><span class="line">$ <span class="built_in">cp</span> /etc/containers/registries.conf ~/.config/containers/registries.conf</span><br><span class="line">$ vim ~/.config/containers/registries.conf</span><br><span class="line">unqualified-search-registries = [<span class="string">&quot;utility.lab.example.com&quot;</span>] </span><br><span class="line">[[utility]]   </span><br><span class="line">insecure = <span class="literal">true</span> </span><br><span class="line">blocked = <span class="literal">false</span>    </span><br><span class="line">location = <span class="string">&quot;utility.lab.example.com&quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录容器注册表</span></span><br><span class="line">[student@servera ~]$ podman login -u admin -p redhat321 utility.lab.example.com</span><br><span class="line">Login Succeeded!</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据仓库地址搜索镜像</span></span><br><span class="line">[student@servera ~]$ podman search utility.lab.example.com/</span><br><span class="line">NAME                                       DESCRIPTION</span><br><span class="line">utility.lab.example.com/rhel8/mariadb-103  </span><br><span class="line">utility.lab.example.com/rhel9/mariadb-105  </span><br><span class="line">utility.lab.example.com/rhel9/httpd-24     </span><br><span class="line">utility.lab.example.com/library/nginx      </span><br><span class="line">utility.lab.example.com/ubi7/ubi           </span><br><span class="line">utility.lab.example.com/ubi9/ubi           </span><br><span class="line">utility.lab.example.com/ubi8/ubi           </span><br><span class="line">utility.lab.example.com/ubi9/python-312    </span><br><span class="line">utility.lab.example.com/rhel9/php-82  </span><br><span class="line"></span><br><span class="line">注意：如果只访问本地仓库，unqualified-search-registries = [<span class="string">&quot;utility.lab.example.com&quot;</span>]默认即可，但要需要访问外网，需要用root用户修改vim /etc/resolv.conf文件内容添加nameserver 8.8.8.8 优先解析。</span><br><span class="line">阿里容器</span><br><span class="line">i2kldsde.mirror.aliyuncs.com</span><br></pre></td></tr></table></figure>

<h3 id="使用容器文件构建容器镜像"><a href="#使用容器文件构建容器镜像" class="headerlink" title="使用容器文件构建容器镜像"></a><strong>使用容器文件构建容器镜像</strong></h3><hr>
<p>  <strong>容器文件是一种文本文件，内含用于构建容器镜像的指令。</strong></p>
<p>**<br>容器文件通常具有定义其文件和目录所在路径或URL的上下文。生成的容器镜像由只读层组成，每一层代表容器文件中的一条指令。**</p>
<p>**<br>以下输出是一个容器文件示例，它使用utility.access.redhat.com注册表中的UBI镜像,安装<br>python3 软件包，并将 hello 字符串打印到控制台。**</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> Containerfile</span><br><span class="line">FROM utility.access.redhat.com/ubi8/ubi:latest</span><br><span class="line">RUN dnf install -y python3</span><br><span class="line">CMD[<span class="string">&quot;/bin/bash&quot;</span>，<span class="string">&quot;-c&quot;</span>，<span class="string">&quot;echo hello&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>创建容器文件及其使用说明超出了本课程的范畴。有关容器文件的更多信息，请参阅DO180课程。</p>
<h3 id="规模化容器管理"><a href="#规模化容器管理" class="headerlink" title="规模化容器管理"></a><strong>规模化容器管理</strong></h3><hr>
<p><strong>新应用越来越多地使用容器来实施功能组件。这些容器提供应用的其他部分使用的服务。组织管理越来越多的容器，可能很快就会不堪重负。</strong></p>
<p><strong>在生产中大规模部署容器需要一个能够应对以下挑战的环境:</strong></p>
<ul>
<li><strong>平台必须确保提供必要服务的容器的可用性。</strong></li>
<li><strong>环境必须通过增加或减少运行中的容器实例，并对流量进行负载平衡，从而应对应用的使用高峰。</strong></li>
<li><strong>平台必须检测容器或主机的故障，并相应地作出反应。</strong></li>
<li><strong>开发人员可能需要自动工作流，以便透明、安全地向客户交付新的应用版本。</strong></li>
</ul>
<p><strong>Kubernetes是一项编排服务，可以使在容器主机集群中部署、管理和扩展基于容器的应用变得更加轻而易举。Kubernetes<br>通过负载平衡器将流量重定向到容器，以便您可以扩展提供服务的容器数量。Kubernetes<br>还支持用户定义的健康检查，以便监控您的容器，并在容器出现故障时将其重新启动。</strong></p>
<p><strong>红帽提供了一个名为红帽OpenShift 的kubernetes<br>发行版。红帽OpenShift是基于<br>Kubernetes基础架构构建的一组模块化组件和服务。它为开发人员提供的额外功能包括基于<br>Web<br>的远程管理、多租户、监控与审计、高级安全功能、应用生命周期管理和自助服务实例等。</strong></p>
<p><strong>红帽OpenShift不在本课程讨论范围之内，但您可以通过<a target="_blank" rel="noopener" href="https://www.openshift.com了解更多相关信息./">https://www.openshift.com了解更多相关信息。</a></strong></p>
<h2 id="34-2-部署容器"><a href="#34-2-部署容器" class="headerlink" title="34.2 部署容器"></a><strong>34.2 部署容器</strong></h2><h3 id="Podman实用程序"><a href="#Podman实用程序" class="headerlink" title="Podman实用程序"></a><strong>Podman实用程序</strong></h3><hr>
<p>**<br><strong>Podman是来自container-tools元数据包的全功能容器引警，用于管理开放容器计划(0C)容器和镜像</strong></p>
<p><strong>**<br>podman实用程序的运作不使用守护进程，因此开发人员无需系统上的特权用户帐户来启动或停止容器</strong></p>
<p><strong>**<br>Podman提供多个子命令来与容器和镜像交互。以下列表显示了本节中使用的子命令:</strong></p>
<p><strong>** Podman的命令:</strong></p>
<p>  命令             描述</p>
<hr>
<p>  podman build     使用容器文件构建容器镜像<br>  podman run       在新容器中运行命令<br>  podman images    列出本地存储中的镜像<br>  podman ps        打印有关容器的信息<br>  podman inspect   显示容器、镜像、卷、网络或容器集的配置<br>  podman pull      从注册表下载镜像<br>  podman cp        在容器和本地文件系统之间复制文件或目录<br>  podman exec      在运行中的容器内执行命令<br>  podman rm        删除一个或多个容器<br>  podman rmi       删除一个或多个本地存储的镜像<br>  podman search    在注册表中搜索镜像</p>
<p><strong>有关各个子命令使用帮助手册的更多信息，请将子命令附加到podman命令，并用连字符将两者分隔。例如，podman-build帮助手册介绍了podman<br>build子命令的用法。</strong></p>
<p>** 为阐述本课中的主题，请想象以下情景:**</p>
<p>** 作为系统管理员，您被委任了一项任务，使用<br>python-38软件包运行基于名为python38的RHEL8UBI容器镜像的容器。您还有一项任务，从容器文件创建容器镜像，并从该容器镜像运行名为python36的容器。使用容器文件创建的容器镜像必须具有python36:1.0标签。识别两个容器之间的差异。另外，请确保容器中安装的python软件包与本地计算机中安装的Python版本不相冲突。**</p>
<h3 id="安装容器实用工具"><a href="#安装容器实用工具" class="headerlink" title="安装容器实用工具"></a><strong>安装容器实用工具</strong></h3><hr>
<p>  <strong>container-tools 软件包包含与容器和容器镜像交互所需的实用程序</strong></p>
<p>** 若要在系统上下载、运行和比较容器，请使用dnf<br>install命令来安装container-tools 元软件包**</p>
<p>** 使用dnf info命令查看 container-tools 软件包的版本和内容**</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ <span class="built_in">sudo</span> dnf -y install container-tools    <span class="comment"># 安装podman容器 </span></span><br><span class="line">[student@servera ~]$ podman --version</span><br><span class="line">[student@servera ~]$ dnf info container-tools</span><br></pre></td></tr></table></figure>

<p>  <strong>container-tools元数据包提供所需的podman和skope<br>实用程序，用于完成分配的任务</strong></p>
<h3 id="从注册表下载容器镜像文件"><a href="#从注册表下载容器镜像文件" class="headerlink" title="从注册表下载容器镜像文件"></a><strong>从注册表下载容器镜像文件</strong></h3><hr>
<p><strong>1.确保podman实用程序已配置为从utility.lab.example.com注册表搜索和下载容器</strong></p>
<p>** 2.podman<br>info命令显示podman实用程序的配置信息，包括其配置的注册表**</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman info</span><br></pre></td></tr></table></figure>

<p>  <strong>podman<br>search命令使用registries.conf文件中指定的注册表列表搜索匹配的名称镜像。默认情况下，Podman在所有非限定搜索注册表中执行搜索</strong></p>
<h3 id="让servera联网方法"><a href="#让servera联网方法" class="headerlink" title="让servera联网方法"></a><strong>让servera联网方法</strong></h3><hr>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、f0宿主机上ens192是第二块网卡，vmware上选择nat模式-选择‘已连接’，再获取IP，保证可以上网</span><br><span class="line">2、在f0宿主机上执行ssh root@172.25.254.254 rht-config-nat</span><br><span class="line">3、servera上ping www.baidu.com测试  </span><br></pre></td></tr></table></figure>

<p><strong>使用podman<br>search命令，显示包含python-38软件包的已配置注册表的镜像列表</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在注册表中搜索镜像</span></span><br><span class="line">[student@servera ~]$ podman search utility.lab.example.com/</span><br><span class="line">NAME                                       DESCRIPTION</span><br><span class="line">utility.lab.example.com/rhel8/mariadb-103  </span><br><span class="line">utility.lab.example.com/rhel9/mariadb-105  </span><br><span class="line">utility.lab.example.com/rhel9/httpd-24     </span><br><span class="line">utility.lab.example.com/library/nginx      </span><br><span class="line">utility.lab.example.com/ubi7/ubi           </span><br><span class="line">utility.lab.example.com/ubi9/ubi           </span><br><span class="line">utility.lab.example.com/ubi8/ubi           </span><br><span class="line">utility.lab.example.com/ubi9/python-312    </span><br><span class="line">utility.lab.example.com/rhel9/php-82 </span><br><span class="line"></span><br><span class="line"><span class="comment"># 从注册表中下载镜像</span></span><br><span class="line">[student@servera ~]$ podman pull utility.lab.example.com/ubi7/ubi</span><br><span class="line">[student@servera ~]$ podman pull utility.lab.example.com/rhel8/mariadb-103</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出本地存储中的镜像</span></span><br><span class="line">[student@servera ~]$ podman images</span><br><span class="line">REPOSITORY                                 TAG         IMAGE ID      CREATED      SIZE</span><br><span class="line">utility.lab.example.com/ubi7/ubi           latest      87dd8ec61bbc  4 years ago  215 MB</span><br><span class="line">utility.lab.example.com/rhel8/mariadb-103  latest      11a47e0fbed0  4 years ago  572 MB</span><br><span class="line"></span><br><span class="line"><span class="comment"># 镜像信息注解:</span></span><br><span class="line">REPOSITORY   :仓库地址</span><br><span class="line">TAG          ：标记，latest最近版本</span><br><span class="line">IMAGE ID     ：镜像ID，ID号唯一，保证镜像唯一性</span><br><span class="line">CREATED      ：创建时间；</span><br><span class="line">SIZE         ：镜像大小</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">练习：</span><br><span class="line">以普通用户身份远程登录系统</span><br><span class="line">ssh student@localhost  </span><br><span class="line">1.登录容器镜像仓库服务器utility.lab.example.com</span><br><span class="line">$ <span class="built_in">sudo</span> vim /etc/containers/registries.conf </span><br><span class="line">$ podman login -u admin -p redhat321 utility.lab.example.com </span><br><span class="line"></span><br><span class="line">2.搜索镜像服务器仓库utility.lab.example.com所有镜像</span><br><span class="line">$ podman search utility.lab.example.com/</span><br><span class="line"></span><br><span class="line">3.下载rhel7、8、9的ubi系统到本地</span><br><span class="line">$ podman pull utility.lab.example.com/ubi7/ubi</span><br><span class="line">$ podman pull utility.lab.example.com/ubi8/ubi</span><br><span class="line">$ podman pull utility.lab.example.com/ubi9/ubi</span><br><span class="line"></span><br><span class="line">4.查看本地镜像</span><br><span class="line">$ podman images</span><br><span class="line"></span><br><span class="line">5.通过rhel7的ubi运行一个交互式容器,然后退出</span><br><span class="line">$ podman run -ti utility.lab.example.com/ubi7/ubi</span><br><span class="line">$ <span class="built_in">exit</span>   <span class="comment">#或者按ctrl+d</span></span><br><span class="line"></span><br><span class="line">6.通过rhel8的ubi运行一个长期挂载到后台的容器</span><br><span class="line">$ podman run -di utility.lab.example.com/ubi8/ubi</span><br><span class="line"></span><br><span class="line">7.通过rhel9的ubi运行一个长期挂载到后台的容器，并且指定容器名称为rhel9</span><br><span class="line">[student@servera ~]$ podman run -di --name rhel9 utility.lab.example.com/ubi9/ubi</span><br><span class="line">b4b889bb5964acae14a6e7c2d138e8cc56e9ebf94edf9653f5341522ffc9ec76</span><br><span class="line"></span><br><span class="line">8.进入rhel9容器进行交互</span><br><span class="line">[student@servera ~]$ podman <span class="built_in">exec</span> -ti rhel9 /bin/bash</span><br><span class="line">[root@b4b889bb5964 /]# <span class="built_in">cat</span> /etc/redhat-release</span><br><span class="line">Red Hat Enterprise Linux release 9.3 (Plow)</span><br><span class="line"></span><br><span class="line">9.使用httpd-24镜像运行一个web服务。并且访问测试</span><br><span class="line"><span class="comment">#本地测试，如果在其他主机上访问servera容器web服务，需要在servera防火墙允许主机端口8090</span></span><br><span class="line"></span><br><span class="line">10.使用nginx镜像运行一个web服务。并且访问测试，nginx容器内端口为80</span><br><span class="line"></span><br><span class="line">11.尝试运行一个mariadb-105的容器</span><br></pre></td></tr></table></figure>

<h3 id="从容器文件创建容器镜像"><a href="#从容器文件创建容器镜像" class="headerlink" title="从容器文件创建容器镜像"></a><strong>从容器文件创建容器镜像</strong></h3><hr>
<p>** 您获得了以下容器文件，用于在 python36-app目录中创建容器镜像**</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> Containerfile </span><br><span class="line">FROM utility.access.redhat.com/ubi8/ubi:latest</span><br><span class="line">RUN dnf install -y python36</span><br><span class="line">CMD[<span class="string">&quot;/bin/bash&quot;</span>，<span class="string">&quot;-c&quot;</span>，<span class="string">&quot;sleep infinity&quot;</span>]</span><br><span class="line"><span class="comment"># 此容器文件是教材中例子默认报错，可以使用下面的容器文件</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ vim Containerfile</span><br><span class="line">FROM utility.lab.example.com/ubi9/ubi:latest</span><br><span class="line">RUN <span class="built_in">echo</span> -e <span class="string">&#x27;[rhel-9.3-for-x86_64-baseos-rpms]\nbaseurl = http://content.example.com/rhel9.3/x86_64/dvd/BaseOS\nenabled = true\ngpgcheck = false\nname = Red Hat Enterprise Linux 9.3 BaseOS (dvd)\n[rhel-9.3-for-x86_64-appstream-rpms]\nbaseurl = http://content.example.com/rhel9.3/x86_64/dvd/AppStream\nenabled = true\ngpgcheck = false\nname = Red Hat Enterprise Linux 9.3 Appstream (dvd)&#x27;</span>&gt;/etc/yum.repos.d/rhel_dvd.repo</span><br><span class="line">RUN yum install --disablerepo=* --enablerepo=rhel-9.3-for-x86_64-baseos-rpms --enablerepo=rhel-9.3-for-x86_64-appstream-rpms -y python3</span><br><span class="line">CMD [<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;sleep infinity&quot;</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>以上容器文件使用utility.lab.example.com&#x2F;ubi9&#x2F;ubi:latest镜像作为基础镜像。容器文件而后将安装python36<br>软件包，并运行sleep infinity bash命令来防止容器退出</strong></li>
<li><strong>通常，容器运行一个进程，然后在该进程完成后退出。sleep<br>nfinity命令可防止容器退出因为该进程永远不会完成。然后可以在容器内进行测试、开发和调试</strong></li>
<li><strong>在检查容器文件后，可以使用podman build命令来构建镜像。podman<br>build命令的语法如下所示:</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ podman build -t NAME:TAG  DIR</span><br><span class="line">[student@servera ~]$ podman build -t rhel7:2.0 .</span><br><span class="line">[student@servera ~]$ podman images</span><br><span class="line">REPOSITORY                                 TAG         IMAGE ID      CREATED         SIZE</span><br><span class="line">localhost/rhel7                            2.0         98d0b6385a00  40 seconds ago  238 MB</span><br><span class="line">utility.lab.example.com/ubi9/ubi           latest      8d2a8803cfca  12 months ago   219 MB</span><br><span class="line">utility.lab.example.com/ubi7/ubi           latest      87dd8ec61bbc  4 years ago     215 MB</span><br><span class="line">utility.lab.example.com/rhel8/mariadb-103  latest      11a47e0fbed0  4 years ago     572 MB</span><br><span class="line"><span class="comment"># 以上输出的最后一行显示了容器镜像ID。大多数Podman命令使用容器镜像ID的前12个字符来指代容器镜像，可以将此短ID或者容器或容器镜像的名称，作为大多数Podman命令的参数</span></span><br><span class="line"><span class="comment"># 注解:</span></span><br><span class="line">-t,--tag name 生成镜像的名称</span><br><span class="line">NAME:新镜像的名称</span><br><span class="line">标签:新镜像的标签。如果未指定标签，则镜像自动标记为latest</span><br><span class="line">DIR:工作目录路径。容器文件必须位于工作目录中。如果工作目录是当前目录，则可以用点(.)来指定它。使用-f标志指定与当前目录不同的目录</span><br></pre></td></tr></table></figure>

<p><strong>使用podman<br>inspect命令来查看容器镜像的低级别信息，并验证其内容是否符合容器要求:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(podman pull  先下载后再使用inspect)</span><br><span class="line">[student@servera ~]$ podman inspect localhost/rhel7:2.0</span><br></pre></td></tr></table></figure>

<p>** podman<br>inspect命令的输出显示reqistry.access.redhat.com&#x2F;ubi8&#x2F;ubi:latest基础镜像、用于安装<br>python36 软件包的 dnf命令，以及在运行时执行以防止容器退出的sleep<br>infinity bash命令**</p>
<h3 id="运行容器"><a href="#运行容器" class="headerlink" title="运行容器"></a><strong>运行容器</strong></h3><hr>
<p><strong>现在，您已拥有所需的容器镜像，可以使用它们来运行容器。容器可以处于以下状态之一!<br>Created 已创建好但尚未启动的容器。 运行中 与其进程一起运行的容器。<br>已停止 其进程已停止的容器。 Paused 其进程已暂停的容器。不支持 Rootless<br>容器。 Deleted 其进程处于已死状态的容器。</strong></p>
<p>**podman ps命令列出系统上正在运行的容器。使用podman ps<br>-a来命令查看计算机中的所有容器 (已创建、已停止、已暂停或正在运行)。 **</p>
<p>** 可使用podman<br>create命令来创建容器，以便稍后运行。若要创建容器，请使用容器localhost&#x2F;rhel7:2.0镜像的ID。也可以使用–name<br>选项设置名称来标识容器。此命令的输出是容器的长ID,如果不指定–name选项，会自动生成一个容器名称。**</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ podman create --name python36 dd6ca291f097</span><br></pre></td></tr></table></figure>

<p><strong>然后，可使用podman ps和podman ps<br>-a命令来验证容器是否已创建但尚未启动。您可以查看有关 python36<br>容器的信息，如容器的短ID、名称和状态，容器在启动时运行的命令，以及用于创建容器的镜像</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ podman ps </span><br><span class="line">$ podman ps -a</span><br></pre></td></tr></table></figure>

<p><strong>现在已验证容器已正确创建，决定启动容器，所以要运行 podman<br>start命令。可以使用名称或容器ID来启动容器。此命令的输出是容器的名称。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ podman start python36</span><br><span class="line">$ podman ps</span><br></pre></td></tr></table></figure>

<h3 id="从远程存储库运行容器"><a href="#从远程存储库运行容器" class="headerlink" title="从远程存储库运行容器"></a><strong>从远程存储库运行容器</strong></h3><p>  您可使用podman run命令，在一个步骤中创建并运行容器。podman run<br>命令在容器内运行进程，此进程将启动新容器。</p>
<p>  您可以使用podman run<br>命令-d选项以分离模式运行容器，这将在后台运行容器，而不是在会话的前台运行</p>
<p>在python36容器的示例中，您不需要提供容器运行所提的命令，原因是为该容器创建镜像的容器文件中已提供了sleep<br>infinity 命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">podman run </span><br><span class="line">-t  终端</span><br><span class="line">-i  交互</span><br><span class="line">-d  放在后台</span><br><span class="line">--name  指定容器的名称，如果不指定，会自从产生名称</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman run -it utility.lab.example.com/ubi7/ubi</span><br><span class="line">[student@servera ~]$ podman ps</span><br><span class="line">CONTAINER ID  IMAGE                                    COMMAND     CREATED             STATUS             PORTS       NAMES</span><br><span class="line">537b1f1fbb6d  utility.lab.example.com/ubi7/ubi:latest  /bin/bash   About a minute ago  Up About a minute              objective_antonelli</span><br><span class="line"></span><br><span class="line"><span class="comment">#实验前可以提前下载镜像至本地 </span></span><br><span class="line"><span class="comment">#podman search utility.lab.example.com/</span></span><br><span class="line"><span class="comment">#podman pull utility.lab.example.com/ubi8/ubi</span></span><br><span class="line"><span class="comment">#podman images</span></span><br><span class="line">[student@servera ~]$ podman run -it --name rhel9 utility.lab.example.com/ubi9/ubi</span><br><span class="line">[student@servera ~]$ podman run -di --name rhel9-1 utility.lab.example.com/ubi9/ubi</span><br><span class="line">[student@servera ~]$ podman ps</span><br><span class="line">CONTAINER ID  IMAGE                                    COMMAND     CREATED         STATUS         PORTS       NAMES</span><br><span class="line">537b1f1fbb6d  utility.lab.example.com/ubi7/ubi:latest  /bin/bash   5 minutes ago   Up 5 minutes               objective_antonelli</span><br><span class="line">fb45a06e2271  utility.lab.example.com/ubi9/ubi:latest  /bin/bash   56 seconds ago  Up 57 seconds              rhel9-1</span><br><span class="line"></span><br><span class="line"><span class="comment"># ctrl+d退出后再查看容器的状态</span></span><br><span class="line">[student@servera ~]$ podman <span class="built_in">exec</span> -ti rhel9-1 /bin/bash</span><br><span class="line">[student@servera ~]$ podman run -d --name rhel9-2 utility.lab.example.com/ubi9/ubi <span class="built_in">sleep</span> infinity</span><br><span class="line">[student@servera ~]$ podman ps</span><br><span class="line">CONTAINER ID  IMAGE                                    COMMAND         CREATED         STATUS         PORTS       NAMES</span><br><span class="line">fb45a06e2271  utility.lab.example.com/ubi9/ubi:latest  /bin/bash       5 minutes ago   Up 5 minutes               rhel9-1</span><br><span class="line">c4f7f4d72747  utility.lab.example.com/ubi9/ubi:latest  <span class="built_in">sleep</span> infinity  34 seconds ago  Up 34 seconds              rhel9-2</span><br></pre></td></tr></table></figure>

<h3 id="容器中的环境隔离"><a href="#容器中的环境隔离" class="headerlink" title="容器中的环境隔离"></a><strong>容器中的环境隔离</strong></h3><p>  <strong>容器隔离应用的环境</strong></p>
<p>**<br>每个容器都有自己的文件系统、网络和进程。查看ps命令的输出，并在主机和运行中容器之间进行比较，就会注意到隔离功能**</p>
<p>** 在本地计算机上运行ps<br>-ax命令，该命令将返回具有许多进程的预期结果**</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ ps -ax</span><br><span class="line">[student@servera ~]$ podman run -di --name python36-db utility.lab.example.com/rhel8/mariadb-103</span><br><span class="line">f4c3d26df7bd3614e6b4954ae6ed485046128afc89a95cba20c834b2ba0327ff</span><br><span class="line">[student@servera ~]$ podman run -di --name python38 utility.lab.example.com/ubi9/ubi</span><br><span class="line">8e7870d50daa32c768c4301911364285a659a5383b4cdadc96b8d3b7ff411c2d</span><br><span class="line">[student@servera ~]$ podman run -<span class="built_in">id</span> --name rhel7 utility.lab.example.com/ubi7/ubi</span><br><span class="line">2d4b030f4141656f8b4b74d419c2b8de52669927a261953c92409bc995b35922</span><br><span class="line">[student@servera ~]$ podman ps -a</span><br><span class="line">CONTAINER ID  IMAGE                                             COMMAND         CREATED         STATUS                     PORTS       NAMES</span><br><span class="line">850618efbece  utility.lab.example.com/ubi9/ubi:latest           /bin/bash       9 hours ago     Exited (0) 9 hours ago                 rhel9</span><br><span class="line">fb45a06e2271  utility.lab.example.com/ubi9/ubi:latest           /bin/bash       9 hours ago     Up 9 hours                             rhel9-1</span><br><span class="line">c4f7f4d72747  utility.lab.example.com/ubi9/ubi:latest           <span class="built_in">sleep</span> infinity  9 hours ago     Up 9 hours                             rhel9-2</span><br><span class="line">f4c3d26df7bd  utility.lab.example.com/rhel8/mariadb-103:latest  run-mysqld      22 minutes ago  Exited (1) 22 minutes ago              python36-db</span><br><span class="line">8e7870d50daa  utility.lab.example.com/ubi9/ubi:latest           /bin/bash       16 minutes ago  Up 16 minutes                          python38</span><br><span class="line">2d4b030f4141  utility.lab.example.com/ubi7/ubi:latest           /bin/bash       12 seconds ago  Up 13 seconds                          rhel7</span><br></pre></td></tr></table></figure>

<p>  <strong>podman exec命令可在运行中的容器内执行命令</strong></p>
<p>**<br>该命令取容器的名称或ID作为第一个参数，并将下列参数作为要在容器内运行的命令**</p>
<p>** 使用podman exec命令查看rhel7容器中正在运行的进程。ps<br>aux命令的输出看起来有所不同，因为它运行与本地计算机不同的进程**</p>
<p>** 使用sh -c命令来封装要在容器中执行的命令**</p>
<p>** ps ax &gt;<br>&#x2F;tmp&#x2F;process-data.log命令被解释为要在容器中执行的命令。如果不封装命令，则Podman可能会将大于号字符(&gt;)解释为podman命令的一部分，而不是podman<br>exec选项的参数**</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#使用练习环境中的utility.lab.example.com/ubi7/ubi镜像，执行一些其他命令，比如ls /等</span></span><br><span class="line">[student@servera ~]$ podman <span class="built_in">exec</span> rhel7 ps -ax</span><br><span class="line">    PID TTY      STAT   TIME COMMAND</span><br><span class="line">      1 ?        Ss     0:00 /bin/bash</span><br><span class="line">      2 ?        R      0:00 ps -ax</span><br><span class="line">[student@servera ~]$ podman <span class="built_in">exec</span> rhel7 sh -c <span class="string">&#x27;ps -a &gt; /tmp/process_data.log&#x27;</span></span><br><span class="line">[student@servera ~]$ podman <span class="built_in">exec</span> rhel7 sh -c <span class="string">&#x27;echo China &gt; /test.txt&#x27;</span></span><br><span class="line">[student@servera ~]$ podman <span class="built_in">exec</span> -ti rhel7 /bin/bash</span><br><span class="line">[root@2d4b030f4141 /]# <span class="built_in">ls</span> /</span><br><span class="line">bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  test.txt  tmp  usr  var</span><br><span class="line">[root@2d4b030f4141 /]# <span class="built_in">cat</span> test.txt</span><br><span class="line">China</span><br><span class="line">[root@2d4b030f4141 /]# <span class="built_in">cat</span> /tmp/process_data.log</span><br><span class="line">    PID TTY          TIME CMD</span><br><span class="line">[root@2d4b030f4141 /]# <span class="built_in">exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">[student@servera ~]$ </span><br></pre></td></tr></table></figure>

<p>** 将主机系统上安装的python版本与容器上安装的python版本进行比较:**</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman <span class="built_in">exec</span> rhel9-1 python3 --version</span><br><span class="line">Python 3.9.18</span><br><span class="line">[student@servera ~]$ python3 --version</span><br><span class="line">Python 3.9.18</span><br><span class="line">[student@servera ~]$ podman <span class="built_in">exec</span> python38  python3 --version</span><br><span class="line">Python 3.9.18</span><br></pre></td></tr></table></figure>

<h3 id="容器中的文件系统隔离"><a href="#容器中的文件系统隔离" class="headerlink" title="容器中的文件系统隔离"></a><strong>容器中的文件系统隔离</strong></h3><hr>
<p><strong>开发人员可以使用文件系统隔离功能，为不同版本的编程语言编写和测试应用，无需使用多个物理机或虚拟机。</strong></p>
<p><strong>您将在终端上的&#x2F;tmp目录中创建一个显示hello world的简单bash 脚本。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ <span class="built_in">echo</span> <span class="string">&quot;echo Hello China!&quot;</span> &gt; /tmp/hello.sh</span><br><span class="line">[student@servera tmp]$ <span class="built_in">cd</span> /tmp;ll</span><br><span class="line">total 8</span><br><span class="line">-rw-r--r--. 1 student student 18 Mar  3 21:24 hello.sh</span><br><span class="line">-rw-r--r--. 1 student student 30 Mar  3 21:01 process_data.log</span><br><span class="line">drwx------. 3 root    root    17 Mar  3 08:28 systemd-private-3f251aad6ce74edb86dddf89d56e8aed-chronyd.service-c0Zzhi</span><br><span class="line">drwx------. 3 root    root    17 Mar  3 08:28 systemd-private-3f251aad6ce74edb86dddf89d56e8aed-dbus-broker.service-QaiP7N</span><br><span class="line">drwx------. 3 root    root    17 Mar  3 08:28 systemd-private-3f251aad6ce74edb86dddf89d56e8aed-systemd-logind.service-iM6Zeq</span><br></pre></td></tr></table></figure>

<p>  <strong>&#x2F;tmp&#x2F;hello.sh<br>文件位于主机计算机上，而不存在于容器内的文件系统上。如果尝试使用podman<br>exec来执行脚本，则会出现错误，因为容器中不存在&#x2F;tmp&#x2F;hello.sh脚本</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[student@servera tmp]$ <span class="built_in">stat</span> /tmp/hello.sh</span><br><span class="line">  File: /tmp/hello.sh</span><br><span class="line">  Size: 18          Blocks: 8          IO Block: 4096   regular file</span><br><span class="line">Device: fc04h/64516d    Inode: 18159864    Links: 1</span><br><span class="line">Access: (0644/-rw-r--r--)  Uid: ( 1000/ student)   Gid: ( 1000/ student)</span><br><span class="line">Context: unconfined_u:object_r:user_tmp_t:s0</span><br><span class="line">Access: 2025-03-03 21:24:33.865950531 -0500</span><br><span class="line">Modify: 2025-03-03 21:24:33.865950531 -0500</span><br><span class="line">Change: 2025-03-03 21:24:33.865950531 -0500</span><br><span class="line"> Birth: 2025-03-03 21:24:33.865950531 -0500</span><br><span class="line">[student@servera tmp]$ podman <span class="built_in">exec</span> rhel7 <span class="built_in">stat</span> /tmp/hello.sh</span><br><span class="line"><span class="built_in">stat</span>: cannot <span class="built_in">stat</span> <span class="string">&#x27;/tmp/hello.sh&#x27;</span>: No such file or directory</span><br></pre></td></tr></table></figure>

<p><strong>podman cp命令在主机和容器文件系统之间复制文件和文件夹。您可以使用<br>podman cp 命令将&#x2F;tmp&#x2F;hello.sh文件复制到python38容器:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman <span class="built_in">cp</span> /tmp/hello.sh rhel7:/tmp/hello.sh</span><br><span class="line">[student@servera ~]$ podman <span class="built_in">exec</span> rhel7 <span class="built_in">stat</span> /tmp/hello.sh</span><br><span class="line">  File: <span class="string">&#x27;/tmp/hello.sh&#x27;</span></span><br><span class="line">  Size: 18          Blocks: 8          IO Block: 4096   regular file</span><br><span class="line">Device: 58h/88d Inode: 10261231    Links: 1</span><br><span class="line">Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)</span><br><span class="line">Access: 2025-03-04 02:24:34.000000000 +0000</span><br><span class="line">Modify: 2025-03-04 02:24:34.000000000 +0000</span><br><span class="line">Change: 2025-03-04 02:28:24.720471184 +0000</span><br><span class="line"> Birth: -</span><br></pre></td></tr></table></figure>

<p><strong>脚本复制到容器文件系统后，即可从容器内执行:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman <span class="built_in">exec</span> rhel7 bash /tmp/hello.sh</span><br><span class="line">Hello China!</span><br></pre></td></tr></table></figure>

<h3 id="删除容器和镜像"><a href="#删除容器和镜像" class="headerlink" title="删除容器和镜像"></a><strong>删除容器和镜像</strong></h3><hr>
<p>** 使用podman rm和podman rmi命令删除容器和镜像**</p>
<p>** 删除容器镜像之前，必须先从该镜像移除任何现有的运行中容器**</p>
<p>** 删除python38容器及其相关镜像:**</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman ps -a</span><br><span class="line">CONTAINER ID  IMAGE                                             COMMAND         CREATED            STATUS                        PORTS       NAMES</span><br><span class="line">850618efbece  utility.lab.example.com/ubi9/ubi:latest           /bin/bash       10 hours ago       Exited (0) 10 hours ago                   rhel9</span><br><span class="line">fb45a06e2271  utility.lab.example.com/ubi9/ubi:latest           /bin/bash       10 hours ago       Up 10 hours                               rhel9-1</span><br><span class="line">c4f7f4d72747  utility.lab.example.com/ubi9/ubi:latest           <span class="built_in">sleep</span> infinity  10 hours ago       Up 10 hours                               rhel9-2</span><br><span class="line">f4c3d26df7bd  utility.lab.example.com/rhel8/mariadb-103:latest  run-mysqld      About an hour ago  Exited (1) About an hour ago              python36-db</span><br><span class="line">8e7870d50daa  utility.lab.example.com/ubi9/ubi:latest           /bin/bash       55 minutes ago     Up 55 minutes                             python38</span><br><span class="line">2d4b030f4141  utility.lab.example.com/ubi7/ubi:latest           /bin/bash       39 minutes ago     Up 39 minutes                             rhel7</span><br><span class="line">student@servera ~]$ podman rmi utility.lab.example.com/ubi9/ubi:latest</span><br><span class="line">Error: image used by 8e7870d50daa32c768c4301911364285a659a5383b4cdadc96b8d3b7ff411c2d: image is <span class="keyword">in</span> use by a container: consider listing external containers and force-removing image</span><br></pre></td></tr></table></figure>

<p>  <strong>必须先停止容器，然后才能删除它。若要停止容器，请使用podman<br>stop命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman stop python38</span><br><span class="line">python38</span><br></pre></td></tr></table></figure>

<p>停止容器后，使用 podman rm 命令来删除容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman <span class="built_in">rm</span> --<span class="built_in">help</span></span><br><span class="line">[student@servera ~]$ podman <span class="built_in">rm</span> python38</span><br><span class="line">python38</span><br><span class="line">[student@servera ~]$ podman ps -a</span><br><span class="line">CONTAINER ID  IMAGE                                             COMMAND         CREATED            STATUS                        PORTS       NAMES</span><br><span class="line">850618efbece  utility.lab.example.com/ubi9/ubi:latest           /bin/bash       10 hours ago       Exited (0) 10 hours ago                   rhel9</span><br><span class="line">fb45a06e2271  utility.lab.example.com/ubi9/ubi:latest           /bin/bash       10 hours ago       Up 10 hours                               rhel9-1</span><br><span class="line">c4f7f4d72747  utility.lab.example.com/ubi9/ubi:latest           <span class="built_in">sleep</span> infinity  10 hours ago       Up 10 hours                               rhel9-2</span><br><span class="line">f4c3d26df7bd  utility.lab.example.com/rhel8/mariadb-103:latest  run-mysqld      About an hour ago  Exited (1) About an hour ago              python36-db</span><br><span class="line">2d4b030f4141  utility.lab.example.com/ubi7/ubi:latest           /bin/bash       45 minutes ago     Up 45 minutes                             rhel7</span><br></pre></td></tr></table></figure>

<p>** 当容器不再存在时，可以使用podman rmi命令删除对应的镜像:**</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman images</span><br><span class="line">REPOSITORY                                 TAG         IMAGE ID      CREATED        SIZE</span><br><span class="line">localhost/rhel7                            2.0         98d0b6385a00  11 hours ago   238 MB</span><br><span class="line">utility.lab.example.com/ubi9/ubi           latest      8d2a8803cfca  12 months ago  219 MB</span><br><span class="line">utility.lab.example.com/ubi7/ubi           latest      87dd8ec61bbc  4 years ago    215 MB</span><br><span class="line">utility.lab.example.com/rhel8/mariadb-103  latest      11a47e0fbed0  4 years ago    572 MB</span><br><span class="line">[student@servera ~]$ podman rmi 8d2a8803cfca</span><br><span class="line">Error: image used by c4f7f4d727471d590f6241cccf0be0b1ef2256cc43a710594642611fe6d0be47: image is <span class="keyword">in</span> use by a container: consider listing external containers and force-removing image</span><br><span class="line">[student@servera ~]$ podman rmi 98d0b6385a00</span><br><span class="line">Untagged: localhost/rhel7:2.0</span><br><span class="line">Deleted: 98d0b6385a005e09cfcee59a393cfce2fc46b56f09af6c4f87bd874f00966ed2</span><br><span class="line">Deleted: 53c739e51f226903b6568038c9cf563de2007f756e0a0e86e5c00604cf474f3d</span><br><span class="line">Deleted: 92b83aa1157f23b209f53480c6bbdf780c39490b37337bc4f4fcb1061b7c978</span><br></pre></td></tr></table></figure>

<h2 id="34-3-管理容器存储和网络资源"><a href="#34-3-管理容器存储和网络资源" class="headerlink" title="34.3 管理容器存储和网络资源"></a><strong>34.3 管理容器存储和网络资源</strong></h2><h3 id="管理容器资源"><a href="#管理容器资源" class="headerlink" title="管理容器资源"></a><strong>管理容器资源</strong></h3><hr>
<p><strong>可以使用容器来运行简单的进程，然后退出。</strong></p>
<p><strong>还可以配置容器以连续运行某一服务，如数据库服务器。如果您持续运行服务，您最终可能需要向容器添加更多资源，如持久存储或对其他网络的访问权限。</strong></p>
<p><strong>可以使用不同的策略为容器配置持久存储:</strong></p>
<p>** 1.对于红帽OpenShift<br>等企业容器平台上的大型部署，您可以使用复杂的存储解决方案为容器提供存储，而无需了解底层基础架构**</p>
<p>**<br>2.对于单个容器主机上且无需扩展的小型部署，您可以通过在运行中的容器上创建要挂载的目录，从容器主机创建持久存储**</p>
<p><strong>当Web服务器或数据库服务器等容器为容器主机外部的客户端提供内容时，必须为这些客户端设置通信通道，以访问容器的内容。</strong></p>
<p><strong>可以配置端口映射，以启用与容器的通信。通过端口映射，目的地为容器主机上端口的请求将被转发到容器内的端口。</strong></p>
<p><strong>设想必须执行以下任务:</strong></p>
<ul>
<li><p><strong>基于MariaDB，创建名为db01的容器化数据库。</strong></p>
</li>
<li><p><strong>配置容器端口映射和主机防火墙，以允许端口3306&#x2F;tcp 上的流量。</strong></p>
</li>
<li><p><strong>配置db01容器，以使用具有适当SELinux 上下文的持久存储。</strong></p>
</li>
<li><p><strong>添加适当的网络配置，以便client01容器可以使用DNS与db01容器通信。</strong></p>
</li>
</ul>
<h3 id="容器的环境变量"><a href="#容器的环境变量" class="headerlink" title="容器的环境变量"></a><strong>容器的环境变量</strong></h3><hr>
<p><strong>容器镜像允许在创建时传递环境变量以自定义容器</strong></p>
<p><strong>可以使用环境变量为容器设置参数，以根据您的环境进行定制，无需创建自己的自定义镜像。通常，您不会修改容器镜像，因为这会向镜像添加层，或许更加难以维护。</strong></p>
<p>使用podman run -d –name db01<br>utility.lab.example.com&#x2F;rhel8&#x2F;mariadb-103命令运行容器化数据库，但发现容器无法启动。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman search utility.lab.example.com/</span><br><span class="line">NAME                                       DESCRIPTION</span><br><span class="line">utility.lab.example.com/rhel8/mariadb-103  </span><br><span class="line">utility.lab.example.com/rhel9/mariadb-105  </span><br><span class="line">utility.lab.example.com/rhel9/httpd-24     </span><br><span class="line">utility.lab.example.com/library/nginx      </span><br><span class="line">utility.lab.example.com/ubi7/ubi           </span><br><span class="line">utility.lab.example.com/ubi9/ubi           </span><br><span class="line">utility.lab.example.com/ubi8/ubi           </span><br><span class="line">utility.lab.example.com/ubi9/python-312    </span><br><span class="line">utility.lab.example.com/rhel9/php-82 </span><br><span class="line">      </span><br><span class="line">[student@servera ~]$ podman pull utility.lab.example.com/rhel8/mariadb-103</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman images</span><br><span class="line">REPOSITORY                                 TAG         IMAGE ID      CREATED        SIZE</span><br><span class="line">utility.lab.example.com/ubi9/ubi           latest      8d2a8803cfca  12 months ago  219 MB</span><br><span class="line">utility.lab.example.com/ubi7/ubi           latest      87dd8ec61bbc  4 years ago    215 MB</span><br><span class="line">utility.lab.example.com/rhel8/mariadb-103  latest      11a47e0fbed0  4 years ago    572 MB</span><br><span class="line">[student@servera ~]$ podman run -d --name db01 utility.lab.example.com/rhel8/mariadb-103</span><br><span class="line">29decc6e48d62506e62e503a383943709138a8f789a32dd27d2fa1761bf3ea9f</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发现容器无法启动</span></span><br><span class="line">[student@servera ~]$ podman ps -a</span><br><span class="line">CONTAINER ID  IMAGE                                             COMMAND     CREATED        STATUS                    PORTS       NAMES</span><br><span class="line">29decc6e48d6  utility.lab.example.com/rhel8/mariadb-103:latest  run-mysqld  2 minutes ago  Exited (1) 2 minutes ago              db01</span><br></pre></td></tr></table></figure>

<p><strong>使用podman container logs命令调查容器状态的原因。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman container logs db01</span><br><span class="line">Warning: Can<span class="string">&#x27;t detect memory limit from cgroups</span></span><br><span class="line"><span class="string">Warning: Can&#x27;</span>t detect number of CPU cores from cgroups</span><br><span class="line">Warning: Can<span class="string">&#x27;t detect memory limit from cgroups</span></span><br><span class="line"><span class="string">Warning: Can&#x27;</span>t detect number of CPU cores from cgroups</span><br><span class="line">=&gt; sourcing 20-validate-variables.sh ...</span><br><span class="line">You must either specify the following environment variables:</span><br><span class="line">  MYSQL_USER (regex: <span class="string">&#x27;^[a-zA-Z0-9_]+$&#x27;</span>)</span><br><span class="line">  MYSQL_PASSWORD (regex: <span class="string">&#x27;^[a-zA-Z0-9_~!@#$%^&amp;*()-=&lt;&gt;,.?;:|]+$&#x27;</span>)</span><br><span class="line">  MYSQL_DATABASE (regex: <span class="string">&#x27;^[a-zA-Z0-9_]+$&#x27;</span>)</span><br><span class="line">Or the following environment variable:</span><br><span class="line">  MYSQL_ROOT_PASSWORD (regex: <span class="string">&#x27;^[a-zA-Z0-9_~!@#$%^&amp;*()-=&lt;&gt;,.?;:|]+$&#x27;</span>)</span><br><span class="line">Or both.</span><br><span class="line">Optional Settings:</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 输出中的usage 标签提供了如何运行镜像的示例。url标签指向红帽容器目录中的一个Web页面，其中记录了环境变量以及有关如何使用容器镜像的其他信息。</span></span><br><span class="line"><span class="comment"># 此镜像的文档显示容器将3306端口用于数据库服务。文档中还显示了以下环境变量可用于配置数据库服务:</span></span><br><span class="line">[student@servera ~]$ podman images</span><br><span class="line">REPOSITORY                                 TAG         IMAGE ID      CREATED        SIZE</span><br><span class="line">utility.lab.example.com/ubi9/ubi           latest      8d2a8803cfca  12 months ago  219 MB</span><br><span class="line">utility.lab.example.com/ubi7/ubi           latest      87dd8ec61bbc  4 years ago    215 MB</span><br><span class="line">utility.lab.example.com/rhel8/mariadb-103  latest      11a47e0fbed0  4 years ago    572 MB</span><br><span class="line">[student@servera ~]$ podman inspect utility.lab.example.com/rhel8/mariadb-103 | grep usage</span><br><span class="line">                    <span class="string">&quot;usage&quot;</span>: <span class="string">&quot;podman run -d -e MYSQL_USER=user -e MYSQL_PASSWORD=pass -e MYSQL_DATABASE=db -p 3306:3306 rhel8/mariadb-103&quot;</span>,</span><br><span class="line">               <span class="string">&quot;usage&quot;</span>: <span class="string">&quot;podman run -d -e MYSQL_USER=user -e MYSQL_PASSWORD=pass -e MYSQL_DATABASE=db -p 3306:3306 rhel8/mariadb-103&quot;</span>,</span><br><span class="line"></span><br><span class="line">$ skopeo inspect docker://utility.lab.example.com/rhel8/mariadb-105 | grep -B 1 Usage</span><br><span class="line"><span class="comment">#练习过程中可以将usage中提示的示例指令作为参考。</span></span><br></pre></td></tr></table></figure>

<p><strong>mariadb镜像的环境变量:</strong></p>
<p>  变量                  描述</p>
<hr>
<p>  MYSQL_USER            要创建的MySQL帐户的用户名<br>  MYSQL_PASSWORD        用户帐户的密码<br>  MYSQL_DATABASE        数据库名称<br>  MYSQL_ROOT_PASSWORD   root用户的密码 (可选)</p>
<p><strong>在检查了镜像的可用环境变量后，使用podman<br>run命令-e选项将环境变量传递给容器，并使用podman<br>ps命令来验证它是否正在运行。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman <span class="built_in">rm</span> -af</span><br><span class="line">29decc6e48d62506e62e503a383943709138a8f789a32dd27d2fa1761bf3ea9f</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman ps -a</span><br><span class="line">CONTAINER ID  IMAGE       COMMAND     CREATED     STATUS      PORTS       NAMES</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman run -d --name db01 -e MYSQL_USER=user -e MYSQL_PASSWORD=pass -e MYSQL_DATABASE=db utility.lab.example.com/rhel8/mariadb-103</span><br><span class="line">41a62ff2efd7f268e52d6f6a0a9b503411824c5f4391b86dae5d3f01376cb896</span><br><span class="line"></span><br><span class="line"><span class="comment"># 容器启动成功</span></span><br><span class="line">[student@servera ~]$ podman ps  -a</span><br><span class="line">CONTAINER ID  IMAGE                                             COMMAND     CREATED        STATUS        PORTS       NAMES</span><br><span class="line">41a62ff2efd7  utility.lab.example.com/rhel8/mariadb-103:latest  run-mysqld  8 seconds ago  Up 8 seconds              db01</span><br></pre></td></tr></table></figure>

<h3 id="容器持久存储"><a href="#容器持久存储" class="headerlink" title="容器持久存储"></a><strong>容器持久存储</strong></h3><hr>
<p>** 默认情况下运行容器时，所有内容都使用基于容器的镜像**</p>
<p>**<br>鉴于容器镜像的寿命短，用户或应用写入的所有新数据在移除容器后都会丢失**</p>
<p>** 若要持久保留数据，可以将容器中的主机文件系统内容与–volume<br>(-v)选项搭配使用。在容器中使用此卷类型时，必须考虑文件系统级别的权限**</p>
<p>**<br>MariaDB容器镜像中，mysql用户必须拥有&#x2F;var&#x2F;lib&#x2F;mysql目录，就如同MariaDB在主机上运行时一样**</p>
<p>**<br>打算挂载到容器中的目录必须具有mysql作为用户和组所有者(或mysql用户的UID&#x2F;GID，如果主机上没有安装<br>MariaDB)**</p>
<p>** 如果以root 用户身份运行容器，则主机上的UID和GID<br>与容器内的UID和GID匹配**</p>
<p>** 可以使用podman<br>unshare命令在用户命名空间内运行命令。要获取用户命名空间的UID映射，请使用podman<br>unshare cat命令**</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman unshare <span class="built_in">cat</span> /proc/self/uid_map</span><br><span class="line">         0       1000          1</span><br><span class="line">         1     100000      65536</span><br><span class="line">[student@servera ~]$ podman unshare <span class="built_in">cat</span> /proc/self/gid_map</span><br><span class="line">         0       1000          1</span><br><span class="line">         1     100000      65536</span><br></pre></td></tr></table></figure>

<p>以上输出显示：</p>
<p>  容器中的root用户 (UID和GID为0)映射到主机计算机上的用户(UID和GID为1000)</p>
<p>  容器中的UID和GID1映射到主机计算机上的UID和GID 100000</p>
<p>1后的每个UID和GID以1增量递增。例如，容器内的UID和GID30映射到主机计算机上的UID和GID100029</p>
<p>  可以使用podman<br>exec命令查看使用临时存储运行的容器内的mysql用户UID和GID:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman <span class="built_in">exec</span> -it db01 grep mysql /etc/passwd</span><br><span class="line">mysql:x:27:27:MySQL Server:/var/lib/mysql:/sbin/nologin</span><br></pre></td></tr></table></figure>


<p>将&#x2F;home&#x2F;user&#x2F;db_data目录挂载到db01容器中，以在容器的&#x2F;var&#x2F;lib&#x2F;mysql目录中提供持久存储</p>
<p>  创建&#x2F;home&#x2F;user&#x2F;db_data目录，并使用podman<br>unshare命令将27的用户命名空间UID和GID设置为该目录的所有者</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ <span class="built_in">mkdir</span> /home/student/db_data</span><br><span class="line">[student@servera ~]$ ll -d /home/student/db_data</span><br><span class="line">drwxr-xr-x. 2 student student 6 Mar  4 00:43 /home/student/db_data</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ ll -d -n /home/student/db_data</span><br><span class="line">drwxr-xr-x. 2 1000 1000 6 Mar  4 00:43 /home/student/db_data</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman unshare <span class="built_in">chown</span> 27:27 /home/student/db_data/</span><br><span class="line">[student@servera ~]$ ll -d /home/student/db_data</span><br><span class="line">drwxr-xr-x. 2 100026 100026 6 Mar  4 00:43 /home/student/db_data</span><br></pre></td></tr></table></figure>

<p>容器中的UID和GID 27映射到主机计算机上的UID和GID100026。可以使用ll<br>-d命令查看&#x2F;home&#x2F;student&#x2F;db_data目录的所有权来验证映射。</p>
<p>现在已设置了正确的文件系统级权限，可使用podman run 命令-v选项来挂载目录:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman <span class="built_in">rm</span> -af</span><br><span class="line">41a62ff2efd7f268e52d6f6a0a9b503411824c5f4391b86dae5d3f01376cb896</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman run -d --name db01 -e MYSQL_USER=user -e MYSQL_PASSWORD=pass -e MYSQL_DATABASE=db -v /home/student/db_data/:/var/lib/mysql  utility.lab.example.com/rhel8/mariadb-103</span><br><span class="line">54279d1fff7f3b679dd9d4efb7bfa28a626f41f7d07bea50a445ec2392c8cb02</span><br><span class="line"></span><br><span class="line"><span class="comment"># db01容器未在运行</span></span><br><span class="line">[student@servera ~]$ podman ps -a</span><br><span class="line">CONTAINER ID  IMAGE                                             COMMAND     CREATED        STATUS                    PORTS       NAMES</span><br><span class="line">54279d1fff7f  utility.lab.example.com/rhel8/mariadb-103:latest  run-mysqld  6 minutes ago  Exited (1) 6 minutes ago              db01</span><br><span class="line"></span><br><span class="line">$ podman run -d --name db01 \</span><br><span class="line">-e MYSQL_USER=user \</span><br><span class="line">-e MYSQL_PASSWORD=pass \</span><br><span class="line">-e MYSQL_DATABASE=db \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=redhat \</span><br><span class="line">-v /home/student/db_data/:/var/lib/mysql \</span><br><span class="line">utility.lab.example.com/rhel8/mariadb-103</span><br></pre></td></tr></table></figure>

<p>podman container logs命令显示&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;data目录的权限错误：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman container logs db01</span><br><span class="line">Warning: Can<span class="string">&#x27;t detect memory limit from cgroups</span></span><br><span class="line"><span class="string">Warning: Can&#x27;</span>t detect number of CPU cores from cgroups</span><br><span class="line">Warning: Can<span class="string">&#x27;t detect memory limit from cgroups</span></span><br><span class="line"><span class="string">Warning: Can&#x27;</span>t detect number of CPU cores from cgroups</span><br><span class="line">=&gt; sourcing 20-validate-variables.sh ...</span><br><span class="line">=&gt; sourcing 25-validate-replication-variables.sh ...</span><br><span class="line">=&gt; sourcing 30-base-config.sh ...</span><br><span class="line">---&gt; 05:58:29     Processing basic MySQL configuration files ...</span><br><span class="line">=&gt; sourcing 60-replication-config.sh ...</span><br><span class="line">=&gt; sourcing 70-s2i-config.sh ...</span><br><span class="line">---&gt; 05:58:29     Processing additional arbitrary  MySQL configuration provided by s2i ...</span><br><span class="line">=&gt; sourcing 40-paas.cnf ...</span><br><span class="line">=&gt; sourcing 50-my-tuning.cnf ...</span><br><span class="line">---&gt; 05:58:29     Initializing database ...</span><br><span class="line">---&gt; 05:58:29     Running mysql_install_db ...</span><br><span class="line"><span class="built_in">mkdir</span>: cannot create directory <span class="string">&#x27;/var/lib/mysql/data&#x27;</span>: Permission denied</span><br><span class="line">Fatal error Can<span class="string">&#x27;t create database directory &#x27;</span>/var/lib/mysql/data<span class="string">&#x27;</span></span><br><span class="line"><span class="string"># 发生此错误的原因是，主机上/home/user/db\_data目录中设置的SELinux上下文不正确</span></span><br></pre></td></tr></table></figure>

<h3 id="容器存储的SELinux上下文"><a href="#容器存储的SELinux上下文" class="headerlink" title="容器存储的SELinux上下文"></a>容器存储的SELinux上下文</h3><hr>
<p>必须先设置container_file_t SELinux<br>上下文类型，然后才能将该目录作为持久存储挂载到容器</p>
<p>如果目录没有container_file_t SELinux 上下文，则容器无法访问该目录</p>
<p>可以将Z选项附加到podman<br>run命令-v选项的参数，以自动设置目录的SELinux上下文</p>
<p>当将&#x2F;home&#x2F;student&#x2F;db_data<br>目录挂载为&#x2F;var&#x2F;lib&#x2F;mysql目录的持久存储时，可以使用podman run -v<br>&#x2F;home&#x2F;student&#x2F;db_data:&#x2F;var&#x2F;lib&#x2F;mysql:Z 命令设置该目录的SELinux上下文</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman <span class="built_in">rm</span> -af</span><br><span class="line">54279d1fff7f3b679dd9d4efb7bfa28a626f41f7d07bea50a445ec2392c8cb02</span><br><span class="line">[student@servera ~]$ podman ps -a</span><br><span class="line">CONTAINER ID  IMAGE       COMMAND     CREATED     STATUS      PORTS       NAMES</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman run -d --name db01 -e MYSQL_USER=user -e MYSQL_PASSWORD=pass -e MYSQL_DATABASE=db -v /home/student/db_data/:/var/lib/mysql:Z utility.lab.example.com/rhel8/mariadb-103</span><br><span class="line">6195fc399b1f6ae8f5b9d3f436c02bb5d6b093b597949dc968b2a64f6e7d023c</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman ps -a</span><br><span class="line">CONTAINER ID  IMAGE                                             COMMAND     CREATED         STATUS         PORTS       NAMES</span><br><span class="line">6195fc399b1f  utility.lab.example.com/rhel8/mariadb-103:latest  run-mysqld  23 seconds ago  Up 24 seconds              db01</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ ll -dZ /home/student/db_data/</span><br><span class="line">drwxr-xr-x. 3 100026 100026 system_u:object_r:container_file_t:s0:c428,c988 36 Mar  4 01:26 /home/student/db_data/</span><br><span class="line"></span><br><span class="line">$ podman run -d --name db01 \</span><br><span class="line">-e MYSQL_USER=user \</span><br><span class="line">-e MYSQL_PASSWORD=pass \</span><br><span class="line">-e MYSQL_DATABASE=db \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=redhat \</span><br><span class="line">-v /home/student/db_data:/var/lib/mysql:Z \</span><br><span class="line">utility.lab.example.com/rhel8/mariadb-103</span><br></pre></td></tr></table></figure>

<h3 id="分配端口映射到容器"><a href="#分配端口映射到容器" class="headerlink" title="分配端口映射到容器"></a>分配端口映射到容器</h3><hr>
<p>要提供对容器的网络访问权限，客户端必须连接到容器主机上的端口，这些端口将网络流量传递到容器中的端口</p>
<p>将容器主机上的网络端口映射到容器中的端口时，容器将接收发送到主机网络端口的网络流量。</p>
<p>例如，可以将容器主机上的13306端口映射到容器上的3306端口，以便与<br>MariaDB容器通信。因此，发送到容器主机端口13306的流量将由容器中运行的MariaDB接收。</p>
<p>可以使用 podman run命令 -p<br>选项设置从容器主机上13306端口到db01容器上3306端口的端口映射</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman <span class="built_in">rm</span> -af</span><br><span class="line">6195fc399b1f6ae8f5b9d3f436c02bb5d6b093b597949dc968b2a64f6e7d023c</span><br><span class="line">[student@servera ~]$ podman ps -a</span><br><span class="line">CONTAINER ID  IMAGE       COMMAND     CREATED     STATUS      PORTS       NAMES</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman run -d --name db01 -e MYSQL_USER=user -e MYSQL_PASSWORD=pass -e MYSQL_DATABASE=db -v /home/student/db_data/:/var/lib/mysql:Z -p 13306:3306 utility.lab.example.com/rhel8/mariadb-103</span><br><span class="line">28202973f22d60ea4ccd096b8a321b30c7d57156a2c41d2502c1a0456c794ced</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman ps -a</span><br><span class="line">CONTAINER ID  IMAGE                                             COMMAND     CREATED         STATUS         PORTS                    NAMES</span><br><span class="line">28202973f22d  utility.lab.example.com/rhel8/mariadb-103:latest  run-mysqld  20 seconds ago  Up 20 seconds  0.0.0.0:13306-&gt;3306/tcp  db01</span><br><span class="line"></span><br><span class="line">$ podman run -d --name db01 \</span><br><span class="line">-e MYSQL_USER=user \</span><br><span class="line">-e MYSQL_PASSWORD=pass \</span><br><span class="line">-e MYSQL_DATABASE=db \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=redhat \</span><br><span class="line">-p 13306:3306 \</span><br><span class="line">-v /home/student/db_data:/var/lib/mysql:Z \</span><br><span class="line">utility.lab.example.com/rhel8/mariadb-103</span><br></pre></td></tr></table></figure>

<p>使用podman<br>port命令-a选项可显示正在使用的所有容器端口映射。还可以使用podmanport<br>db01命令显示 db01容器的映射端口。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman port -a</span><br><span class="line">28202973f22d    3306/tcp -&gt; 0.0.0.0:13306</span><br><span class="line">[student@servera ~]$ podman port db01</span><br><span class="line">3306/tcp -&gt; 0.0.0.0:13306</span><br></pre></td></tr></table></figure>

<p>可以使用firewall-cmd命令允许端口13306流量传入容器主机，以便它可以重定向到容器:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Rootless(特权)容器无法打开主机上特权端口1024有 以下的端口。比如-p 80:8000 ，比必须使用root才可以对其进行调整</span></span><br><span class="line">[student@servera ~]$ <span class="built_in">sudo</span> firewall-cmd --permanent --add-port=13306/tcp</span><br><span class="line">[<span class="built_in">sudo</span>] password <span class="keyword">for</span> student: </span><br><span class="line">success</span><br><span class="line">[student@servera ~]$ <span class="built_in">sudo</span> firewall-cmd --reload</span><br><span class="line">success</span><br><span class="line">[student@servera ~]$ <span class="built_in">sudo</span> firewall-cmd --list-all</span><br><span class="line">public (active)</span><br><span class="line">  target: default</span><br><span class="line">  icmp-block-inversion: no</span><br><span class="line">  interfaces: eth0</span><br><span class="line">  sources: </span><br><span class="line">  services: cockpit dhcpv6-client ssh</span><br><span class="line">  ports: 13306/tcp</span><br><span class="line">  protocols: </span><br><span class="line">  forward: <span class="built_in">yes</span></span><br><span class="line">  masquerade: no</span><br><span class="line">  forward-ports: </span><br><span class="line">  source-ports: </span><br><span class="line">  icmp-blocks: </span><br><span class="line">  rich rules: </span><br><span class="line"><span class="comment"># firewall-cmd --add-port=13306/tcp --permanent</span></span><br><span class="line"><span class="comment"># firewall-cmd --reload</span></span><br></pre></td></tr></table></figure>

<h3 id="附加测试"><a href="#附加测试" class="headerlink" title="附加测试"></a>附加测试</h3><p>通过主机mariadb数据库客户端软件访问容器数据库服务，需要安装mariadb软件后指定-u账号，-p密码(无空格)，-h数据库服务器所在主机名或IP(不是容器名)及-P(大写)主机映射端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[kiosk@foundation0 ~]$ <span class="built_in">sudo</span> dnf -y install mariadb</span><br><span class="line">[kiosk@foundation0 ~]$ mysql -u user -ppass -h servera -P 13306    <span class="comment"># -h 后面填写您当前实验的主机名或IP</span></span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection <span class="built_in">id</span> is 8</span><br><span class="line">Server version: 10.3.17-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; SHOW DATABASES;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| db                 |</span><br><span class="line">| information_schema |</span><br><span class="line">| <span class="built_in">test</span>               |</span><br><span class="line">+--------------------+</span><br><span class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.012 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; USE db;</span><br><span class="line">Database changed</span><br><span class="line">MariaDB [db]&gt; SHOW TABLES;</span><br><span class="line">Empty <span class="built_in">set</span> (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db]&gt; <span class="built_in">exit</span></span><br><span class="line">Bye</span><br></pre></td></tr></table></figure>

<h3 id="容器中的DNS配置"><a href="#容器中的DNS配置" class="headerlink" title="容器中的DNS配置"></a>容器中的DNS配置</h3><p>Podmanv4.0支持两种容器网络后端，即Netavark和CNI</p>
<p>自RHEL9起，系统默认使用Netavark。若要验证所用的网络后端，请运行以下podman<br>info命令。</p>
<p><a target="_blank" rel="noopener" href="https://docs.redhat.com/zh_hans/documentation/red_hat_enterprise_linux/9/html/building_running_and_managing_containers/proc_switching-the-network-stack-from-cni-to-netavark_assembly_setting-container-network-modes">将网络堆栈从 CNI 切换到 Netavark | Red Hat Product<br>Documentation</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ podman info --format &#123;&#123;.Host.NetworkBackend&#125;&#125;</span><br><span class="line">netavark</span><br></pre></td></tr></table></figure>

<p>主机上使用默认Podman网络的现有容器无法解析彼此的主机名，因为默认网络上未启用DNS。</p>
<p>使用podman network create命令创建一个支持DNS的网络。您可使用podman<br>network create命令创建名为db_net<br>的网络，并将子网指定为10.87.0.0&#x2F;16，网关指定为10.87.0.1。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ podman network create --gateway 10.87.0.1 --subnet 10.87.0.0/16 db_net</span><br><span class="line"></span><br><span class="line">$ podman network <span class="built_in">ls</span> <span class="comment">#列出容器网络</span></span><br></pre></td></tr></table></figure>

<p>如果不指定–gateway 或–subnet 选项，则会使用默认值创建它们。</p>
<p>podman network inspect 命令显示关于特定网络的信息。您可以使用podman<br>network inspect 命令验证网关和子网的设置是否正确，以及新的dbnet<br>网络是否启用了DNS。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ podman network inspect db_net</span><br></pre></td></tr></table></figure>

<p>您可以使用podman run命令–network选项将启用DNS的db_net<br>网络添加到新容器。您可以使用podman run命令–network选项创建连接到db_net<br>网络的db01和client01容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ podman run -d --name db01 \</span><br><span class="line">--network db_net \</span><br><span class="line">-e MYSQL_USER=user \</span><br><span class="line">-e MYSQL_PASSWORD=pass \</span><br><span class="line">-e MYSQL_DATABASE=db \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=redhat \</span><br><span class="line">-v /home/student/db_data:/var/lib/mysql:Z \</span><br><span class="line">-p 13306:3306 \</span><br><span class="line">utility.lab.example.com/rhel8/mariadb-105</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ podman run -d --name client01 \</span><br><span class="line">--network db_net \</span><br><span class="line">-v /etc/yum.repos.d:/etc/yum.repos.d/ \</span><br><span class="line">utility.lab.example.com/ubi9-beta/ubi \</span><br><span class="line"><span class="built_in">sleep</span> infinity</span><br><span class="line"></span><br><span class="line">$ podman ps -a</span><br></pre></td></tr></table></figure>

<p>由于容器设计为仅具有所需的最少软件包，因此容器可能不具有测试通信所需的实用程序，如ping和ip命令。您可以使用<br>podman exec 命令在容器中安装这些实用程序。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ podman <span class="built_in">exec</span> client01 dnf install -y iputils iproute</span><br><span class="line">..output omitted..</span><br></pre></td></tr></table></figure>

<p>容器现在可以通过容器名称互相 ping。您可以使用podman exec<br>命令来测试DNS解析。名称解析到为db_net网络手动设置的子网内的IP。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ podman <span class="built_in">exec</span> client01 ping -c4 db01</span><br><span class="line">PING db01.dns.podman (10.87.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 10.87.0.2 (10.87.0.2): icmp_seq=1 ttl=64 <span class="keyword">time</span>=1.08 ms</span><br><span class="line">64 bytes from 10.87.0.2 (10.87.0.2): icmp_seq=2 ttl=64 <span class="keyword">time</span>=0.082 ms</span><br><span class="line">64 bytes from 10.87.0.2 (10.87.0.2): icmp_seq=3 ttl=64 <span class="keyword">time</span>=0.063 ms</span><br><span class="line">64 bytes from 10.87.0.2 (10.87.0.2): icmp_seq=4 ttl=64 <span class="keyword">time</span>=0.070 ms</span><br></pre></td></tr></table></figure>

<p>您可以使用 podman exec命令验证每个容器中的IP地址是否与DNS解析匹配。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ podman <span class="built_in">exec</span> client01 ip a | grep 10.8</span><br><span class="line">    inet 10.87.0.3/16 brd 10.87.255.255 scope global eth0</span><br></pre></td></tr></table></figure>

<h3 id="多个网络连接到单个容器"><a href="#多个网络连接到单个容器" class="headerlink" title="多个网络连接到单个容器"></a>多个网络连接到单个容器</h3><p>多个网络可以同时连接到一个容器，以帮助分隔不同类型的流量。 您可以使用<br>podman network create命令创建backend 网络</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ podman network create backend</span><br></pre></td></tr></table></figure>

<p>然后，使用podman network ls 命令查看所有 Podman 网络。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ podman network <span class="built_in">ls</span></span><br><span class="line">NETWORK ID    NAME    DRIVER  </span><br><span class="line">a7fea510a6d1  backend bridge</span><br><span class="line">fe680efc5276  db01    bridge</span><br><span class="line">2f259bab93aa  podman  bridge</span><br></pre></td></tr></table></figure>

<p>没有通过podman network create 命令的–gateway和–subnet<br>选项指定子网和网关。 使用podman network inspect 命令来获取backend<br>网络的IP信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ podman network inspect backend</span><br></pre></td></tr></table></figure>

<p>在容器运行时，您可以使用podman network connect<br>命令将其他网络连接到容器。您可以使用podman network<br>connect命令，将backend网络连接到db01和client01容器。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ podman network connect backend db01</span><br><span class="line">$ podman network connect backend client01</span><br></pre></td></tr></table></figure>

<p>您可以使用podman inspect<br>命令验证两个网络是否都已连接到各个容器并显示IP信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ podman inspect db01</span><br><span class="line"></span><br><span class="line">$ podman inspect db01 | grep -A 34 Networks &gt; db01</span><br><span class="line">$ <span class="built_in">cat</span> db01  <span class="comment">#查看db01的两个网络IP为10.89.0.2 ， 10.87.0.2</span></span><br></pre></td></tr></table></figure>

<p>client01容器现在可以与两个网络上的db01容器通信。您可以使用podman exec<br>命令从cliento1容器pingdb01容器上的两个网络。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ podman <span class="built_in">exec</span> -ti client01 ping -c4 10.89.0.2</span><br><span class="line">PING 10.89.0.2 (10.89.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 10.89.0.2: icmp_seq=1 ttl=64 <span class="keyword">time</span>=0.352 ms</span><br><span class="line">$ podman <span class="built_in">exec</span> -ti client01 ping -c4 10.87.0.2</span><br><span class="line">PING 10.87.0.2 (10.87.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 10.87.0.2: icmp_seq=1 ttl=64 <span class="keyword">time</span>=0.594 ms</span><br></pre></td></tr></table></figure>

<p>容器内安装mariadb客户端访问容器数据库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ podman <span class="built_in">exec</span> client01 dnf -y install mariadb</span><br><span class="line">podman</span><br><span class="line">$ podman <span class="built_in">exec</span> -ti client01 mysql -u user -ppass -h db01</span><br></pre></td></tr></table></figure>

<h2 id="34-4-作为系统服务来管理容器"><a href="#34-4-作为系统服务来管理容器" class="headerlink" title="34.4 作为系统服务来管理容器"></a>34.4 作为系统服务来管理容器</h2><h3 id="使用systemd单元管理小型容器环境"><a href="#使用systemd单元管理小型容器环境" class="headerlink" title="使用systemd单元管理小型容器环境"></a>使用systemd单元管理小型容器环境</h3><p>可以运行容器来完成系统任务，或获取一系列命令的输出</p>
<p>可能还希望运行无限期运行服务的容器，如Web 服务器或数据库</p>
<p>在传统环境中，特权用户通常将这些服务配置为在系统启动时运行，并使用<br>systemctl 命令进行管理</p>
<p>作为普通用户，可以创建systemd单元来配置您的Rootless容器。利用此配置，可以通过systemctl命令将容器作为常规系统服务进行管理</p>
<p>基于systemd单元管理容器主要用于不需要扩展的基本和小型部署</p>
<p>对于许多基于容器的应用和服务的更复杂扩展和编排，可以使用基于Kubernetes的企业编排平台，如红帽OpenShift容器平台</p>
<h3 id="为探讨本课中的主题，使用以下场景测试"><a href="#为探讨本课中的主题，使用以下场景测试" class="headerlink" title="为探讨本课中的主题，使用以下场景测试"></a><strong>为探讨本课中的主题，使用以下场景测试</strong></h3><p>作为系统管理员，您被委任了一项任务，将基于nginx镜像的nginx容器配置为在系统启动时启动</p>
<p>必须为Web服务器内容挂载&#x2F;home&#x2F;appdev-adm&#x2F;nginx_web目录，在目录中制作内容为<br>“nginx_web_page”的索引页面，挂载至容器的nginx发布目录&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html，并将8080端口从本地计算机映射到容器80</p>
<p>将容器配置为通过systemctl命令来启动和停止</p>
<p><img src="/%E7%BA%A2%E5%B8%BD-Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E4%B8%8E%E5%AE%B9%E5%99%A8.assets/%E5%AE%B9%E5%99%A8%E5%92%8C%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1%E7%9A%84%E9%9C%80%E6%B1%82.png"></p>
<h3 id="systemd用户服务要求"><a href="#systemd用户服务要求" class="headerlink" title="systemd用户服务要求"></a>systemd用户服务要求</h3><p>作为普通用户，可以使用systemctl命令来启用服务</p>
<p>该服务在打开会话(图形界面、文本控制台或SSH)时启动，并在关闭最后一个会话时停止。此行为与系统服务有所不同，系统服务是在系统启动时启动并在系统关机时停止。</p>
<p>默认情况下，当使用useradd<br>命令创建用户帐户时，系统将使用普通用户ID范围中的下一个可用ID</p>
<p>系统还在&#x2F;etc&#x2F;subuid文件中为用户的容器保留一系列ID</p>
<p>如果使用useradd命令–system选项创建用户帐户，则系统不会为用户容器保留范围。因此，无法使用系统帐户启动Rootless容器。</p>
<p>决定创建一个专门的用户帐户来管理容器。使用useradd<br>命令创建appdev-adm用户，并将redhat用作密码。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ <span class="built_in">sudo</span> useradd appdev-adm</span><br><span class="line">[<span class="built_in">sudo</span>] password <span class="keyword">for</span> student:student</span><br><span class="line">[student@servera ~]$ <span class="built_in">sudo</span> passwd appdev-adm</span><br><span class="line">Changing password <span class="keyword">for</span> user appdev-adm.</span><br><span class="line">New password:</span><br><span class="line">BAD PASSWORD: The password is shorter than 8 characters</span><br><span class="line">Retype new password:</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br></pre></td></tr></table></figure>

<p>然后，使用 su命令切换到appdev-adm用户，并使用podman命令来启动。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ su appdev-adm</span><br><span class="line">Password:redhat</span><br><span class="line">[appdev-adm@servera student]$ podman info</span><br><span class="line">ERRO[0000] XDG_RUNTIME_DIR directory <span class="string">&quot;/run/user/1000&quot;</span> is not owned by the current user</span><br><span class="line">[root@servera ~]# su appdev-adm</span><br><span class="line">[appdev-adm@servera root]$ podman info</span><br><span class="line">ERRO[0000] XDG_RUNTIME_DIR directory <span class="string">&quot;/run/user/0&quot;</span> is not owned by the current user</span><br></pre></td></tr></table></figure>

<p>Podman是一款无状态实用程序，需要完整的登录会话</p>
<p>Podman 必须在SSH会话中使用，不能在sudo或su shell中使用。因此，您将退出su<br>shell，并通过SSH登录计算机。</p>
<p>无状态应用:Stateless Application<br>是指并不会在会话中保存下次会话中去要的客户端数据。<br>每一个会话都像首次执行一样,不会依赖之前的数据进行响应。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[appdev-adm@servera root]$ <span class="built_in">exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">[root@servera ~]# ssh appdev-adm@localhost</span><br><span class="line">appdev-adm@localhost<span class="string">&#x27;s password:</span></span><br><span class="line"><span class="string">Register this system with Red Hat Insights: insights-client --register</span></span><br><span class="line"><span class="string">Create an account or view all your systems at https://red.ht/insights-dashboard</span></span><br><span class="line"><span class="string">Last login: Tue Mar  4 09:06:27 2025</span></span><br><span class="line"><span class="string">[appdev-adm@servera ~]$ podman info</span></span><br><span class="line"><span class="string">[appdev-adm@servera ~]$ podman login -u admin -p redhat321 utility.lab.example.com</span></span><br><span class="line"><span class="string">Login Succeeded!</span></span><br><span class="line"><span class="string">[appdev-adm@servera ~]$ podman search utility.lab.example.com/</span></span><br><span class="line"><span class="string">NAME                                       DESCRIPTION</span></span><br><span class="line"><span class="string">utility.lab.example.com/rhel8/mariadb-103</span></span><br><span class="line"><span class="string">utility.lab.example.com/rhel9/mariadb-105</span></span><br><span class="line"><span class="string">utility.lab.example.com/rhel9/httpd-24</span></span><br><span class="line"><span class="string">utility.lab.example.com/library/nginx</span></span><br><span class="line"><span class="string">utility.lab.example.com/ubi7/ubi</span></span><br><span class="line"><span class="string">utility.lab.example.com/ubi9/ubi</span></span><br><span class="line"><span class="string">utility.lab.example.com/ubi8/ubi</span></span><br><span class="line"><span class="string">utility.lab.example.com/ubi9/python-312</span></span><br><span class="line"><span class="string">utility.lab.example.com/rhel9/php-82</span></span><br></pre></td></tr></table></figure>

<p>然后，配置容器注册表并使用您的凭据进行身份验证。您可以使用以下命令运行<br>http 容器。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[appdev-adm@servera ~]$ <span class="built_in">mkdir</span> /home/appdev-adm/nginx_web/</span><br><span class="line">[appdev-adm@servera ~]$ <span class="built_in">echo</span> nginx_web_page &gt; /home/appdev-adm/nginx_web/index.html</span><br><span class="line">[appdev-adm@servera ~]$ <span class="built_in">cat</span> /home/appdev-adm/nginx_web/index.html</span><br><span class="line">nginx_web_page</span><br><span class="line">[appdev-adm@servera ~]$ podman run -d --name nginx -v /home/appdev-adm/nginx_web/:/usr/share/nginx/html/:Z -p 8080:80 utility.lab.example.com/library/nginx</span><br><span class="line">[appdev-adm@servera ~]$ podman ps -a</span><br><span class="line">CONTAINER ID  IMAGE                                         COMMAND               CREATED        STATUS        PORTS                 NAMES</span><br><span class="line">6f72fe3fc6d7  utility.lab.example.com/library/nginx:latest  nginx -g daemon o...  2 minutes ago  Up 2 minutes  0.0.0.0:8080-&gt;80/tcp  nginx</span><br><span class="line">[appdev-adm@servera ~]$ curl localhost:8080</span><br><span class="line">nginx_web_page</span><br></pre></td></tr></table></figure>

<h3 id="为容器创建systemd用户文件"><a href="#为容器创建systemd用户文件" class="headerlink" title="为容器创建systemd用户文件"></a>为容器创建systemd用户文件</h3><p>在~&#x2F;.confiq&#x2F;svstemd&#x2F;user&#x2F;目录中手动定义systemd服务</p>
<p>用户服务的文件语法与系统服务文件的相同。有关更多详细信息，请查看systemd.unit(5)和systemd.service(5)man手册</p>
<p>使用podman generate systemd 命令为现有容器生成systemd 服务文件podman<br>generate systemd 命令使用容器作为模型来创建配置文件</p>
<p>podman generate systemd命令–new选项指示podman实用程序对systemd<br>服务进行配置，以便在该服务启动时创建容器并在该服务停止时删除容器</p>
<p>可以使用podman generate<br>systemd命令和–name选项来显示为nginx容器建模的systemd服务文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[appdev-adm@servera ~]$ man systemd.unit | grep config.*user</span><br><span class="line">       ~/.config/systemd/user.control/*</span><br><span class="line">       ~/.config/systemd/user/*</span><br><span class="line">       │~/.config/systemd/user.control                    │ using the dbus API (<span class="variable">$XDG_CONFIG_HOME</span> is used <span class="keyword">if</span>   │</span><br><span class="line">       │<span class="variable">$HOME</span>/.config/systemd/user                        │ <span class="built_in">set</span>, ~/.config otherwise)                         │</span><br><span class="line">[appdev-adm@servera ~]$ man systemd.unit</span><br><span class="line">[appdev-adm@servera ~]$ <span class="built_in">mkdir</span> -p ~/.config/systemd/user/</span><br><span class="line">[appdev-adm@servera ~]$ <span class="built_in">cd</span> ~/.config/systemd/user/</span><br><span class="line">[appdev-adm@servera ~]$ podman stop nginx        <span class="comment"># 生成单元文件之前先停止容器</span></span><br><span class="line">nginx</span><br><span class="line">[appdev-adm@servera user]$ podman generate systemd -n nginx -f</span><br><span class="line">/home/appdev-adm/.config/systemd/user/container-nginx.service</span><br><span class="line">[appdev-adm@servera user]$ <span class="built_in">ls</span></span><br><span class="line">container-nginx.service</span><br><span class="line">[appdev-adm@servera user]$ systemctl --user <span class="built_in">enable</span> --now container-nginx.service</span><br><span class="line">Created symlink /home/appdev-adm/.config/systemd/user/default.target.wants/container-nginx.service → /home/appdev-adm/.config/systemd/user/container-nginx.service.</span><br><span class="line">[appdev-adm@servera ~]$ podman ps -a</span><br><span class="line">CONTAINER ID  IMAGE                                         COMMAND               CREATED         STATUS             PORTS                 NAMES</span><br><span class="line">6f72fe3fc6d7  utility.lab.example.com/library/nginx:latest  nginx -g daemon o...  26 minutes ago  Up About a minute  0.0.0.0:8080-&gt;80/tcp  nginx</span><br><span class="line">[appdev-adm@servera user]$ systemctl --user stop container-nginx.service</span><br><span class="line">[appdev-adm@servera ~]$ podman ps -a</span><br><span class="line">CONTAINER ID  IMAGE                                         COMMAND               CREATED         STATUS                     PORTS                 NAMES</span><br><span class="line">6f72fe3fc6d7  utility.lab.example.com/library/nginx:latest  nginx -g daemon o...  27 minutes ago  Exited (0) 16 seconds ago  0.0.0.0:8080-&gt;80/tcp  nginx</span><br><span class="line">[appdev-adm@servera user]$ systemctl --user restart container-nginx.service</span><br><span class="line"></span><br><span class="line">$ podman generate systemd -n nginx</span><br><span class="line">ExecStart=/usr/bin/podman start nginx</span><br><span class="line">ExecStop=/usr/bin/podman stop -t 10 nginx</span><br><span class="line"></span><br><span class="line">*$ podman generate systemd -n nginx -f</span><br><span class="line">$ <span class="built_in">ls</span></span><br><span class="line">container-nginx.service</span><br></pre></td></tr></table></figure>

<ul>
<li>启动时，systemd守护进程执行podman start命令来启动现有容器</li>
<li>停止时，systemd守护进程执行podman<br>stop命令来停止容器。请注意，systemd守护进程不会删除该容器。</li>
</ul>
<p>然后，使用上一命令并加上–new选项来比较systemd配置。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ podman generate systemd -n nginx --new</span><br><span class="line"></span><br><span class="line">ExecStartPre=/bin/rm -f %t/%n.ctr-id</span><br><span class="line">ExecStart=/usr/bin/podman run --cidfile=%t/%n.ctr-id --cgroups=no-conmon --<span class="built_in">rm</span> --sdnotify=conmon --replace -d --name nginx -p 8080:80 -v /home/appdev-adm/nginx_web/:/usr/share/nginx/html/:Z utility.lab.example.com/library/nginx</span><br><span class="line">ExecStop=/usr/bin/podman stop --ignore --cidfile=%t/%n.ctr-id</span><br><span class="line">ExecStopPost=/usr/bin/podman <span class="built_in">rm</span> -f --ignore --cidfile=%t/%n.ctr-id</span><br><span class="line"></span><br><span class="line"><span class="comment">#通过--new选项创建用户单元文件的方法，仅供参考</span></span><br><span class="line">$ <span class="built_in">cd</span> ~/.config/systemd/user/</span><br><span class="line">$ podman generate systemd -n nginx --new -f</span><br><span class="line">/home/appdev-adm/.config/systemd/user/container-nginx.service</span><br></pre></td></tr></table></figure>

<ul>
<li>启动时，systemd守护进程执行 podman run<br>命令以创建并启动新容器。此操作使用podman run<br>命令–rm选项，它将在停止时删除容器。</li>
<li>停止时，systemd 执行 podman stop 命令以停止容器。</li>
<li>在systemd停止容器后，systemd 将使用podman rm -f命令将其移除。</li>
</ul>
<p>验证 podman generate systemd 命令的输出，并使用–files<br>选项运行上一命令，以在当前目录中创建systemd用户文件。由于nginx容器使用持久存储，因此您选择使用带有–new选项的podman<br>generate<br>systemd命令。然后，创建~&#x2F;config&#x2F;systemd&#x2F;user&#x2F;目录并将文件移到此位置上</p>
<h3 id="为容器管理systemd用户文件"><a href="#为容器管理systemd用户文件" class="headerlink" title="为容器管理systemd用户文件"></a>为容器管理systemd用户文件</h3><p>现在，您已创建了 systemd 用户文件，可以使用 systemctl命令 –user<br>选项来管理nginx容器。<br>首先，重新加载systemd守护进程，使systemctl命令知道新的用户文件。使用systemctl–user<br>start命令启动nginx容器。使用为容器生成的 systemd用户文件的名称。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl --user <span class="built_in">enable</span> --now container-nginx.service</span><br><span class="line"><span class="comment">#其他的管理方法，仅供参考</span></span><br><span class="line">$ systemctl --user status container-nginx.service</span><br><span class="line">$ systemctl --user stop container-nginx.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#建议重启验证容器是否可以 开机自启动</span></span><br></pre></td></tr></table></figure>

<p>下表总结了 systemd 系统和用户服务之间使用的不同目录和命令。</p>
<hr>
<p>  比较系统和用户服务                  </p>
<hr>
<p>  存储自定义单元文件       系统服务   &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;unit.service</p>
<pre><code>                       用户服务   \~/.config/systemd/user/unit.service
</code></pre>
<p>  重新加载单元文件         系统服务   # systemctl daemon-reload</p>
<pre><code>                       用户服务   \$ systemctl --user daemon-reload
</code></pre>
<p>  启动和停止服务           系统服务   # systemctl start UNIT</p>
<pre><code>                                  \# systemctl stop UNIT

                       用户服务   \$ systemctl --user start UNIT

                                  \$ systemctl --user stop UNIT
</code></pre>
<p>  在计算机启动时启动服务   系统服务   # systemctl enable UNIT</p>
<pre><code>                       用户服务   \$ loginctl enable-linger

                                  \$ systemctl --user enable UNIT
</code></pre>
<hr>
<h3 id="将容器配置为在系统引导时启动"><a href="#将容器配置为在系统引导时启动" class="headerlink" title="将容器配置为在系统引导时启动"></a>将容器配置为在系统引导时启动</h3><p>此时，systemd服务配置已就绪，可以为给定的用户运行容器。但是，如果用户从系统注销，systemd服务会在特定时间后停止容器。出现此行为的原因是，systemd<br>服务单元是使用.user<br>选项创建的，它在用户登录时启动服务，并在用户注销时停止服务。 ​<br>不过，您可以通过运行loginctl enable-linger<br>命令来更改此默认行为，并强制已启用的服务在服务器启动时启动，并在服务器关闭期间停止。<br>​可以使用<br>loginctl命令将systemd用户服务配置为在所配置服务的最后一个用户会话关闭后保留</p>
<p>使用 loginctl show-user 命令验证配置是否成功。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[appdev-adm@servera ~]$ loginctl show-user appdev-adm</span><br><span class="line">Linger=no</span><br><span class="line">[appdev-adm@servera ~]$ loginctl enable-linger</span><br><span class="line">[appdev-adm@servera ~]$ loginctl show-user appdev-adm</span><br><span class="line">Linger=<span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启后进行测试</span></span><br><span class="line">[kiosk@foundation0 ~]$ ssh root@servera</span><br><span class="line">[root@servera ~]# ssh appdev-adm@localhost</span><br><span class="line">[appdev-adm@servera ~]$ podman ps -a</span><br><span class="line">CONTAINER ID  IMAGE                                         COMMAND               CREATED         STATUS             PORTS                 NAMES</span><br><span class="line">6f72fe3fc6d7  utility.lab.example.com/library/nginx:latest  nginx -g daemon o...  40 minutes ago  Up About a minute  0.0.0.0:8080-&gt;80/tcp  nginx</span><br></pre></td></tr></table></figure>

<h3 id="以Root-用户身份使用Systemd-管理容器"><a href="#以Root-用户身份使用Systemd-管理容器" class="headerlink" title="以Root 用户身份使用Systemd 管理容器"></a>以Root 用户身份使用Systemd 管理容器</h3><p>将容器配置为以root身份运行，并使用systemd<br>服务文件进行管理。这种方法的一个优势是，您可以将这些服务文件配置为像常见systemd<br>单元文件那样工作，而不是以特定用户身份来运行。</p>
<p>将服务文件设置为 root的过程与前面概述的<br>Rootless容器过程类似，但以下例外: ​ 不要创建专门的用户来管理容器。 ​<br>服务文件必须在&#x2F;etc&#x2F;systemd&#x2F;system<br>目录中，而不是在~&#x2F;config&#x2F;systemd&#x2F;user目录中 ​<br>使用systemctl命令管理容器，但不使用 –user 选项 ​ 不要以root用户身份运行<br>loginctl enable-linger命令</p>
<p>有关演示，请参见本节末尾参考资料中所列红帽视频频道中的YouTube视频</p>
<pre><code>练习：P358
</code></pre>
<h2 id="34-5-容器模考练习"><a href="#34-5-容器模考练习" class="headerlink" title="34.5 容器模考练习"></a>34.5 容器模考练习</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">-RH134</span><br><span class="line">-foundation0</span><br><span class="line">$ <span class="keyword">for</span> i <span class="keyword">in</span> classroom utility bastion workstation servera;<span class="keyword">do</span> rht-vmctl start <span class="variable">$i</span>;<span class="keyword">done</span></span><br><span class="line">$ ssh workstation</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-workstation</span><br><span class="line">$ lab start containers-deploy</span><br><span class="line">$ ssh servera</span><br><span class="line"></span><br><span class="line"><span class="comment">#第一题</span></span><br><span class="line">-servera</span><br><span class="line">$ podman login utility.lab.example.com -u admin -p redhat321 <span class="comment">#应提示登录成功</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">sudo</span> vim ~/Containerfile </span><br><span class="line">FROM utility.lab.example.com/ubi9-beta/ubi:latest</span><br><span class="line">RUN <span class="built_in">mkdir</span> /dir&#123;1,2&#125;</span><br><span class="line">RUN <span class="built_in">echo</span> -e <span class="string">&#x27;[rhel-9.0-for-x86_64-baseos-rpms]\nbaseurl = http://content.example.com/rhel9.0/x86_64/dvd/BaseOS\nenabled = true\ngpgcheck = false\nname = Red Hat Enterprise Linux 9.0 BaseOS (dvd)\n[rhel-9.0-for-x86_64-appstream-rpms]\nbaseurl = http://content.example.com/rhel9.0/x86_64/dvd/AppStream\nenabled = true\ngpgcheck = false\nname = Red Hat Enterprise Linux 9.0 Appstream (dvd)&#x27;</span>&gt;/etc/yum.repos.d/rhel_dvd.repo</span><br><span class="line">RUN yum install --disablerepo=* --enablerepo=rhel-9.0-for-x86_64-baseos-rpms --enablerepo=rhel-9.0-for-x86_64-appstream-rpms -y python3</span><br><span class="line">CMD [<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;sleep infinity&quot;</span>]</span><br><span class="line"></span><br><span class="line">*$ podman build -t pdf .</span><br><span class="line">$ podman images</span><br><span class="line"></span><br><span class="line"><span class="comment">#继续做第二题</span></span><br><span class="line">$ <span class="built_in">sudo</span> -i</span><br><span class="line">student</span><br><span class="line"><span class="comment"># mkdir /opt/&#123;file,progress&#125;</span></span><br><span class="line"><span class="comment"># chown -R student /opt </span></span><br><span class="line"><span class="comment"># ll /opt</span></span><br><span class="line"><span class="comment"># exit</span></span><br><span class="line">$ podman run \</span><br><span class="line">    -d \</span><br><span class="line">    --name ascii2pdf \</span><br><span class="line">    -v /opt/file:/dir1:Z \</span><br><span class="line">    -v /opt/progress:/dir2:Z \</span><br><span class="line">    pdf</span><br><span class="line"></span><br><span class="line">$ podman stop ascii2pdf</span><br><span class="line"></span><br><span class="line">$ loginctl enable-linger</span><br><span class="line">$ loginctl show-user wallah</span><br><span class="line"></span><br><span class="line">$ MANWIDTH=160; man systemd.unit | grep config.*user</span><br><span class="line">...</span><br><span class="line">       `│<span class="variable">$HOME</span>/.config/systemd/user`                      │...</span><br><span class="line"></span><br><span class="line">*$ <span class="built_in">mkdir</span> -p ~/.config/systemd/user/</span><br><span class="line">*$ <span class="built_in">cd</span> ~/.config/systemd/user/</span><br><span class="line">*$ podman generate systemd -n ascii2pdf -f</span><br><span class="line">*$ systemctl --user <span class="built_in">enable</span> --now container-ascii2pdf</span><br><span class="line">$ systemctl --user status container-logserver</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ &lt;Ctrl-D&gt;</span><br><span class="line"><span class="comment"># cp /etc/fstab /opt/file</span></span><br><span class="line"><span class="comment"># ls /opt/progress</span></span><br><span class="line"><span class="comment"># file /opt/progress/fstab</span></span><br></pre></td></tr></table></figure>

</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF/">容器技术</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/podman%E5%AE%B9%E5%99%A8/">podman容器</a></div><hr></div></article></div><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/avatar.png" alt="罗宇"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">罗宇</p><p class="is-size-6 is-block">用开放的思维，解决封闭的问题</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国-四川-成都</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives/"><p class="title">3</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories/"><p class="title">2</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags/"><p class="title">2</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://luovip.github.io" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://luovip.github.io"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="/luovipyu@163.com"><i class="fa fa-envelope"></i></a></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo官网</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget"><div class="card-content"><h3 class="menu-label">最新评论</h3><span class="body_hot_comment">加载中，最新评论有1分钟缓存...</span></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-04-16T15:19:09.820Z">2025-04-16</time></p><p class="title"><a href="/2025/04/16/hello-world/">Hello World</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-04-15T05:50:42.000Z">2025-04-15</time></p><p class="title"><a href="/2025/04/15/Linux%E5%9F%BA%E7%A1%80/">Linux基本使用</a></p><p class="categories"><a href="/categories/Linux/">Linux</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2025/04/15/podman%E5%AE%B9%E5%99%A8/"><img src="/img/podman.jpg" alt="podman容器"></a></figure><div class="media-content"><p class="date"><time dateTime="2025-04-15T05:50:42.000Z">2025-04-15</time></p><p class="title"><a href="/2025/04/15/podman%E5%AE%B9%E5%99%A8/">podman容器</a></p><p class="categories"><a href="/categories/%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF/">容器技术</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF/"><span class="level-start"><span class="level-item">容器技术</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2025/04/"><span class="level-start"><span class="level-item">四月 2025</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Linux%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"><span class="tag">Linux基本使用</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/podman%E5%AE%B9%E5%99%A8/"><span class="tag">podman容器</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><!--!--></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://cdn.jsdelivr.net/gh/removeif/removeif-demo@latest/img/logo.png" alt="墨香笔记@技术博客" height="28"></a><p class="size-small"><span>&copy; 2025 罗宇</span>  Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a> &amp; <a href="https://github.com/removeif/hexo-theme-amazing" target="_blank">Amazing</a> <br><span>© <a href="http://www.beian.miit.gov.cn/" target="_blank">川ICP备88888888号-8（测试）</a><br></span><span>© 版权说明：[本网站所有内容均收集于互联网或自己创作,<br />&nbsp;&nbsp;&nbsp;&nbsp;方便于网友与自己学习交流，如有侵权，请<a href="/message" target="_blank">留言</a>，立即处理]<br /></span><span><span id="statistic-times">loading...</span><script>function createTime(time) {
            var n = new Date(time);
            now.setTime(now.getTime() + 250),
                days = (now - n) / 1e3 / 60 / 60 / 24,
                dnum = Math.floor(days),
                hours = (now - n) / 1e3 / 60 / 60 - 24 * dnum,
                hnum = Math.floor(hours),
            1 == String(hnum).length && (hnum = "0" + hnum),
                minutes = (now - n) / 1e3 / 60 - 1440 * dnum - 60 * hnum,
                mnum = Math.floor(minutes),
            1 == String(mnum).length && (mnum = "0" + mnum),
                seconds = (now - n) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum,
                snum = Math.round(seconds),
            1 == String(snum).length && (snum = "0" + snum),
                document.getElementById("statistic-times").innerHTML = "❤️本站自 <strong>"+time.split(" ")[0].replace(/\//g,".")+"</strong> 已运行 <strong>" + dnum + "</strong> 天 <strong>" + hnum + "</strong> 小时 <strong>" + mnum + "</strong> 分 <strong>" + snum + "</strong> 秒！❤️";
        }var now = new Date();setInterval("createTime('2025/04/17 00:00:00')", 250,"");</script><br></span><div class="size-small"><span>❤️感谢 <strong><span id="busuanzi_value_site_uv">99+</span></strong> 小伙伴的 <strong><span id="busuanzi_value_site_pv">99+</span></strong> 次光临！❤️</span></div></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/removeif/hexo-theme-amazing"><i class="fab fa-github"></i></a></p></div><div class="sideMusic"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="/js/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><meting-js style="width: auto;height: 2000px;" server="netease" type="playlist" id="2364053447" theme="#2980b9" loop="all" autoplay="false" order="list" storageName="aplayer-setting" lrctype="0" list-max-height="400px" fixed="true"></meting-js></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script>$.getScript('/js/comment-issue-data.js',function(){loadIssueData('Ov23ctQiAn2xyj6nkypC','4587c075fd4d39782a2c0f71312169d7fbe435c5','luovip','luovip.github.io',false);})</script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script data-pjax src="/js/insight.js" defer></script><script data-pjax>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script><script type="text/javascript">var pjax = new Pjax({
            elements: "a",//代表点击链接就更新
            selectors: [  //代表要更新的节点
                ".section",
                "title"
            ],
            cache: true,
            cacheBust:false
        })

        function loadBusuanzi(){
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js", function () {});
        }

        function loadMathJax() { //加载mathjax
            $.getScript("//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML", function () {
                MathJax.Hub.Config({ tex2jax: { inlineMath: [['$', '$'], ['\(', '\)']] } });
                var math = document.getElementsByClassName("entry-content")[0];
                MathJax.Hub.Queue(["Typeset", MathJax.Hub, math]);
            });
        };

        // 开始 PJAX 执行的函数
        document.addEventListener('pjax:send', function () {
        });
        
        // PJAX 完成之后执行的函数，可以和上面的重载放在一起
        document.addEventListener('pjax:complete', function () {
            $(".section").css({opacity:1});
            if(true){
                $.getScript('/js/comment-issue-data.js',function(){loadIssueData('Ov23ctQiAn2xyj6nkypC','4587c075fd4d39782a2c0f71312169d7fbe435c5','luovip','luovip.github.io',false);});
            }
            if(false){
                loadMathJax();
            }
            loadMainJs(jQuery, window.moment, window.ClipboardJS, window.IcarusThemeSettings);
            loadBackTop();
            loadBusuanzi();
            if(typeof loadBanner == 'function'){
                loadBanner();
            }
        });</script></body></html>