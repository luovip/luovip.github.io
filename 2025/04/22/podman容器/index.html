<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>podman容器 - Linux技术博客</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Linux技术博客"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Linux技术博客"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="1 容器概念"><meta property="og:type" content="blog"><meta property="og:title" content="罗宇"><meta property="og:url" content="https://luovip.github.io/"><meta property="og:site_name" content="罗宇"><meta property="og:description" content="1 容器概念"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://luovip.github.io/img/avatar.png"><meta property="article:published_time" content="2025-04-22T05:50:42.000Z"><meta property="article:modified_time" content="2025-04-29T09:12:16.989Z"><meta property="article:author" content="removeif"><meta property="article:tag" content="podman容器"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://luovip.github.io/img/avatar.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com/2025/04/22/podman%E5%AE%B9%E5%99%A8/"},"headline":"Linux技术博客","image":["http://example.com/img/podman.jpg"],"datePublished":"2025-04-22T05:50:42.000Z","dateModified":"2025-04-29T09:12:16.989Z","author":{"@type":"Person","name":"罗宇"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject"}},"description":"1 容器概念"}</script><link rel="canonical" href="http://example.com/2025/04/22/podman%E5%AE%B9%E5%99%A8/"><link rel="icon" href="/img/favicon.svg"><meta name="referrer" content="no-referrer-when-downgrade"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/6.0.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark-reasonable.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Oxanium:wght@300;400;600&amp;family=Roboto+Mono"><link rel="stylesheet" href="/css/cyberpunk.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="/js/globalUtils.js"></script><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdnjs.loli.net/ajax/libs/pace/1.2.4/pace.min.js"></script><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Linux技术博客</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/media">音乐</a><a class="navbar-item" href="/album">相册</a><a class="navbar-item" href="/about">关于我</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><!--!--><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/img/podman.jpg" alt="podman容器"></span></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2025-04-22 13:50:42  <span class="level-item"> 罗宇 </span><a class="commentCountImg" href="/2025/04/22/podman%E5%AE%B9%E5%99%A8/#comment-container"><span class="display-none-class">/2025/04/22/podman容器/</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="0da2d347bea435506ce680df4d2efb1e">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>2 小时  <i class="fas fa-pencil-alt"> </i>15.1 k</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">podman容器</h1><div class="content"><h1 id="1-容器概念"><a href="#1-容器概念" class="headerlink" title="1 容器概念"></a><strong>1 容器概念</strong></h1><span id="more"></span>
<h2 id="1-1-容器技术介绍"><a href="#1-1-容器技术介绍" class="headerlink" title="1.1 容器技术介绍"></a><strong>1.1 容器技术介绍</strong></h2><p>​      软件应用通常依赖于运行时环境(runtimeenvironment)提供的系统库、配置文件或服务。传统上，软件应用的运行时环境安装在物理主机或虚拟机上运行的操作系统中。然后，管理员在操作系统上安装应用依赖项</p>
<p>​      在红帽企业Linux中，诸如RPM等打包系统可协助管理员管理应用依赖项。安装httpd软件包时，RPM系统会确保同时安装该软件包的正确库和其他依赖项</p>
<p>​      传统方式部署软件应用的主要弊端是这些依赖项会受到运行时环境的束缚，应用需要的支持软件的版本可能比操作系统提供的软件更旧或更新。同一系统上的两个应用可能需要同一软件互不兼容的不同版本</p>
<p>​     解决这些冲突的方式之一是将应用打包并作为容器进行部署<br>​     容器是由一个或多个与系统其余部分隔离的进程组成的集合，软件容器是打包应用以简化其部署和管理的一种方式<br>​     以实体集装箱为例。集装箱是打包和装运货物的标准方式。它作为一个箱子进行标记、装载、卸载，以及从一个位置运输到另一个位置。集装箱中的内容与其他集装箱的内容隔离，因此互不影响。这些基本原则也适用于软件容器</p>
<h2 id="1-2-容器的核心技术"><a href="#1-2-容器的核心技术" class="headerlink" title="1.2 容器的核心技术"></a><strong>1.2 容器的核心技术</strong></h2><p>  <strong>红帽企业Linux通过运用以下核心技术来支持容器:</strong></p>
<p>1.用于资源管理的控制组(cgroups)</p>
<p>2.用于进程隔离的命名空间</p>
<p>3.加强安全边界的SELinux和Seccomp安全计算模式</p>
<h2 id="1-3-容器和虚拟机的差异"><a href="#1-3-容器和虚拟机的差异" class="headerlink" title="1.3 容器和虚拟机的差异"></a><strong>1.3 容器和虚拟机的差异</strong></h2><p>1.容器提供许多与虚拟机相同的益处，如安全、存储和网络隔离等<br>2.这两种技术都将其应用库和运行时资源与主机操作系统或虚拟机监控程序隔离开，反之亦</p>
<p>3.容器和虚拟机以不同的方式与硬件和底层操作系统交互</p>
<p>** 4.虚拟机具有以下特征:</p>
<p>** 使多个操作系统能够同时在一个硬件平台上运行</p>
<p>** 使用虚拟机监控程序将硬件分为多个虚拟硬件系统</p>
<p>** 需要一个完整的操作系统环境来支持该应用</p>
<p>** 5.容器具有以下特征:</p>
<p>** 直接在操作系统上运行，从而跨系统上的所有容器共享资源</p>
<p>** 共享主机的内核，但它将应用进程与系统其余部分隔离开来</p>
<p>** 与虚拟机相比，它需要的硬件资源要少得多，因此容器的启动速度也更快</p>
<p>** 包括所有依赖项，如系统和编程依赖项，以及配置设置</p>
<h2 id="1-4-Rootless和Rootful容器"><a href="#1-4-Rootless和Rootful容器" class="headerlink" title="1.4 Rootless和Rootful容器"></a><strong>1.4 Rootless和Rootful容器</strong></h2><p><strong>在容器主机上，由特权用户运行的容器称为Rootful容器、由非特权用户运行的容器称为Rootless容器</strong></p>
<p>**<br>Rootless容器不允许使用通常为特权用户保留的系统资源，例如访问受限目录，或在受限端口(1024以下的端口)上发布网络服务。此功能可防止潜在攻击者获取容器主机上的root特权</p>
<p>**<br>如有必要，可使用root用户身份直接运行容器，但如果有漏洞允许攻击者破坏容器，这样做会削弱系统的安全性</p>
<h2 id="1-5-设计基于容器的架构"><a href="#1-5-设计基于容器的架构" class="headerlink" title="1.5 设计基于容器的架构"></a><strong>1.5 设计基于容器的架构</strong></h2><p>  <strong>容器是重复利用托管应用并使其可以移植的有效方式</strong></p>
<p>**<br><strong>容器可以轻松地从一个环境迁移到另一个环境，如从开发环境迁移到生产环境</strong></p>
<p><strong>** 可以保存一个容器的多个版本，并根据需要快速访问每个版本</strong></p>
<p><strong>**<br>容器通常是临时的，可以将运行中容器所生成的数据永久保存到持久存储中，但容器本身通常会在需要时运行，然后停止并被删除，下次需要该特定容器时，将启动新的容器进程</strong></p>
<p><strong>**<br>可以在单个容器中安装含有多个服务的复杂软件应用。例如，Web服务器可能需要使用数据库和消息传递系统。不过，将一个容器用于多个服务会难以管理</strong></p>
<p><strong>**<br>更好的设计是在单独的容器中运行每个组件、Web服务器、数据库和消息传递系统。这样，更新和维护单个应用组件不会影响其他组件或应用堆栈</strong></p>
<h1 id="2-容器镜像和注册表"><a href="#2-容器镜像和注册表" class="headerlink" title="2 容器镜像和注册表"></a>2 容器镜像和注册表</h1><p>  <strong>运行容器必须使用容器镜像:</strong></p>
<p>**<br>容器镜像是包含编码步骤的静态文件，它充当创建容器的蓝图。容器镜像打包应用及其所有依赖项，如系统库、编程语言运行时和库以及其他配置设置**</p>
<p>**<br>容器镜像根据规范构建，如开放容器项目(OCI)镜像格式规范。这些规范定义容器镜像的格式，以及镜像支持的容器主机操作系统和硬件架构的元数据</p>
<p>**<br>容器注册表是用于存储和检索容器镜像的存储库。开发人员将容器镜像推送或上传到容器注册表中。可以从注册表中将这些容器镜像拉取或下载到本地系统，以用于运行容器</p>
<p>** 可使用包含第三方镜像的公共注册表，也可使用贵组织控制的私有注册表</p>
<p>容器镜像来源很重要。和任何其他软件包一样，必须知道是否可以信任容器镜像中的代码。对于是否及如何提供、评估和测试提交给它们的容器镜像，不同的注册表具有不同的策略</p>
<p>**<br>红帽通过两个主容器注册表分发认证容器镜像，可以使用红帽登录凭据来访问这两个注册表:</p>
<p>** 1.utility.redhat.io: 适用于基于官方红帽产品的容器</p>
<p>** 2.utilityconnect.redhat,com:适用于基于第三方产品的容器</p>
<p>**<br>3.红帽容器目录(<a target="_blank" rel="noopener" href="https://access.redhat.com/containers)%E6%8F%90%E4%BE%9B%E4%BA%86%E4%B8%80%E4%B8%AA%E5%9F%BA%E4%BA%8EWeb%E7%9A%84%E7%95%8C%E9%9D%A2%EF%BC%8C%E9%80%9A%E8%BF%87%E5%AE%83%E5%8F%AF%E4%BB%A5%E6%90%9C%E7%B4%A2%E8%BF%99%E4%BA%9B%E6%B3%A8%E5%86%8C%E8%A1%A8%E4%B8%AD%E7%9A%84%E8%AE%A4%E8%AF%81%E5%86%85%E5%AE%B9%E3%80%82">https://access.redhat.com/containers)提供了一个基于Web的界面，通过它可以搜索这些注册表中的认证内容。</a></p>
<p>**<br>4.培训环境中添加了红帽Quay,官方为收费版，培训环境中为免费版utility.lab.example.com</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 环境中使用的镜像仓库浏览器访问为:</span></span><br><span class="line">https://utility   账号是:admin  密码:redhat321</span><br><span class="line"><span class="comment"># 镜像对应的地址为:utility.lab.example.com</span></span><br><span class="line"></span><br><span class="line">[kiosk@foundation0 ~]$ <span class="built_in">cat</span> /etc/hosts</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line"><span class="comment">### rht-vm-hosts file listing the entries to be appended to /etc/hosts</span></span><br><span class="line"></span><br><span class="line">172.25.250.254 bastion.lab.example.com bastion</span><br><span class="line">172.25.250.10  servera.lab.example.com servera</span><br><span class="line">172.25.250.11  serverb.lab.example.com serverb</span><br><span class="line">172.25.250.220 utility.lab.example.com utility</span><br><span class="line">172.25.250.9   workstation.lab.example.com workstation</span><br><span class="line"><span class="comment"># 登录servera请使用ssh方式，不要使用su切换。</span></span><br><span class="line"><span class="comment"># 安装容器:</span></span><br><span class="line">[root@foundation0 ~]# ssh root@servera</span><br><span class="line">[root@servera ~]# ssh student@localhost</span><br><span class="line">[student@servera ~]$ <span class="built_in">sudo</span> dnf -y install container-tools    <span class="comment"># 安装podman容器 </span></span><br><span class="line">[student@servera ~]$ podman --version</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录容器:</span></span><br><span class="line"><span class="comment"># 需要红帽开发人员账户才能从红帽注册表下载镜像。可以使用podman login命令对注册表进行身份验证。如果不向podman login命令提供注册表URL，它会向默认配置的注册表进行身份验证</span></span><br><span class="line">$ podman login --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录方法一(交互)：</span></span><br><span class="line">$ podman login utility.lab.example.com </span><br><span class="line">Username: admin</span><br><span class="line">Password: redhat321</span><br><span class="line">Login Succeeded!</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录方法二(非交互)： # 推荐</span></span><br><span class="line">$ podman login utility.lab.example.com -u admin -p redhat321  <span class="comment"># 生产环境中是有https验证的</span></span><br><span class="line">Login Succeeded!</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman login -u admin -p redhat321 utility.lab.example.com</span><br><span class="line">Error: authenticating creds <span class="keyword">for</span> <span class="string">&quot;utility.lab.example.com&quot;</span>: pinging container registry utility.lab.example.com: Get <span class="string">&quot;https://utility.lab.example.com/v2/&quot;</span>: tls: failed to verify certificate: x509: certificate is not valid <span class="keyword">for</span> any names, but wanted to match utility.lab.example.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果出现以上报错，是要求https验证，需要通过选项--tls-verify进行手动关闭</span></span><br><span class="line"><span class="comment"># podman login utility.lab.example.com -u admin -p redhat321 --tls-verify=false</span></span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman login --<span class="built_in">help</span></span><br><span class="line">Description:</span><br><span class="line">  Log <span class="keyword">in</span> to a container registry on a specified server.</span><br><span class="line">Usage:</span><br><span class="line">  podman login [options] [REGISTRY]</span><br><span class="line">Examples:</span><br><span class="line">  podman login quay.io</span><br><span class="line">  podman login --username ... --password ... quay.io</span><br><span class="line">  podman login --authfile <span class="built_in">dir</span>/auth.json quay.io</span><br><span class="line">Options:</span><br><span class="line">      --authfile string   path of the authentication file. Use REGISTRY_AUTH_FILE environment variable to override</span><br><span class="line">      --cert-dir string   use certificates at the specified path to access the registry</span><br><span class="line">      --get-login         Return the current login user <span class="keyword">for</span> the registry</span><br><span class="line">  -p, --password string   Password <span class="keyword">for</span> registry</span><br><span class="line">      --password-stdin    Take the password from stdin</span><br><span class="line">      --tls-verify        Require HTTPS and verify certificates when contacting registries</span><br><span class="line">  -u, --username string   Username <span class="keyword">for</span> registry</span><br><span class="line">  -v, --verbose           Write more detailed information to stdout</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman login -u admin -p redhat321 utility.lab.example.com --tls-verify=<span class="literal">false</span></span><br><span class="line">Login Succeeded!</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录方法三(非交互):</span></span><br><span class="line"><span class="comment"># 使用podman login命令的--username和--password-sdtin选项，指定用于登录注册表的用户和密码</span></span><br><span class="line"><span class="comment"># --password-stdin选项从stdin读取密码</span></span><br><span class="line"><span class="comment"># 红帽建议不要使用--password选项直接提供密码，因为此选项会将密码存储在日志文件中</span></span><br><span class="line">$ <span class="built_in">echo</span> redhat321 | podman login -u admin --password-stdin utility.lab.example.com  </span><br><span class="line">Login Succeeded!</span><br></pre></td></tr></table></figure>

<p><strong>要验证您是否已登录到某一注册表，请使用 podman login命令<br>–get-login选项。及退出登录podman logout</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ podman login --get-login   <span class="comment"># 查看登录的用户</span></span><br><span class="line">admin</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman login utility.lab.example.com --get-login    <span class="comment"># 指定仓库地址，查看登录用户</span></span><br><span class="line">admin</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman <span class="built_in">logout</span> utility.lab.example.com  <span class="comment"># 登出</span></span><br><span class="line">Removed login credentials <span class="keyword">for</span> utility.lab.example.com</span><br></pre></td></tr></table></figure>

<h2 id="2-1-配置容器注册表"><a href="#2-1-配置容器注册表" class="headerlink" title="2.1 配置容器注册表"></a><strong>2.1 配置容器注册表</strong></h2><p><strong>容器注册表的默认配置文件是 &#x2F;etc&#x2F;containers&#x2F;registries.conf 文件</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ <span class="built_in">sudo</span> vim /etc/containers/registries.conf</span><br><span class="line">[<span class="built_in">sudo</span>] password <span class="keyword">for</span> student: student</span><br><span class="line"></span><br><span class="line"><span class="comment">#第22行 指定可搜索的镜像仓库地址，如果使用完全合格域名，此处可以留空</span></span><br><span class="line">unqualified-search-registries = [<span class="string">&quot;utility.lab.example.com&quot;</span>,<span class="string">&quot;registry.access.redhat.com&quot;</span>,<span class="string">&quot;registry.redhat.io&quot;</span>,<span class="string">&quot;docker.io&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#第24行</span></span><br><span class="line">[[utility]]   解除注释开启以下功能</span><br><span class="line"></span><br><span class="line"><span class="comment">#第37行</span></span><br><span class="line">insecure = <span class="literal">true</span>    <span class="comment">#false/true 开启https安全验证/关闭安全验证</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#第40行</span></span><br><span class="line">blocked = <span class="literal">false</span>    <span class="comment">#需要过滤掉的镜像仓库地址</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#第56行</span></span><br><span class="line">location = <span class="string">&quot;utility.lab.example.com&quot;</span> 指定容器注册表位置</span><br><span class="line"></span><br><span class="line">$注意</span><br><span class="line">~/.config/containers/registries.conf目录设置会覆盖/etc/containers/registries.conf</span><br><span class="line"></span><br><span class="line">推荐：</span><br><span class="line">【student】</span><br><span class="line">$ <span class="built_in">mkdir</span> -p ~/.config/containers</span><br><span class="line">$ <span class="built_in">cp</span> /etc/containers/registries.conf ~/.config/containers/registries.conf</span><br><span class="line">$ vim ~/.config/containers/registries.conf</span><br><span class="line">unqualified-search-registries = [<span class="string">&quot;utility.lab.example.com&quot;</span>] </span><br><span class="line">[[utility]]   </span><br><span class="line">insecure = <span class="literal">true</span> </span><br><span class="line">blocked = <span class="literal">false</span>    </span><br><span class="line">location = <span class="string">&quot;utility.lab.example.com&quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录容器注册表</span></span><br><span class="line">[student@servera ~]$ podman login -u admin -p redhat321 utility.lab.example.com</span><br><span class="line">Login Succeeded!</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据仓库地址搜索镜像</span></span><br><span class="line">[student@servera ~]$ podman search utility.lab.example.com/</span><br><span class="line">NAME                                       DESCRIPTION</span><br><span class="line">utility.lab.example.com/rhel8/mariadb-103  </span><br><span class="line">utility.lab.example.com/rhel9/mariadb-105  </span><br><span class="line">utility.lab.example.com/rhel9/httpd-24     </span><br><span class="line">utility.lab.example.com/library/nginx      </span><br><span class="line">utility.lab.example.com/ubi7/ubi           </span><br><span class="line">utility.lab.example.com/ubi9/ubi           </span><br><span class="line">utility.lab.example.com/ubi8/ubi           </span><br><span class="line">utility.lab.example.com/ubi9/python-312    </span><br><span class="line">utility.lab.example.com/rhel9/php-82  </span><br><span class="line"></span><br><span class="line">注意：如果只访问本地仓库，unqualified-search-registries = [<span class="string">&quot;utility.lab.example.com&quot;</span>]默认即可，但要需要访问外网，需要用root用户修改vim /etc/resolv.conf文件内容添加nameserver 8.8.8.8 优先解析。</span><br><span class="line">阿里容器</span><br><span class="line">i2kldsde.mirror.aliyuncs.com</span><br></pre></td></tr></table></figure>

<h2 id="2-2-使用容器文件构建容器镜像"><a href="#2-2-使用容器文件构建容器镜像" class="headerlink" title="2.2 使用容器文件构建容器镜像"></a><strong>2.2 使用容器文件构建容器镜像</strong></h2><hr>
<p>  <strong>容器文件是一种文本文件，内含用于构建容器镜像的指令。</strong></p>
<p>**<br>容器文件通常具有定义其文件和目录所在路径或URL的上下文。生成的容器镜像由只读层组成，每一层代表容器文件中的一条指令。**</p>
<p>**<br>以下输出是一个容器文件示例，它使用utility.access.redhat.com注册表中的UBI镜像,安装<br>python3 软件包，并将 hello 字符串打印到控制台。**</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> Containerfile</span><br><span class="line">FROM utility.access.redhat.com/ubi8/ubi:latest</span><br><span class="line">RUN dnf install -y python3</span><br><span class="line">CMD[<span class="string">&quot;/bin/bash&quot;</span>，<span class="string">&quot;-c&quot;</span>，<span class="string">&quot;echo hello&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>创建容器文件及其使用说明超出了本课程的范畴。有关容器文件的更多信息，请参阅DO180课程。</p>
<h2 id="2-3-规模化容器管理"><a href="#2-3-规模化容器管理" class="headerlink" title="2.3 规模化容器管理"></a><strong>2.3 规模化容器管理</strong></h2><hr>
<p><strong>新应用越来越多地使用容器来实施功能组件。这些容器提供应用的其他部分使用的服务。组织管理越来越多的容器，可能很快就会不堪重负。</strong></p>
<p><strong>在生产中大规模部署容器需要一个能够应对以下挑战的环境:</strong></p>
<ul>
<li><strong>平台必须确保提供必要服务的容器的可用性。</strong></li>
<li><strong>环境必须通过增加或减少运行中的容器实例，并对流量进行负载平衡，从而应对应用的使用高峰。</strong></li>
<li><strong>平台必须检测容器或主机的故障，并相应地作出反应。</strong></li>
<li><strong>开发人员可能需要自动工作流，以便透明、安全地向客户交付新的应用版本。</strong></li>
</ul>
<p><strong>Kubernetes是一项编排服务，可以使在容器主机集群中部署、管理和扩展基于容器的应用变得更加轻而易举。Kubernetes<br>通过负载平衡器将流量重定向到容器，以便您可以扩展提供服务的容器数量。Kubernetes<br>还支持用户定义的健康检查，以便监控您的容器，并在容器出现故障时将其重新启动。</strong></p>
<p><strong>红帽提供了一个名为红帽OpenShift 的kubernetes<br>发行版。红帽OpenShift是基于<br>Kubernetes基础架构构建的一组模块化组件和服务。它为开发人员提供的额外功能包括基于<br>Web<br>的远程管理、多租户、监控与审计、高级安全功能、应用生命周期管理和自助服务实例等。</strong></p>
<p><strong>红帽OpenShift不在本课程讨论范围之内，但您可以通过<a target="_blank" rel="noopener" href="https://www.openshift.com了解更多相关信息./">https://www.openshift.com了解更多相关信息。</a></strong></p>
<h1 id="3-部署容器"><a href="#3-部署容器" class="headerlink" title="3 部署容器"></a><strong>3 部署容器</strong></h1><h2 id="3-1Podman实用程序"><a href="#3-1Podman实用程序" class="headerlink" title="3.1Podman实用程序"></a>3.1Podman实用程序</h2><hr>
<p>**<br><strong>Podman是来自container-tools元数据包的全功能容器引警，用于管理开放容器计划(0C)容器和镜像</strong></p>
<p><strong>**<br>podman实用程序的运作不使用守护进程，因此开发人员无需系统上的特权用户帐户来启动或停止容器</strong></p>
<p><strong>**<br>Podman提供多个子命令来与容器和镜像交互。以下列表显示了本节中使用的子命令:</strong></p>
<p><strong>** Podman的命令:</strong></p>
<p>  命令             描述</p>
<hr>
<p>  podman build     使用容器文件构建容器镜像<br>  podman run       在新容器中运行命令<br>  podman images    列出本地存储中的镜像<br>  podman ps        打印有关容器的信息<br>  podman inspect   显示容器、镜像、卷、网络或容器集的配置<br>  podman pull      从注册表下载镜像<br>  podman cp        在容器和本地文件系统之间复制文件或目录<br>  podman exec      在运行中的容器内执行命令<br>  podman rm        删除一个或多个容器<br>  podman rmi       删除一个或多个本地存储的镜像<br>  podman search    在注册表中搜索镜像</p>
<p><strong>有关各个子命令使用帮助手册的更多信息，请将子命令附加到podman命令，并用连字符将两者分隔。例如，podman-build帮助手册介绍了podman<br>build子命令的用法。</strong></p>
<p>** 为阐述本课中的主题，请想象以下情景:**</p>
<p>** 作为系统管理员，您被委任了一项任务，使用<br>python-38软件包运行基于名为python38的RHEL8UBI容器镜像的容器。您还有一项任务，从容器文件创建容器镜像，并从该容器镜像运行名为python36的容器。使用容器文件创建的容器镜像必须具有python36:1.0标签。识别两个容器之间的差异。另外，请确保容器中安装的python软件包与本地计算机中安装的Python版本不相冲突。**</p>
<h2 id="3-2-安装容器实用工具"><a href="#3-2-安装容器实用工具" class="headerlink" title="3.2 安装容器实用工具"></a>3.2 安装容器实用工具</h2><hr>
<p>  <strong>container-tools 软件包包含与容器和容器镜像交互所需的实用程序</strong></p>
<p>** 若要在系统上下载、运行和比较容器，请使用dnf<br>install命令来安装container-tools 元软件包**</p>
<p>** 使用dnf info命令查看 container-tools 软件包的版本和内容**</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ <span class="built_in">sudo</span> dnf -y install container-tools    <span class="comment"># 安装podman容器 </span></span><br><span class="line">[student@servera ~]$ podman --version</span><br><span class="line">[student@servera ~]$ dnf info container-tools</span><br></pre></td></tr></table></figure>

<p>  <strong>container-tools元数据包提供所需的podman和skope<br>实用程序，用于完成分配的任务</strong></p>
<h2 id="3-3-从注册表下载容器镜像文件"><a href="#3-3-从注册表下载容器镜像文件" class="headerlink" title="3.3 从注册表下载容器镜像文件"></a>3.3 从注册表下载容器镜像文件</h2><hr>
<p><strong>1.确保podman实用程序已配置为从utility.lab.example.com注册表搜索和下载容器</strong></p>
<p>** 2.podman<br>info命令显示podman实用程序的配置信息，包括其配置的注册表**</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman info</span><br></pre></td></tr></table></figure>

<p>  <strong>podman<br>search命令使用registries.conf文件中指定的注册表列表搜索匹配的名称镜像。默认情况下，Podman在所有非限定搜索注册表中执行搜索</strong></p>
<h2 id="3-4-让servera联网方法"><a href="#3-4-让servera联网方法" class="headerlink" title="3.4 让servera联网方法"></a>3.4 让servera联网方法</h2><hr>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、f0宿主机上ens192是第二块网卡，vmware上选择nat模式-选择‘已连接’，再获取IP，保证可以上网</span><br><span class="line">2、在f0宿主机上执行ssh root@172.25.254.254 rht-config-nat</span><br><span class="line">3、servera上ping www.baidu.com测试  </span><br></pre></td></tr></table></figure>

<p><strong>使用podman<br>search命令，显示包含python-38软件包的已配置注册表的镜像列表</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在注册表中搜索镜像</span></span><br><span class="line">[student@servera ~]$ podman search utility.lab.example.com/</span><br><span class="line">NAME                                       DESCRIPTION</span><br><span class="line">utility.lab.example.com/rhel8/mariadb-103  </span><br><span class="line">utility.lab.example.com/rhel9/mariadb-105  </span><br><span class="line">utility.lab.example.com/rhel9/httpd-24     </span><br><span class="line">utility.lab.example.com/library/nginx      </span><br><span class="line">utility.lab.example.com/ubi7/ubi           </span><br><span class="line">utility.lab.example.com/ubi9/ubi           </span><br><span class="line">utility.lab.example.com/ubi8/ubi           </span><br><span class="line">utility.lab.example.com/ubi9/python-312    </span><br><span class="line">utility.lab.example.com/rhel9/php-82 </span><br><span class="line"></span><br><span class="line"><span class="comment"># 从注册表中下载镜像</span></span><br><span class="line">[student@servera ~]$ podman pull utility.lab.example.com/ubi7/ubi</span><br><span class="line">[student@servera ~]$ podman pull utility.lab.example.com/rhel8/mariadb-103</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出本地存储中的镜像</span></span><br><span class="line">[student@servera ~]$ podman images</span><br><span class="line">REPOSITORY                                 TAG         IMAGE ID      CREATED      SIZE</span><br><span class="line">utility.lab.example.com/ubi7/ubi           latest      87dd8ec61bbc  4 years ago  215 MB</span><br><span class="line">utility.lab.example.com/rhel8/mariadb-103  latest      11a47e0fbed0  4 years ago  572 MB</span><br><span class="line"></span><br><span class="line"><span class="comment"># 镜像信息注解:</span></span><br><span class="line">REPOSITORY   :仓库地址</span><br><span class="line">TAG          ：标记，latest最近版本</span><br><span class="line">IMAGE ID     ：镜像ID，ID号唯一，保证镜像唯一性</span><br><span class="line">CREATED      ：创建时间；</span><br><span class="line">SIZE         ：镜像大小</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">练习：</span><br><span class="line">以普通用户身份远程登录系统</span><br><span class="line">ssh student@localhost  </span><br><span class="line">1.登录容器镜像仓库服务器utility.lab.example.com</span><br><span class="line">$ <span class="built_in">sudo</span> vim /etc/containers/registries.conf </span><br><span class="line">$ podman login -u admin -p redhat321 utility.lab.example.com </span><br><span class="line"></span><br><span class="line">2.搜索镜像服务器仓库utility.lab.example.com所有镜像</span><br><span class="line">$ podman search utility.lab.example.com/</span><br><span class="line"></span><br><span class="line">3.下载rhel7、8、9的ubi系统到本地</span><br><span class="line">$ podman pull utility.lab.example.com/ubi7/ubi</span><br><span class="line">$ podman pull utility.lab.example.com/ubi8/ubi</span><br><span class="line">$ podman pull utility.lab.example.com/ubi9/ubi</span><br><span class="line"></span><br><span class="line">4.查看本地镜像</span><br><span class="line">$ podman images</span><br><span class="line"></span><br><span class="line">5.通过rhel7的ubi运行一个交互式容器,然后退出</span><br><span class="line">$ podman run -ti utility.lab.example.com/ubi7/ubi</span><br><span class="line">$ <span class="built_in">exit</span>   <span class="comment">#或者按ctrl+d</span></span><br><span class="line"></span><br><span class="line">6.通过rhel8的ubi运行一个长期挂载到后台的容器</span><br><span class="line">$ podman run -di utility.lab.example.com/ubi8/ubi</span><br><span class="line"></span><br><span class="line">7.通过rhel9的ubi运行一个长期挂载到后台的容器，并且指定容器名称为rhel9</span><br><span class="line">[student@servera ~]$ podman run -di --name rhel9 utility.lab.example.com/ubi9/ubi</span><br><span class="line">b4b889bb5964acae14a6e7c2d138e8cc56e9ebf94edf9653f5341522ffc9ec76</span><br><span class="line"></span><br><span class="line">8.进入rhel9容器进行交互</span><br><span class="line">[student@servera ~]$ podman <span class="built_in">exec</span> -ti rhel9 /bin/bash</span><br><span class="line">[root@b4b889bb5964 /]# <span class="built_in">cat</span> /etc/redhat-release</span><br><span class="line">Red Hat Enterprise Linux release 9.3 (Plow)</span><br><span class="line"></span><br><span class="line">9.使用httpd-24镜像运行一个web服务。并且访问测试</span><br><span class="line"><span class="comment">#本地测试，如果在其他主机上访问servera容器web服务，需要在servera防火墙允许主机端口8090</span></span><br><span class="line"></span><br><span class="line">10.使用nginx镜像运行一个web服务。并且访问测试，nginx容器内端口为80</span><br><span class="line"></span><br><span class="line">11.尝试运行一个mariadb-105的容器</span><br></pre></td></tr></table></figure>

<h2 id="3-5-从容器文件创建容器镜像"><a href="#3-5-从容器文件创建容器镜像" class="headerlink" title="3.5 从容器文件创建容器镜像"></a>3.5 从容器文件创建容器镜像</h2><hr>
<p>** 您获得了以下容器文件，用于在 python36-app目录中创建容器镜像**</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> Containerfile </span><br><span class="line">FROM utility.access.redhat.com/ubi8/ubi:latest</span><br><span class="line">RUN dnf install -y python36</span><br><span class="line">CMD[<span class="string">&quot;/bin/bash&quot;</span>，<span class="string">&quot;-c&quot;</span>，<span class="string">&quot;sleep infinity&quot;</span>]</span><br><span class="line"><span class="comment"># 此容器文件是教材中例子默认报错，可以使用下面的容器文件</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ vim Containerfile</span><br><span class="line">FROM utility.lab.example.com/ubi9/ubi:latest</span><br><span class="line">RUN <span class="built_in">echo</span> -e <span class="string">&#x27;[rhel-9.3-for-x86_64-baseos-rpms]\nbaseurl = http://content.example.com/rhel9.3/x86_64/dvd/BaseOS\nenabled = true\ngpgcheck = false\nname = Red Hat Enterprise Linux 9.3 BaseOS (dvd)\n[rhel-9.3-for-x86_64-appstream-rpms]\nbaseurl = http://content.example.com/rhel9.3/x86_64/dvd/AppStream\nenabled = true\ngpgcheck = false\nname = Red Hat Enterprise Linux 9.3 Appstream (dvd)&#x27;</span>&gt;/etc/yum.repos.d/rhel_dvd.repo</span><br><span class="line">RUN yum install --disablerepo=* --enablerepo=rhel-9.3-for-x86_64-baseos-rpms --enablerepo=rhel-9.3-for-x86_64-appstream-rpms -y python3</span><br><span class="line">CMD [<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;sleep infinity&quot;</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>以上容器文件使用utility.lab.example.com&#x2F;ubi9&#x2F;ubi:latest镜像作为基础镜像。容器文件而后将安装python36<br>软件包，并运行sleep infinity bash命令来防止容器退出</strong></li>
<li><strong>通常，容器运行一个进程，然后在该进程完成后退出。sleep<br>nfinity命令可防止容器退出因为该进程永远不会完成。然后可以在容器内进行测试、开发和调试</strong></li>
<li><strong>在检查容器文件后，可以使用podman build命令来构建镜像。podman<br>build命令的语法如下所示:</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ podman build -t NAME:TAG  DIR</span><br><span class="line">[student@servera ~]$ podman build -t rhel7:2.0 .</span><br><span class="line">[student@servera ~]$ podman images</span><br><span class="line">REPOSITORY                                 TAG         IMAGE ID      CREATED         SIZE</span><br><span class="line">localhost/rhel7                            2.0         98d0b6385a00  40 seconds ago  238 MB</span><br><span class="line">utility.lab.example.com/ubi9/ubi           latest      8d2a8803cfca  12 months ago   219 MB</span><br><span class="line">utility.lab.example.com/ubi7/ubi           latest      87dd8ec61bbc  4 years ago     215 MB</span><br><span class="line">utility.lab.example.com/rhel8/mariadb-103  latest      11a47e0fbed0  4 years ago     572 MB</span><br><span class="line"><span class="comment"># 以上输出的最后一行显示了容器镜像ID。大多数Podman命令使用容器镜像ID的前12个字符来指代容器镜像，可以将此短ID或者容器或容器镜像的名称，作为大多数Podman命令的参数</span></span><br><span class="line"><span class="comment"># 注解:</span></span><br><span class="line">-t,--tag name 生成镜像的名称</span><br><span class="line">NAME:新镜像的名称</span><br><span class="line">标签:新镜像的标签。如果未指定标签，则镜像自动标记为latest</span><br><span class="line">DIR:工作目录路径。容器文件必须位于工作目录中。如果工作目录是当前目录，则可以用点(.)来指定它。使用-f标志指定与当前目录不同的目录</span><br></pre></td></tr></table></figure>

<p><strong>使用podman<br>inspect命令来查看容器镜像的低级别信息，并验证其内容是否符合容器要求:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(podman pull  先下载后再使用inspect)</span><br><span class="line">[student@servera ~]$ podman inspect localhost/rhel7:2.0</span><br></pre></td></tr></table></figure>

<p>** podman<br>inspect命令的输出显示reqistry.access.redhat.com&#x2F;ubi8&#x2F;ubi:latest基础镜像、用于安装<br>python36 软件包的 dnf命令，以及在运行时执行以防止容器退出的sleep<br>infinity bash命令**</p>
<h1 id="4-运行容器"><a href="#4-运行容器" class="headerlink" title="4 运行容器"></a>4 运行容器</h1><hr>
<p><strong>现在，您已拥有所需的容器镜像，可以使用它们来运行容器。容器可以处于以下状态之一!<br>Created 已创建好但尚未启动的容器。 运行中 与其进程一起运行的容器。<br>已停止 其进程已停止的容器。 Paused 其进程已暂停的容器。不支持 Rootless<br>容器。 Deleted 其进程处于已死状态的容器。</strong></p>
<p>**podman ps命令列出系统上正在运行的容器。使用podman ps<br>-a来命令查看计算机中的所有容器 (已创建、已停止、已暂停或正在运行)。 **</p>
<p>** 可使用podman<br>create命令来创建容器，以便稍后运行。若要创建容器，请使用容器localhost&#x2F;rhel7:2.0镜像的ID。也可以使用–name<br>选项设置名称来标识容器。此命令的输出是容器的长ID,如果不指定–name选项，会自动生成一个容器名称。**</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ podman create --name python36 dd6ca291f097</span><br></pre></td></tr></table></figure>

<p><strong>然后，可使用podman ps和podman ps<br>-a命令来验证容器是否已创建但尚未启动。您可以查看有关 python36<br>容器的信息，如容器的短ID、名称和状态，容器在启动时运行的命令，以及用于创建容器的镜像</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ podman ps </span><br><span class="line">$ podman ps -a</span><br></pre></td></tr></table></figure>

<p><strong>现在已验证容器已正确创建，决定启动容器，所以要运行 podman<br>start命令。可以使用名称或容器ID来启动容器。此命令的输出是容器的名称。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ podman start python36</span><br><span class="line">$ podman ps</span><br></pre></td></tr></table></figure>

<h2 id="4-1-从远程存储库运行容器"><a href="#4-1-从远程存储库运行容器" class="headerlink" title="4.1 从远程存储库运行容器"></a>4.1 从远程存储库运行容器</h2><p>  您可使用podman run命令，在一个步骤中创建并运行容器。podman run<br>命令在容器内运行进程，此进程将启动新容器。</p>
<p>  您可以使用podman run<br>命令-d选项以分离模式运行容器，这将在后台运行容器，而不是在会话的前台运行</p>
<p>在python36容器的示例中，您不需要提供容器运行所提的命令，原因是为该容器创建镜像的容器文件中已提供了sleep<br>infinity 命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">podman run </span><br><span class="line">-t  终端</span><br><span class="line">-i  交互</span><br><span class="line">-d  放在后台</span><br><span class="line">--name  指定容器的名称，如果不指定，会自从产生名称</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman run -it utility.lab.example.com/ubi7/ubi</span><br><span class="line">[student@servera ~]$ podman ps</span><br><span class="line">CONTAINER ID  IMAGE                                    COMMAND     CREATED             STATUS             PORTS       NAMES</span><br><span class="line">537b1f1fbb6d  utility.lab.example.com/ubi7/ubi:latest  /bin/bash   About a minute ago  Up About a minute              objective_antonelli</span><br><span class="line"></span><br><span class="line"><span class="comment">#实验前可以提前下载镜像至本地 </span></span><br><span class="line"><span class="comment">#podman search utility.lab.example.com/</span></span><br><span class="line"><span class="comment">#podman pull utility.lab.example.com/ubi8/ubi</span></span><br><span class="line"><span class="comment">#podman images</span></span><br><span class="line">[student@servera ~]$ podman run -it --name rhel9 utility.lab.example.com/ubi9/ubi</span><br><span class="line">[student@servera ~]$ podman run -di --name rhel9-1 utility.lab.example.com/ubi9/ubi</span><br><span class="line">[student@servera ~]$ podman ps</span><br><span class="line">CONTAINER ID  IMAGE                                    COMMAND     CREATED         STATUS         PORTS       NAMES</span><br><span class="line">537b1f1fbb6d  utility.lab.example.com/ubi7/ubi:latest  /bin/bash   5 minutes ago   Up 5 minutes               objective_antonelli</span><br><span class="line">fb45a06e2271  utility.lab.example.com/ubi9/ubi:latest  /bin/bash   56 seconds ago  Up 57 seconds              rhel9-1</span><br><span class="line"></span><br><span class="line"><span class="comment"># ctrl+d退出后再查看容器的状态</span></span><br><span class="line">[student@servera ~]$ podman <span class="built_in">exec</span> -ti rhel9-1 /bin/bash</span><br><span class="line">[student@servera ~]$ podman run -d --name rhel9-2 utility.lab.example.com/ubi9/ubi <span class="built_in">sleep</span> infinity</span><br><span class="line">[student@servera ~]$ podman ps</span><br><span class="line">CONTAINER ID  IMAGE                                    COMMAND         CREATED         STATUS         PORTS       NAMES</span><br><span class="line">fb45a06e2271  utility.lab.example.com/ubi9/ubi:latest  /bin/bash       5 minutes ago   Up 5 minutes               rhel9-1</span><br><span class="line">c4f7f4d72747  utility.lab.example.com/ubi9/ubi:latest  <span class="built_in">sleep</span> infinity  34 seconds ago  Up 34 seconds              rhel9-2</span><br></pre></td></tr></table></figure>

<h2 id="4-2-容器中的环境隔离"><a href="#4-2-容器中的环境隔离" class="headerlink" title="4.2 容器中的环境隔离"></a>4.2 容器中的环境隔离</h2><p>  <strong>容器隔离应用的环境</strong></p>
<p>**<br>每个容器都有自己的文件系统、网络和进程。查看ps命令的输出，并在主机和运行中容器之间进行比较，就会注意到隔离功能**</p>
<p>** 在本地计算机上运行ps<br>-ax命令，该命令将返回具有许多进程的预期结果**</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ ps -ax</span><br><span class="line">[student@servera ~]$ podman run -di --name python36-db utility.lab.example.com/rhel8/mariadb-103</span><br><span class="line">f4c3d26df7bd3614e6b4954ae6ed485046128afc89a95cba20c834b2ba0327ff</span><br><span class="line">[student@servera ~]$ podman run -di --name python38 utility.lab.example.com/ubi9/ubi</span><br><span class="line">8e7870d50daa32c768c4301911364285a659a5383b4cdadc96b8d3b7ff411c2d</span><br><span class="line">[student@servera ~]$ podman run -<span class="built_in">id</span> --name rhel7 utility.lab.example.com/ubi7/ubi</span><br><span class="line">2d4b030f4141656f8b4b74d419c2b8de52669927a261953c92409bc995b35922</span><br><span class="line">[student@servera ~]$ podman ps -a</span><br><span class="line">CONTAINER ID  IMAGE                                             COMMAND         CREATED         STATUS                     PORTS       NAMES</span><br><span class="line">850618efbece  utility.lab.example.com/ubi9/ubi:latest           /bin/bash       9 hours ago     Exited (0) 9 hours ago                 rhel9</span><br><span class="line">fb45a06e2271  utility.lab.example.com/ubi9/ubi:latest           /bin/bash       9 hours ago     Up 9 hours                             rhel9-1</span><br><span class="line">c4f7f4d72747  utility.lab.example.com/ubi9/ubi:latest           <span class="built_in">sleep</span> infinity  9 hours ago     Up 9 hours                             rhel9-2</span><br><span class="line">f4c3d26df7bd  utility.lab.example.com/rhel8/mariadb-103:latest  run-mysqld      22 minutes ago  Exited (1) 22 minutes ago              python36-db</span><br><span class="line">8e7870d50daa  utility.lab.example.com/ubi9/ubi:latest           /bin/bash       16 minutes ago  Up 16 minutes                          python38</span><br><span class="line">2d4b030f4141  utility.lab.example.com/ubi7/ubi:latest           /bin/bash       12 seconds ago  Up 13 seconds                          rhel7</span><br></pre></td></tr></table></figure>

<p>  <strong>podman exec命令可在运行中的容器内执行命令</strong></p>
<p>**<br>该命令取容器的名称或ID作为第一个参数，并将下列参数作为要在容器内运行的命令**</p>
<p>** 使用podman exec命令查看rhel7容器中正在运行的进程。ps<br>aux命令的输出看起来有所不同，因为它运行与本地计算机不同的进程**</p>
<p>** 使用sh -c命令来封装要在容器中执行的命令**</p>
<p>** ps ax &gt;<br>&#x2F;tmp&#x2F;process-data.log命令被解释为要在容器中执行的命令。如果不封装命令，则Podman可能会将大于号字符(&gt;)解释为podman命令的一部分，而不是podman<br>exec选项的参数**</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#使用练习环境中的utility.lab.example.com/ubi7/ubi镜像，执行一些其他命令，比如ls /等</span></span><br><span class="line">[student@servera ~]$ podman <span class="built_in">exec</span> rhel7 ps -ax</span><br><span class="line">    PID TTY      STAT   TIME COMMAND</span><br><span class="line">      1 ?        Ss     0:00 /bin/bash</span><br><span class="line">      2 ?        R      0:00 ps -ax</span><br><span class="line">[student@servera ~]$ podman <span class="built_in">exec</span> rhel7 sh -c <span class="string">&#x27;ps -a &gt; /tmp/process_data.log&#x27;</span></span><br><span class="line">[student@servera ~]$ podman <span class="built_in">exec</span> rhel7 sh -c <span class="string">&#x27;echo China &gt; /test.txt&#x27;</span></span><br><span class="line">[student@servera ~]$ podman <span class="built_in">exec</span> -ti rhel7 /bin/bash</span><br><span class="line">[root@2d4b030f4141 /]# <span class="built_in">ls</span> /</span><br><span class="line">bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  test.txt  tmp  usr  var</span><br><span class="line">[root@2d4b030f4141 /]# <span class="built_in">cat</span> test.txt</span><br><span class="line">China</span><br><span class="line">[root@2d4b030f4141 /]# <span class="built_in">cat</span> /tmp/process_data.log</span><br><span class="line">    PID TTY          TIME CMD</span><br><span class="line">[root@2d4b030f4141 /]# <span class="built_in">exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">[student@servera ~]$ </span><br></pre></td></tr></table></figure>

<p>** 将主机系统上安装的python版本与容器上安装的python版本进行比较:**</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman <span class="built_in">exec</span> rhel9-1 python3 --version</span><br><span class="line">Python 3.9.18</span><br><span class="line">[student@servera ~]$ python3 --version</span><br><span class="line">Python 3.9.18</span><br><span class="line">[student@servera ~]$ podman <span class="built_in">exec</span> python38  python3 --version</span><br><span class="line">Python 3.9.18</span><br></pre></td></tr></table></figure>

<h2 id="4-3-容器中的文件系统隔离"><a href="#4-3-容器中的文件系统隔离" class="headerlink" title="4.3 容器中的文件系统隔离"></a>4.3 容器中的文件系统隔离</h2><hr>
<p><strong>开发人员可以使用文件系统隔离功能，为不同版本的编程语言编写和测试应用，无需使用多个物理机或虚拟机。</strong></p>
<p><strong>您将在终端上的&#x2F;tmp目录中创建一个显示hello world的简单bash 脚本。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ <span class="built_in">echo</span> <span class="string">&quot;echo Hello China!&quot;</span> &gt; /tmp/hello.sh</span><br><span class="line">[student@servera tmp]$ <span class="built_in">cd</span> /tmp;ll</span><br><span class="line">total 8</span><br><span class="line">-rw-r--r--. 1 student student 18 Mar  3 21:24 hello.sh</span><br><span class="line">-rw-r--r--. 1 student student 30 Mar  3 21:01 process_data.log</span><br><span class="line">drwx------. 3 root    root    17 Mar  3 08:28 systemd-private-3f251aad6ce74edb86dddf89d56e8aed-chronyd.service-c0Zzhi</span><br><span class="line">drwx------. 3 root    root    17 Mar  3 08:28 systemd-private-3f251aad6ce74edb86dddf89d56e8aed-dbus-broker.service-QaiP7N</span><br><span class="line">drwx------. 3 root    root    17 Mar  3 08:28 systemd-private-3f251aad6ce74edb86dddf89d56e8aed-systemd-logind.service-iM6Zeq</span><br></pre></td></tr></table></figure>

<p>  <strong>&#x2F;tmp&#x2F;hello.sh<br>文件位于主机计算机上，而不存在于容器内的文件系统上。如果尝试使用podman<br>exec来执行脚本，则会出现错误，因为容器中不存在&#x2F;tmp&#x2F;hello.sh脚本</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[student@servera tmp]$ <span class="built_in">stat</span> /tmp/hello.sh</span><br><span class="line">  File: /tmp/hello.sh</span><br><span class="line">  Size: 18          Blocks: 8          IO Block: 4096   regular file</span><br><span class="line">Device: fc04h/64516d    Inode: 18159864    Links: 1</span><br><span class="line">Access: (0644/-rw-r--r--)  Uid: ( 1000/ student)   Gid: ( 1000/ student)</span><br><span class="line">Context: unconfined_u:object_r:user_tmp_t:s0</span><br><span class="line">Access: 2025-03-03 21:24:33.865950531 -0500</span><br><span class="line">Modify: 2025-03-03 21:24:33.865950531 -0500</span><br><span class="line">Change: 2025-03-03 21:24:33.865950531 -0500</span><br><span class="line"> Birth: 2025-03-03 21:24:33.865950531 -0500</span><br><span class="line">[student@servera tmp]$ podman <span class="built_in">exec</span> rhel7 <span class="built_in">stat</span> /tmp/hello.sh</span><br><span class="line"><span class="built_in">stat</span>: cannot <span class="built_in">stat</span> <span class="string">&#x27;/tmp/hello.sh&#x27;</span>: No such file or directory</span><br></pre></td></tr></table></figure>

<p><strong>podman cp命令在主机和容器文件系统之间复制文件和文件夹。您可以使用<br>podman cp 命令将&#x2F;tmp&#x2F;hello.sh文件复制到python38容器:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman <span class="built_in">cp</span> /tmp/hello.sh rhel7:/tmp/hello.sh</span><br><span class="line">[student@servera ~]$ podman <span class="built_in">exec</span> rhel7 <span class="built_in">stat</span> /tmp/hello.sh</span><br><span class="line">  File: <span class="string">&#x27;/tmp/hello.sh&#x27;</span></span><br><span class="line">  Size: 18          Blocks: 8          IO Block: 4096   regular file</span><br><span class="line">Device: 58h/88d Inode: 10261231    Links: 1</span><br><span class="line">Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)</span><br><span class="line">Access: 2025-03-04 02:24:34.000000000 +0000</span><br><span class="line">Modify: 2025-03-04 02:24:34.000000000 +0000</span><br><span class="line">Change: 2025-03-04 02:28:24.720471184 +0000</span><br><span class="line"> Birth: -</span><br></pre></td></tr></table></figure>

<p><strong>脚本复制到容器文件系统后，即可从容器内执行:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman <span class="built_in">exec</span> rhel7 bash /tmp/hello.sh</span><br><span class="line">Hello China!</span><br></pre></td></tr></table></figure>

<h2 id="4-4-删除容器和镜像"><a href="#4-4-删除容器和镜像" class="headerlink" title="4.4 删除容器和镜像"></a>4.4 删除容器和镜像</h2><hr>
<p>** 使用podman rm和podman rmi命令删除容器和镜像**</p>
<p>** 删除容器镜像之前，必须先从该镜像移除任何现有的运行中容器**</p>
<p>** 删除python38容器及其相关镜像:**</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman ps -a</span><br><span class="line">CONTAINER ID  IMAGE                                             COMMAND         CREATED            STATUS                        PORTS       NAMES</span><br><span class="line">850618efbece  utility.lab.example.com/ubi9/ubi:latest           /bin/bash       10 hours ago       Exited (0) 10 hours ago                   rhel9</span><br><span class="line">fb45a06e2271  utility.lab.example.com/ubi9/ubi:latest           /bin/bash       10 hours ago       Up 10 hours                               rhel9-1</span><br><span class="line">c4f7f4d72747  utility.lab.example.com/ubi9/ubi:latest           <span class="built_in">sleep</span> infinity  10 hours ago       Up 10 hours                               rhel9-2</span><br><span class="line">f4c3d26df7bd  utility.lab.example.com/rhel8/mariadb-103:latest  run-mysqld      About an hour ago  Exited (1) About an hour ago              python36-db</span><br><span class="line">8e7870d50daa  utility.lab.example.com/ubi9/ubi:latest           /bin/bash       55 minutes ago     Up 55 minutes                             python38</span><br><span class="line">2d4b030f4141  utility.lab.example.com/ubi7/ubi:latest           /bin/bash       39 minutes ago     Up 39 minutes                             rhel7</span><br><span class="line">student@servera ~]$ podman rmi utility.lab.example.com/ubi9/ubi:latest</span><br><span class="line">Error: image used by 8e7870d50daa32c768c4301911364285a659a5383b4cdadc96b8d3b7ff411c2d: image is <span class="keyword">in</span> use by a container: consider listing external containers and force-removing image</span><br></pre></td></tr></table></figure>

<p>  <strong>必须先停止容器，然后才能删除它。若要停止容器，请使用podman<br>stop命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman stop python38</span><br><span class="line">python38</span><br></pre></td></tr></table></figure>

<p>停止容器后，使用 podman rm 命令来删除容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman <span class="built_in">rm</span> --<span class="built_in">help</span></span><br><span class="line">[student@servera ~]$ podman <span class="built_in">rm</span> python38</span><br><span class="line">python38</span><br><span class="line">[student@servera ~]$ podman ps -a</span><br><span class="line">CONTAINER ID  IMAGE                                             COMMAND         CREATED            STATUS                        PORTS       NAMES</span><br><span class="line">850618efbece  utility.lab.example.com/ubi9/ubi:latest           /bin/bash       10 hours ago       Exited (0) 10 hours ago                   rhel9</span><br><span class="line">fb45a06e2271  utility.lab.example.com/ubi9/ubi:latest           /bin/bash       10 hours ago       Up 10 hours                               rhel9-1</span><br><span class="line">c4f7f4d72747  utility.lab.example.com/ubi9/ubi:latest           <span class="built_in">sleep</span> infinity  10 hours ago       Up 10 hours                               rhel9-2</span><br><span class="line">f4c3d26df7bd  utility.lab.example.com/rhel8/mariadb-103:latest  run-mysqld      About an hour ago  Exited (1) About an hour ago              python36-db</span><br><span class="line">2d4b030f4141  utility.lab.example.com/ubi7/ubi:latest           /bin/bash       45 minutes ago     Up 45 minutes                             rhel7</span><br></pre></td></tr></table></figure>

<p>** 当容器不再存在时，可以使用podman rmi命令删除对应的镜像:**</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman images</span><br><span class="line">REPOSITORY                                 TAG         IMAGE ID      CREATED        SIZE</span><br><span class="line">localhost/rhel7                            2.0         98d0b6385a00  11 hours ago   238 MB</span><br><span class="line">utility.lab.example.com/ubi9/ubi           latest      8d2a8803cfca  12 months ago  219 MB</span><br><span class="line">utility.lab.example.com/ubi7/ubi           latest      87dd8ec61bbc  4 years ago    215 MB</span><br><span class="line">utility.lab.example.com/rhel8/mariadb-103  latest      11a47e0fbed0  4 years ago    572 MB</span><br><span class="line">[student@servera ~]$ podman rmi 8d2a8803cfca</span><br><span class="line">Error: image used by c4f7f4d727471d590f6241cccf0be0b1ef2256cc43a710594642611fe6d0be47: image is <span class="keyword">in</span> use by a container: consider listing external containers and force-removing image</span><br><span class="line">[student@servera ~]$ podman rmi 98d0b6385a00</span><br><span class="line">Untagged: localhost/rhel7:2.0</span><br><span class="line">Deleted: 98d0b6385a005e09cfcee59a393cfce2fc46b56f09af6c4f87bd874f00966ed2</span><br><span class="line">Deleted: 53c739e51f226903b6568038c9cf563de2007f756e0a0e86e5c00604cf474f3d</span><br><span class="line">Deleted: 92b83aa1157f23b209f53480c6bbdf780c39490b37337bc4f4fcb1061b7c978</span><br></pre></td></tr></table></figure>

<h1 id="5-管理容器存储和网络资源"><a href="#5-管理容器存储和网络资源" class="headerlink" title="5 管理容器存储和网络资源"></a>5 管理容器存储和网络资源</h1><h2 id="5-1-管理容器资源"><a href="#5-1-管理容器资源" class="headerlink" title="5.1 管理容器资源"></a>5.1 管理容器资源</h2><hr>
<p><strong>可以使用容器来运行简单的进程，然后退出。</strong></p>
<p><strong>还可以配置容器以连续运行某一服务，如数据库服务器。如果您持续运行服务，您最终可能需要向容器添加更多资源，如持久存储或对其他网络的访问权限。</strong></p>
<p><strong>可以使用不同的策略为容器配置持久存储:</strong></p>
<p>** 1.对于红帽OpenShift<br>等企业容器平台上的大型部署，您可以使用复杂的存储解决方案为容器提供存储，而无需了解底层基础架构**</p>
<p>**<br>2.对于单个容器主机上且无需扩展的小型部署，您可以通过在运行中的容器上创建要挂载的目录，从容器主机创建持久存储**</p>
<p><strong>当Web服务器或数据库服务器等容器为容器主机外部的客户端提供内容时，必须为这些客户端设置通信通道，以访问容器的内容。</strong></p>
<p><strong>可以配置端口映射，以启用与容器的通信。通过端口映射，目的地为容器主机上端口的请求将被转发到容器内的端口。</strong></p>
<p><strong>设想必须执行以下任务:</strong></p>
<ul>
<li><p><strong>基于MariaDB，创建名为db01的容器化数据库。</strong></p>
</li>
<li><p><strong>配置容器端口映射和主机防火墙，以允许端口3306&#x2F;tcp 上的流量。</strong></p>
</li>
<li><p><strong>配置db01容器，以使用具有适当SELinux 上下文的持久存储。</strong></p>
</li>
<li><p><strong>添加适当的网络配置，以便client01容器可以使用DNS与db01容器通信。</strong></p>
</li>
</ul>
<h2 id="5-2-容器的环境变量"><a href="#5-2-容器的环境变量" class="headerlink" title="5.2 容器的环境变量"></a>5.2 容器的环境变量</h2><hr>
<p><strong>容器镜像允许在创建时传递环境变量以自定义容器</strong></p>
<p><strong>可以使用环境变量为容器设置参数，以根据您的环境进行定制，无需创建自己的自定义镜像。通常，您不会修改容器镜像，因为这会向镜像添加层，或许更加难以维护。</strong></p>
<p>使用podman run -d –name db01<br>utility.lab.example.com&#x2F;rhel8&#x2F;mariadb-103命令运行容器化数据库，但发现容器无法启动。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman search utility.lab.example.com/</span><br><span class="line">NAME                                       DESCRIPTION</span><br><span class="line">utility.lab.example.com/rhel8/mariadb-103  </span><br><span class="line">utility.lab.example.com/rhel9/mariadb-105  </span><br><span class="line">utility.lab.example.com/rhel9/httpd-24     </span><br><span class="line">utility.lab.example.com/library/nginx      </span><br><span class="line">utility.lab.example.com/ubi7/ubi           </span><br><span class="line">utility.lab.example.com/ubi9/ubi           </span><br><span class="line">utility.lab.example.com/ubi8/ubi           </span><br><span class="line">utility.lab.example.com/ubi9/python-312    </span><br><span class="line">utility.lab.example.com/rhel9/php-82 </span><br><span class="line">      </span><br><span class="line">[student@servera ~]$ podman pull utility.lab.example.com/rhel8/mariadb-103</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman images</span><br><span class="line">REPOSITORY                                 TAG         IMAGE ID      CREATED        SIZE</span><br><span class="line">utility.lab.example.com/ubi9/ubi           latest      8d2a8803cfca  12 months ago  219 MB</span><br><span class="line">utility.lab.example.com/ubi7/ubi           latest      87dd8ec61bbc  4 years ago    215 MB</span><br><span class="line">utility.lab.example.com/rhel8/mariadb-103  latest      11a47e0fbed0  4 years ago    572 MB</span><br><span class="line">[student@servera ~]$ podman run -d --name db01 utility.lab.example.com/rhel8/mariadb-103</span><br><span class="line">29decc6e48d62506e62e503a383943709138a8f789a32dd27d2fa1761bf3ea9f</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发现容器无法启动</span></span><br><span class="line">[student@servera ~]$ podman ps -a</span><br><span class="line">CONTAINER ID  IMAGE                                             COMMAND     CREATED        STATUS                    PORTS       NAMES</span><br><span class="line">29decc6e48d6  utility.lab.example.com/rhel8/mariadb-103:latest  run-mysqld  2 minutes ago  Exited (1) 2 minutes ago              db01</span><br></pre></td></tr></table></figure>

<p><strong>使用podman container logs命令调查容器状态的原因。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman container logs db01</span><br><span class="line">Warning: Can<span class="string">&#x27;t detect memory limit from cgroups</span></span><br><span class="line"><span class="string">Warning: Can&#x27;</span>t detect number of CPU cores from cgroups</span><br><span class="line">Warning: Can<span class="string">&#x27;t detect memory limit from cgroups</span></span><br><span class="line"><span class="string">Warning: Can&#x27;</span>t detect number of CPU cores from cgroups</span><br><span class="line">=&gt; sourcing 20-validate-variables.sh ...</span><br><span class="line">You must either specify the following environment variables:</span><br><span class="line">  MYSQL_USER (regex: <span class="string">&#x27;^[a-zA-Z0-9_]+$&#x27;</span>)</span><br><span class="line">  MYSQL_PASSWORD (regex: <span class="string">&#x27;^[a-zA-Z0-9_~!@#$%^&amp;*()-=&lt;&gt;,.?;:|]+$&#x27;</span>)</span><br><span class="line">  MYSQL_DATABASE (regex: <span class="string">&#x27;^[a-zA-Z0-9_]+$&#x27;</span>)</span><br><span class="line">Or the following environment variable:</span><br><span class="line">  MYSQL_ROOT_PASSWORD (regex: <span class="string">&#x27;^[a-zA-Z0-9_~!@#$%^&amp;*()-=&lt;&gt;,.?;:|]+$&#x27;</span>)</span><br><span class="line">Or both.</span><br><span class="line">Optional Settings:</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 输出中的usage 标签提供了如何运行镜像的示例。url标签指向红帽容器目录中的一个Web页面，其中记录了环境变量以及有关如何使用容器镜像的其他信息。</span></span><br><span class="line"><span class="comment"># 此镜像的文档显示容器将3306端口用于数据库服务。文档中还显示了以下环境变量可用于配置数据库服务:</span></span><br><span class="line">[student@servera ~]$ podman images</span><br><span class="line">REPOSITORY                                 TAG         IMAGE ID      CREATED        SIZE</span><br><span class="line">utility.lab.example.com/ubi9/ubi           latest      8d2a8803cfca  12 months ago  219 MB</span><br><span class="line">utility.lab.example.com/ubi7/ubi           latest      87dd8ec61bbc  4 years ago    215 MB</span><br><span class="line">utility.lab.example.com/rhel8/mariadb-103  latest      11a47e0fbed0  4 years ago    572 MB</span><br><span class="line">[student@servera ~]$ podman inspect utility.lab.example.com/rhel8/mariadb-103 | grep usage</span><br><span class="line">                    <span class="string">&quot;usage&quot;</span>: <span class="string">&quot;podman run -d -e MYSQL_USER=user -e MYSQL_PASSWORD=pass -e MYSQL_DATABASE=db -p 3306:3306 rhel8/mariadb-103&quot;</span>,</span><br><span class="line">               <span class="string">&quot;usage&quot;</span>: <span class="string">&quot;podman run -d -e MYSQL_USER=user -e MYSQL_PASSWORD=pass -e MYSQL_DATABASE=db -p 3306:3306 rhel8/mariadb-103&quot;</span>,</span><br><span class="line"></span><br><span class="line">$ skopeo inspect docker://utility.lab.example.com/rhel8/mariadb-105 | grep -B 1 Usage</span><br><span class="line"><span class="comment">#练习过程中可以将usage中提示的示例指令作为参考。</span></span><br></pre></td></tr></table></figure>

<p><strong>mariadb镜像的环境变量:</strong></p>
<p>  变量                  描述</p>
<hr>
<p>  MYSQL_USER            要创建的MySQL帐户的用户名<br>  MYSQL_PASSWORD        用户帐户的密码<br>  MYSQL_DATABASE        数据库名称<br>  MYSQL_ROOT_PASSWORD   root用户的密码 (可选)</p>
<p><strong>在检查了镜像的可用环境变量后，使用podman<br>run命令-e选项将环境变量传递给容器，并使用podman<br>ps命令来验证它是否正在运行。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman <span class="built_in">rm</span> -af</span><br><span class="line">29decc6e48d62506e62e503a383943709138a8f789a32dd27d2fa1761bf3ea9f</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman ps -a</span><br><span class="line">CONTAINER ID  IMAGE       COMMAND     CREATED     STATUS      PORTS       NAMES</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman run -d --name db01 -e MYSQL_USER=user -e MYSQL_PASSWORD=pass -e MYSQL_DATABASE=db utility.lab.example.com/rhel8/mariadb-103</span><br><span class="line">41a62ff2efd7f268e52d6f6a0a9b503411824c5f4391b86dae5d3f01376cb896</span><br><span class="line"></span><br><span class="line"><span class="comment"># 容器启动成功</span></span><br><span class="line">[student@servera ~]$ podman ps  -a</span><br><span class="line">CONTAINER ID  IMAGE                                             COMMAND     CREATED        STATUS        PORTS       NAMES</span><br><span class="line">41a62ff2efd7  utility.lab.example.com/rhel8/mariadb-103:latest  run-mysqld  8 seconds ago  Up 8 seconds              db01</span><br></pre></td></tr></table></figure>

<h2 id="5-3-容器持久存储"><a href="#5-3-容器持久存储" class="headerlink" title="5.3 容器持久存储"></a>5.3 容器持久存储</h2><hr>
<p>** 默认情况下运行容器时，所有内容都使用基于容器的镜像**</p>
<p>**<br>鉴于容器镜像的寿命短，用户或应用写入的所有新数据在移除容器后都会丢失**</p>
<p>** 若要持久保留数据，可以将容器中的主机文件系统内容与–volume<br>(-v)选项搭配使用。在容器中使用此卷类型时，必须考虑文件系统级别的权限**</p>
<p>**<br>MariaDB容器镜像中，mysql用户必须拥有&#x2F;var&#x2F;lib&#x2F;mysql目录，就如同MariaDB在主机上运行时一样**</p>
<p>**<br>打算挂载到容器中的目录必须具有mysql作为用户和组所有者(或mysql用户的UID&#x2F;GID，如果主机上没有安装<br>MariaDB)**</p>
<p>** 如果以root 用户身份运行容器，则主机上的UID和GID<br>与容器内的UID和GID匹配**</p>
<p>** 可以使用podman<br>unshare命令在用户命名空间内运行命令。要获取用户命名空间的UID映射，请使用podman<br>unshare cat命令**</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman unshare <span class="built_in">cat</span> /proc/self/uid_map</span><br><span class="line">         0       1000          1</span><br><span class="line">         1     100000      65536</span><br><span class="line">[student@servera ~]$ podman unshare <span class="built_in">cat</span> /proc/self/gid_map</span><br><span class="line">         0       1000          1</span><br><span class="line">         1     100000      65536</span><br></pre></td></tr></table></figure>

<p>以上输出显示：</p>
<p>  容器中的root用户 (UID和GID为0)映射到主机计算机上的用户(UID和GID为1000)</p>
<p>  容器中的UID和GID1映射到主机计算机上的UID和GID 100000</p>
<p>1后的每个UID和GID以1增量递增。例如，容器内的UID和GID30映射到主机计算机上的UID和GID100029</p>
<p>  可以使用podman<br>exec命令查看使用临时存储运行的容器内的mysql用户UID和GID:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman <span class="built_in">exec</span> -it db01 grep mysql /etc/passwd</span><br><span class="line">mysql:x:27:27:MySQL Server:/var/lib/mysql:/sbin/nologin</span><br></pre></td></tr></table></figure>


<p>将&#x2F;home&#x2F;user&#x2F;db_data目录挂载到db01容器中，以在容器的&#x2F;var&#x2F;lib&#x2F;mysql目录中提供持久存储</p>
<p>  创建&#x2F;home&#x2F;user&#x2F;db_data目录，并使用podman<br>unshare命令将27的用户命名空间UID和GID设置为该目录的所有者</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ <span class="built_in">mkdir</span> /home/student/db_data</span><br><span class="line">[student@servera ~]$ ll -d /home/student/db_data</span><br><span class="line">drwxr-xr-x. 2 student student 6 Mar  4 00:43 /home/student/db_data</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ ll -d -n /home/student/db_data</span><br><span class="line">drwxr-xr-x. 2 1000 1000 6 Mar  4 00:43 /home/student/db_data</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman unshare <span class="built_in">chown</span> 27:27 /home/student/db_data/</span><br><span class="line">[student@servera ~]$ ll -d /home/student/db_data</span><br><span class="line">drwxr-xr-x. 2 100026 100026 6 Mar  4 00:43 /home/student/db_data</span><br></pre></td></tr></table></figure>

<p>容器中的UID和GID 27映射到主机计算机上的UID和GID100026。可以使用ll<br>-d命令查看&#x2F;home&#x2F;student&#x2F;db_data目录的所有权来验证映射。</p>
<p>现在已设置了正确的文件系统级权限，可使用podman run 命令-v选项来挂载目录:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman <span class="built_in">rm</span> -af</span><br><span class="line">41a62ff2efd7f268e52d6f6a0a9b503411824c5f4391b86dae5d3f01376cb896</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman run -d --name db01 -e MYSQL_USER=user -e MYSQL_PASSWORD=pass -e MYSQL_DATABASE=db -v /home/student/db_data/:/var/lib/mysql  utility.lab.example.com/rhel8/mariadb-103</span><br><span class="line">54279d1fff7f3b679dd9d4efb7bfa28a626f41f7d07bea50a445ec2392c8cb02</span><br><span class="line"></span><br><span class="line"><span class="comment"># db01容器未在运行</span></span><br><span class="line">[student@servera ~]$ podman ps -a</span><br><span class="line">CONTAINER ID  IMAGE                                             COMMAND     CREATED        STATUS                    PORTS       NAMES</span><br><span class="line">54279d1fff7f  utility.lab.example.com/rhel8/mariadb-103:latest  run-mysqld  6 minutes ago  Exited (1) 6 minutes ago              db01</span><br><span class="line"></span><br><span class="line">$ podman run -d --name db01 \</span><br><span class="line">-e MYSQL_USER=user \</span><br><span class="line">-e MYSQL_PASSWORD=pass \</span><br><span class="line">-e MYSQL_DATABASE=db \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=redhat \</span><br><span class="line">-v /home/student/db_data/:/var/lib/mysql \</span><br><span class="line">utility.lab.example.com/rhel8/mariadb-103</span><br></pre></td></tr></table></figure>

<p>podman container logs命令显示&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;data目录的权限错误：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman container logs db01</span><br><span class="line">Warning: Can<span class="string">&#x27;t detect memory limit from cgroups</span></span><br><span class="line"><span class="string">Warning: Can&#x27;</span>t detect number of CPU cores from cgroups</span><br><span class="line">Warning: Can<span class="string">&#x27;t detect memory limit from cgroups</span></span><br><span class="line"><span class="string">Warning: Can&#x27;</span>t detect number of CPU cores from cgroups</span><br><span class="line">=&gt; sourcing 20-validate-variables.sh ...</span><br><span class="line">=&gt; sourcing 25-validate-replication-variables.sh ...</span><br><span class="line">=&gt; sourcing 30-base-config.sh ...</span><br><span class="line">---&gt; 05:58:29     Processing basic MySQL configuration files ...</span><br><span class="line">=&gt; sourcing 60-replication-config.sh ...</span><br><span class="line">=&gt; sourcing 70-s2i-config.sh ...</span><br><span class="line">---&gt; 05:58:29     Processing additional arbitrary  MySQL configuration provided by s2i ...</span><br><span class="line">=&gt; sourcing 40-paas.cnf ...</span><br><span class="line">=&gt; sourcing 50-my-tuning.cnf ...</span><br><span class="line">---&gt; 05:58:29     Initializing database ...</span><br><span class="line">---&gt; 05:58:29     Running mysql_install_db ...</span><br><span class="line"><span class="built_in">mkdir</span>: cannot create directory <span class="string">&#x27;/var/lib/mysql/data&#x27;</span>: Permission denied</span><br><span class="line">Fatal error Can<span class="string">&#x27;t create database directory &#x27;</span>/var/lib/mysql/data<span class="string">&#x27;</span></span><br><span class="line"><span class="string"># 发生此错误的原因是，主机上/home/user/db\_data目录中设置的SELinux上下文不正确</span></span><br></pre></td></tr></table></figure>

<h2 id="5-4-容器存储的SELinux上下文"><a href="#5-4-容器存储的SELinux上下文" class="headerlink" title="5.4 容器存储的SELinux上下文"></a>5.4 容器存储的SELinux上下文</h2><hr>
<p>必须先设置container_file_t SELinux<br>上下文类型，然后才能将该目录作为持久存储挂载到容器</p>
<p>如果目录没有container_file_t SELinux 上下文，则容器无法访问该目录</p>
<p>可以将Z选项附加到podman<br>run命令-v选项的参数，以自动设置目录的SELinux上下文</p>
<p>当将&#x2F;home&#x2F;student&#x2F;db_data<br>目录挂载为&#x2F;var&#x2F;lib&#x2F;mysql目录的持久存储时，可以使用podman run -v<br>&#x2F;home&#x2F;student&#x2F;db_data:&#x2F;var&#x2F;lib&#x2F;mysql:Z 命令设置该目录的SELinux上下文</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman <span class="built_in">rm</span> -af</span><br><span class="line">54279d1fff7f3b679dd9d4efb7bfa28a626f41f7d07bea50a445ec2392c8cb02</span><br><span class="line">[student@servera ~]$ podman ps -a</span><br><span class="line">CONTAINER ID  IMAGE       COMMAND     CREATED     STATUS      PORTS       NAMES</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman run -d --name db01 -e MYSQL_USER=user -e MYSQL_PASSWORD=pass -e MYSQL_DATABASE=db -v /home/student/db_data/:/var/lib/mysql:Z utility.lab.example.com/rhel8/mariadb-103</span><br><span class="line">6195fc399b1f6ae8f5b9d3f436c02bb5d6b093b597949dc968b2a64f6e7d023c</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman ps -a</span><br><span class="line">CONTAINER ID  IMAGE                                             COMMAND     CREATED         STATUS         PORTS       NAMES</span><br><span class="line">6195fc399b1f  utility.lab.example.com/rhel8/mariadb-103:latest  run-mysqld  23 seconds ago  Up 24 seconds              db01</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ ll -dZ /home/student/db_data/</span><br><span class="line">drwxr-xr-x. 3 100026 100026 system_u:object_r:container_file_t:s0:c428,c988 36 Mar  4 01:26 /home/student/db_data/</span><br><span class="line"></span><br><span class="line">$ podman run -d --name db01 \</span><br><span class="line">-e MYSQL_USER=user \</span><br><span class="line">-e MYSQL_PASSWORD=pass \</span><br><span class="line">-e MYSQL_DATABASE=db \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=redhat \</span><br><span class="line">-v /home/student/db_data:/var/lib/mysql:Z \</span><br><span class="line">utility.lab.example.com/rhel8/mariadb-103</span><br></pre></td></tr></table></figure>

<h2 id="5-5-分配端口映射到容器"><a href="#5-5-分配端口映射到容器" class="headerlink" title="5.5 分配端口映射到容器"></a>5.5 分配端口映射到容器</h2><hr>
<p>要提供对容器的网络访问权限，客户端必须连接到容器主机上的端口，这些端口将网络流量传递到容器中的端口</p>
<p>将容器主机上的网络端口映射到容器中的端口时，容器将接收发送到主机网络端口的网络流量。</p>
<p>例如，可以将容器主机上的13306端口映射到容器上的3306端口，以便与<br>MariaDB容器通信。因此，发送到容器主机端口13306的流量将由容器中运行的MariaDB接收。</p>
<p>可以使用 podman run命令 -p<br>选项设置从容器主机上13306端口到db01容器上3306端口的端口映射</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman <span class="built_in">rm</span> -af</span><br><span class="line">6195fc399b1f6ae8f5b9d3f436c02bb5d6b093b597949dc968b2a64f6e7d023c</span><br><span class="line">[student@servera ~]$ podman ps -a</span><br><span class="line">CONTAINER ID  IMAGE       COMMAND     CREATED     STATUS      PORTS       NAMES</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman run -d --name db01 -e MYSQL_USER=user -e MYSQL_PASSWORD=pass -e MYSQL_DATABASE=db -v /home/student/db_data/:/var/lib/mysql:Z -p 13306:3306 utility.lab.example.com/rhel8/mariadb-103</span><br><span class="line">28202973f22d60ea4ccd096b8a321b30c7d57156a2c41d2502c1a0456c794ced</span><br><span class="line"></span><br><span class="line">[student@servera ~]$ podman ps -a</span><br><span class="line">CONTAINER ID  IMAGE                                             COMMAND     CREATED         STATUS         PORTS                    NAMES</span><br><span class="line">28202973f22d  utility.lab.example.com/rhel8/mariadb-103:latest  run-mysqld  20 seconds ago  Up 20 seconds  0.0.0.0:13306-&gt;3306/tcp  db01</span><br><span class="line"></span><br><span class="line">$ podman run -d --name db01 \</span><br><span class="line">-e MYSQL_USER=user \</span><br><span class="line">-e MYSQL_PASSWORD=pass \</span><br><span class="line">-e MYSQL_DATABASE=db \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=redhat \</span><br><span class="line">-p 13306:3306 \</span><br><span class="line">-v /home/student/db_data:/var/lib/mysql:Z \</span><br><span class="line">utility.lab.example.com/rhel8/mariadb-103</span><br></pre></td></tr></table></figure>

<p>使用podman<br>port命令-a选项可显示正在使用的所有容器端口映射。还可以使用podmanport<br>db01命令显示 db01容器的映射端口。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ podman port -a</span><br><span class="line">28202973f22d    3306/tcp -&gt; 0.0.0.0:13306</span><br><span class="line">[student@servera ~]$ podman port db01</span><br><span class="line">3306/tcp -&gt; 0.0.0.0:13306</span><br></pre></td></tr></table></figure>

<p>可以使用firewall-cmd命令允许端口13306流量传入容器主机，以便它可以重定向到容器:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Rootless(特权)容器无法打开主机上特权端口1024有 以下的端口。比如-p 80:8000 ，比必须使用root才可以对其进行调整</span></span><br><span class="line">[student@servera ~]$ <span class="built_in">sudo</span> firewall-cmd --permanent --add-port=13306/tcp</span><br><span class="line">[<span class="built_in">sudo</span>] password <span class="keyword">for</span> student: </span><br><span class="line">success</span><br><span class="line">[student@servera ~]$ <span class="built_in">sudo</span> firewall-cmd --reload</span><br><span class="line">success</span><br><span class="line">[student@servera ~]$ <span class="built_in">sudo</span> firewall-cmd --list-all</span><br><span class="line">public (active)</span><br><span class="line">  target: default</span><br><span class="line">  icmp-block-inversion: no</span><br><span class="line">  interfaces: eth0</span><br><span class="line">  sources: </span><br><span class="line">  services: cockpit dhcpv6-client ssh</span><br><span class="line">  ports: 13306/tcp</span><br><span class="line">  protocols: </span><br><span class="line">  forward: <span class="built_in">yes</span></span><br><span class="line">  masquerade: no</span><br><span class="line">  forward-ports: </span><br><span class="line">  source-ports: </span><br><span class="line">  icmp-blocks: </span><br><span class="line">  rich rules: </span><br><span class="line"><span class="comment"># firewall-cmd --add-port=13306/tcp --permanent</span></span><br><span class="line"><span class="comment"># firewall-cmd --reload</span></span><br></pre></td></tr></table></figure>

<h3 id="附加测试"><a href="#附加测试" class="headerlink" title="附加测试"></a>附加测试</h3><p>通过主机mariadb数据库客户端软件访问容器数据库服务，需要安装mariadb软件后指定-u账号，-p密码(无空格)，-h数据库服务器所在主机名或IP(不是容器名)及-P(大写)主机映射端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[kiosk@foundation0 ~]$ <span class="built_in">sudo</span> dnf -y install mariadb</span><br><span class="line">[kiosk@foundation0 ~]$ mysql -u user -ppass -h servera -P 13306    <span class="comment"># -h 后面填写您当前实验的主机名或IP</span></span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection <span class="built_in">id</span> is 8</span><br><span class="line">Server version: 10.3.17-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; SHOW DATABASES;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| db                 |</span><br><span class="line">| information_schema |</span><br><span class="line">| <span class="built_in">test</span>               |</span><br><span class="line">+--------------------+</span><br><span class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.012 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; USE db;</span><br><span class="line">Database changed</span><br><span class="line">MariaDB [db]&gt; SHOW TABLES;</span><br><span class="line">Empty <span class="built_in">set</span> (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [db]&gt; <span class="built_in">exit</span></span><br><span class="line">Bye</span><br></pre></td></tr></table></figure>

<h2 id="5-6-容器中的DNS配置"><a href="#5-6-容器中的DNS配置" class="headerlink" title="5.6 容器中的DNS配置"></a>5.6 容器中的DNS配置</h2><p>Podmanv4.0支持两种容器网络后端，即Netavark和CNI</p>
<p>自RHEL9起，系统默认使用Netavark。若要验证所用的网络后端，请运行以下podman<br>info命令。</p>
<p><a target="_blank" rel="noopener" href="https://docs.redhat.com/zh_hans/documentation/red_hat_enterprise_linux/9/html/building_running_and_managing_containers/proc_switching-the-network-stack-from-cni-to-netavark_assembly_setting-container-network-modes">将网络堆栈从 CNI 切换到 Netavark | Red Hat Product<br>Documentation</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ podman info --format &#123;&#123;.Host.NetworkBackend&#125;&#125;</span><br><span class="line">netavark</span><br></pre></td></tr></table></figure>

<p>主机上使用默认Podman网络的现有容器无法解析彼此的主机名，因为默认网络上未启用DNS。</p>
<p>使用podman network create命令创建一个支持DNS的网络。您可使用podman<br>network create命令创建名为db_net<br>的网络，并将子网指定为10.87.0.0&#x2F;16，网关指定为10.87.0.1。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ podman network create --gateway 10.87.0.1 --subnet 10.87.0.0/16 db_net</span><br><span class="line"></span><br><span class="line">$ podman network <span class="built_in">ls</span> <span class="comment">#列出容器网络</span></span><br></pre></td></tr></table></figure>

<p>如果不指定–gateway 或–subnet 选项，则会使用默认值创建它们。</p>
<p>podman network inspect 命令显示关于特定网络的信息。您可以使用podman<br>network inspect 命令验证网关和子网的设置是否正确，以及新的dbnet<br>网络是否启用了DNS。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ podman network inspect db_net</span><br></pre></td></tr></table></figure>

<p>您可以使用podman run命令–network选项将启用DNS的db_net<br>网络添加到新容器。您可以使用podman run命令–network选项创建连接到db_net<br>网络的db01和client01容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ podman run -d --name db01 \</span><br><span class="line">--network db_net \</span><br><span class="line">-e MYSQL_USER=user \</span><br><span class="line">-e MYSQL_PASSWORD=pass \</span><br><span class="line">-e MYSQL_DATABASE=db \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=redhat \</span><br><span class="line">-v /home/student/db_data:/var/lib/mysql:Z \</span><br><span class="line">-p 13306:3306 \</span><br><span class="line">utility.lab.example.com/rhel8/mariadb-105</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ podman run -d --name client01 \</span><br><span class="line">--network db_net \</span><br><span class="line">-v /etc/yum.repos.d:/etc/yum.repos.d/ \</span><br><span class="line">utility.lab.example.com/ubi9-beta/ubi \</span><br><span class="line"><span class="built_in">sleep</span> infinity</span><br><span class="line"></span><br><span class="line">$ podman ps -a</span><br></pre></td></tr></table></figure>

<p>由于容器设计为仅具有所需的最少软件包，因此容器可能不具有测试通信所需的实用程序，如ping和ip命令。您可以使用<br>podman exec 命令在容器中安装这些实用程序。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ podman <span class="built_in">exec</span> client01 dnf install -y iputils iproute</span><br><span class="line">..output omitted..</span><br></pre></td></tr></table></figure>

<p>容器现在可以通过容器名称互相 ping。您可以使用podman exec<br>命令来测试DNS解析。名称解析到为db_net网络手动设置的子网内的IP。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ podman <span class="built_in">exec</span> client01 ping -c4 db01</span><br><span class="line">PING db01.dns.podman (10.87.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 10.87.0.2 (10.87.0.2): icmp_seq=1 ttl=64 <span class="keyword">time</span>=1.08 ms</span><br><span class="line">64 bytes from 10.87.0.2 (10.87.0.2): icmp_seq=2 ttl=64 <span class="keyword">time</span>=0.082 ms</span><br><span class="line">64 bytes from 10.87.0.2 (10.87.0.2): icmp_seq=3 ttl=64 <span class="keyword">time</span>=0.063 ms</span><br><span class="line">64 bytes from 10.87.0.2 (10.87.0.2): icmp_seq=4 ttl=64 <span class="keyword">time</span>=0.070 ms</span><br></pre></td></tr></table></figure>

<p>您可以使用 podman exec命令验证每个容器中的IP地址是否与DNS解析匹配。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ podman <span class="built_in">exec</span> client01 ip a | grep 10.8</span><br><span class="line">    inet 10.87.0.3/16 brd 10.87.255.255 scope global eth0</span><br></pre></td></tr></table></figure>

<h2 id="5-7-多个网络连接到单个容器"><a href="#5-7-多个网络连接到单个容器" class="headerlink" title="5.7 多个网络连接到单个容器"></a>5.7 多个网络连接到单个容器</h2><p>多个网络可以同时连接到一个容器，以帮助分隔不同类型的流量。 您可以使用<br>podman network create命令创建backend 网络</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ podman network create backend</span><br></pre></td></tr></table></figure>

<p>然后，使用podman network ls 命令查看所有 Podman 网络。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ podman network <span class="built_in">ls</span></span><br><span class="line">NETWORK ID    NAME    DRIVER  </span><br><span class="line">a7fea510a6d1  backend bridge</span><br><span class="line">fe680efc5276  db01    bridge</span><br><span class="line">2f259bab93aa  podman  bridge</span><br></pre></td></tr></table></figure>

<p>没有通过podman network create 命令的–gateway和–subnet<br>选项指定子网和网关。 使用podman network inspect 命令来获取backend<br>网络的IP信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ podman network inspect backend</span><br></pre></td></tr></table></figure>

<p>在容器运行时，您可以使用podman network connect<br>命令将其他网络连接到容器。您可以使用podman network<br>connect命令，将backend网络连接到db01和client01容器。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ podman network connect backend db01</span><br><span class="line">$ podman network connect backend client01</span><br></pre></td></tr></table></figure>

<p>您可以使用podman inspect<br>命令验证两个网络是否都已连接到各个容器并显示IP信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ podman inspect db01</span><br><span class="line"></span><br><span class="line">$ podman inspect db01 | grep -A 34 Networks &gt; db01</span><br><span class="line">$ <span class="built_in">cat</span> db01  <span class="comment">#查看db01的两个网络IP为10.89.0.2 ， 10.87.0.2</span></span><br></pre></td></tr></table></figure>

<p>client01容器现在可以与两个网络上的db01容器通信。您可以使用podman exec<br>命令从cliento1容器pingdb01容器上的两个网络。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ podman <span class="built_in">exec</span> -ti client01 ping -c4 10.89.0.2</span><br><span class="line">PING 10.89.0.2 (10.89.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 10.89.0.2: icmp_seq=1 ttl=64 <span class="keyword">time</span>=0.352 ms</span><br><span class="line">$ podman <span class="built_in">exec</span> -ti client01 ping -c4 10.87.0.2</span><br><span class="line">PING 10.87.0.2 (10.87.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 10.87.0.2: icmp_seq=1 ttl=64 <span class="keyword">time</span>=0.594 ms</span><br></pre></td></tr></table></figure>

<p>容器内安装mariadb客户端访问容器数据库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ podman <span class="built_in">exec</span> client01 dnf -y install mariadb</span><br><span class="line">podman</span><br><span class="line">$ podman <span class="built_in">exec</span> -ti client01 mysql -u user -ppass -h db01</span><br></pre></td></tr></table></figure>

<h1 id="6-系统服务来管理容器"><a href="#6-系统服务来管理容器" class="headerlink" title="6 系统服务来管理容器"></a>6 系统服务来管理容器</h1><h2 id="6-1-systemd管理小型容器"><a href="#6-1-systemd管理小型容器" class="headerlink" title="6.1 systemd管理小型容器"></a>6.1 systemd管理小型容器</h2><p>可以运行容器来完成系统任务，或获取一系列命令的输出</p>
<p>可能还希望运行无限期运行服务的容器，如Web 服务器或数据库</p>
<p>在传统环境中，特权用户通常将这些服务配置为在系统启动时运行，并使用<br>systemctl 命令进行管理</p>
<p>作为普通用户，可以创建systemd单元来配置您的Rootless容器。利用此配置，可以通过systemctl命令将容器作为常规系统服务进行管理</p>
<p>基于systemd单元管理容器主要用于不需要扩展的基本和小型部署</p>
<p>对于许多基于容器的应用和服务的更复杂扩展和编排，可以使用基于Kubernetes的企业编排平台，如红帽OpenShift容器平台</p>
<h2 id="6-2-systemd用户服务要求"><a href="#6-2-systemd用户服务要求" class="headerlink" title="6.2 systemd用户服务要求"></a>6.2 systemd用户服务要求</h2><p>作为普通用户，可以使用systemctl命令来启用服务</p>
<p>该服务在打开会话(图形界面、文本控制台或SSH)时启动，并在关闭最后一个会话时停止。此行为与系统服务有所不同，系统服务是在系统启动时启动并在系统关机时停止。</p>
<p>默认情况下，当使用useradd<br>命令创建用户帐户时，系统将使用普通用户ID范围中的下一个可用ID</p>
<p>系统还在&#x2F;etc&#x2F;subuid文件中为用户的容器保留一系列ID</p>
<p>如果使用useradd命令–system选项创建用户帐户，则系统不会为用户容器保留范围。因此，无法使用系统帐户启动Rootless容器。</p>
<p>决定创建一个专门的用户帐户来管理容器。使用useradd<br>命令创建appdev-adm用户，并将redhat用作密码。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ <span class="built_in">sudo</span> useradd appdev-adm</span><br><span class="line">[<span class="built_in">sudo</span>] password <span class="keyword">for</span> student:student</span><br><span class="line">[student@servera ~]$ <span class="built_in">sudo</span> passwd appdev-adm</span><br><span class="line">Changing password <span class="keyword">for</span> user appdev-adm.</span><br><span class="line">New password:</span><br><span class="line">BAD PASSWORD: The password is shorter than 8 characters</span><br><span class="line">Retype new password:</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br></pre></td></tr></table></figure>

<p>然后，使用 su命令切换到appdev-adm用户，并使用podman命令来启动。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[student@servera ~]$ su appdev-adm</span><br><span class="line">Password:redhat</span><br><span class="line">[appdev-adm@servera student]$ podman info</span><br><span class="line">ERRO[0000] XDG_RUNTIME_DIR directory <span class="string">&quot;/run/user/1000&quot;</span> is not owned by the current user</span><br><span class="line">[root@servera ~]# su appdev-adm</span><br><span class="line">[appdev-adm@servera root]$ podman info</span><br><span class="line">ERRO[0000] XDG_RUNTIME_DIR directory <span class="string">&quot;/run/user/0&quot;</span> is not owned by the current user</span><br></pre></td></tr></table></figure>

<p>Podman是一款无状态实用程序，需要完整的登录会话</p>
<p>Podman 必须在SSH会话中使用，不能在sudo或su shell中使用。因此，您将退出su<br>shell，并通过SSH登录计算机。</p>
<p>无状态应用:Stateless Application<br>是指并不会在会话中保存下次会话中去要的客户端数据。<br>每一个会话都像首次执行一样,不会依赖之前的数据进行响应。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[appdev-adm@servera root]$ <span class="built_in">exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">[root@servera ~]# ssh appdev-adm@localhost</span><br><span class="line">appdev-adm@localhost<span class="string">&#x27;s password:</span></span><br><span class="line"><span class="string">Register this system with Red Hat Insights: insights-client --register</span></span><br><span class="line"><span class="string">Create an account or view all your systems at https://red.ht/insights-dashboard</span></span><br><span class="line"><span class="string">Last login: Tue Mar  4 09:06:27 2025</span></span><br><span class="line"><span class="string">[appdev-adm@servera ~]$ podman info</span></span><br><span class="line"><span class="string">[appdev-adm@servera ~]$ podman login -u admin -p redhat321 utility.lab.example.com</span></span><br><span class="line"><span class="string">Login Succeeded!</span></span><br><span class="line"><span class="string">[appdev-adm@servera ~]$ podman search utility.lab.example.com/</span></span><br><span class="line"><span class="string">NAME                                       DESCRIPTION</span></span><br><span class="line"><span class="string">utility.lab.example.com/rhel8/mariadb-103</span></span><br><span class="line"><span class="string">utility.lab.example.com/rhel9/mariadb-105</span></span><br><span class="line"><span class="string">utility.lab.example.com/rhel9/httpd-24</span></span><br><span class="line"><span class="string">utility.lab.example.com/library/nginx</span></span><br><span class="line"><span class="string">utility.lab.example.com/ubi7/ubi</span></span><br><span class="line"><span class="string">utility.lab.example.com/ubi9/ubi</span></span><br><span class="line"><span class="string">utility.lab.example.com/ubi8/ubi</span></span><br><span class="line"><span class="string">utility.lab.example.com/ubi9/python-312</span></span><br><span class="line"><span class="string">utility.lab.example.com/rhel9/php-82</span></span><br></pre></td></tr></table></figure>

<p>然后，配置容器注册表并使用您的凭据进行身份验证。您可以使用以下命令运行<br>http 容器。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[appdev-adm@servera ~]$ <span class="built_in">mkdir</span> /home/appdev-adm/nginx_web/</span><br><span class="line">[appdev-adm@servera ~]$ <span class="built_in">echo</span> nginx_web_page &gt; /home/appdev-adm/nginx_web/index.html</span><br><span class="line">[appdev-adm@servera ~]$ <span class="built_in">cat</span> /home/appdev-adm/nginx_web/index.html</span><br><span class="line">nginx_web_page</span><br><span class="line">[appdev-adm@servera ~]$ podman run -d --name nginx -v /home/appdev-adm/nginx_web/:/usr/share/nginx/html/:Z -p 8080:80 utility.lab.example.com/library/nginx</span><br><span class="line">[appdev-adm@servera ~]$ podman ps -a</span><br><span class="line">CONTAINER ID  IMAGE                                         COMMAND               CREATED        STATUS        PORTS                 NAMES</span><br><span class="line">6f72fe3fc6d7  utility.lab.example.com/library/nginx:latest  nginx -g daemon o...  2 minutes ago  Up 2 minutes  0.0.0.0:8080-&gt;80/tcp  nginx</span><br><span class="line">[appdev-adm@servera ~]$ curl localhost:8080</span><br><span class="line">nginx_web_page</span><br></pre></td></tr></table></figure>

<h3 id="为容器创建systemd用户文件"><a href="#为容器创建systemd用户文件" class="headerlink" title="为容器创建systemd用户文件"></a>为容器创建systemd用户文件</h3><p>在~&#x2F;.confiq&#x2F;svstemd&#x2F;user&#x2F;目录中手动定义systemd服务</p>
<p>用户服务的文件语法与系统服务文件的相同。有关更多详细信息，请查看systemd.unit(5)和systemd.service(5)man手册</p>
<p>使用podman generate systemd 命令为现有容器生成systemd 服务文件podman<br>generate systemd 命令使用容器作为模型来创建配置文件</p>
<p>podman generate systemd命令–new选项指示podman实用程序对systemd<br>服务进行配置，以便在该服务启动时创建容器并在该服务停止时删除容器</p>
<p>可以使用podman generate<br>systemd命令和–name选项来显示为nginx容器建模的systemd服务文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[appdev-adm@servera ~]$ man systemd.unit | grep config.*user</span><br><span class="line">       ~/.config/systemd/user.control/*</span><br><span class="line">       ~/.config/systemd/user/*</span><br><span class="line">       │~/.config/systemd/user.control                    │ using the dbus API (<span class="variable">$XDG_CONFIG_HOME</span> is used <span class="keyword">if</span>   │</span><br><span class="line">       │<span class="variable">$HOME</span>/.config/systemd/user                        │ <span class="built_in">set</span>, ~/.config otherwise)                         │</span><br><span class="line">[appdev-adm@servera ~]$ man systemd.unit</span><br><span class="line">[appdev-adm@servera ~]$ <span class="built_in">mkdir</span> -p ~/.config/systemd/user/</span><br><span class="line">[appdev-adm@servera ~]$ <span class="built_in">cd</span> ~/.config/systemd/user/</span><br><span class="line">[appdev-adm@servera ~]$ podman stop nginx        <span class="comment"># 生成单元文件之前先停止容器</span></span><br><span class="line">nginx</span><br><span class="line">[appdev-adm@servera user]$ podman generate systemd -n nginx -f</span><br><span class="line">/home/appdev-adm/.config/systemd/user/container-nginx.service</span><br><span class="line">[appdev-adm@servera user]$ <span class="built_in">ls</span></span><br><span class="line">container-nginx.service</span><br><span class="line">[appdev-adm@servera user]$ systemctl --user <span class="built_in">enable</span> --now container-nginx.service</span><br><span class="line">Created symlink /home/appdev-adm/.config/systemd/user/default.target.wants/container-nginx.service → /home/appdev-adm/.config/systemd/user/container-nginx.service.</span><br><span class="line">[appdev-adm@servera ~]$ podman ps -a</span><br><span class="line">CONTAINER ID  IMAGE                                         COMMAND               CREATED         STATUS             PORTS                 NAMES</span><br><span class="line">6f72fe3fc6d7  utility.lab.example.com/library/nginx:latest  nginx -g daemon o...  26 minutes ago  Up About a minute  0.0.0.0:8080-&gt;80/tcp  nginx</span><br><span class="line">[appdev-adm@servera user]$ systemctl --user stop container-nginx.service</span><br><span class="line">[appdev-adm@servera ~]$ podman ps -a</span><br><span class="line">CONTAINER ID  IMAGE                                         COMMAND               CREATED         STATUS                     PORTS                 NAMES</span><br><span class="line">6f72fe3fc6d7  utility.lab.example.com/library/nginx:latest  nginx -g daemon o...  27 minutes ago  Exited (0) 16 seconds ago  0.0.0.0:8080-&gt;80/tcp  nginx</span><br><span class="line">[appdev-adm@servera user]$ systemctl --user restart container-nginx.service</span><br><span class="line"></span><br><span class="line">$ podman generate systemd -n nginx</span><br><span class="line">ExecStart=/usr/bin/podman start nginx</span><br><span class="line">ExecStop=/usr/bin/podman stop -t 10 nginx</span><br><span class="line"></span><br><span class="line">*$ podman generate systemd -n nginx -f</span><br><span class="line">$ <span class="built_in">ls</span></span><br><span class="line">container-nginx.service</span><br></pre></td></tr></table></figure>

<ul>
<li>启动时，systemd守护进程执行podman start命令来启动现有容器</li>
<li>停止时，systemd守护进程执行podman<br>stop命令来停止容器。请注意，systemd守护进程不会删除该容器。</li>
</ul>
<p>然后，使用上一命令并加上–new选项来比较systemd配置。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ podman generate systemd -n nginx --new</span><br><span class="line"></span><br><span class="line">ExecStartPre=/bin/rm -f %t/%n.ctr-id</span><br><span class="line">ExecStart=/usr/bin/podman run --cidfile=%t/%n.ctr-id --cgroups=no-conmon --<span class="built_in">rm</span> --sdnotify=conmon --replace -d --name nginx -p 8080:80 -v /home/appdev-adm/nginx_web/:/usr/share/nginx/html/:Z utility.lab.example.com/library/nginx</span><br><span class="line">ExecStop=/usr/bin/podman stop --ignore --cidfile=%t/%n.ctr-id</span><br><span class="line">ExecStopPost=/usr/bin/podman <span class="built_in">rm</span> -f --ignore --cidfile=%t/%n.ctr-id</span><br><span class="line"></span><br><span class="line"><span class="comment">#通过--new选项创建用户单元文件的方法，仅供参考</span></span><br><span class="line">$ <span class="built_in">cd</span> ~/.config/systemd/user/</span><br><span class="line">$ podman generate systemd -n nginx --new -f</span><br><span class="line">/home/appdev-adm/.config/systemd/user/container-nginx.service</span><br></pre></td></tr></table></figure>

<ul>
<li>启动时，systemd守护进程执行 podman run<br>命令以创建并启动新容器。此操作使用podman run<br>命令–rm选项，它将在停止时删除容器。</li>
<li>停止时，systemd 执行 podman stop 命令以停止容器。</li>
<li>在systemd停止容器后，systemd 将使用podman rm -f命令将其移除。</li>
</ul>
<p>验证 podman generate systemd 命令的输出，并使用–files<br>选项运行上一命令，以在当前目录中创建systemd用户文件。由于nginx容器使用持久存储，因此您选择使用带有–new选项的podman<br>generate<br>systemd命令。然后，创建~&#x2F;config&#x2F;systemd&#x2F;user&#x2F;目录并将文件移到此位置上</p>
<h3 id="为容器管理systemd用户文件"><a href="#为容器管理systemd用户文件" class="headerlink" title="为容器管理systemd用户文件"></a>为容器管理systemd用户文件</h3><p>现在，您已创建了 systemd 用户文件，可以使用 systemctl命令 –user<br>选项来管理nginx容器。<br>首先，重新加载systemd守护进程，使systemctl命令知道新的用户文件。使用systemctl–user<br>start命令启动nginx容器。使用为容器生成的 systemd用户文件的名称。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl --user <span class="built_in">enable</span> --now container-nginx.service</span><br><span class="line"><span class="comment">#其他的管理方法，仅供参考</span></span><br><span class="line">$ systemctl --user status container-nginx.service</span><br><span class="line">$ systemctl --user stop container-nginx.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#建议重启验证容器是否可以 开机自启动</span></span><br></pre></td></tr></table></figure>

<p>下表总结了 systemd 系统和用户服务之间使用的不同目录和命令。</p>
<hr>
<p>  比较系统和用户服务                  </p>
<hr>
<p>  存储自定义单元文件       系统服务   &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;unit.service</p>
<pre><code>                       用户服务   \~/.config/systemd/user/unit.service
</code></pre>
<p>  重新加载单元文件         系统服务   # systemctl daemon-reload</p>
<pre><code>                       用户服务   \$ systemctl --user daemon-reload
</code></pre>
<p>  启动和停止服务           系统服务   # systemctl start UNIT</p>
<pre><code>                                  \# systemctl stop UNIT

                       用户服务   \$ systemctl --user start UNIT

                                  \$ systemctl --user stop UNIT
</code></pre>
<p>  在计算机启动时启动服务   系统服务   # systemctl enable UNIT</p>
<pre><code>                       用户服务   \$ loginctl enable-linger

                                  \$ systemctl --user enable UNIT
</code></pre>
<hr>
<h3 id="容器配置为系统引导时启动"><a href="#容器配置为系统引导时启动" class="headerlink" title="容器配置为系统引导时启动"></a>容器配置为系统引导时启动</h3><p>此时，systemd服务配置已就绪，可以为给定的用户运行容器。但是，如果用户从系统注销，systemd服务会在特定时间后停止容器。出现此行为的原因是，systemd<br>服务单元是使用.user<br>选项创建的，它在用户登录时启动服务，并在用户注销时停止服务。 ​<br>不过，您可以通过运行loginctl enable-linger<br>命令来更改此默认行为，并强制已启用的服务在服务器启动时启动，并在服务器关闭期间停止。<br>​可以使用<br>loginctl命令将systemd用户服务配置为在所配置服务的最后一个用户会话关闭后保留</p>
<p>使用 loginctl show-user 命令验证配置是否成功。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[appdev-adm@servera ~]$ loginctl show-user appdev-adm</span><br><span class="line">Linger=no</span><br><span class="line">[appdev-adm@servera ~]$ loginctl enable-linger</span><br><span class="line">[appdev-adm@servera ~]$ loginctl show-user appdev-adm</span><br><span class="line">Linger=<span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启后进行测试</span></span><br><span class="line">[kiosk@foundation0 ~]$ ssh root@servera</span><br><span class="line">[root@servera ~]# ssh appdev-adm@localhost</span><br><span class="line">[appdev-adm@servera ~]$ podman ps -a</span><br><span class="line">CONTAINER ID  IMAGE                                         COMMAND               CREATED         STATUS             PORTS                 NAMES</span><br><span class="line">6f72fe3fc6d7  utility.lab.example.com/library/nginx:latest  nginx -g daemon o...  40 minutes ago  Up About a minute  0.0.0.0:8080-&gt;80/tcp  nginx</span><br></pre></td></tr></table></figure>

<h3 id="Root使用Systemd管理容器"><a href="#Root使用Systemd管理容器" class="headerlink" title="Root使用Systemd管理容器"></a>Root使用Systemd管理容器</h3><p>将容器配置为以root身份运行，并使用systemd<br>服务文件进行管理。这种方法的一个优势是，您可以将这些服务文件配置为像常见systemd<br>单元文件那样工作，而不是以特定用户身份来运行。</p>
<p>将服务文件设置为 root的过程与前面概述的<br>Rootless容器过程类似，但以下例外: ​ 不要创建专门的用户来管理容器。 ​<br>服务文件必须在&#x2F;etc&#x2F;systemd&#x2F;system<br>目录中，而不是在~&#x2F;config&#x2F;systemd&#x2F;user目录中 ​<br>使用systemctl命令管理容器，但不使用 –user 选项 ​ 不要以root用户身份运行<br>loginctl enable-linger命令</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>podman容器</p><p><a href="http://example.com/2025/04/22/podman容器/">http://example.com/2025/04/22/podman容器/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><a href="http://example.com"><p>罗宇</p></a></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2025-04-22 13:50:42</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2025-04-29 17:12:16</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="recommend-area"></div><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/social-share.js/1.0.16/css/share.min.css"><div class="social-share"></div><script src="https://cdnjs.loli.net/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2025/04/21/Ansible%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/"><span class="level-item">Ansible的基本使用</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="is-flex is-mobile" href="#1-容器概念"><span>1 容器概念</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#1-1-容器技术介绍"><span>1.1 容器技术介绍</span></a></li><li><a class="is-flex is-mobile" href="#1-2-容器的核心技术"><span>1.2 容器的核心技术</span></a></li><li><a class="is-flex is-mobile" href="#1-3-容器和虚拟机的差异"><span>1.3 容器和虚拟机的差异</span></a></li><li><a class="is-flex is-mobile" href="#1-4-Rootless和Rootful容器"><span>1.4 Rootless和Rootful容器</span></a></li><li><a class="is-flex is-mobile" href="#1-5-设计基于容器的架构"><span>1.5 设计基于容器的架构</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#2-容器镜像和注册表"><span>2 容器镜像和注册表</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#2-1-配置容器注册表"><span>2.1 配置容器注册表</span></a></li><li><a class="is-flex is-mobile" href="#2-2-使用容器文件构建容器镜像"><span>2.2 使用容器文件构建容器镜像</span></a></li><li><a class="is-flex is-mobile" href="#2-3-规模化容器管理"><span>2.3 规模化容器管理</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#3-部署容器"><span>3 部署容器</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#3-1Podman实用程序"><span>3.1Podman实用程序</span></a></li><li><a class="is-flex is-mobile" href="#3-2-安装容器实用工具"><span>3.2 安装容器实用工具</span></a></li><li><a class="is-flex is-mobile" href="#3-3-从注册表下载容器镜像文件"><span>3.3 从注册表下载容器镜像文件</span></a></li><li><a class="is-flex is-mobile" href="#3-4-让servera联网方法"><span>3.4 让servera联网方法</span></a></li><li><a class="is-flex is-mobile" href="#3-5-从容器文件创建容器镜像"><span>3.5 从容器文件创建容器镜像</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#4-运行容器"><span>4 运行容器</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#4-1-从远程存储库运行容器"><span>4.1 从远程存储库运行容器</span></a></li><li><a class="is-flex is-mobile" href="#4-2-容器中的环境隔离"><span>4.2 容器中的环境隔离</span></a></li><li><a class="is-flex is-mobile" href="#4-3-容器中的文件系统隔离"><span>4.3 容器中的文件系统隔离</span></a></li><li><a class="is-flex is-mobile" href="#4-4-删除容器和镜像"><span>4.4 删除容器和镜像</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#5-管理容器存储和网络资源"><span>5 管理容器存储和网络资源</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#5-1-管理容器资源"><span>5.1 管理容器资源</span></a></li><li><a class="is-flex is-mobile" href="#5-2-容器的环境变量"><span>5.2 容器的环境变量</span></a></li><li><a class="is-flex is-mobile" href="#5-3-容器持久存储"><span>5.3 容器持久存储</span></a></li><li><a class="is-flex is-mobile" href="#5-4-容器存储的SELinux上下文"><span>5.4 容器存储的SELinux上下文</span></a></li><li><a class="is-flex is-mobile" href="#5-5-分配端口映射到容器"><span>5.5 分配端口映射到容器</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#附加测试"><span>附加测试</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#5-6-容器中的DNS配置"><span>5.6 容器中的DNS配置</span></a></li><li><a class="is-flex is-mobile" href="#5-7-多个网络连接到单个容器"><span>5.7 多个网络连接到单个容器</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#6-系统服务来管理容器"><span>6 系统服务来管理容器</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#6-1-systemd管理小型容器"><span>6.1 systemd管理小型容器</span></a></li><li><a class="is-flex is-mobile" href="#6-2-systemd用户服务要求"><span>6.2 systemd用户服务要求</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#为容器创建systemd用户文件"><span>为容器创建systemd用户文件</span></a></li><li><a class="is-flex is-mobile" href="#为容器管理systemd用户文件"><span>为容器管理systemd用户文件</span></a></li><li><a class="is-flex is-mobile" href="#容器配置为系统引导时启动"><span>容器配置为系统引导时启动</span></a></li><li><a class="is-flex is-mobile" href="#Root使用Systemd管理容器"><span>Root使用Systemd管理容器</span></a></li></ul></li></ul></li></ul></div></div><style>.menu-list > li > a.is-active + .menu-list { display: block; }.menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/avatar.png" alt="罗宇"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">罗宇</p><p class="is-size-6 is-block">用开放的思维，解决封闭的问题</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国-四川-成都</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives/"><p class="title">5</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories/"><p class="title">3</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags/"><p class="title">5</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://luovip.github.io" target="_blank" rel="noopener">关注我</a></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo官网</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://mirrors.nju.edu.cn/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">南京大学镜像站</span></span><span class="level-right"><span class="level-item tag">mirrors.nju.edu.cn</span></span></a></li><li><a class="level is-mobile" href="https://developer.aliyun.com/mirror/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">阿里云镜像站</span></span><span class="level-right"><span class="level-item tag">developer.aliyun.com</span></span></a></li></ul></div></div></div><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><figure class="media-left"><a class="image" href="/2025/04/22/podman%E5%AE%B9%E5%99%A8/"><img src="/img/podman.jpg" alt="podman容器"></a></figure><div class="media-content"><p class="date"><time dateTime="2025-04-22T05:50:42.000Z">2025-04-22 13:50:42</time></p><p class="title"><a href="/2025/04/22/podman%E5%AE%B9%E5%99%A8/">podman容器</a></p><p class="categories"><a href="/categories/%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF/">容器技术</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2025/04/21/Ansible%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/"><img src="/img/ansible-cover.jpg" alt="Ansible的基本使用"></a></figure><div class="media-content"><p class="date"><time dateTime="2025-04-21T05:50:42.000Z">2025-04-21 13:50:42</time></p><p class="title"><a href="/2025/04/21/Ansible%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/">Ansible的基本使用</a></p><p class="categories"><a href="/categories/Ansible/">Ansible</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2025/04/20/Linux%E8%BF%9B%E9%98%B6/"><img src="/img/Linux.png" alt="Linux进阶"></a></figure><div class="media-content"><p class="date"><time dateTime="2025-04-20T05:50:42.000Z">2025-04-20 13:50:42</time></p><p class="title"><a href="/2025/04/20/Linux%E8%BF%9B%E9%98%B6/">Linux进阶</a></p><p class="categories"><a href="/categories/Linux/">Linux</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2025/04/19/Linux%E7%9A%84%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1/"><img src="/img/Linux.png" alt="Linux的基础服务"></a></figure><div class="media-content"><p class="date"><time dateTime="2025-04-19T05:50:42.000Z">2025-04-19 13:50:42</time></p><p class="title"><a href="/2025/04/19/Linux%E7%9A%84%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1/">Linux的基础服务</a></p><p class="categories"><a href="/categories/Linux/">Linux</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2025/04/18/Linux%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"><img src="/img/Linux.png" alt="Linux的基本使用"></a></figure><div class="media-content"><p class="date"><time dateTime="2025-04-18T05:50:42.000Z">2025-04-18 13:50:42</time></p><p class="title"><a href="/2025/04/18/Linux%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/">Linux的基本使用</a></p><p class="categories"><a href="/categories/Linux/">Linux</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/Ansible/"><span class="level-start"><span class="level-item">Ansible</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF/"><span class="level-start"><span class="level-item">容器技术</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2025/04/"><span class="level-start"><span class="level-item">四月 2025</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Ansible/"><span class="tag">Ansible</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"><span class="tag">Linux的基本使用</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux%E7%9A%84%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1/"><span class="tag">Linux的基础服务</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux%E8%BF%9B%E9%98%B6/"><span class="tag">Linux进阶</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/podman%E5%AE%B9%E5%99%A8/"><span class="tag">podman容器</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div><!--!--><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Linux技术博客</a><p class="size-small"><span>&copy; 2021-2025</span>  Powered by 罗宇 <br><span>© <a href="http://www.beian.miit.gov.cn/" target="_blank">川ICP备88888888号</a><br></span><span>© 版权说明:本网站所有内容均自己创作,方便用于技术交流和日常总结!<br /></span><span><span id="statistic-times">loading...</span><script>function createTime(time) {
            var n = new Date(time);
            now.setTime(now.getTime() + 250),
                days = (now - n) / 1e3 / 60 / 60 / 24,
                dnum = Math.floor(days),
                hours = (now - n) / 1e3 / 60 / 60 - 24 * dnum,
                hnum = Math.floor(hours),
            1 == String(hnum).length && (hnum = "0" + hnum),
                minutes = (now - n) / 1e3 / 60 - 1440 * dnum - 60 * hnum,
                mnum = Math.floor(minutes),
            1 == String(mnum).length && (mnum = "0" + mnum),
                seconds = (now - n) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum,
                snum = Math.round(seconds),
            1 == String(snum).length && (snum = "0" + snum),
                document.getElementById("statistic-times").innerHTML = "❤️本站自 <strong>"+time.split(" ")[0].replace(/\//g,".")+"</strong> 已运行 <strong>" + dnum + "</strong> 天 <strong>" + hnum + "</strong> 小时 <strong>" + mnum + "</strong> 分 <strong>" + snum + "</strong> 秒！❤️";
        }var now = new Date();setInterval("createTime('2021/12/17 00:00:00')", 250,"");</script><br></span></p></div><div class="level-end"></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script data-pjax src="/js/insight.js" defer></script><script data-pjax>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script><script type="text/javascript">var pjax = new Pjax({
            elements: "a",//代表点击链接就更新
            selectors: [  //代表要更新的节点
                ".section",
                "title"
            ],
            cache: true,
            cacheBust:false
        })

        function loadBusuanzi(){
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js", function () {});
        }

        function loadMathJax() { //加载mathjax
            $.getScript("//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML", function () {
                MathJax.Hub.Config({ tex2jax: { inlineMath: [['$', '$'], ['\(', '\)']] } });
                var math = document.getElementsByClassName("entry-content")[0];
                MathJax.Hub.Queue(["Typeset", MathJax.Hub, math]);
            });
        };

        // 开始 PJAX 执行的函数
        document.addEventListener('pjax:send', function () {
        });
        
        // PJAX 完成之后执行的函数，可以和上面的重载放在一起
        document.addEventListener('pjax:complete', function () {
            $(".section").css({opacity:1});
            if(false){
                $.getScript('/js/comment-issue-data.js',function(){loadIssueData('undefined','undefined','undefined','undefined',undefined);});
            }
            if(false){
                loadMathJax();
            }
            loadMainJs(jQuery, window.moment, window.ClipboardJS, window.IcarusThemeSettings);
            loadBackTop();
            loadBusuanzi();
            if(typeof loadBanner == 'function'){
                loadBanner();
            }
        });</script></body></html>