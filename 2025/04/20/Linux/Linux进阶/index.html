<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Linux进阶 - Linux技术博客</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Linux技术博客"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Linux技术博客"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="1 必须掌握的Linux命令"><meta property="og:type" content="blog"><meta property="og:title" content="罗宇"><meta property="og:url" content="https://luovip.github.io/"><meta property="og:site_name" content="罗宇"><meta property="og:description" content="1 必须掌握的Linux命令"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://luovip.github.io/img/avatar.png"><meta property="article:published_time" content="2025-04-20T05:50:42.000Z"><meta property="article:modified_time" content="2025-05-11T14:51:27.842Z"><meta property="article:author" content="removeif"><meta property="article:tag" content="Linux进阶"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://luovip.github.io/img/avatar.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com/2025/04/20/Linux/Linux%E8%BF%9B%E9%98%B6/"},"headline":"Linux技术博客","image":["http://example.com/img/Linux.jpg"],"datePublished":"2025-04-20T05:50:42.000Z","dateModified":"2025-05-11T14:51:27.842Z","author":{"@type":"Person","name":"罗宇"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject"}},"description":"1 必须掌握的Linux命令"}</script><link rel="canonical" href="http://example.com/2025/04/20/Linux/Linux%E8%BF%9B%E9%98%B6/"><link rel="icon" href="/img/favicon.svg"><meta name="referrer" content="no-referrer-when-downgrade"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/6.0.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark-reasonable.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Oxanium:wght@300;400;600&amp;family=Roboto+Mono"><link rel="stylesheet" href="/css/cyberpunk.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="/js/globalUtils.js"></script><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdnjs.loli.net/ajax/libs/pace/1.2.4/pace.min.js"></script><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Linux技术博客</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/media">音乐</a><a class="navbar-item" href="/album">相册</a><a class="navbar-item" href="/about">关于我</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><!--!--><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/img/Linux.jpg" alt="Linux进阶"></span></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2025-04-20 13:50:42  <span class="level-item"> 罗宇 </span><a class="commentCountImg" href="/2025/04/20/Linux/Linux%E8%BF%9B%E9%98%B6/#comment-container"><span class="display-none-class">/2025/04/20/Linux/Linux进阶/</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="b4d1b7cf2b764f69bece2b7cb8df6745">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>9 小时  <i class="fas fa-pencil-alt"> </i>77.2 k</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">Linux进阶</h1><div class="content"><h1 id="1-必须掌握的Linux命令"><a href="#1-必须掌握的Linux命令" class="headerlink" title="1 必须掌握的Linux命令"></a>1 必须掌握的Linux命令</h1><span id="more"></span>


<h2 id="1-1-强大好用的Shell"><a href="#1-1-强大好用的Shell" class="headerlink" title="1.1 强大好用的Shell"></a>1.1 强大好用的Shell</h2><h3 id="系统内核"><a href="#系统内核" class="headerlink" title="系统内核"></a>系统内核</h3><p>​     一台完整的计算机是由运算器、控制器、存储器、输入&#x2F;输出等多种硬件设备共同组成的，而能让各种硬件设备各司其职且又能协同运行的东西就是系统内核</p>
<p>​     Linux系统的内核负责完成对硬件资源的分配、调度等管理任务，对系统的正常运行起着十分重要的作用</p>
<p>​     与修改Windows系统中的注册表类似，直接改动内核参数的难度比较大，而且一旦”手滑”还有可能导致系统直接崩溃</p>
<p>​     不建议直接去编辑内核中的参数，而是用基于系统调用接口开发出来的程序或服务来管理计算机，以满足日常的工作需要</p>
<h3 id="用户与硬件"><a href="#用户与硬件" class="headerlink" title="用户与硬件"></a>用户与硬件</h3><p>人类是无法直接控制硬件的</p>
<p>硬件设备由系统内核直接管理，但由于内核的复杂性太高，在访问时存在较大的风险，因此用户不能直接访问内核</p>
<p>虽然通过调用系统提供的API(应用程序编程接口)就能实现某个功能，但哪怕实现”将一条信息通过互联网传输给别人”这样简单的任务，都要手动调用几十次API接口，使用起来太不切实际</p>
<p>最外层的服务程序是最贴近于用户端的，这些服务程序集成了大量API接口的完整软件，微信、QQ就是这样的服务程序</p>
<p><img src="/Linux%E5%9F%BA%E7%A1%80.assets/5dfb1128e83270a693b74fdc0b77e758.png"></p>
<h3 id="Shell"><a href="#Shell" class="headerlink" title="Shell"></a>Shell</h3><p>名称由来：被一层层”包裹”起来的硬件设备，感觉像一只蜗牛的壳呢？英文中的壳叫作Shell，行业中也将用户终端程序称之为Shell</p>
<p>翻译官：Shell就是终端程序的统称，充当了人与内核(硬件)之间的翻译官</p>
<p>用户把一些命令”告诉”终端程序，它就会调用相应的程序服务去完成某些工作</p>
<p>默认使用终端：包括红帽系统在内的许多主流Linux系统默认使用的终端是Bash(Bourne-Again SHell)解释器</p>
<p>Bash解释器的优势：</p>
<p>1.通过上下方向键来调取执行过的Linux命令</p>
<p>2.命令或参数仅需输入前几位就可以用Tab键补全</p>
<p>3.具有强大的批处理脚本</p>
<p>4.具有实用的环境变量功能</p>
<p>Shell与Bash是包含与被包含的关系：</p>
<p>举例来说，在社会中有翻译官这个职业，它是由许多从业者共同组成的职业名称，而Bash则是其中一个出色的成员，是Shell终端程序中的一份子</p>
<h2 id="1-2-常用系统工作命令"><a href="#1-2-常用系统工作命令" class="headerlink" title="1.2 常用系统工作命令"></a>1.2 常用系统工作命令</h2><h3 id="echo命令"><a href="#echo命令" class="headerlink" title="echo命令"></a>echo命令</h3><p>在终端设备上输出指定字符串或变量提取后的值，能够给用户一些简单的提醒信息，亦可以将输出的指定字符串内容同管道符一起传递给后续命令作为标准输入信息进行二次处理，还可以同输出重定向符一起操作，将信息直接写入文件</p>
<p>如需提取变量值，需在变量名称前加入$符号，变量名称一般均为大写形‍式</p>
<p>语法格式:echo [字符串] [$变量]</p>
<p>常用参数：</p>
<p><img src="/media/1ce5bc97d0fc57cdd982a8a94267d59d.png" alt="截图.png"></p>
<p>执行”echo 字符串”或”echo<br>$变量”，$符号的意思是提取变量的实际值，以便后续的输出操作</p>
<p>命令使用示例：</p>
<p>1.输出指定字符串到终端设备界面(默认为电脑屏幕)：</p>
<p><img src="/media/1dcd4200d0d2e8ffcdb2c5c73bd9bf41.png" alt="截图.png"></p>
<p>2.使用”$变量”的方式提取出变量SHELL的值，并将其输出到屏幕上：</p>
<p><img src="/media/45704ba18da11d44b4d5f70160ab8cef.png" alt="截图.png"></p>
<p>3.搭配转义符一起使用，输出纯字符串内容：</p>
<p><img src="/media/eff72c6a2345c2e684ffff0385d6ffc2.png" alt="截图.png"></p>
<p>4.搭配输出重定向符一起使用，将字符串内容直接写入文件中：</p>
<p><img src="/media/4e99b4ee7f8d340a80a3505a6b4ef13f.png" alt="截图.png"></p>
<p>5.搭配反引号执行命令，并将执行结果输出：</p>
<p><img src="/media/f52d68f5df0c8c3535b67d4699f228c8.png" alt="截图.png"></p>
<p>6.输出带有换行符的内容：</p>
<p><img src="/media/27b78016fadf975ef37962f565b62920.png" alt="截图.png"></p>
<p>7.指定删除字符串中某些字符，随后将内容输出：</p>
<p><img src="/media/97fd7c5ef538d67922481588e303021d.png" alt="截图.png"></p>
<h3 id="date命令"><a href="#date命令" class="headerlink" title="date命令"></a>date命令</h3><p>显示或设置系统日期与时间信息</p>
<p>可以根据想要的格式来输出系统时间信息</p>
<p>时间格式为MMDDhhmm[CC][YY][.ss]，其中MM为月份，DD为日，hh为小时，mm为分钟，CC为年份前两位数字，YY为年份后两位数字，ss为秒的值</p>
<p>语法格式：date 参数 对象</p>
<p>常用参数：</p>
<p><img src="/media/5431f8a1ba37febe572d410263c32602.png" alt="截图.png"></p>
<p>命令使用示例：</p>
<p>1.默认格式输出系统当前的日期与时间信息：</p>
<p><img src="/media/512782debbf908db4fc54fe3f6e983a1.png" alt="截图.png"></p>
<p>2.按照”年-月-日 小时:分钟:秒”的格式查看当前系统时间：</p>
<p><img src="/media/d4739825f554698657219afb6d645c5e.png" alt="截图.png"></p>
<p>3.设置系统为指定的日期和时间：</p>
<p><img src="/media/b80e8fc61308d70d9dfb6ad1f884e00a.png" alt="截图.png"></p>
<p>4.date命令中的参数%j用来查看今天是当年中的第几天，这个参数能很好区分备份时间的早晚，数字越大，越靠近当前时间：</p>
<p><img src="/media/3c2e4b93c4483401d3ac7e0722079126.png" alt="截图.png"></p>
<h3 id="timedatectl命令"><a href="#timedatectl命令" class="headerlink" title="timedatectl命令"></a>timedatectl命令</h3><p>设置系统时间与日期</p>
<p>与使用date命令设置日期时间不同，使用timedatectl命令设置过的日期时间信息将被写入系统配置文件，从而立即且长期有效，不会随系统重启而失效</p>
<p>该命令能用来查看系统时间与日期，一站式搞定系统时间</p>
<p>语法格式:timedatectl 参数 对象</p>
<p>常用参数：</p>
<p><img src="/media/6554396e9311a51fb8f1275e6590ed49.png" alt="截图.png"></p>
<p>命令使用示例：</p>
<p>1.查看当前系统中的时区、日期、时间等信息：</p>
<p><img src="/media/0ccf358083939dae31a1a07fb0b3e49a.png" alt="截图.png"></p>
<p>2.关闭NTP时间服务器同步功能：</p>
<p><img src="/media/62f4322d675842a96cac3563ea09d1f9.png" alt="截图.png"></p>
<p>3.设置系统日期、系统时间：</p>
<p><img src="/media/52f2cd0d07f20de165d771407d9e82f7.png" alt="截图.png"></p>
<p>4.查看可选时区：</p>
<p><img src="/media/161b9d81fecc815b1dc382c4ada7f60e.png" alt="截图.png"></p>
<p>5.设置系统时区：</p>
<p><img src="/media/eae3d1227238d064b5f906bb676ac81b.png" alt="截图.png"></p>
<h3 id="reboot命令"><a href="#reboot命令" class="headerlink" title="reboot命令"></a>reboot命令</h3><p>用于重新启动计算机。与halt和shutdown命令相似</p>
<p>语法格式:reboot [参数]</p>
<p>常用参数：</p>
<p><img src="/media/6e058122584ab52d6dbfb97798910f33.png" alt="截图.png"></p>
<p>命令使用示例：</p>
<p>1.重启当前系统与模拟重启当前系统：</p>
<p><img src="/media/fb72f875d9888ab596e00a5057ef8ca3.png" alt="截图.png"></p>
<h3 id="poweroff命令"><a href="#poweroff命令" class="headerlink" title="poweroff命令"></a>poweroff命令</h3><p>用于关闭操作系统</p>
<p>语法格式:poweroff [参数]</p>
<p>常用参数：</p>
<p><img src="/media/81fd10e97d5eddb74dab896cd74249cf.png" alt="截图.png"></p>
<p>命令使用示例：</p>
<p>1.关闭操作系统：</p>
<p><img src="/media/2f4eca0e1f620a1eaae23d5014070bac.png" alt="截图.png"></p>
<p>2.模拟关机操作并记录过程到日志文件(没有真正关机)：</p>
<p><img src="/media/0a21deabccb99cb42eda86e861d9eec6.png" alt="截图.png"></p>
<p>3.将所有硬件设置为备用模式，并关闭操作系统：</p>
<p><img src="/media/1989b685763416f11e44b94d293e4268.png" alt="截图.png"></p>
<h3 id="wget命令"><a href="#wget命令" class="headerlink" title="wget命令"></a>wget命令</h3><p>从指定网址下载网络文件</p>
<p>wget命令非常稳定，即便网络发生波动也不会导致下载失败，而是不断尝试重连，直至整个文件下载完毕</p>
<p>wget命令支持如HTTP、HTTPS、FTP等常见协议，可以在命令行中直接下载网络文件</p>
<p>语法格式：wget 参数 网址URL 对象</p>
<p>常用参数：</p>
<p><img src="/media/eb9aee2aa1036ddda06c83e1390d8275.png" alt="截图.png"></p>
<p><img src="/media/bf3cdbb07c35f3173fb5ebe9c5717ab1.png" alt="截图.png"></p>
<p>命令使用示例：</p>
<p>1.下载指定的网络文件</p>
<p><img src="/media/47588521a444823afae9db049c624697.png" alt="截图.png"></p>
<p>2.下载指定的网络文件，并定义保存在本地的文件名称</p>
<p><img src="/media/65fb270a1c545bfdc3475d2ef7137bb7.png" alt="截图.png"></p>
<p>3.下载指定的网络文件，限速最高每秒300kbit&#x2F;s</p>
<p><img src="/media/da97f7139d7927609f5f53596621d0cd.png" alt="截图.png"></p>
<p>4.启用断点续传技术下载指定的网络文件</p>
<p><img src="/media/c0240dd09377e546be7c3414cf70a42b.png" alt="截图.png"></p>
<p>5.下载指定的网络文件，将任务放至后台执行</p>
<p><img src="/media/1e0136d4738b925989bdb86befe44b96.png" alt="截图.png"></p>
<h3 id="ps命令"><a href="#ps命令" class="headerlink" title="ps命令"></a>ps命令</h3><p>显示当前系统的进程状态。使用ps命令可以查看到进程的所有信息，例如进程的号码、发起者、系统资源(处理器与内存)使用占比、运行状态等</p>
<p>ps命令可及时发现哪些进程出现”僵死”或”不可中断”等异常情‍况</p>
<p>ps命令经常会与kill命令搭配使用，以中断和删除不必要的服务进程，避免服务器的资源浪费</p>
<p>语法格式：ps 参数</p>
<p>常用参数：</p>
<p><img src="/media/a2fdcf196b0b380a8aac4b4f74f48551.png" alt="截图.png"></p>
<p><img src="/media/eb7693b87c77cec45d08c73435116e74.png" alt="截图.png"></p>
<p>Linux系统中有5种常见的进程状态，分别为运行、中断、不可中断、僵死与停止，其各自含义如下：</p>
<p>1.R(运行):进程正在运行或在运行队列中等待</p>
<p>2.S(中断):进程处于休眠中，当某个条件形成后或者接收到信号时，则脱离该状态</p>
<p>3.D(不可中断):进程不响应系统异步信号，即便用kill命令也不能将其中断</p>
<p>4.Z(僵死):进程已终止，但进程描述符仍存在, 直到父进程调用wait4()系统函数后将进程释放</p>
<p>5.T(停止):进程收到停止信号后停止运行</p>
<p>除了上面5种常见的进程状态，还有可能是：</p>
<p>高优先级(&lt;)、低优先级(N)、被锁进内存(L)、包含子进程(s)以及多线程(l)这5种补充形式</p>
<p>ps命令可允许参数不加减号（-），因此可直接 写成ps aux的样子</p>
<p>命令使用示例：</p>
<p>1.显示系统中全部的进程信息，含详细信息：</p>
<p><img src="/media/148908e0d7a578857fdc896ab7262a1a.png" alt="截图.png"></p>
<p>2.结合输出重定向，将当前进程信息保留备份至指定文件：</p>
<p><img src="/media/2ea35ef83873d47ff33ade027eacf653.png" alt="截图.png"></p>
<p>3.结合管道操作符，将当前系统运行状态中指定的进程信息过滤出来：</p>
<p><img src="/media/aee5ff5bf375fe06af497b7c893ad28a.png" alt="截图.png"></p>
<p>4.结合管道操作符，将当前系统运行状态中指定用户的进程信息过滤出来：</p>
<p><img src="/media/32ec43a084fe4a042b94e904ca5a13b5.png" alt="截图.png"></p>
<p>5.结合管道操作符与sort命令，依据处理器使用量（第三列）情况降序排序：</p>
<p><img src="/media/58f9048b9c3fdff911490973da507484.png" alt="截图.png"></p>
<p>6.结合管道操作符与sort命令，依据内存使用量（第四列）情况降序排序：</p>
<p><img src="/media/2466fa90c8b429dff897b09bd01ca4cc.png" alt="截图.png"></p>
<h3 id="pstree命令"><a href="#pstree命令" class="headerlink" title="pstree命令"></a>pstree命令</h3><p>以树状图形式显示进程信息，Linux系统中常用ps命令查看进程状态信息，但是却无法了解进程之间的依赖关系，哪个是父进程，哪个是子进程？这些信息则可通过pstree命令进行查看</p>
<p>语法格式：pstree 参数</p>
<p>常用参数：</p>
<p><img src="/media/17152b43e15e7be31eda498841430f84.png" alt="截图.png"></p>
<p><img src="/media/145fa3279ee8b43b3091a4b646d2b2ed.png" alt="截图.png"></p>
<p>命令使用示例：</p>
<p>1.以树状图形式显示当前系统中的全部进程(默认)：</p>
<p><img src="/media/928efb130858139439ef2dc9b2bfb4c5.png" alt="截图.png"></p>
<p>2.以树状图形式显示当前系统中的全部进程(带有进程号)：</p>
<p><img src="/media/92f6eb11667ed029fc747401b0630f06.png" alt="截图.png"></p>
<p>3.以更完整、更丰富的信息样式显示每个进程：</p>
<p><img src="/media/2c7696582642d973b1721877c776ae0d.png" alt="截图.png"></p>
<h3 id="top命令"><a href="#top命令" class="headerlink" title="top命令"></a>top命令</h3><p>实时显示系统运行状态，包含处理器、内存、服务、进程等重要资产信息</p>
<p>除了能看到常规的服务进程信息之外，还能够对处理器和内存的负载情况一目了然，实时感知系统全局的运行状态</p>
<p>语法格式:top 参数 对象</p>
<p>常用参数：</p>
<p><img src="/media/f0e3276f7d877f890538db001c56cefc.png" alt="截图.png"></p>
<p>命令使用示例：</p>
<p>1.默认格式显示系统运行信息：</p>
<p><img src="/media/23fb61ba57d7fc0cac2043646e28eee2.png" alt="截图.png"></p>
<p>top命令执行结果的前5行为系统整体的统计信息，其所代表的含义如下：</p>
<p>第1行：系统时间、运行时间、登录终端数、系统负载(3个数值分别为1分钟、5分钟、15分钟内的平均值，数值越小意味着负载越低)</p>
<p>第2行：进程总数、运行中的进程数、睡眠中的进程数、停止的进程数、僵死的进程数</p>
<p>第3行：用户占用资源百分比、系统内核占用资源百分比、改变过优先级的进程资源百分比、空闲的资源百分比等。其中数据均为CPU数据并以百分比格式显示，例如：”99.9 id”意味着有99.9%的CPU处理器资源处于空闲</p>
<p>第4行：物理内存总量、内存空闲量、内存使用量、作为内核缓存的内存量</p>
<p>第5行：虚拟内存总量、虚拟内存空闲量、虚拟内存使用量、已被提前加载的内存量</p>
<p>2.默认格式显示系统运行信息，但提供完整的进程路径及名称：</p>
<p><img src="/media/615ec52b6bfd1c5b60ad117973dab093.png" alt="截图.png"></p>
<p>3.以批处理模式显示程序信息：</p>
<p><img src="/media/4e0b80db1f8b2584247958df8e63fb06.png" alt="截图.png"></p>
<p>4.设定每5秒刷新一次信息：</p>
<p><img src="/media/e850e48d607f3ee41152a7dfcf5b96c3.png" alt="截图.png"></p>
<p>5.设定总显示次数为5次，随后自动退出命令：</p>
<p><img src="/media/17569399172f8532182405f3dd51ae07.png" alt="截图.png"></p>
<h3 id="nice命令"><a href="#nice命令" class="headerlink" title="nice命令"></a>nice命令</h3><p>用于调整进程的优先级，合理分配系统资源。优先级范围为-20~19，数字越小，优先级越高</p>
<p>语法格式:nice [参数] 命令或脚本名</p>
<p>常用参数：</p>
<p><img src="/media/8637bbef2b92d4ade5be571e580ab8e4.png" alt="截图.png"></p>
<p>命令使用示例：</p>
<p>1.以优先级别为5的方式执行指定脚本：</p>
<p><img src="/media/770a5f2bcae3fe70f91095cbbd62b943.png" alt="截图.png"></p>
<p>2.以最高优先级的方式执行指定脚本：</p>
<p><img src="/media/0a25e98f448478ca271f9bb648f780ea.png" alt="截图.png"></p>
<h3 id="pidof命令"><a href="#pidof命令" class="headerlink" title="pidof命令"></a>pidof命令</h3><p>用于查找服务进程的PID号码</p>
<p>语法格式:pidof [参数] 服务名</p>
<p>常用参数：</p>
<p><img src="/media/309c1839d3ff446c79f803f376b1b4f5.png" alt="截图.png"></p>
<p>命令使用示例：</p>
<p>1.查找某个指定服务所对应的进程PID号码：</p>
<p><img src="/media/99a196c0f6c7ade7dfd77aea38043751.png" alt="截图.png"></p>
<p>2.查找多个指定服务所对应的进程PID号码：</p>
<p><img src="/media/3fc349eaed4df3e3c989464c619bf952.png" alt="截图.png"></p>
<h3 id="kill命令"><a href="#kill命令" class="headerlink" title="kill命令"></a>kill命令</h3><p>kill命令的功能是杀死(结束)进程</p>
<p>Linux系统中如需结束某个进程，既可以使用如service或systemctl这样的管理命令来结束服务，也可以使用kill命令直接结束进程信息</p>
<p>如使用kill命令后进程并没有结束，则可以使用信号9进行强制杀死动作</p>
<p>语法格式：kill 参数 进程号</p>
<p>常用参数：</p>
<p><img src="/media/bb369da9494f94c5d8b30eb22f28245c.png" alt="截图.png"></p>
<p>命令使用示例：</p>
<p>1.列出系统支持的全部信号列表：</p>
<p><img src="/media/25b42e383a7a5d7e77e20ed13874bd85.png" alt="截图.png"></p>
<p>2.结束某个指定的进程(数字为对应的PID值)：</p>
<p><img src="/media/60035c1dba0edd6b818978b47226721c.png" alt="截图.png"></p>
<p>3.强制结束某个指定的进程(数字为对应的PID值)：</p>
<p><img src="/media/b83cd55a7eedfc37e502b17e165bb786.png" alt="截图.png"></p>
<h3 id="killall命令"><a href="#killall命令" class="headerlink" title="killall命令"></a>killall命令</h3><p>用于基于服务名关闭一组进程</p>
<p>常使用kill命令关闭指定PID进程号的服务，暂且不论要先用ps命令找到对应的进程号才能关闭它，就说很多服务实际会发起多个进程，对应有数个不同PID进程号，要用kill命令逐一关闭也是件麻烦事</p>
<p>将ps和kill两个命令的执行过程合二为一，就得到了超好用的killall命令。一个只需要管理员给出要关闭的服务名，就能自动找到其所对应的全部进程信息，并关闭它们</p>
<p>语法格式:killall [参数] 服务名</p>
<p>常用参数：</p>
<p><img src="/media/bd8cd5195739cb4cb62037c42ebabf53.png" alt="截图.png"></p>
<p><img src="/media/31c3b7ae4b0b3c655c2d6755177f6d06.png" alt="截图.png"></p>
<p>命令使用示例：</p>
<p>1.结束指定服务所对应的全部进程：</p>
<p><img src="/media/eb504a867791c88e41537542a4bba7d7.png" alt="截图.png"></p>
<p>2.打印已知信号列表：</p>
<p><img src="/media/82a5c3ba92e40392abdd626bb0bd3c29.png" alt="截图.png"></p>
<p>如果在系统终端中执行一个命令后想立即停止它，可以同时按下Ctrl+C组合键，这样将立即终止该命令的进程</p>
<p>如果有些命令在执行时不断地在屏幕上输出信息，影响到后续命令的输入，则可以在执行命令时在末尾添加一个&amp;符号，这样命令将进入系统后台来执行</p>
<h2 id="1-3-系统状态检测命令"><a href="#1-3-系统状态检测命令" class="headerlink" title="1.3 系统状态检测命令"></a>1.3 系统状态检测命令</h2><h3 id="ifconfig命令"><a href="#ifconfig命令" class="headerlink" title="ifconfig命令"></a>ifconfig命令</h3><p>显示或设置网络设备参数信息。Windows系统中类似的命令为ipconfig，同样的功能可以使用ifconfig去完‍成</p>
<p>不建议使用ifconfig命令配置网络设备的参数信息，因为一旦服务器重启，配置过的参数会自动失效，因此还是编写到配置文件中更稳妥</p>
<p>使用ifconfig命令来查看本机当前的网卡配置与网络状态等信息时，主要查看的是网卡名称、inet 参数后面的IP地址、ether参数后面的网卡物理地址(MAC地址)以及RX、TX的接收数据包与发送数据包的个数及累计流量(即下面加粗的信息内容)：</p>
<p><img src="/media/1ab937a79a3748c423cb21fc98232264.png" alt="截图.png"></p>
<p>语法格式：ifconfig 参数 网卡名 动作</p>
<p>常用参数：</p>
<p><img src="/media/928f25dff87afe6cf2a26742f72e7088.png" alt="截图.png"></p>
<p>常用动作：</p>
<p><img src="/media/8470f99fdd9e01a5a8f67043a096afa9.png" alt="截图.png"></p>
<p>命令使用示例：</p>
<p>1.对指定网卡设备依次进行关闭和启动操作：</p>
<p><img src="/media/34fcb58b1d27816729a1205ff8cec65c.png" alt="截图.png"></p>
<p>2.对指定的网卡设备执行IP地址修改操作：</p>
<p><img src="/media/48dd721d16e01ff264a7dfc7a11e3244.png" alt="截图.png"></p>
<p>3.对指定的网卡设备执行MAC地址修改操作：</p>
<p><img src="/media/c30cce8dd5b83d2295ac6c2725bdf301.png" alt="截图.png"></p>
<p>4.对指定的网卡设备依次进行ARP协议关闭与开启操作：</p>
<p><img src="/media/e137868dbb0f4a83ff46b695ca9cce15.png" alt="截图.png"></p>
<h3 id="uname命令"><a href="#uname命令" class="headerlink" title="uname命令"></a>uname命令</h3><p>查看系统内核版本与系统架构等信息</p>
<p>语法格式:uname 参数</p>
<p>常用参数：</p>
<p><img src="/media/37597b18968584b4231d0e3161e2e70e.png" alt="截图.png"></p>
<p>命令使用示例：</p>
<p>1.显示系统内核名称</p>
<p><img src="/media/d79f09fb36e96ae7ffba63966559fce0.png" alt="截图.png"></p>
<p>2.显示系统所有相关信息(内核名称、主机名、版本号及硬件架构)</p>
<p><img src="/media/84b411acca3d7c2fc90efc0f35fb2fc1.png" alt="截图.png"></p>
<p>3.显示系统内核版本号</p>
<p><img src="/media/d418ff516518672986631b7a46d0ac78.png" alt="截图.png"></p>
<p>4.显示系统硬件架构</p>
<p><img src="/media/aafddce203cb9f5bcb96837a50bb1179.png" alt="截图.png"></p>
<p>5.如果要查看当前系统版本的详细信息，则需要查看redhat-release文件，其命令以及相应的结果如下：</p>
<p><img src="/media/89359430aa22f51b3caefcb3ac26eb1e.png" alt="截图.png"></p>
<h3 id="uptime命令"><a href="#uptime命令" class="headerlink" title="uptime命令"></a>uptime命令</h3><p>查看系统负载信息，可以显示当前系统时间、系统已运行时间、启用终端数量以及平均负载值等信息</p>
<p>平均负载值指的是系统在最近1分钟、5分钟、15分钟内的压力情况，负载值越低越好</p>
<p>建议负载值保持在1左右，在生产环境中不要超过5就好</p>
<p>语法格式：uptime 参数</p>
<p>命令使用示例：</p>
<p>1.查看当前系统负载及相关信息：</p>
<p><img src="/media/eadaa3a6a89d2ebe02e4677e66ac1a56.png" alt="截图.png"></p>
<p>2.以更易读的形式显示系统已运行时间：</p>
<p><img src="/media/3144ccd5cc16b1d6a11fd28650e3f908.png" alt="截图.png"></p>
<p>3.显示本次系统的开机时间：</p>
<p><img src="/media/b707deb54520782ce801f25e47a75872.png" alt="截图.png"></p>
<h3 id="free命令"><a href="#free命令" class="headerlink" title="free命令"></a>free命令</h3><p>显示系统内存使用量情况，包含物理内存和交换内存的总量、使用量、空闲量情况</p>
<p>语法格式：free 参数</p>
<p><img src="/media/541c84478d56f021c647493c5a962c1b.png" alt="截图.png"></p>
<p>常用参数：</p>
<p><img src="/media/d904abcf36ae8be4109253e878ce0337.png" alt="截图.png"></p>
<p>命令使用示例：</p>
<p>1.以默认的容量单位显示内存使用量信息</p>
<p><img src="/media/52307fdfded884c99267ed8697ab068a.png" alt="截图.png"></p>
<p>2.以MB为单位显示内存使用量信息</p>
<p><img src="/media/838d6e530cd96a9e0997e2d2adc0fb15.png" alt="截图.png"></p>
<p>3.以易读的单位显示内存使用量信息</p>
<p><img src="/media/e4221be26a7b1f1ae81f62db2cc15510.png" alt="截图.png"></p>
<p>4.以易读的单位显示内存使用量信息，每隔10s刷新一次</p>
<p><img src="/media/711d67f1f39e878880945cb2a447f44f.png" alt="截图.png"></p>
<h3 id="who命令"><a href="#who命令" class="headerlink" title="who命令"></a>who命令</h3><p>用于显示当前登录用户信息，包含登录的用户名、终端、日期时间、进程等信息</p>
<p>语法格式:who 参数</p>
<p><img src="/media/22509336434f11c1edfa099e47abf179.png" alt="截图.png"></p>
<p>常用参数:</p>
<p><img src="/media/f4add4a0edb89cc2ac2fe6f29300be98.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.查看当前登录用户信息</p>
<p><img src="/media/bbeaa032318ef459818195fdaa5265f0.png" alt="截图.png"></p>
<p>2.查看当前登录用户信息，并加上标题</p>
<p><img src="/media/d960d76107beff2e155bc30f8d4a9b21.png" alt="截图.png"></p>
<p>3.查看当前全部的登录全部用户信息</p>
<p><img src="/media/2463df0b032bd0340436216f7aaf3988.png" alt="截图.png"></p>
<p>4.查看系统的最近启动时间</p>
<p><img src="/media/4798eecab43a4e73fb48bd20453af78c.png" alt="截图.png"></p>
<h3 id="last命令"><a href="#last命令" class="headerlink" title="last命令"></a>last命令</h3><p>显示用户历史登录情况</p>
<p>通过读取系统登录历史日志文件(&#x2F;var&#x2F;log&#x2F;wtmp)并按照用户名、登录终端、来源终端、时间等信息进行划分，可让用户对系统历史登录情况一目了然</p>
<p>语法格式：last 参数 对象</p>
<p>常用参数：</p>
<p><img src="/media/0fdad8d8a7a6003b05b04f2be527e3a4.png" alt="截图.png"></p>
<p>命令使用示例：</p>
<p>1.显示近期用户或终端的历史登录情况</p>
<p><img src="/media/d2fc5be13bdd6beeaf3ffd567d1eb648.png" alt="截图.png"></p>
<p>2.仅显示最近3条历史登录情况，并不显示来源终端信息</p>
<p><img src="/media/d8c7ea8aedef9136711b59c537518857.png" alt="截图.png"></p>
<p>3.显示系统的开关机历史信息，并将来源终端放到最后</p>
<p><img src="/media/bfe4866945cbe07005ff5db8ce9a73a1.png" alt="截图.png"></p>
<h3 id="ping命令"><a href="#ping命令" class="headerlink" title="ping命令"></a>ping命令</h3><p>测试主机间网络的连通性，它发送出基于ICMP传输协议的数据包，要求对方主机予以回复</p>
<p>若对方主机的网络功能没有问题且防火墙放行流量，则就会回复该信息，我们也就可得知对方主机系统在线并运行正常了</p>
<p>Windows系统下的ping命令会发送出去4个请求后自动结束该命令</p>
<p>Linux系统下ping命令不会自动终止，需要用户手动按下Ctrl+C组合键才能结束，或是发起命令时加入-c参数限定发送数据包的个数。**</p>
<p>语法格式：ping 参数 域名或IP地址</p>
<p>常用参数：</p>
<p><img src="/media/ddb6edc05c3ea9abda3f83b1fffe529c.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.测试与指定域名之间的网络连通性(需手动按下Ctrl+C组合键结束命令)</p>
<p><img src="/media/3242d2fee36cd56b1bd22246d56d2ac1.png" alt="截图.png"></p>
<p>2.测试与指定主机之间的网络连通性，发送请求包限定为4个</p>
<p><img src="/media/d8c998a8a1bf8e7ab0235fdcfef0ff1b.png" alt="截图.png"></p>
<p>3.测试与指定主机之间的网络连通性，发送3个请求包，每次间隔0.2s，最长等待时间为3s</p>
<p><img src="/media/2c9b92e7cf77fd6b59dc21f89f564efd.png" alt="截图.png"></p>
<h3 id="tracepath命令"><a href="#tracepath命令" class="headerlink" title="tracepath命令"></a>tracepath命令</h3><p>追踪数据包的路由信息</p>
<p>tracepath命令能够追踪并显示数据包到达目的主机所经过的路由信息，以及对应的MTU值</p>
<p>语法格式:tracepath 参数 域名或IP地址</p>
<p>常用参数：</p>
<p><img src="/media/2d04e9103ec8c9f5a503ce86220a08b7.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.追踪到达域名的主机路由信息</p>
<p><img src="/media/0d0a5294c7f7a3b8c913251c7d7d9ca4.png" alt="截图.png"></p>
<p>2.追踪到达域名的主机路由信息，同时显示IP地址与主机名</p>
<p><img src="/media/225933d195eec4d3b3a1db0e2af056e6.png" alt="截图.png"></p>
<p>3.设置追踪数据包路由的最大TTL值为20，并追踪到达域名的主机路由信息</p>
<p><img src="/media/a5ab04ae14cc96cc35bea080bd716e50.png" alt="截图.png"></p>
<h3 id="netstat命令"><a href="#netstat命令" class="headerlink" title="netstat命令"></a>netstat命令</h3><p>显示各种网络相关信息，例如网络连接状态、路由表信息、接口状态、NAT、多播成员等</p>
<p>语法格式：netstat 参数</p>
<p>常用参数：</p>
<p><img src="/media/86080587e68db1a7530275cf48bc2c4c.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.显示系统网络状态中的所有连接信息</p>
<p><img src="/media/24c9bbfb3d2d9e9211e4e1a21e026706.png" alt="截图.png"></p>
<p>2.显示系统网络状态中的UDP连接信息</p>
<p><img src="/media/7d93335f409dfc3b0e30324a056f0be9.png" alt="截图.png"></p>
<p>3.显示系统网络状态中的UDP连接端口号使用信息</p>
<p><img src="/media/33879d743fa3713f43e8260c59695f58.png" alt="截图.png"></p>
<p>4.显示网卡当前状态信息</p>
<p><img src="/media/f1e46d788cce22b453b49df7f00dea48.png" alt="截图.png"></p>
<p>5.显示网络路由表状态信息</p>
<p><img src="/media/b0504aee87c70f8d7be946012ed83359.png" alt="截图.png"></p>
<p>6.找到某个服务所对应的连接信息</p>
<p><img src="/media/e95b82dc47c3da1965f877c78b79be1f.png" alt="截图.png"></p>
<h3 id="history命令"><a href="#history命令" class="headerlink" title="history命令"></a>history命令</h3><p>显示与管理历史命令记录</p>
<p>Linux系统默认会记录用户执行过的有命令，可以使用history命令查阅它们，也可以对其记录进行修改和删除操作</p>
<p>​           执行history命令能显示出当前用户在本地计算机中执行过的最近1000条命令记录。如果觉得1000不够用，可以自定义&#x2F;etc&#x2F;profile文件中<br>的HISTSIZE变量值。在使用history命令时，可以使用-c参数清空所有的命令历史记录。还可以使用”!编码数字”的方式来重复执行某一次的命令</p>
<p>语法格式：history 参数</p>
<p>常用参数:</p>
<p><img src="/media/1817bf35d76b838c4a71557cd5464371.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.显示执行过的全部命令记录</p>
<p><img src="/media/179580f476fd4b16d57d27bb569cbf49.png" alt="截图.png"></p>
<p>2.显示最近执行过的5条命令</p>
<p><img src="/media/49b31811ce4f97eb5c155c75a2b95b1e.png" alt="截图.png"></p>
<p>3.将本次缓存区信息写入历史文件（~&#x2F;.bash_history）</p>
<p><img src="/media/6b95cf0e8ee1e94d2dc6d590d66f49f9.png" alt="截图.png"></p>
<p>4.将历史文件中的信息读入当前缓冲区</p>
<p><img src="/media/baae3484fe022774e8bb6ca139455e1a.png" alt="截图.png"></p>
<p>5.将本次缓冲区信息追加写入历史文件（~&#x2F;.bash_history）</p>
<p><img src="/media/aec6fed8b0f8c81791fa852ee5635a27.png" alt="截图.png"></p>
<p>6.清空本次缓冲区及历史文件中的信息</p>
<p><img src="/media/9a3889269200c670327aba69a4e6b0dd.png" alt="截图.png"></p>
<h3 id="sosreport命令"><a href="#sosreport命令" class="headerlink" title="sosreport命令"></a>sosreport命令</h3><p>用于收集系统配置及架构信息并输出诊断文档</p>
<p>当Linux系统出现故障需要联系技术支持人员时，大多数时候都要先使用这个命令来简单收集系统的运行状态和服务配置信息，以便让技术支持人员能够远程解决一些小问题，抑或让他们能提前了解某些复杂问题</p>
<p>语法格式：sosreport [参数]</p>
<p>常用参数：</p>
<p><img src="/media/2491453b1fd83c8a77ff9c045ccd4cc5.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.列出所有可用的插件及其选项</p>
<p><img src="/media/d739ce3298f3403b35c1f09acd975aac.png" alt="截图.png"></p>
<p>2.使用-e参数，启用指定apache.log插件</p>
<p><img src="/media/9f586f3194de5f9b37ec00efa72c1b64.png" alt="截图.png"></p>
<p>3.使用-n参数，禁用指定yum.yumlist插件</p>
<p><img src="/media/b286a082926ccd50a0e52330cf771a02.png" alt="截图.png"></p>
<p>4.使用-a参数，启用所有列出来的插件</p>
<p><img src="/media/dce320669c3c0252fab0bd1243e24b61.png" alt="截图.png"></p>
<h2 id="1-4-查找定位文件命令"><a href="#1-4-查找定位文件命令" class="headerlink" title="1.4 查找定位文件命令"></a>1.4 查找定位文件命令</h2><h3 id="pwd命令"><a href="#pwd命令" class="headerlink" title="pwd命令"></a>pwd命令</h3><p>显示当前工作目录的路径，即显示所在位置的绝对路‍径</p>
<p>语法格式：pwd 参数</p>
<p>常用参数：</p>
<p><img src="/media/950668721ef553dbe275ac09bc98298e.png" alt="截图.png"></p>
<p>命令使用示例：</p>
<p>1.查看当前所处的工作目录</p>
<p><img src="/media/ee0b822d3c4ec298563c4abc26ca5216.png" alt="截图.png"></p>
<h3 id="cd命令"><a href="#cd命令" class="headerlink" title="cd命令"></a>cd命令</h3><p>更改当前所处的工作目录，路径可以是绝对路径，也可以是相对路径，若省略不写则会跳转至当前使用者的家目‍录</p>
<p>“cd-“返回到上一次所处的目录、”cd..”进入上级目录、”cd～”切换到当前用户的家目录、”cd～username”切换到其他用户的家目录</p>
<p>语法格式：cd 参数 目录名</p>
<p>常用参数：</p>
<p><img src="/media/b483c8ed91d15301ea32468dbfec0893.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.切到指定目录</p>
<p><img src="/media/66eb91eb75cce8e613f6c743798d0c6c.png" alt="截图.png"></p>
<h3 id="ls命令"><a href="#ls命令" class="headerlink" title="ls命令"></a>ls命令</h3><p>显示目录中的文件及其属性信息</p>
<p>所处的工作目录不同，当前工作目录下能看到的文件肯定也不同</p>
<p>使用ls命令的-a参数可以看到全部文件（包括隐藏文件），使用-l参数可以查看文件的属性、大小等详细信息。将这两个参数整合之后，再执行ls命令即可查看当前目录中的所有文件并输出这些文件的属性信息：</p>
<p><img src="/media/e904688106e63fc7aa3345e38f245691.png" alt="截图.png"></p>
<p>语法格式：ls 参数 文件名</p>
<p>常用参数：</p>
<p><img src="/media/564921295e060fd7e26933befa8fe09c.png" alt="截图.png"></p>
<p>命令使用示例：</p>
<p>1.显示当前目录中的文件名（默认不含隐藏文件）</p>
<p><img src="/media/2cd3145596f575ac25e69ccc9407004a.png" alt="截图.png"></p>
<p>2.显示当前目录中的文件名（含隐藏文件）</p>
<p><img src="/media/75fb966e70886157c0d26bfc70d82004.png" alt="截图.png"></p>
<p>3.以详细信息模式输出文件名及其属性信息</p>
<p><img src="/media/13fe7723361d9ef95bd9a7b0012fa8c5.png" alt="截图.png"></p>
<p>4.显示指定目录中的文件列表</p>
<p><img src="/media/0608a79b87e70f7d05a77de664f59dc7.png" alt="截图.png"></p>
<p>5.显示当前目录中的文件名及inode属性信息</p>
<p><img src="/media/16e161094245937a0f0712b9328a098d.png" alt="截图.png"></p>
<p>6.结合通配符一起使用，显示指定目录中所有以sd开头的文件列表</p>
<p><img src="/media/8469d5d4a11cbc8e548a12b21839d4cf.png" alt="截图.png"></p>
<p>7.依据文件内容大小进行排序，显示指定目录中文件名及其属性详情信息</p>
<p><img src="/media/b333c4141e68a16fbb2fe7fc6dba2a80.png" alt="截图.png"></p>
<p><img src="/media/c83f759f6ba990b4b617a910a6587722.png" alt="截图.png"></p>
<h3 id="tree命令"><a href="#tree命令" class="headerlink" title="tree命令"></a>tree命令</h3><p>以树状图形式列出目录内容</p>
<p>语法格式:tree 参数</p>
<p>常用参数:</p>
<p><img src="/media/cb3b9856c8281d2f26cd99f72e1ce75b.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.显示当前工作目录下的文件层级</p>
<p><img src="/media/acf06bd6b53957aa2f97976b67fca04c.png" alt="截图.png"></p>
<p>2.以文件和目录的更改时间进行排序</p>
<p><img src="/media/93ad8088c6aeb57d21fa22ee277ee072.png" alt="截图.png"></p>
<p>3.以带有相对路径的形式显示当前工作目录下的文件层级</p>
<p><img src="/media/35f3d88d3a58750ffb7a541b8e947ab6.png" alt="截图.png"></p>
<p>4.只显示目录的层级关系</p>
<p><img src="/media/aca409ab574385485540c1bb4ac050a9.png" alt="截图.png"></p>
<h3 id="find命令"><a href="#find命令" class="headerlink" title="find命令"></a>find命令</h3><p>根据给定的路径和条件查找相关文件或目录，其参数灵活方便，且支持正则表达式，结合管道符后能够实现更加复杂的功能</p>
<p>find命令通常进行的是从根目录(&#x2F;)开始的全盘搜索，有别于whereis、which、locate等有条件或部分文件的搜索</p>
<p>对于服务器负载较高的情况，建议不要在高峰时期使用find命令的模糊搜索，这会相对消耗较多的系统资源</p>
<p>语法格式:find 路径 条件 文件名</p>
<p>常用参数：</p>
<p><img src="/media/aeb8a9a14c8c34ba5d26ff14cf7bb8f2.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.全盘搜索系统中所有以.conf结尾的文件</p>
<p><img src="/media/c83fee7ac5642b0eecf3bc4b375c789e.png" alt="截图.png"></p>
<p>2.在&#x2F;etc目录中搜索所有大于1MB的文件</p>
<p><img src="/media/9296e97a8bc392da9fd8a78af78cf96b.png" alt="截图.png"></p>
<p>3.在&#x2F;home目录中搜索所有属于指定用户的文件</p>
<p><img src="/media/263ab71f3660e59cf2e52137c8fdd395.png" alt="截图.png"></p>
<p>4.在&#x2F;var&#x2F;log目录下搜索所有不是以.log结尾的文件</p>
<p><img src="/media/08e70152c38fed445e14b4af2e1e61b8.png" alt="截图.png"></p>
<p>5.搜索当前工作目录中所有近7天被修改过的文件</p>
<p><img src="/media/c78f64768818d5aee034812a461eb8ee.png" alt="截图.png"></p>
<p>6.全盘搜索系统中所有类型为目录且权限为1777的目录文件</p>
<p><img src="/media/9c3e0a022afddfbd3905b16a272656bf.png" alt="截图.png"></p>
<p>7.全盘搜索系统中所有类型为普通文件且可执行的文件信息</p>
<p><img src="/media/0db69207cb0fa180b44905ddc79e6ea8.png" alt="截图.png"></p>
<p>8.全盘搜索系统中所有后缀为.mp4的文件，并删除所有查找到的文件</p>
<p><img src="/media/1bcd9fce1c26fa757327aadf61e4b3a3.png" alt="截图.png"></p>
<p><img src="/media/d636b1ddc7bc5701862a33664f44c1b4.png" alt="截图.png"></p>
<h3 id="locate命令"><a href="#locate命令" class="headerlink" title="locate命令"></a>locate命令</h3><p>快速查找文件或目录</p>
<p>与find命令进行全局搜索不同，locate命令是基于数据文件(&#x2F;var&#x2F;lib&#x2F;locatedb)进行的定点查找</p>
<p>在使用 locate 命令时，先使用updateddb命令生成一个索引库文件，这个库文件的名字是&#x2F;var&#x2F;lib&#x2F;mlocate&#x2F;mlocate.db，后续在使用locate命令搜索文件时就是在该库中进行查找操作，速度会快很多</p>
<p>第一次使用locate命令之前，记得先执行updatedb命令来生成索引数据库，然后再进行查找：</p>
<p><img src="/media/6d5bd5389179cfa2a649c9a4fc872119.png" alt="截图.png"></p>
<p>语法格式:locate 参数 文件名</p>
<p>常用参数：</p>
<p><img src="/media/31b5db94a00dfb3f1aa559101be20675.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.在指定目录下搜索带有指定关键词的文件</p>
<p><img src="/media/5292d7b1e9ddd8c65c92e5692c7f48bf.png" alt="截图.png"></p>
<h3 id="whereis命令"><a href="#whereis命令" class="headerlink" title="whereis命令"></a>whereis命令</h3><p>​      按照名称快速搜索二进制程序(命令)、源代码以及帮助文件所对应的位置也是基于updatedb命令所生成的索引库文件进行搜索，与locate<br>命令的区别是不关心那些相同名称的文件，仅仅是快速找到对应的命令文件及其帮助文件所在的位置</p>
<p>语法格式：whereis 参数 命令名</p>
<p>常用参数:</p>
<p><img src="/media/b23b2a9fc0473465a3d1cadce9bb8916.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.查找指定命令程序及相关文件所在的位置</p>
<p><img src="/media/c5ee4f5b0977c3c4ce3575e61f5ca544.png" alt="截图.png"></p>
<p>2.仅查找指定命令程序文件所在的位置</p>
<p><img src="/media/85d57fbfc78013428fad9f02ab02915b.png" alt="截图.png"></p>
<p>3.仅查找指定命令的帮助文件所在的位置</p>
<p><img src="/media/70999588665c573f58b535ea15f4fbf0.png" alt="截图.png"></p>
<h3 id="which命令"><a href="#which命令" class="headerlink" title="which命令"></a>which命令</h3><p>查找命令文件，能快速搜索二进制程序所对应的位置</p>
<p>如果既不关心同名文件(find与locate)，也不关心命令所对应的源代码和帮助文件（whereis），仅仅是想找到命令本身所在的路径，那么这个which命令就太合适了</p>
<p>语法格式：which 参数 文件名</p>
<p>常用参数：</p>
<p><img src="/media/209e18ad50aa37d30d4652ababed28b2.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.查找某个指定命令文件所在位置</p>
<p><img src="/media/a5e340124737a835e7f2e86fbc97037f.png" alt="截图.png"></p>
<p>2.查找多个执行命令文件所在位置</p>
<p><img src="/media/be5072d1d551a7c6508fc41ee8381431.png" alt="截图.png"></p>
<h2 id="1-5-文本文件编辑命令"><a href="#1-5-文本文件编辑命令" class="headerlink" title="1.5 文本文件编辑命令"></a>1.5 文本文件编辑命令</h2><h3 id="cat命令"><a href="#cat命令" class="headerlink" title="cat命令"></a>cat命令</h3><p>在终端设备上显示文件内容</p>
<p>在Linux系统中有很多用于查看文件内容的命令，如more、tail、head等，每个命令都有各自的特点</p>
<p>cat命令适合查看内容较少的纯文本文件。 对于内容较多的文件，用more命令‍显示</p>
<p>语法格式:cat 参数 文件名</p>
<p>常用参数：</p>
<p><img src="/media/f32b732398c4710c2da8070db13697a8.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.查看指定文件的内容</p>
<p><img src="/media/ed63f3958306ac0f5d1fbe07025539c6.png" alt="截图.png"></p>
<p>2.查看指定文件的内容并显示行号</p>
<p><img src="/media/d76df62b608eaadb8229d8ae9d0fc8ac.png" alt="截图.png"></p>
<p>3.搭配空设备文件和输出重定向操作符，清空指定文件的内容</p>
<p><img src="/media/e641d6c1af1a31b7ff2b893114fe9870.png" alt="截图.png"></p>
<p>4.持续写入文件内容，直到碰到EOF终止符后结束并保存</p>
<p><img src="/media/067bbdfe5da23b0d7de611bf5a58e8c9.png" alt="截图.png"></p>
<p>5.搭配输出重定向操作符，将光盘设备制作成镜像文件</p>
<p><img src="/media/881d8fe0d717e1ae5ee339b51aa39beb.png" alt="截图.png"></p>
<h3 id="more命令"><a href="#more命令" class="headerlink" title="more命令"></a>more命令</h3><p>分页显示文本文件的内容</p>
<p>如果文本文件中的内容较多较长，使用cat命令读取后则很难看清，这时使用more命令进行分页查看就比较合适了</p>
<p>该命令可以把文本内容一页一页地显示在终端界面上，用户每按一次Enter键即向下一行，每按一次空格键即向下一页，直至看完为止</p>
<p>语法格式:more 参数 文件名</p>
<p>常用参数：</p>
<p><img src="/media/1b5679feb96f1163dc4a8fe72dacf488.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.分页显示指定的文本文件内容</p>
<p><img src="/media/f3001663b17e347a36d97e2eeddca8ce.png" alt="截图.png"></p>
<p>2.先进行清屏操作，随后以每次10行内容的格式显示指定的文本文件内容</p>
<p><img src="/media/5a5befc82f31ec630b848a1cb322927f.png" alt="截图.png"></p>
<p>3.分页显示指定的文本文件内容，若遇到连续两行及以上空白行的情况，则以一行空白行显示</p>
<p><img src="/media/f5c32fc49ee8996a15d3a8abe4ece48c.png" alt="截图.png"></p>
<p>4.从第10行开始，分页显示指定的文本文件内容</p>
<p><img src="/media/bf88452c5c86ac0c2a2d85cded11006f.png" alt="截图.png"></p>
<h3 id="head命令"><a href="#head命令" class="headerlink" title="head命令"></a>head命令</h3><p>显示文件开头的内容，默认为前10行</p>
<p>语法格式：head 参数 文件名</p>
<p>常用参数：</p>
<p><img src="/media/6d83186740fd9d27e01a4f1a35bda942.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.默认显示文件前10行内容</p>
<p><img src="/media/74131b2666d3d626d21ca974fae3b70b.png" alt="截图.png"></p>
<p>2.显示指定文件前5行内容</p>
<p><img src="/media/f0367c86a471be3367239c1eb4988695.png" alt="截图.png"></p>
<p>3.显示指定文件前20个字符</p>
<p><img src="/media/096895ede2cfb57ee18b9ef720841c88.png" alt="截图.png"></p>
<h3 id="tail命令"><a href="#tail命令" class="headerlink" title="tail命令"></a>tail命令</h3><p>tail命令用于查看纯文本文件的后N行或持续刷新文件的最新内容</p>
<p>如果指定了多个文件，则会在显示的每个文件内容前面加上文件名来加以区分</p>
<p>高阶玩法的-f参数的作用是持续显示文件的尾部最新内容</p>
<p>语法格式：tail 参数 文件名</p>
<p>常用参数：</p>
<p><img src="/media/c8dc483143dd3a1d7ef2befa166cd203.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.默认显示指定文件尾部的后10行内容</p>
<p><img src="/media/5dd5c47d5a8d3cb94ed551267b2ea84f.png" alt="截图.png"></p>
<p>2.指定显示指定文件尾部的后5行内容</p>
<p><img src="/media/80598935a4d3ed676244250ce3c9d4df.png" alt="截图.png"></p>
<p>3.指定显示指定文件尾部的后30个字符</p>
<p><img src="/media/e7be15f2e298819023b778d726e4a272.png" alt="截图.png"></p>
<p>4.持续刷新显示指定文件尾部的后10行内容</p>
<p><img src="/media/83e9c6bf8668549bdce33c1b32923531.png" alt="截图.png"></p>
<h3 id="tr命令"><a href="#tr命令" class="headerlink" title="tr命令"></a>tr命令</h3><p>功能是转换字符</p>
<p>tr命令是一款批量字符转换、压缩、删除的文本工具，但仅能从标准输入中读取文本内容，需要与管道符或输入重定向操作符搭配使用</p>
<p>语法格式:tr 参数 字符串1 字符串2</p>
<p>常用参数：</p>
<p><img src="/media/528fc78ed4dfb9b71066ee4688622aa1.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.将指定文件中的小写字母转换成大写字母后输出内容到终端界面</p>
<p><img src="/media/f19ef3687968b0da2bb517fafb70bf16.png" alt="截图.png"></p>
<p>2.删除指定文件中所有的数字后输出内容到终端界面</p>
<p><img src="/media/3d53bd9cb343c1d9a6699581c7eca9fc.png" alt="截图.png"></p>
<p>3.将指定文件中的多个相邻空行去重后输出内容到终端界面</p>
<p><img src="/media/c7587b61400fd251c3e98eb34b79baef.png" alt="截图.png"></p>
<h3 id="wc命令"><a href="#wc命令" class="headerlink" title="wc命令"></a>wc命令</h3><p>统计文件的字节数、单词数、行数等信息，并将统计结果输出到终端界面</p>
<p>语法格式:wc 参数 文件名</p>
<p>常用参数：</p>
<p><img src="/media/c41b89452f470d337eb5f5e3cf525740.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.统计指定文件的单词数量、字节数量、字符数量、总行数</p>
<p><img src="/media/96727518a4fb63b25e2465230fb4d18e.png" alt="截图.png"></p>
<p>2.&#x2F;etc&#x2F;passwd是用于保存所有用户信息的文件，要统计当前系统中有多<br>少个用户，可以使用下面的命令来进行查询:</p>
<p><img src="/media/a1673b85fb870e965dc5781869bcfa5e.png" alt="截图.png"></p>
<h3 id="stat命令"><a href="#stat命令" class="headerlink" title="stat命令"></a>stat命令</h3><p>显示文件的状态信息</p>
<p>​       在Linux系统中，每个文件都有3个”历史时间”:最后访问时间(ATIME)、最后修改时间(MTIME)、最后更改时间(CTIME)，用户可以使用stat命令查看到它们，进而判别有没有其他人修改过文件内容</p>
<p>使用touch命令可以轻易修改文件的ATIME和MTIME，因此请勿单纯以文件历史时间作为判别系统有无被他人入侵的唯一标准</p>
<p>语法格式：stat 参数 文件名</p>
<p>常用参数：</p>
<p><img src="/media/fdb6bf68f5883543d9c011878f4fafa5.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.查看指定文件的状态信息(含ATIME、MTIME与CTIME)</p>
<p><img src="/media/61d84adb5fb43303b979eebfd5f8a581.png" alt="截图.png"></p>
<p>2.仅查看指定文件的文件系统信息</p>
<p><img src="/media/c9e94afd15b9f549868f5b8edd9572f8.png" alt="截图.png"></p>
<p>3.以简洁的方式查看指定文件的状态信息</p>
<p><img src="/media/7a6aa819476b1a70c9b9537cb8f4e90d.png" alt="截图.png"></p>
<h3 id="grep命令"><a href="#grep命令" class="headerlink" title="grep命令"></a>grep命令</h3><p>grep命令用于按行提取文本内容</p>
<p>grep命令两个最常用的参数：-n参数用来显示搜索到的信息的行号、-v参数用于反选信息(即没有包含关键词的所有信息行)</p>
<p>​       与之容易混淆的是egrep命令和fgrep命令，如果把grep命令当作标准搜索命令，那么egrep则是扩展搜索命令，等价于grep<br>-E命令，支持扩展的正则表达式</p>
<p>fgrep则是快速搜索命令，等价于grep -F命令，不支持正则表达式，直接按照字符串内容进行匹配</p>
<p>语法格式:grep 参数 文件名</p>
<p>常用参数：</p>
<p><img src="/media/0af9ddf559a7bec13f3c245fa4fd3d65.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.搜索指定文件中包含某个关键词的内容行</p>
<p><img src="/media/83f3bd889e8e9b4e63ff0e82b779084e.png" alt="截图.png"></p>
<p>2.搜索指定文件中以某个关键词开头的内容行</p>
<p><img src="/media/5cd21e65bac0a2f07cb8342207034877.png" alt="截图.png"></p>
<p>3.搜索多个文件中包含某个关键词的内容行</p>
<p><img src="/media/28f1e4408eb09d1a6ce9f7541bb70de6.png" alt="截图.png"></p>
<p>4.搜索多个文件中包含某个关键词的内容，不显示文件名称</p>
<p><img src="/media/8041acd7d0cbdefd6b526d0a5ac1cf6a.png" alt="截图.png"></p>
<p>5.搜索指定文件中包含某个关键词位置的行号及内容行</p>
<p><img src="/media/848fb60f76be2fb7ccafca2569bb34cb.png" alt="截图.png"></p>
<p>6.搜索指定文件中不包含某个关键词的内容行</p>
<p><img src="/media/e6d37ab44c75f072f659c16aaef676a7.png" alt="截图.png"></p>
<h3 id="cut命令"><a href="#cut命令" class="headerlink" title="cut命令"></a>cut命令</h3><p>按列提取文件内容</p>
<p>常用的grep命令仅能对关键词进行按行提取过滤，而cut命令则可以根据指定的关键词信息，针对特定的列内容进行过滤</p>
<p>​       一般而言，基于”行”的方式来提取数据是比较简单的，只需要设置好要搜索的关键词即可。但是如果按”列”搜索，不仅要使用-f参数设置需要查看的列数，还需要使用-d参数来设置间隔符号</p>
<p>语法格式:cut 参数 文件名</p>
<p>常用参数：</p>
<p><img src="/media/aef94fa31deec6733ebf5975330df220.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.以冒号为间隔符，仅提取指定文件中第一列的内容</p>
<p><img src="/media/56487c642ce61eec3bff8ee818079dec.png" alt="截图.png"></p>
<p>2.仅提取指定文件中每行的前4个字符</p>
<p><img src="/media/b3f9e628793cedd39dab33541132428b.png" alt="截图.png"></p>
<h3 id="diff命令"><a href="#diff命令" class="headerlink" title="diff命令"></a>diff命令</h3><p>比较文件内容的差异</p>
<p>语法格式:diff 参数 文件名1 文件名2</p>
<p>常用参数：</p>
<p><img src="/media/b2b162b63416d3b6f9c182343e123def.png" alt="截图.png"></p>
<p>使用diff命令时，不仅可以使用–brief参数来确认两个文件是否相同，还可以使用-c</p>
<p>参数详细比较出多个文件的差异之处：</p>
<p>1.先使用cat命令分别查看diff_A.txt和diff_B.txt文件的内容，然后进行比较：</p>
<p><img src="/media/33bb97e8d5f3638d9dad852b49af6053.png" alt="截图.png"></p>
<p>2.接下来使用diff –brief命令显示比较后的结果，判断文件是否相同</p>
<p><img src="/media/7920c21a023f2aad89f5f5bc40670c3d.png" alt="截图.png"></p>
<p>3.最后使用带有-c参数的diff命令来描述文件内容具体的不同</p>
<p><img src="/media/7c7eb533d3017e7b5f997962446f55e4.png" alt="截图.png"></p>
<h3 id="uniq命令"><a href="#uniq命令" class="headerlink" title="uniq命令"></a>uniq命令</h3><p>去除文件中的重复内容行</p>
<p>​      uniq命令能够去除掉文件中相邻的重复内容行，如果两端相同内容，但中间夹杂了其他文本行，则需要先使用sort命令进行排序后再去重，这样保留下来的内容就都是唯一的了</p>
<p>语法格式:uniq 参数 文件名</p>
<p>常用参数：</p>
<p><img src="/media/a039816abe170e9f9c9b0a4f0c8f190b.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.对指定的文件进行去重操作</p>
<p><img src="/media/9c3ef1d414d4496dfc1eed8ff2f12081.png" alt="截图.png"></p>
<p>2.统计相同内容行在文件中重复出现的次数</p>
<p><img src="/media/967f965cca8543e2476e3633097e96f2.png" alt="截图.png"></p>
<p>3.仅显示指定文件中没有存在完全相同内容行的信息</p>
<p><img src="/media/b2e047efc212c6f51904e687b7a06100.png" alt="截图.png"></p>
<p>4.仅显示指定文件中存在完全相同内容行的信息</p>
<p><img src="/media/ba6ff68009ccc733d58f926e2f632c60.png" alt="截图.png"></p>
<h3 id="sort命令"><a href="#sort命令" class="headerlink" title="sort命令"></a>sort命令</h3><p>对文件内容进行排序</p>
<p>语法格式:sort 参数 文件名</p>
<p>常用参数:</p>
<p><img src="/media/8da492ea7d62b19a9ad199d7aacd815b.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.对指定的文件内容按照字母顺序进行排序(默认)</p>
<p><img src="/media/7872b3dd9522b26d79da4b6e53c31b74.png" alt="截图.png"></p>
<p>2.对指定的文件内容按照数字大小进行排序</p>
<p><img src="/media/111f180ac68dfb535f38d84b2f761ed9.png" alt="截图.png"></p>
<p>3.以冒号(:)为间隔符，对指定的文件内容按照数字大小对第3列进行排序</p>
<p><img src="/media/8abc686e26844424cb94ebac5c47d4c3.png" alt="截图.png"></p>
<p>4.sort命令无论内容行之间是否夹杂有其他内容，只要有两个一模一样的内容行，就可以使用-u 参数进行去重操作</p>
<p><img src="/media/f95583b3a97f0c1e4d07f9a679ee6d7a.png" alt="截图.png"></p>
<h3 id="tee命令"><a href="#tee命令" class="headerlink" title="tee命令"></a>tee命令</h3><p>用于读取标准输入的数据，将其内容转交到标准输出设备中，同时保存成文件</p>
<p>语法格式：tee [参数] 文件名</p>
<p>常用参数：</p>
<p><img src="/media/d168fde997a027e874efbe1f4f8d6f2e.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.将用户输入的数据同时写入到两个文件中</p>
<p><img src="/media/f50aa6fd52a349a0fe53073fc0100955.png" alt="截图.png"></p>
<p>2.执行某个指定的命令，并将其执行结果即输出到屏幕，又写入到文件中</p>
<p><img src="/media/8844a3260e9d287772d4734c80f9a4f2.png" alt="截图.png"></p>
<h2 id="1-6-文件目录管理命令"><a href="#1-6-文件目录管理命令" class="headerlink" title="1.6 文件目录管理命令"></a>1.6 文件目录管理命令</h2><h3 id="touch命令"><a href="#touch命令" class="headerlink" title="touch命令"></a>touch命令</h3><p>创建空文件与修改时间戳</p>
<p>文件不存在时会创建一个空内容的文本文件；如果文件存在，会对文件的Atime(访问时间)和Ctime(修改时间)进行修改操作</p>
<p>语法格式:touch 参数 文件名</p>
<p>常用参数：</p>
<p><img src="/media/e873f36406794f2e4b84eb872e051c97.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.创建出一个指定名称的空文件</p>
<p><img src="/media/611eaa3486189d2126112e1be97ca996.png" alt="截图.png"></p>
<p>2.结合通配符，创建多个指定名称的空文件</p>
<p><img src="/media/90497fb0a8d06135a3c0376558431e68.png" alt="截图.png"></p>
<p>3.修改指定文件的查看时间和修改时间</p>
<p><img src="/media/fff567a1d15458204f33f5afc45ae200.png" alt="截图.png"></p>
<h3 id="mkdir命令"><a href="#mkdir命令" class="headerlink" title="mkdir命令"></a>mkdir命令</h3><p>创建目录文件</p>
<p>若要创建的目标目录已经存在，则会提示已存在而不继续创建，不覆盖已有文件</p>
<p>若目录不存在，但具有嵌套的依赖关系时，例如&#x2F;Dir1&#x2F;Dir2&#x2F;Dir3&#x2F;Dir4&#x2F;Dir5，要想一次性创建则需要加入-p参数，进行递归操‍作</p>
<p>语法格式:mkdir 参数 目录名</p>
<p>常用参数：</p>
<p><img src="/media/ac2e7690b929de82d9b841f9644fa970.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.建立一个目录文件</p>
<p><img src="/media/e43d6032555d44c63b54aa9d748c2115.png" alt="截图.png"></p>
<p>2.创建一个目录文件并设置700权限，不让除所有主以外的任何人读、写、执行它</p>
<p><img src="/media/ac666fd447ef9500b87a0bc922c3bc57.png" alt="截图.png"></p>
<p>3.一次性创建多个目录文件</p>
<p><img src="/media/27fa9558295ea7bd03f0a7fb086f0e86.png" alt="截图.png"></p>
<p>4.在系统根目录中，一次性创建多个有嵌套关系的目录文件</p>
<p><img src="/media/fea4d6d652201a64d84dc3986038fff5.png" alt="截图.png"></p>
<h3 id="cp命令"><a href="#cp命令" class="headerlink" title="cp命令"></a>cp命令</h3><p>复制文件或目录</p>
<p>cp命令能够将一个或多个文件或目录复制到指定位置，亦常用于文件的备份工作</p>
<p>-r参数用于递归操作，复制目录时若忘记添加则会直接报错</p>
<p>-f参数则用于当目标文件已存在时会直接覆盖而不再询问</p>
<p>复制操作具 体分为3种情况：</p>
<p>1.如果目标文件是目录，则会把源文件复制到该目录中</p>
<p>2.如果目标文件也是普通文件，则会询问是否要覆盖它</p>
<p>3.如果目标文件不存在，则执行正常的复制操作</p>
<p>语法格式：cp 参数 源文件名 目标文件名</p>
<p>常用参数：</p>
<p><img src="/media/03839132a255827e8d467b9898ea2d29.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.复制指定的源文件，并定义新文件的名称</p>
<p><img src="/media/e78f4c7b48cbd5474aae6026ed614710.png" alt="截图.png"></p>
<p>2.复制指定的源目录，并定义新目录的名称</p>
<p><img src="/media/553ab23adf241e3ad88ee9f84a472602.png" alt="截图.png"></p>
<p>3.复制文件时，保留其原始权限及用户归属信息</p>
<p><img src="/media/ae54dc767f4eb4795b277d93d967cec5.png" alt="截图.png"></p>
<p>4.将指定文件复制到&#x2F;etc目录中，并覆盖已有文件，不进行询问</p>
<p><img src="/media/4f76ae52877cab99b2e067c6a25a475c.png" alt="截图.png"></p>
<p>5.将多个文件一同复制到&#x2F;etc目录中，如已有目标文件名称则默认询问是否覆盖</p>
<p><img src="/media/2193befb98e6b2075422f7a13d41778b.png" alt="截图.png"></p>
<h3 id="mv命令"><a href="#mv命令" class="headerlink" title="mv命令"></a>mv命令</h3><p>用于剪切或重命名文件</p>
<p>剪切不同于复制，默认会把源文件删除，只保留剪切后的文件</p>
<p>如果在同一个目录中将某个文件剪切后还粘贴到当前目录下，其实也就是对该文件进行了重命名操作</p>
<p>语法格式:mv 参数 源文件名 目标文件名</p>
<p>常用参数:</p>
<p><img src="/media/e1b94a4d0e0789361dc94dc4e30aa416.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.对指定文件进行剪切后粘贴(重命名)操作</p>
<p><img src="/media/ea5bdff783ca4890b27f2ec7f4ecf2aa.png" alt="截图.png"></p>
<p>2.将指定文件移动到&#x2F;etc目录中，保留文件原始名称</p>
<p><img src="/media/fad809e773ff5bfae04f93abd16eaf0e.png" alt="截图.png"></p>
<p>3.将指定目录移动到&#x2F;etc目录中，并定义新的目录名称</p>
<p><img src="/media/bcb268621afa79d93af81778e816f683.png" alt="截图.png"></p>
<p>4.将&#x2F;home目录中所有的文件都移动到当前工作目录中，若遇到文件已存在则直接覆盖</p>
<p><img src="/media/2956dc3b68d006a5be32b2a70622b51e.png" alt="截图.png"></p>
<h3 id="rm命令"><a href="#rm命令" class="headerlink" title="rm命令"></a>rm命令</h3><p>用于删除文件或目录</p>
<p>Linux系统中删除文件时，系统会默认询问是否要执行删除操作，如果不想总是看到这种反复的确认信息，可在rm命令后跟上-f参数来强制删除</p>
<p>要想删除一个目录， 需要在rm命令后面加一个-r参数才可以，否则删除不掉</p>
<p>语法格式：rm 参数 文件名</p>
<p>常用参数：</p>
<p><img src="/media/d1f59406c0228c22e01bffb05d03d21d.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.删除文件时默认会进行二次确认，敲击y进行确认</p>
<p><img src="/media/5804d258be56b91fd8f55a4a3de51331.png" alt="截图.png"></p>
<p>2.强制删除文件而无须二次确认</p>
<p><img src="/media/8eec201439eac982c1af5c5923bba2aa.png" alt="截图.png"></p>
<p>3.删除指定目录及其内的全部子文件，一并强制删除</p>
<p><img src="/media/f88759edcdfb8d0cd3c4fa4d93dec084.png" alt="截图.png"></p>
<p>4.强制删除当前工作目录内所有以.txt为后缀的文件</p>
<p><img src="/media/c184dd4a78f9e85e2363a077a0977360.png" alt="截图.png"></p>
<p>5.强制清空服务器系统内的所有文件</p>
<p><img src="/media/4299b984e8ce024524bcdf5d5d3a87a2.png" alt="截图.png"></p>
<h3 id="dd命令"><a href="#dd命令" class="headerlink" title="dd命令"></a>dd命令</h3><p>按照指定大小和个数的数据块来复制文件或转换文件</p>
<p>语法格式为：dd if&#x3D; 参数值 of&#x3D;参数值 count&#x3D;参数值 bs&#x3D;参数值</p>
<p>语法格式：dd 参数 对象</p>
<p>常用参数：</p>
<p><img src="/media/2a35f6b7f6d02511ebc9f658db088e2d.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.用dd命令从&#x2F;dev&#x2F;zero<br>设备文件中取出一个大小为560MB的数据块，然后保存成名为560_file的文件</p>
<p><img src="/media/c6ce2ef8b47c26477532fa0b0bc5db60.png" alt="截图.png"></p>
<p>2.dd命令的功能也绝不仅限于复制文件这么简单</p>
<p>​        如果想把光驱设备中的光盘制作成iso格式的镜像文件，在 Windows系统中需要借助于第三方软件才能做到，但在Linux系统中可以直接使用dd命令来压制出光盘镜像文件，将它变成一个可立即使用的iso镜像：</p>
<p><img src="/media/6c2429314d625c8c4af1153541138d8a.png" alt="截图.png"></p>
<h3 id="file命令"><a href="#file命令" class="headerlink" title="file命令"></a>file命令</h3><p>用于查看文件的类型</p>
<p>语法格式：file 参数 文件名</p>
<p>常用参数：</p>
<p><img src="/media/980979cbdf05cc6b6bfb64b74a7ef3d8.png" alt="截图.png"></p>
<p>命令使用示例:</p>
<p>1.查看指定文件的类型</p>
<p><img src="/media/e797155600aaf7451287c5fe5592822a.png" alt="截图.png"></p>
<p>2.查看指定文件的类型，但不显示文件名</p>
<p><img src="/media/26587495c8917e0d9db79b7864339cd6.png" alt="截图.png"></p>
<p>3.通过MIME来分辨指定文件的类型</p>
<p><img src="/media/a32fd0ec51c449c56b62079c8da4ae6c.png" alt="截图.png"></p>
<p>4.查看符号链接文件的类型，会提示实际的文件名称</p>
<p><img src="/media/18c2cdc0312faa924f9efdcaafff45ed.png" alt="截图.png"></p>
<p>5.直接查看指定符号链接文件所对应的目标文件的类型</p>
<p><img src="/media/efdfc4d016d549eafac0d6d95d0a9c81.png" alt="截图.png"></p>
<h3 id="tar命令"><a href="#tar命令" class="headerlink" title="tar命令"></a>tar命令</h3><p>压缩和解压缩文件，能够制作出Linux系统中常见的tar、tar.gz、tar.bz2等格式的压缩包文件</p>
<p>对于RHEL 7、CentOS7版本及以后的系统，解压缩时不添加格式参数（如z或j），系统也能自动进行分析并解压</p>
<p>语法格式:tar 参数 压缩包名 文件或目录名</p>
<p>常用参数：</p>
<p><img src="/media/43f6125172a635b6f4ad7c2fe40a6ead.png" alt="截图.png"></p>
<p>-c参数用于创建压缩文件，-x参数用于解压文件，因此这两个参数不能同时使用</p>
<p>-z参数指定使用gzip格式来压缩或解压文件，-j参数指定使用bzip2格式来压缩或解 压文件</p>
<p>用户使用时则是根据文件的后缀来决定应使用何种格式的参数进行解压</p>
<p>使用-v参数向用户不断显示 压缩或解压的过程</p>
<p>-C参数用于指定要解压到哪个指定的目录。-f参数特别重要，它必须放到参数的最后一位，代表要压缩或解压的软件包名称</p>
<p>一般使用”tar -czvf 压缩包名称.tar.gz 要打包的目录”命令把指定的文件进行打包压缩；相应的解压命令为”tar -xzvf<br>压缩 包名称.tar.gz”</p>
<p>演示打包压缩与解压的操作：</p>
<p>1.先使用tar命令把&#x2F;etc目录通过gzip格式进行打包压缩，并把文件命名为etc.tar.gz：</p>
<p><img src="/media/2945e3249e27f3757521c2d4df5b830f.png" alt="截图.png"></p>
<p>2.将打包后的压缩包文件指定解压到&#x2F;root&#x2F;etc目录中(先使用mkdir命令创建&#x2F;root&#x2F;etc目录)：</p>
<p><img src="/media/724af0df623d337d567b63d4bdbd4c35.png" alt="截图.png"></p>
<h1 id="2-管道符、重定向与环境变量"><a href="#2-管道符、重定向与环境变量" class="headerlink" title="2 管道符、重定向与环境变量"></a>2 管道符、重定向与环境变量</h1><h2 id="2-1-输入输出重定向"><a href="#2-1-输入输出重定向" class="headerlink" title="2.1 输入输出重定向"></a>2.1 输入输出重定向</h2><p>输入重定向是指把文件导入到命令中，而输出重定向则是指把原本要输出到屏幕的数据信息写入到指定文件中</p>
<p>相较于输入重定向，使用输出重定向的频率更高，所以又将输出重定向分为了标准输出重定向和错误输出重定向两种：</p>
<p>1.标准输入重定向(STDIN，文件描述符为0):默认从键盘输入，也可从其他文件或命令中输入</p>
<p>2.标准输出重定向( STDOUT，文件描述符为1):默认输出到屏幕</p>
<p>3.错误输出重定向(STDERR，文件描述符为2):默认输出到屏幕</p>
<p>​       分别查看两个文件的属性信息，先创建出第一个文件，而第二个文件是不存在的。所以，虽然针对这两个文件的操作都分别会在屏幕上输出一些信息，但这两个操作的差异其实很大：</p>
<p><img src="/media/1d5f54e6304a0376580311496784cadf.png" alt="截图.png"></p>
<p>​      上述命令中名为linuxprobe的文件是真实存在的，输出信息是该文件的一些相关权限、所有者、所属组、文件大小及修改时间等信息，这也是该命令的标准输出信息。而名为xxxxxx的第二个文件是不存在的，因此在执行完ls命令之后显示的报错提示信息也是该命令的错误输出信息。那么，要想把原本输出到屏幕上的数据转而写入到文件当中，就要区别对待这两种输出信息。</p>
<p>1.输入重定向中用到的符号及其作用 ：</p>
<p><img src="/media/ec104b93e0b6c718ccf8f59ad7926407.png" alt="截图.png"></p>
<p>2.输出重定向中用到的符号及其作用：</p>
<p><img src="/media/a2767c92dde633c5c2ed4a4f9e99bc65.png" alt="截图.png"></p>
<p>对于重定向中的标准输出模式，可以省略文件描述符1不写，而错误输出模式的文件描述符2是必须要写的</p>
<p>通过标准输出重定向将man bash命令原本要输出到屏幕的信息写入到文件readme.txt中，然后显示readme.txt文件中的内容。具体命令如下：</p>
<p><img src="/media/e120df13e45ffb5e36602c77f8d723b4.png" alt="截图.png"></p>
<p>​        通过覆盖写入模式向readme.txt文件写入多行数据(该文件中已包含man命令信息)。通过覆盖写入模式向文件中写入数据时，每一次都会覆盖掉上一次写入的内容，所以最终文件中只有最后一次的写入结果：</p>
<p><img src="/media/1a57ddb7f1fef29664f9f6ec34f053d6.png" alt="截图.png"></p>
<p>通过追加写入模式向readme.txt文件写入一次数据，然后在执行cat命令之后，可以看到如下所示的文件内容：</p>
<p><img src="/media/a1901777541217f5133d8f8f241baa3c.png" alt="截图.png"></p>
<p>​       虽然都是输出重定向技术，但是命令的标准输出和错误输出还是有区别的。例如查看当前目录中某个文件的信息，这里以linuxprobe<br>文件为例。由于这个文件是真实存在的，因此使用标准输出即可将原本要输出到屏幕的信息写入到文件中，而错误的输出重定向则依然把<br>信息输出到了屏幕上：</p>
<p><img src="/media/cb7bef51d90755dae971cf50b61a9e1b.png" alt="截图.png"></p>
<p>​      如何把命令的报错信息写入到文件？当用户在执行一个自动化的 Shell脚本时，这个操作会特别有用，而且特别实用，因为它可以把整个脚本执行过程中的报错信息都记录到文件中：</p>
<p><img src="/media/1b4c419f5a7537d0affb02260242ff57.png" alt="截图.png"></p>
<p>​     不区分标准输出和错误输出，只要命令有输出信息则全部追加写入到文件中。这就要用到&amp;&gt;&gt;操作符：</p>
<p><img src="/media/146df6b33e8e761e268d56b3d24a7537.png" alt="截图.png"></p>
<p>​     输入重定向的作用是把文件直接导入到命令中。使用输入重定向把readme.txt文件导入给wc -l 命令，统计文件中的内容行数：</p>
<p><img src="/media/13e3dce39116fdfbf15fc218090a8fa9.png" alt="截图.png"></p>
<p>​      “wc -l &#x2F;etc&#x2F;passwd”是非常标准的”命令+参数+对象”的执行格式，而”wc -l &lt; readme.txt”是将readme.txt文件中的内容通过操作符导入到命令<br>中，没有被当作命令对象进行执行，因此wc命令只能读到信息流数据，而没有文件名称的信息。</p>
<h2 id="2-2-管道命令符"><a href="#2-2-管道命令符" class="headerlink" title="2.2 管道命令符"></a>2.2 管道命令符</h2><p>把前一个命令原本要输出到屏幕的信息当作后一个命令的标准输入</p>
<p>1.找出所有被限制登录系统的用户：grep &#x2F;sbin&#x2F;nologin &#x2F;etc&#x2F;passwd</p>
<p>2.统计文本行数的命令则是wc –l</p>
<p>3.把grep搜索命令的输出值传递给wc统计命令，即把原本要输出到屏幕的用户信息列表再交给wc命令作进一步的加工，因此只需要把管道符放到两条命令之间即可，具体如下：</p>
<p><img src="/media/77b1ac1323d743ad9adeb731d6041fd5.png" alt="截图.png"></p>
<p>4.用翻页的形式查看&#x2F;etc 目录中的文件列表及属性信息：</p>
<p><img src="/media/d5ed701509c77f4f80de14153790f86b.png" alt="截图.png"></p>
<p>5.在修改用户密码时，通常都需要输入两次密码以进行确认，这在编写自动化脚本时将成为一个非常致命的缺陷</p>
<p>  通过把管道符和passwd命令的–stdin参数相结合，可以用一条命令来完成密码重置操作：</p>
<p><img src="/media/6a3fd21171c04ed545bc3d9059c91e2e.png" alt="截图.png"></p>
<p>6.如果需将管道符处理后的结果既输出到屏幕，又同时写入到文件中，可以与tee命令结合使用：</p>
<p><img src="/media/ecbae188f1fbf85df583c23ee710dce2.png" alt="截图.png"></p>
<h2 id="2-3-命令行的通配符"><a href="#2-3-命令行的通配符" class="headerlink" title="2.3 命令行的通配符"></a>2.3 命令行的通配符</h2><p>通配符就是通用的匹配信息的符号</p>
<p>1.星号（*）代表匹配零个或多个字符</p>
<p>2.问号（?）代表匹配单个字符</p>
<p>3.中括号内加上数字[0-9]代表匹配0～9之间的单个数字的字符</p>
<p>4.中括号内加上字母[abc]则是代表匹配a、b、c三个字符中的任意一个字符</p>
<p><img src="/media/d8f598a8628fa720df30d134a79f3e2c.png" alt="截图.png"></p>
<p>使用示例:</p>
<p>1.匹配所有在&#x2F;dev目录中且以sda开头的文件</p>
<p><img src="/media/13773cf186646a50747ab65ce8891dce.png" alt="截图.png"></p>
<p>2.只想查看文件名以sda开头，但后面还紧跟其他某一个字符的文件的相关信息</p>
<p><img src="/media/c594b285a56d6901884b49e8439746a1.png" alt="截图.png"></p>
<p>3.除了使用[0-9]来匹配0～9之间的单个数字，也可以用[135]这样的方式仅匹配这3个指定数字中的一个</p>
<p>   若没有匹配到数字1或2或3，则不会显示出来</p>
<p><img src="/media/df56fb4b8860a9e06d3a8e10f388ebd7.png" alt="截图.png"></p>
<p>4.通配符也可以放到前面。比如，搜索&#x2F;etc&#x2F;目录中所有以.conf结尾的配置文件有哪些</p>
<p><img src="/media/d2be8feeb5014dff2eab41ba16ea7067.png" alt="截图.png"></p>
<p>5.可以与创建文件的命令相结合，创建出很多个文件。不过在创建多个文件时，需要使用大括号，并且字段之间用逗号间隔</p>
<p><img src="/media/5aad73584390bbbd281618fb1ffb43ab.png" alt="截图.png"></p>
<p>6.使用通配符可以输出一些指定的信息</p>
<p><img src="/media/438e72a8af38b9731ef2966579d15b6c.png" alt="截图.png"></p>
<h2 id="2-4-常用的转义字符"><a href="#2-4-常用的转义字符" class="headerlink" title="2.4 常用的转义字符"></a>2.4 常用的转义字符</h2><p>为了能更好地理解用户的表达，Shell解释器提供了丰富的转义字符来处理输入的特殊数据</p>
<p>反斜杠( \ ):使反斜杠后面的一个变量变为单纯的字符</p>
<p>单引号(‘ ‘):转义其中所有的变量为单纯的字符串</p>
<p>双引号(“ “):保留其中的变量属性，不进行转义处理</p>
<p>反引号(` `):把其中的命令执行后返回结果</p>
<p>使用示例：</p>
<p>1.定义一个名为PRICE的变量并赋值为5，然后输出以双引号括起来的字符串与变量信息</p>
<p><img src="/media/449eea7fff0e241e37cf981ef2977b92.png" alt="截图.png"></p>
<p>2.输出”Price is $5”，即”价格是5美元”的字符串内容</p>
<p><img src="/media/e52fa2416c472390861b22731c3655ff.png" alt="截图.png"></p>
<p>3.将反引号与uname -a命令结合，使用echo命令查看本机的Linux版 本和内核信息</p>
<p><img src="/media/060b675dd96fcc0a658541c919e21f7c.png" alt="截图.png"></p>
<p>4.在大多数情况下好像加不加双引号，效果都一样</p>
<p>​    两者的区别在于无法得知第一种执行方式中到底有几个参数。因 为有可能把”AA BB CC”当作一个参数整体直接输出到屏幕，也有可能分别将AA、BB和CC输出到屏幕。如果参数中出现了空格，就加双引号；如果参数中没有空格，那就不用加双引号</p>
<p><img src="/media/d05f0179c680bd85db9910a227aa1831.png" alt="截图.png"></p>
<h2 id="2-5-重要的环境变量"><a href="#2-5-重要的环境变量" class="headerlink" title="2.5 重要的环境变量"></a>2.5 重要的环境变量</h2><p>变量是计算机系统用于保存可变值的数据类型</p>
<p>在Linux系统中，变量名称一般都是大写的，命令则都是小写的，这是一种约定俗成的规范</p>
<p>Linux系统的环境变量用来定义系统运行环境的一些参数，比如每个用户不同的家目录、邮件存放位置等</p>
<p>可以直接通过变量名称来提取到对应的变量值</p>
<p>命令在Linux中的执行分为4个步骤：</p>
<p>1.判断用户是否以绝对路径或相对路径的方式输入命令(如&#x2F;bin&#x2F;ls)，如果是绝对路径则直接执行，否则进入第2步继续判断</p>
<p>2.Linux系统检查用户输入的命令是否为”别名命令”，即用一个自定义的命令名称来替换原本的命令名称</p>
<p>​    使用rm命令删除文件时，Linux系统都会要求用户确认是否执行删除操作，这是Linux系统为防止用户误删除文件而特意设置的rm别名命令：”rm<br>-i”</p>
<p><img src="/media/97bea5db0a6993a3e4b7797fb2eecba6.png" alt="截图.png"></p>
<p>alias命令用于创建一个属于自己的命令别名，语法格式为”alias 别名&#x3D;命令”。取消一个命令别名，则用unalias命令，语法格式为”unalias 别名”</p>
<p>将当前rm命令所被设置的别名取消掉，再删除文件试试：</p>
<p><img src="/media/3cebca85a8dd9495507cb4b734dc4a8d.png" alt="截图.png"></p>
<p>3.Bash解释器判断用户输入的是内部命令还是外部命令</p>
<p>内部命令是解释器内部的指令，会被直接执行</p>
<p>用户在绝大部分时间输入的是外部命令，这些命令交由步骤4继续处理</p>
<p><img src="/media/161ca98434c031f58695000784965a5a.png" alt="截图.png"></p>
<p>4.系统在多个路径中查找用户输入的命令文件，定义这些路径的变量叫作PATH，作用是告诉Bash解释器待执行的命令可能存放的位置，然后Bash解释器就会在这些位置中逐个查找</p>
<p><img src="/media/2ebdc198151646b18fa5c4ac4b822bcb.png" alt="截图.png"></p>
<p>为什么不能将当前目录(.)添加到PATH中呢?</p>
<p>​     尽管可以将当前目录(.)添加到PATH变量中，从而在某些情况下可以让用户免去输入命令所在路径的麻烦。但如果黑客在比较常用的公共目录&#x2F;tmp中存放了一个与ls或cd命令同名的木马文件，而用户又恰巧在公共目录中执行了这些命令，那么就极有可能中招了</p>
<p>Linux系统中最重要的10个环境变量：</p>
<p><img src="/media/62abddc6c20e088b9e020d99a038232d.png" alt="截图.png"></p>
<p><img src="/media/65f27c34d0639841ee974bffc67851b5.png" alt="截图.png"></p>
<p>​       Linux作为一个多用户、多任务的操作系统，能够为每个用户提供独立的、合适的工作运行环境。因此，一个相同的变量会因为用户身份的不同而具有不同的值。使用下述命令来查看 HOME变量在不同的用户身份下都有哪些值：</p>
<p><img src="/media/9c45299e02dc69223d33739840258567.png" alt="截图.png"></p>
<p>​      变量是由固定的变量名与用户或系统设置的变量值两部分组成的，可以自行创建变量来满足工作需求。例如，设置一个名称为WORKDIR的变量，方便用户更轻松地进入一个层次较深的目录：</p>
<p><img src="/media/d4798728277657b73c9bc70384c1929f.png" alt="截图.png"></p>
<p>但是这样的变量不具有全局性，作用范围也有限，默认情况下不能被其他用户使用：</p>
<p><img src="/media/6ad34336f873ff59903780fbe8a73551.png" alt="截图.png"></p>
<p>如果工作需要，可使用export命令将其提升为全局变量，这样其他用户也就可以使用它了：</p>
<p><img src="/media/60e1004f33f217d166870199dd217d63.png" alt="截图.png"></p>
<p>直接在终端设置的变量能够立即生效，但在重启服务器后就会失效，需要将变量和变量值写入到.bashrc或者.bash_profile文件中，以确保永久能使用</p>
<h1 id="3-Vim编辑器与Shell命令脚本"><a href="#3-Vim编辑器与Shell命令脚本" class="headerlink" title="3 Vim编辑器与Shell命令脚本"></a>3 Vim编辑器与Shell命令脚本</h1><h2 id="3-1-Vim文本编辑器"><a href="#3-1-Vim文本编辑器" class="headerlink" title="3.1 Vim文本编辑器"></a>3.1 Vim文本编辑器</h2><p>Linux系统中一切都是文件，而配置一个服务就是在修改其配置文件的参数</p>
<p>Vim文本编辑器默认会安装在当前所有的Linux操作系统上，是一款超棒的文本编辑器</p>
<p>Vim编辑器中设置了3种模式：</p>
<p>命令模式:控制光标移动，可对文本进行复制、粘贴、删除和查找等</p>
<p>末行模式:正常的文本录入</p>
<p>编辑模式:保存或退出文档，以及设置编辑环境</p>
<p>Vim编辑器模式的切换：</p>
<p>1.每次运行Vim编辑器时，默认进入命令模式，此时需先切换到输入模式后再进行文档编写工作</p>
<p>2.每次编写完文档后需要先返回命令模式，然后再进入末行模式，执行文档的保存或退出操作</p>
<p>3.在Vim中，无法直接从输入模式切换到末行模式</p>
<p><img src="/media/5cb64e0b3764329a8b4707124b8ff7aa.png" alt="截图.png"></p>
<p>命令模式中最常用的一些命令：</p>
<p><img src="/media/d8c0e0037fc6253684aaa34a9da61e92.png" alt="截图.png"></p>
<p>末行模式主要用于保存或退出文件，以及设置Vim编辑器的工作环境，还可以让用户执行外部的Linux命令或跳转到所编写文档的特定行数</p>
<p>要切换到末行模式，在命令模式 输入一个冒号就可以</p>
<p>末行模式常用的命令：</p>
<p><img src="/media/0c9533d7aafd1dfad8b55710557d7032.png" alt="截图.png"></p>
<h3 id="编写简单文档"><a href="#编写简单文档" class="headerlink" title="编写简单文档"></a>编写简单文档</h3><p>​       给文档取个名字，这里将其命名为practice.txt。如果存在该文档，则是打开它。如果不存在，则是创建一个临时的输入文件：</p>
<p><img src="/media/9bbe551aa119051b35fad5fd253fd341.png" alt="截图.png"></p>
<p>​     打开practice.txt文档后，默认进入Vim编辑器的命令模式。此时只能执行该模式下的命令，而不能随意输入文本内容</p>
<p>​     需要切换到输入模式才可以编写文档，可以分别使用a、i、o这3个键从命令模式切换到输入模式。其中，a键与i键分别是在光标后面一位和光标当前位置切换到输入模式，而o键则是在光标的下面再创建一个空行，此时可敲击a键进入编辑器的输入模式：</p>
<p>​     进入输入模式后，可随意输入文本内容，Vim编辑器不会把输入的文本内容当作命令而执行：</p>
<p><img src="/media/8b1c61b6217e3bf238d2017475057c99.png" alt="截图.png"></p>
<p>在编写完之后，要想保存并退出，必须先敲击键盘的 Esc键从输入模式返回命令模式：</p>
<p><img src="/media/fa201f64fbf816d78001bfb69255c6df.png" alt="截图.png"></p>
<p>再输入”:wq!”切换到末行模式才能完成保存退出操作：</p>
<p><img src="/media/17b8968b1bad98956ba07c77e2fee4e6.png" alt="截图.png"></p>
<p>当在末行模式中输入”:wq!”命令时，就意味着强制保存并退出文档。然后可以用cat命令查看保存后的文档内容：</p>
<p><img src="/media/21e9804ea0673ec8de4e54aceedf5cb3.png" alt="截图.png"></p>
<h3 id="配置主机名称"><a href="#配置主机名称" class="headerlink" title="配置主机名称"></a>配置主机名称</h3><p>​       在局域网中查找某台特定的主机，或者对主机进行区分，除了要有IP地址外，还要为主机配置一个主机名，主机之间可以通过这个类似于域名的名称来相互访问在Linux 系统中，主机名大多保存在&#x2F;etc&#x2F;hostname文件中，接下来将&#x2F;etc&#x2F;hostname 配置文件的内容修改为”linuxprobe.com”，步骤如下：</p>
<p>1.使用Vim编辑器修改&#x2F;etc&#x2F;hostname主机名称文件</p>
<p>2.把原始主机名称删除后追加”linuxprobe.com</p>
<p>3.保存并退出文档，然后使用hostname命令检查是否修改成功</p>
<p><img src="/media/56cc87e0c08ac6fd8c08e19db1a4225f.png" alt="截图.png"></p>
<p>​     hostname命令用于查看当前的主机名称，但有时主机名称的改变不会立即同步到系统中，如果发现修改完成后还显示原来的主机名称，可重启虚拟机后再行查看：</p>
<p><img src="/media/ab5efb1da7f254233206e8dd07a00005.png" alt="截图.png"></p>
<h3 id="配置网卡信息"><a href="#配置网卡信息" class="headerlink" title="配置网卡信息"></a>配置网卡信息</h3><p>现在有一个名称为ifcfg-ens160的网卡设备，将其配置为开机自启动，并且IP地址、子网、网关等信息由人工指定，其步骤如下</p>
<p>第一步:切换到&#x2F;etc&#x2F;sysconfig&#x2F;network-scripts目录中(存放网卡的配置文件)</p>
<p>第二步:使用Vim编辑器修改网卡文件ifcfg-ens160，逐项写入下面的配置参数并保存退出</p>
<p>由于每台设备的硬件及架构是不一样的，因此请使用ifconfig命令自行确认各自网卡的默认名称</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">设备类型：TYPE=Ethernet</span><br><span class="line">地址分配模式：BOOTPROTO=static</span><br><span class="line">网卡名称：NAME=ens160</span><br><span class="line">是否启动：ONBOOT=yes</span><br><span class="line">IP地址：IPADDR=192.168.1.28</span><br><span class="line">子网掩码：NETMASK=255.255.255.0</span><br><span class="line">网关地址：GATEWAY=192.168.1.1</span><br><span class="line">DNS地址：DNS1=192.168.1.1</span><br></pre></td></tr></table></figure>

<hr>
<p>第三步:重启网络服务并测试网络是否连通</p>
<p>进入到网卡配置文件所在的目录，然后编辑网卡配置文件，在其中填入下面的信息：</p>
<p><img src="/media/dbef69cd7b198a5995e3be3312acb3e9.png" alt="截图.png"></p>
<p><img src="/media/f10dd3ac2c60035a64e1447dd5c16489.png" alt="截图.png"></p>
<p>执行重启网卡设备的命令，然后通过ping命令测试网络能否连通：</p>
<p><img src="/media/0c38c819ed46ab47a865787a1a0a7693.png" alt="截图.png"></p>
<p>启动或停止网卡：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nmcli connection reload ——重载网卡</span><br><span class="line">nmcli connection up ens33 ——激活网卡ens33</span><br><span class="line">nmcli connection down ens33 ——停用网卡ens33</span><br><span class="line">nmcli connection down ens33 &amp;&amp; nmcli connection up ens33 ——重启网卡ens33</span><br></pre></td></tr></table></figure>

<h3 id="配置软件仓库"><a href="#配置软件仓库" class="headerlink" title="配置软件仓库"></a>配置软件仓库</h3><p>软件仓库是一种能进一步简化RPM管理软件的难度以及自动分析所需软件包及其依赖关系的技术</p>
<p>可把Yum或DNF想成是一个硕大的软件仓库，里面保存有几乎所有常用的工具，只需要说出所需的软件包名称，系统就会自动为您搞定一切</p>
<p>Yum与DNF软件仓库的配置文件是通用的，填写好配置文件信息后，这两个软件仓库的命令都是可以正常使用</p>
<p>在RHEL 8中使用dnf作为软件的安装命令，因为它具备更高的效率，而且支持多线程同时安装软件</p>
<p>配置软件仓库的步骤：</p>
<p>1.进入&#x2F;etc&#x2F;yum.repos.d&#x2F;目录(该目录存放着软件仓库的配置文件)</p>
<p>2.使用Vim编辑器创建一个名为rhel8.repo的新配置文件(文件名称可随意，但后缀必须为.repo），逐项写入下面的配置参数并保存退出</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">仓库名称：具有唯一性的标识名称，不应与其他软件仓库发生冲突</span></span><br><span class="line"><span class="string">描述信息（name）：可以是一些介绍性的词，易于识别软件仓库的用处</span></span><br><span class="line"><span class="string">仓库位置（baseurl）：软件包的获取方式，可以使用FTP或HTTP下载，也可以是本地的文件（需要在后面添加file参数）</span></span><br><span class="line"><span class="string">是否启用（enabled）：设置此源是否可用；1为可用，0为禁用</span></span><br><span class="line"><span class="string">是否校验（gpgcheck）：设置此源是否校验文件；1为校验，0为不校验</span></span><br><span class="line"><span class="string">公钥位置（gpgkey）：若上面的参数开启了校验功能，则此处为公钥文件位置。若没有开启，则省略不写</span></span><br></pre></td></tr></table></figure>

<p>3.按配置参数中所填写的仓库位置挂载光盘，并把光盘挂载信息写入&#x2F;etc&#x2F;fstab文件中</p>
<p>4.使用”dnf install httpd -y”命令检查软件仓库是否已经可用</p>
<p>​    进入&#x2F;etc&#x2F;yum.repos.d目录创建软件仓库的配置文件：</p>
<p><img src="/media/d87b7259edf3a64bda7ccc33b0891462.png" alt="截图.png"></p>
<p><img src="/media/e1732dd71d337092a87cfca95b5990a1.png" alt="截图.png"></p>
<p>​     创建挂载点后进行挂载操作，并设置成开机自动挂载：</p>
<p><img src="/media/1a12f5847ef0de8c7564725709a6c43d.png" alt="截图.png"></p>
<p><img src="/media/92e6a0c2357dc1a5207b8b8cfa857c01.png" alt="截图.png"></p>
<p>​    尝试使用软件仓库的dnf命令来安装Web服务，软件包名称为httpd，安装后出现”Complete!”则代表配置正确：</p>
<p><img src="/media/8bcfda6d6fcdeb216c8f0b8948693048.png" alt="截图.png"></p>
<h2 id="3-2-编写Shell脚本"><a href="#3-2-编写Shell脚本" class="headerlink" title="3.2 编写Shell脚本"></a>3.2 编写Shell脚本</h2><p>​       可将Shell终端解释器当作人与计算机硬件之间的”翻译官”，作为用户与Linux系统内部的通信媒介，除了能支持各种变量与参数外，还提供了诸如循环、分支等高级编程语言才有的控制结构特性</p>
<p>Shell脚本命令的工作方式有下面两种：</p>
<p>交互式(Interactive):用户每输入一条命令就立即执行</p>
<p>批处理(Batch):由用户事先编好一个完整的Shell脚本，Shell会一次性执行脚本中诸多的命令</p>
<p>当前系统已经默认使用Bash作为命令行终端解释器：</p>
<p><img src="/media/06896fd8e82e1e88b1b575902bcd406b.png" alt="截图.png"></p>
<h3 id="编写简单的脚本"><a href="#编写简单的脚本" class="headerlink" title="编写简单的脚本"></a>编写简单的脚本</h3><p>使用Vim编辑器把Linux命令按照顺序依次写入到一个文件中，就是一个简单的脚本</p>
<p>如果想查看当前所在工作路径并列出当前目录下所有的文件及属性信息，实现这个功能的脚本应该类似于下面这样：</p>
<p><img src="/media/6a8cc509b10d99dcab3cc7146c32a8f7.png" alt="截图.png"></p>
<p><img src="/media/55e67a62f29422833ed57f8f4063496d.png" alt="截图.png"></p>
<p>Shell脚本文件的名称可以任意，但为了避免被误以为是普通文件，建议将.sh后缀加上，以表示是一个脚本文件。</p>
<p>在上面的example.sh脚本中实际上出现了3种不同的元素：</p>
<p>第一行的脚本声明(#!)用来告诉系统使用哪种Shell解释器来执行该脚本</p>
<p>第二行的注释信息(#)是对脚本功能和某些命令的介绍信息</p>
<p>第三、四行的可执行语句是执行的Linux命令</p>
<p><img src="/media/4250c5de28db525d8465b9a4e1f2613c.png" alt="截图.png"></p>
<p>第二种运行脚本程序的方法是通过输入完整路径的方式来执行。默认会因为权限不足而提示报错信息，需要为脚本文件增加执行权限</p>
<p><img src="/media/0317008aed9ea0c46c6c8aa566d10400.png" alt="截图.png"></p>
<h3 id="接收用户的参数"><a href="#接收用户的参数" class="headerlink" title="接收用户的参数"></a>接收用户的参数</h3><p>为了让Shell脚本程序更好地满足实时需求，以便灵活完成工作，必须要让脚本程序能够像之前执行命令时那样，接收输入的参数</p>
<p>Linux系统的Shell脚本语言内设了用于接收参数的变量，变量之间使用空格间隔：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$0</span>对应的是当前Shell脚本程序的名称</span><br><span class="line"><span class="variable">$#</span>对应的是总共有几个参数</span><br><span class="line">$*对应的是所有位置的参数值</span><br><span class="line">$?对应的是显示上一次命令的执行返回值</span><br><span class="line"><span class="variable">$1</span>、<span class="variable">$2</span>、<span class="variable">$3</span>……则分别对应着第N个位置的参数值</span><br></pre></td></tr></table></figure>

<p><img src="/media/3994039caa324a1e6a0c42d898f40e95.png" alt="截图.png"></p>
<p>通过引用上面的变量参数来看一下真实效果：</p>
<p><img src="/media/5db39cf3afc04fc30b74b45f3dbce8bb.png" alt="截图.png"></p>
<h3 id="判断用户的参数"><a href="#判断用户的参数" class="headerlink" title="判断用户的参数"></a>判断用户的参数</h3><p>Shell脚本的条件测试语法可判断表达式是否成立，若条件成立则返回数字0，否则返回非值</p>
<p>条件测试语法的执行格式如下图所示。条件表达式两边均应有一个空格：</p>
<p><img src="/media/98741653ef09de1a9122e42c2c4eab81.png" alt="截图.png"></p>
<p>按照测试对象来划分，条件测试语句可分为4种：文件测试语句、逻辑测试语句、整数值比较语句、字符串比较语句</p>
<p>1.文件测试即使用指定条件判断文件是否存在或权限是否满足等情况的运算符，具体参数如下:</p>
<p><img src="/media/bab9fe869483672fe1251dc484a727f5.png" alt="截图.png"></p>
<p>使用文件测试语句来判断&#x2F;etc&#x2F;fstab是否为一个目录类型的文件或是否为一般文件，通过Shell内设$?变量显示上一条命令执行后的返回值</p>
<p>如果返回值为0，则目录存在或为一般文件；如果返回值为非零的值，则意味着它不是目录或这个目录不存在以及不为一般文件：</p>
<p><img src="/media/69d614c258645ece668f5c9fedd4b26d.png" alt="截图.png"></p>
<p>2.逻辑语句用于对测试结果进行逻辑分析，根据测试结果可实现不同的效果</p>
<p>​      Shell终端中逻辑”与”运算符是&amp;&amp;，表示当前面的命令执行成功后才会执行后面的命令,因此可以用来判断&#x2F;dev&#x2F;cdrom文件是否存在，若存在则输出Exist字样</p>
<p><img src="/media/ac6a53899d624937939fb2a4f1810ecb.png" alt="截图.png"></p>
<p>​      逻辑”或”在Linux系统中的运算符号为||，表示前面的命令执行失败后才会执行后面的命令：</p>
<p><img src="/media/3c9d6718dff6fe96cdf22c8637832971.png" alt="截图.png"></p>
<p>​     逻辑”非”在Linux系统中的运算符号是一个叹号(!)，表示把条件测试中的判断结果取相反值：</p>
<p><img src="/media/25a387a213fdb9b50d888e3aa2ba30c1.png" alt="截图.png"></p>
<p>​     叹号应放到判断语句的前面，代表对整个的测试语句进行取反值操作，而不应该写成”$USER !&#x3D;root”，因为”!&#x3D;”代表的是不等于符号（≠），尽管执行效果一样，但缺少了逻辑关系</p>
<p>注明：</p>
<p>1.&amp;&amp;是逻辑”与”，只有当前面的语句执行成功的时候才会执行后面的语句</p>
<p>2.||是逻辑”或”，只有当前面的语句执行失败的时候才会执行后面的语句</p>
<p>3.!是逻辑”非”，代表对逻辑测试结果取反值；之前若为正确则变成错误，若为错误则变成正确</p>
<p>​      下面这个示例的执行顺序是，先判断当前登录用户的USER变量名称是否等于root，然后用逻辑”非”运算符进行取反操作，效果就变成了判断当前登录的用户是否为非管理员用户。最后若条件成立，则会根据逻辑”与”运算符输出user字样；若条件不满足，则会通过逻辑”或”运算符输出root字样，而只有在前面的&amp;&amp;不成立时才会执行后面的||符号：</p>
<p><img src="/media/a4276307257f9472a3cb481b149bd6ea.png" alt="截图.png"></p>
<p>3.可用的整数比较运算符：</p>
<p><img src="/media/dfb7f9b480dfc9d84b80d97b4a9eaf60.png" alt="截图.png"></p>
<p><img src="/media/0587d8837b3f6460c5ac1b930e9e47e2.png" alt="截图.png"></p>
<p>先使用free -m命令查看内存使用量情况(单位为MB)，再通过”grep Mem:”命令过滤出剩余内存量的行，再用awk ‘{print $4}’命令只保留第4列：</p>
<p><img src="/media/106a1243738317e019b1b988559e33cc.png" alt="截图.png"></p>
<p>如果把这个命令写入到Shell脚本中，建议把输出结果赋值给一个变量，以方便其他命令调用：</p>
<p><img src="/media/25837ac59f99b088b5874af1ca9a9eba.png" alt="截图.png"></p>
<p>使用整数运算符判断内存可用量的值是否小于1024，若小 于则提示”Insufficient Memory”(内存不足)：</p>
<p><img src="/media/300fe319602f0a35a758698408462dc1.png" alt="截图.png"></p>
<p>4.字符串比较语句用于判断测试字符串是否为空值或两个字符串是否相同。经常用来判断某个变量是否未被定义(即内容为空值)</p>
<p>   字符串比较中常见的运算符：</p>
<p><img src="/media/07153fe5cf19e8ace8cd4b4934cdda94.png" alt="截图.png"></p>
<p>   通过判断String变量是否为空值，进而判断是否定义了这个变量：</p>
<p><img src="/media/fdd792b00ecc51f4693096c81bcca228.png" alt="截图.png"></p>
<p>   当用于保存当前语系的环境变量值LANG不是英语（en.US）时，则会满足逻辑测试条件并输出”Not en.US”（非英语）的字样：</p>
<p><img src="/media/b6b1822168c90ad6b53ac3d6bc05a304.png" alt="截图.png"></p>
<h2 id="3-3-流程控制语句"><a href="#3-3-流程控制语句" class="headerlink" title="3.3 流程控制语句"></a>3.3 流程控制语句</h2><h3 id="if条件测试语句"><a href="#if条件测试语句" class="headerlink" title="if条件测试语句"></a>if条件测试语句</h3><p>if条件测试语句可以让脚本根据实际情况自动执行相应的命令</p>
<p>从技术角度来讲，if语句分为单分支结构、双分支结构、多分支结构；其复杂度随着灵活度一起逐级上升</p>
<p>1.单分支if条件语句</p>
<p>   单分支结构由if、then、fi关键词组成，而且只在条件成立后才执行预设的命令：</p>
<p><img src="/media/528e7fdb033ad4e44d8b08d377423ce8.png" alt="截图.png"></p>
<p>  使用单分支的if条件语句判断&#x2F;media&#x2F;cdrom目录是否存在，若不存在就创建这个目录，反之结束条件判断和整个Shell脚本的执行：</p>
<p><img src="/media/1bc8ede815a6625b9a9296f63a429d72.png" alt="截图.png"></p>
<p><img src="/media/63c3a7532dab5c27db66e8064a7c8b55.png" alt="截图.png"></p>
<p>2.双分支if条件语句</p>
<p>   双分支结构由if、then、else、fi关键词组成，进行一次条件匹配判断</p>
<p>   如果与条件匹配，则去执行相应的预设命令；反之则去执行不匹配时的预设命令</p>
<p><img src="/media/f1f30a3b90a58a37ac14dd1297faa645.png" alt="截图.png"></p>
<p>   使用双分支的if条件语句来验证某台主机是否在线，然后根据返回值的结果，显示主机是否在线</p>
<p>   Linux系统的ping命令通过-c参数规定尝试的次数，使用-i参数定义每个数据包的发送间隔，使用-W参数定义等待超时时间</p>
<p><img src="/media/d65a70d967f4073c330fe6831141c7d2.png" alt="截图.png"></p>
<p>​    若前面的那条语句成功执行，则$?变量会显示数字0，反之则显示一个非零的数字(可能为1或2，取决于系统版本）。因此可以使用整数比较运算符来判断$?变量是否为0，从而获知那条语句的最终判断情况。这里的服务器IP地址为192.168.1.30，验证一下脚本的效果：</p>
<p><img src="/media/88c5f46ce9aa560b07424cb0e54e9301.png" alt="截图.png"></p>
<p>3.多分支if条件语句</p>
<p>多分支结构由if、then、else、elif、fi关键词组成，进行多次条件匹配判断，多次判断中的任何一项在匹配成功后都会执行相应的预设命令</p>
<p><img src="/media/36f9d045b5d4ca02186598c547681e75.png" alt="截图.png"></p>
<p>使用多分支的if条件语句判断用户输入的分数在哪个成绩区间内，输出如Excellent、Pass、Fail等提示信息</p>
<p>Linux系统中read用来读取用户输入信息的命令，能够把接收到的用户输入信息赋值给后面的指定变量，-p参数用于向用户显示一些提示信息：</p>
<p><img src="/media/e4b5587064238e7defab5bd8052cd38d.png" alt="截图.png"></p>
<h3 id="for条件循环语句"><a href="#for条件循环语句" class="headerlink" title="for条件循环语句"></a>for条件循环语句</h3><p>for循环语句允许脚本一次性读取多个信息，然后逐一对信息进行操作处理。当要处理的数据有范围时，使用for循环语句就很适合：</p>
<p><img src="/media/2a2c1a5960b217765ca56ccffc4603d3.png" alt="截图.png"></p>
<p>使用for循环语句从列表文件中读取多个用户名，然后为其逐一创建用户账户并设置密码</p>
<p>首先创建用户名称的列表文件users.txt，每个用户名称单独一行：</p>
<p><img src="/media/d3641486cc21471e1ac2f99b35c667b3.png" alt="截图.png"></p>
<p>​      脚本中使用read命令读取用户输入的密码值，然后赋值给PASSWD变量，并通过-p参数向用户显示一段提示信息，告诉用户正在输入的内容即将作为账户密码</p>
<p>​     在执行该脚本后，会自动使用从列表文件users.txt中获取到所有的用户名称，然后逐一使用”id 用户名”命令查看用户的信息，并使用$?判断这条命令是否执行成功，也就是判断该用户是否已经存在</p>
<p>​     &#x2F;dev&#x2F;null被称作Linux黑洞，把输出信息重定向到这个文件等同于删除数据(类似于没有回收功能的垃圾箱)，可以让用户的屏幕窗口保持简洁</p>
<p><img src="/media/c5c9c26a711a452aa47bb4554666bf4d.png" alt="截图.png"></p>
<p>​     执行批量创建用户的Shell脚本addusers.sh，在输入为账户设定的密码后将由脚本自动检查并创建这些账户</p>
<p>​     由于已经将多余的信息通过输出重定向符转移到了&#x2F;dev&#x2F;null黑洞文件中，因此在正常情况下屏幕窗口除了”用户账户创建成功”(Create<br>success)的提示后不会有其他内容</p>
<p>​      Linux系统中&#x2F;etc&#x2F;passwd是用来保存用户账户信息的文件。如果想确认这个脚本是否成功创建了用户账户，可以打开这个文件，看其中是否有这些新创建的用户信息</p>
<p><img src="/media/681eeb916d1dd6ea3ff790f24607e721.png" alt="截图.png"></p>
<p>​      脚本从文本中自动读取 主机列表，自动逐个测试主机是否在线</p>
<p>​      首先创建一个主机列表文件 ipaddrs.txt：</p>
<p><img src="/media/0bde5c60decba25b94020ddb576ac591.png" alt="截图.png"></p>
<p>​      让脚本从主机列表文件 ipaddrs.txt中自动读取IP地址并将其赋值给HLIST变量，从而通过判断ping命令执行后的返回值来逐个测试主机是否在线。脚本中出现的”$（命令）”是一种类似于转义字符中反引号`命令`的Shell操作符，效果同样是执行括号或双引号括起来的字符串中的命令</p>
<p><img src="/media/9dfc794ac46af086118ef97acde7c1e7.png" alt="截图.png"></p>
<p><img src="/media/83ea0f2a7bd01ab87338e1269227c39f.png" alt="截图.png"></p>
<h3 id="while条件循环语句"><a href="#while条件循环语句" class="headerlink" title="while条件循环语句"></a>while条件循环语句</h3><p>​      while条件循环语句是让脚本根据某些条件来重复执行命令的语句，循环结构在执行前并不确定最终执行的次数，不同于for循环语句中有目标、有范围的使用场景  </p>
<p>​      while循环语句通过判断条件测试的真假来决定是否继续执行命令，若条件为真就继续执行，为假就结束循环</p>
<p><img src="/media/0fd9f19988c490735d1d5fd329bee410.png" alt="截图.png"></p>
<p>​       编写一个用来猜测数 值大小的脚本Guess.sh。该脚本使用$RANDOM变量调取一个随机的数值（范围为 0～32767），然后将这个随机数对1000进行取余操作，并使用expr命令取得其结果，再用这个数值与用户通过read命令输入的数值进行比较判断。这个判断语句分为3种情况，分别是判断用户输入的数值是等于、大于还是小于使用expr命令取得的数值</p>
<p>​       while条件循环语句中的条件测试始终为true，因此判断语句会无限执行下去，直到用户输入的数值等于expr命令取得的数值后，才运行exit<br>0命令终止脚本的执行</p>
<p><img src="/media/7a82ac1fc19593f7d1bb88739cb8ebcc.png" alt="截图.png"></p>
<p>当条件为true(真)的时候，while语句会一直循环下去，只有碰到exit才会结束</p>
<h3 id="case条件测试语句"><a href="#case条件测试语句" class="headerlink" title="case条件测试语句"></a>case条件测试语句</h3><p>case语句是在多个范围内匹配数据</p>
<p>若匹配成功则执行相关命令并结束整个条件测试</p>
<p>如果数据不在所列出的范围内， 则会去执行星号（*）中所定义的默认命令</p>
<p><img src="/media/e22a6eed3e572d9d2f30f1978fc7c24f.png" alt="截图.png"></p>
<p>编写脚本Checkkeys.sh，提示用户输入一个字符并将其赋值给变量KEY，然后根据变量KEY的值向用户显示其值是字母、数字还是其他字符：</p>
<p><img src="/media/f8f18592b4fc178b51ee4950fc08a1e1.png" alt="截图.png"></p>
<h2 id="3-4-计划任务服务程序"><a href="#3-4-计划任务服务程序" class="headerlink" title="3.4 计划任务服务程序"></a>3.4 计划任务服务程序</h2><p>计划任务分为一次性计划任务与长期性计划任务</p>
<h3 id="一次性计划任务"><a href="#一次性计划任务" class="headerlink" title="一次性计划任务"></a>一次性计划任务</h3><p>一次性计划任务只执行一次，一般用于临时的工作需求。可以用at命令实现这种功能，只需要写成”at 时间”的形式就行</p>
<p>查看已设置好但还未执行的一次性计划任务，可以使用at-l命令；要想将其删除，可以使用”atrm任务序号”</p>
<p>at命令中的参数及其作用:</p>
<p><img src="/media/d85584b512874dba509bee7ce420b83c.png" alt="截图.png"></p>
<p>使用at命令设置一次性计划任务时，默认采用的是交互式方法。如，将系统设置为在今晚23:30自动重启网站服务</p>
<p><img src="/media/bbd02fa0d3a76caef6e42473505db6fe.png" alt="截图.png"></p>
<p><img src="/media/3e299a1717972751353b400400d3622a.png" alt="截图.png"></p>
<p>上面设置了两条一样的计划任务，可以使用atrm命令删除其中一条：</p>
<p><img src="/media/bdc6f20b16710157ee59d7d60929393e.png" alt="截图.png"></p>
<p>特殊场景：把计划任务写入Shell脚本中，当用户激活该脚本后再开始倒 计时执行</p>
<p>使用”at now +2 MINUTE”的方式进行操作，表示2分钟（MINUTE）后执行这个任务，也可以将其替代成小时（HOUR）、日（DAY）、月（MONTH）等：</p>
<p><img src="/media/70155346fac246bbf28d7a9927edb965.png" alt="截图.png"></p>
<h3 id="长期性计划任务"><a href="#长期性计划任务" class="headerlink" title="长期性计划任务"></a>长期性计划任务</h3><p>有时候希望Linux系统能够周期性地、有规律地执行某些具体的任务，那么Linux系统中默认启用的crond服务简直再适合不过了</p>
<p>创建、编辑计划任务的命令为crontab -e，查看当前计划任务的令为crontab -l，删除某条计划任务的命令为crontab -r</p>
<p>以管理员的身份登录的系统，还可以在crontab命令中加上-u参数编辑他人的计划任务</p>
<p>crontab命令中的参数及其作用如下：</p>
<p><img src="/media/21a787810d58f7da3939ef49b6b8f573.png" alt="截图.png"></p>
<p>使用crond设置任务的参数格式，如果有些字段没有被设置，则需要使用星号(*)占位：</p>
<p><img src="/media/36539dc989fc54c88bb603622a31e0ae.png" alt="截图.png"></p>
<p>使用crond设置任务的参数字段说明：</p>
<p><img src="/media/bd0057dc22307872962861330e1c064c.png" alt="截图.png"></p>
<p>1.在每周一、三、五的凌晨3:25都需要使用tar命令把某个网站的数据目录进行打包使其作为一个备份文件</p>
<p>可以使用crontab -e命令来创建计划任务，为自己创建计划任务时无须使用-u参数</p>
<p>crontab –e命令的具体实现效果和crontab -l命令的结果如下所示：</p>
<p><img src="/media/6d3ed441b12bc7edcb38cb19429140fb.png" alt="截图.png"></p>
<p>用逗号（,）来分别表示多个时间段，例如”8,9,12”表示8月、9月 和12月</p>
<p>用减号（-）来表示一段连续的时间周期（例如字段”日”的取值为”12-15”表示每月的12～15日）</p>
<p>用除号（&#x2F;）表示执行任务的间隔时间（例如”*&#x2F;2”表示每 隔 2分钟执行一次任务）</p>
<p>在crond服务中需要同时包含多条计划任务的命令语句，应每行仅写一条</p>
<p>在crond服务的计划任务参数中，所有命令一定要用绝对路径的方式来写</p>
<p><img src="/media/65042a1f80c16ea35d3ffab32dacb862.png" alt="截图.png"></p>
<p>使用计划服务的注意事项：</p>
<p>1.在crond服务的配置参数中，一般会像Shell脚本那样以#号开头写上注释信息</p>
<p>2.计划任务中的”分”字段必须有数值，绝对不能为空或是*号，”日”和”星期”字段不能同 时使用，会发生冲突</p>
<p>3.删除crond计划任务直接使用crontab -e命令进入编辑界面，删除里面的文本信息即可。也可以使用 crontab -r 命令直接进行删除</p>
<p><img src="/media/b02c2e07f7741df3d82f163ef0d4cd68.png" alt="截图.png"></p>
<h1 id="4-用户身份与文件权限"><a href="#4-用户身份与文件权限" class="headerlink" title="4 用户身份与文件权限"></a>4 用户身份与文件权限</h1><h2 id="4-1-用户身份与能力"><a href="#4-1-用户身份与能力" class="headerlink" title="4.1 用户身份与能力"></a>4.1 用户身份与能力</h2><h3 id="用户身份"><a href="#用户身份" class="headerlink" title="用户身份"></a>用户身份</h3><p>Linux系统的管理员之所以是root，并不是因为它的名字叫root，而是因为该用户的身份号码(UID)的数值为0</p>
<p>Linux系统中UID就像身份证号码一样具有唯一性，可通过用户的UID值判断用户身份。在RHEL 8系统中，用户身份有以下这些：</p>
<p>1.管理员UID为0: 系统的管理员用户</p>
<p>2.系统用户UID为1～999:<br>    Linux系统为了避免因某个服务程序出现漏洞而被黑客提权至整台服务器，默认服务程序会由独立的系统用户负责运行，进而有效控制被破坏范围</p>
<p>3.普通用户UID从1000开始:由管理员创建的用于日常工作的用户</p>
<p>注明:UID是不能冲突的，而且管理员创建的普通用户的UID默认是从1000开始的(即使前面有闲置的号码)</p>
<h3 id="用户组"><a href="#用户组" class="headerlink" title="用户组"></a>用户组</h3><p>Linux系统引入了用户组的概念。<br>通过使用用户组号码可以把多个用户加入到同一个组中，从而方便为组中的用户统一规划权限或指定任务</p>
<p>Linux系统创建每个用户时自动创建一个与其同名的基本用户组，基本用户组只有该用户一人</p>
<p>如果该用户以后被归纳到其他用户组，则这个其他用户组称之为扩展用户组</p>
<p>一个用户只有一个基本用户组，但是可以有多个扩展用户组，从而满足日常的工作需要</p>
<p>注明：</p>
<p>1.基本用户组像是原生家庭，是创建账号(出生)时自动生成的</p>
<p>2.扩展用户组则像工作单位，为了完成工作，需要加入到各个不同的群体中，这是需要手动添加的</p>
<h3 id="id命令"><a href="#id命令" class="headerlink" title="id命令"></a>id命令</h3><p>用于显示用户的详细信息，语法格式为”id 用户名”</p>
<p>查看用户的基本信息，如用户ID、基本组与扩展组GID，用于判别某个用户是否已经存在，以及查看相关信息</p>
<p>使用id命令查看名称为linuxprobe的用户信息：</p>
<p><img src="/media/3811042c6793cfe012e83b298befcaaf.png" alt="截图.png"></p>
<h3 id="useradd命令"><a href="#useradd命令" class="headerlink" title="useradd命令"></a>useradd命令</h3><p>用于创建新的用户账户，语法格式为”useradd [参数] 用户名”</p>
<p>该命令创建用户账户时，默认的用户家目录会被存放在&#x2F;home目录中，默认的Shell解释器为&#x2F;bin&#x2F;bash，默认会创建一个与该用户同名的基本用户组</p>
<p>默认设置根据useradd命令参数修改：</p>
<p><img src="/media/3a4fabb381660beca58783fa6a81049d.png" alt="截图.png"></p>
<p>使用useradd命令创建一个名称为linuxcool的用户，并使用id命令确认信息：</p>
<p><img src="/media/0132b318150382666a1b973d3e5fcd7b.png" alt="截图.png"></p>
<p>创建一个普通用户并指定家目录的路径、用户的UID以及Shell解 释器</p>
<p>&#x2F;sbin&#x2F;nologin是终端解释器中的一员，用户的解释器被设置为nologin代表该用户不能登录到系统中：</p>
<p><img src="/media/e7e03ac70a7753610461d484641dced5.png" alt="截图.png"></p>
<h3 id="groupadd命令"><a href="#groupadd命令" class="headerlink" title="groupadd命令"></a>groupadd命令</h3><p>用于创建新的用户组，语法格式为”groupadd [参数] 群组名”</p>
<p>使用如下命令创建一个用户组ronny：</p>
<p><img src="/media/ff89d1ba599c4626795cce72a92a1ba3.png" alt="截图.png"></p>
<h3 id="usermod命令"><a href="#usermod命令" class="headerlink" title="usermod命令"></a>usermod命令</h3><p>用于修改用户的属性，语法格式为”usermod [参 数] 用户名”</p>
<p>用户的信息保存在&#x2F;etc&#x2F;passwd文件中，可以直接用文本编辑器来修改其中的用户参数项目，也可以用usermod命令修改已经创建的用户信息，比如用户的UID、基本扩展用户组、默认终端等</p>
<p>usermod命令的参数以及作用如下:</p>
<p><img src="/media/7b059bbc744d0ed27467508c2c19f04d.png" alt="截图.png"></p>
<p>将用户linuxprobe加入到root用户组中，扩展组列表中会出现root用户组的字样:</p>
<p><img src="/media/e759bf6c617fe201a4d0a5e1828b335c.png" alt="截图.png"></p>
<p>使用-u参数修改linuxprobe用户的UID号码值：</p>
<p><img src="/media/aac6450981bf80a4d770c481c560e749.png" alt="截图.png"></p>
<p>把用户的解释器终端由默认的&#x2F;bin&#x2F;bash修改为 &#x2F;sbin&#x2F;nologin：</p>
<p><img src="/media/cd9398ff39ac178fb34dfdd76a234718.png" alt="截图.png"></p>
<p>​    将用户的终端设置成&#x2F;sbin&#x2F;nologin后用户马上就不能登录了（切换身份也不行），但用户依然可以被某个服务所调用，管理某个具体的服务。这好处是当黑客通过这个服务入侵成功后，破坏的范围也仅仅局限于这个特定的服务，而不能使用这个用户身份登录到整台服务器上，从而尽可能地把损失降至最小化。默认终端是&#x2F;bin&#x2F;bash</p>
<h3 id="passwd命令"><a href="#passwd命令" class="headerlink" title="passwd命令"></a>passwd命令</h3><p>用于修改用户的密码、过期时间等，语法格式为”passwd [参数] 用户名”</p>
<p>普通用户只能使用passwd命令修改自己的系统密码，root管理员有权限修改其他所有人的密码</p>
<p>root管理员在Linux系统中修改自己或他人的密码时不需要验证旧密码</p>
<p>root管理员能够修改其他用户的密码，就表示其完全拥有该用户的管理权限</p>
<p>passwd命令中的参数以及作用如下：</p>
<p><img src="/media/d946a376deede0608035c83297b61516.png" alt="截图.png"></p>
<p>1.修改自己的密码，只需要输入命令后敲击回车键即可：</p>
<p><img src="/media/ffdb3bd3c129bda32a572d2ea34777da.png" alt="截图.png"></p>
<p>2.修改其他人的密码，需要先检查当前是否为root管理员权限，然后在命令后指定要修改密码的那位用户的名称：</p>
<p><img src="/media/bdea38485666f1f9d45fb0041bf94e47.png" alt="截图.png"></p>
<p>3.可使用passwd命令禁止某用户登录系 统，而不是将其删除。既保证了系统的安全，也避免了频繁添加、删除用户带来的麻烦：</p>
<p><img src="/media/11523b09afda21a8ba2b5189e3d7f411.png" alt="截图.png"></p>
<p>4.在解锁时也要使用管理员的身份；如果普通用户也有锁定权限，系统肯定会乱成一锅粥：</p>
<p><img src="/media/cd2fefaf61d05d06463839b6869d5941.png" alt="截图.png"></p>
<h3 id="userdel命令"><a href="#userdel命令" class="headerlink" title="userdel命令"></a>userdel命令</h3><p>用于删除已有的用户账户，语法格式为”userdel [参 数] 用户名”</p>
<p>可通过userdel命令删除某用户的所有信息。在执行删除操作时，该用户的家目录默认会保留下来，此时可以使用-r参数将其删除</p>
<p>userdel命令的参数以及作用如下：</p>
<p><img src="/media/5d3c86883a46d619574aa0513192fa8c.png" alt="截图.png"></p>
<p>1.删除一个用户时，一般建议保留其家目录的数据，以免有重要的数据被误删除</p>
<p>   使用userdel命令时可以不加参数，写清要删除的用户名称就行：</p>
<p><img src="/media/69ec1ff7a6cbb0c772b56c885aa86870.png" alt="截图.png"></p>
<p>2.虽然此时该用户已被删除，但家目录数据会继续存放在&#x2F;home目录中，等确认未来不再使用时将其手动删除即可：</p>
<p><img src="/media/936026e8a3578c7c8c3cad6173fd3c0d.png" alt="截图.png"></p>
<h2 id="4-2-文件权限与归属"><a href="#4-2-文件权限与归属" class="headerlink" title="4.2 文件权限与归属"></a>4.2 文件权限与归属</h2><p>Linux系统中每个文件都有归属的所有者和所属组，规定文件所有者、所属组以及其他人对文件所拥有可读（r）、可写（w）、可执行（x）等权限</p>
<p>1.对于一般文件来说：</p>
<p>“可读”表示能够读取文件的实际内容、”可写”表示能够编辑、新增、修改、删除文件的实际内容、”可执行”则表示能够运行一个脚本程序</p>
<p>2.对于目录文件来说：</p>
<p>“可读”表示能够读取目录内的文件列表、”可写”表示能够在目录内新增、删除、重命名文件、”可执行”则表示能够进入该目录*</p>
<p> 可读、可写、可执行权限对应的命令在文件和目录上是有区别的，具体参考如下：</p>
<p><img src="/media/64a36d29d05a3d1a756a597d770e24f9.png" alt="截图.png"></p>
<p>文件的可读、可写、可执行权限简写为r、w、x，亦可分别用数字4、2、1表示，文件所有者、文件所属组及其他用户权限之间无关联，如下所示：</p>
<p><img src="/media/ebc96427dae2ae184494faf96d7c65cf.png" alt="截图.png"></p>
<p>文件权限转换示意图(字符与数字)：</p>
<p><img src="/media/ca2748aba442e7feb807a1a6fa1be61d.png" alt="截图.png"></p>
<p>文件属性信息：</p>
<p><img src="/media/b1cbe2f71fe65e3528f2f9637ecafdb7.png" alt="截图.png"></p>
<p>​       上图中包含了文件的类型、访问权限、所有者(属主)、所属组(属组)、占用磁盘大小、最后修改时间和文件名称等信息。该文件的类型为普通文件，所有者权限为可读、可写（rw-），所属组权限为可读（r–），其他人也只有可读权限（r–），文件的磁盘占用大小是34298字节，最近一次的修改时间为4月2日的0:23，文件的名称为install.log</p>
<p>​         排在权限前面的减号（-）是文件类型（减号表示普通文件），常见的文件类型包括普通文件（-）、目录文件（d）、链接文件（l）、管道文件（p）、块设备文件（b）以及字符设备文（c）</p>
<p>​       纯文本信息、服务配置信息、日志信息以及Shell脚本等都属于普通文件</p>
<p>​      块设备文件（b）和字符设备文件（c）一般是指硬件设备，如鼠标、键盘、光驱、硬盘等</p>
<h2 id="4-3-文件的特殊权限"><a href="#4-3-文件的特殊权限" class="headerlink" title="4.3 文件的特殊权限"></a>4.3 文件的特殊权限</h2><p>​      文件的rwx权限无法满足对安全和灵活性的需求，因此便有了SUID、SGID与SBIT的特殊权限位。这是对文件权限进行设置的特殊功能，可与一般权限同时使用，以弥补一般权限不能实现的功能</p>
<h3 id="SUID"><a href="#SUID" class="headerlink" title="SUID"></a>SUID</h3><p>SUID是一种对二进制程序进行设置的特殊权限，能够让二进制程序的执行者临时拥有所有者的权限(仅对拥有执行权限的二进制程序有效)</p>
<p>​     所有用户都可以执行passwd命令修改自己的用户密码，用户密码保存在&#x2F;etc&#x2F;shadow文件中。该文件默认权限是000，即除了root管理员以外，所有用户都没有查看或编辑该文件的权限</p>
<p>​     使用passwd命令加上SUID特殊权限位，就可让普通用户临时获得程序所有者的身份，把变更的密码信息写入到shadow文件中</p>
<p>​     查看passwd命令属性时发现所有者的权限由rwx变成了rws，x改变成s意味着文件被赋予了SUID 权限。如果原权限位上没有x执行权限，那么被赋予特殊权限后将变成大写的S</p>
<p><img src="/media/a6e751be794054f37af3881cf92422ea.png" alt="截图.png"></p>
<h3 id="SGID"><a href="#SGID" class="headerlink" title="SGID"></a>SGID</h3><p>SGID特殊权限有两种应用场景：</p>
<p>1.当对二进制程序进行设置时，能够让执行者临时获取文 件所属组的权限</p>
<p>2.当对目录进行设置时，则是让目录内新创建的文件自动继承该目录原有用户组的名称</p>
<p>   SGID的第一种功能是参考SUID设计的，不同在于执行程序的用户获取的不再是文件所有者的临时权限，而是获取到文件所属组的权限</p>
<p>   在早期的Linux系统中&#x2F;dev&#x2F;kmem是一个字符设备文件，用于存储内核程序要访问的数据，权限为：</p>
<p><img src="/media/0c6dbe253ce9e3211bddc8afcf1f02b6.png" alt="截图.png"></p>
<p>除了root管理员或属于system组的成员外，所有用户都没有读取上述文件的权限。为了获取进程的状态信息，可在用于查看系统进程状态的ps命令文件上增加SGID特殊权限位</p>
<p>下面查看ps命令文件的属性信息：</p>
<p><img src="/media/ad96b20d574a2c82fccddb425c85b7a0.png" alt="截图.png"></p>
<p>由于ps命令被增加了SGID特殊权限位，所以当用户执行该命令时，也就临时获取到了system用户组的权限，从而顺利地读取到了设备文件。</p>
<p>每个文件都有其归属的所有者和所属组，当创建或传送一个文件后，这个文件就会自动归属于执行这个操作的用户（即该用户是文件的所有者）</p>
<p>​        如果需要在一个部门内设置共享目录，让部门内的所有人员都能够读取目录中的内容，那么就可以在创建部门共享目录后，在该目录上设置SGID特殊权限位。这样，部门内的任何人员在里面创建的任何文件都会归属于该目录的所属组，而不再是自己的基本用户组。此时，用到的就是SGID的第二个功能，即在某个目录中创建的文件自动继承该目录的用户组（只可以对目录进行设置）</p>
<p><img src="/media/089ddb3993aec828447a534990f8c4f3.png" alt="截图.png"></p>
<p>​      使用上述命令设置好目录的777权限(确保普通用户可以向其中写入文件)，并为该目录设置了SGID特殊权限位后，就可以切换至一个普通用户，然后尝试在该目录中创建文件，并查看新创建的文件是否会继承新创建的文件所在的目录的所属组名称：</p>
<p><img src="/media/dcde0ff443fb2f025ac3e86c84cc502a.png" alt="截图.png"></p>
<p>1.chmod命令用于设置文件的一般权限及特殊权限，语法格 式为”chmod [参数] 文件名”</p>
<p>​    把一个文件的权限设置成其所有者可读可写可执行、所属组可读可写、其他人没有任何权限，则相应的字符法表示为rwxrw—-，其对应的数字法表示为760</p>
<p><img src="/media/16a0993c22fba715626a3677c8e2fb86.png" alt="截图.png"></p>
<p>​    chown命令用于设置文件的所有者和所有组，语法格式为”chown 所有者:所有组 文件名”</p>
<p>​    chmod和chown命令是用于修改文件属性和权限的最常用命令，它们有一个特别的共性，就是针对目录进行操作时需要加上大写参数-R来表示递归操作，即对目录内所有的文件进行整体操作</p>
<p>​    使用”所有者:所有组”的格式把前面那个文件的所属信息修改一下，变更后的效果如下：</p>
<p><img src="/media/0470c34afb83e08ccf8e8fa6d2926ad5.png" alt="截图.png"></p>
<h3 id="SBIT"><a href="#SBIT" class="headerlink" title="SBIT"></a>SBIT</h3><p>SBIT特殊权限位可确保用户只能删除自己的文件，而不能删除其他用户的文件</p>
<p>当对某个目录设置了SBIT粘滞位权限后，该目录中的文件就只能被其所有者执行删除操作了</p>
<p>RHEL 8系统中的&#x2F;tmp作为一个共享文件的目录，默认设置了SBIT特殊权限位，因此除非是该目录的所有者，否则无法删除这里面的文件</p>
<p>​       与SUID和SGID权限显示方法不同，当目录被设置SBIT特殊权限位后，文件其他用户权限部分的x执行权限就会被替换成t或者T—原本有x执行权限则会写成t、原本没有x执行权限则会被写成T</p>
<p>&#x2F;tmp目录上的SBIT权限默认已经存在，这体现为”其他用户”权限字段的权限变为rwt：</p>
<p><img src="/media/68823c5602c5f94d0d9138098191f0ff.png" alt="截图.png"></p>
<p>文件能否被删除并不取决于自身的权限，而是看其所在目录是否有写入权限</p>
<p>赋予了这个test 文件最大的777权限(rwxrwxrwx)：</p>
<p><img src="/media/4d7d8bc937941959e2511d182eb19fcd.png" alt="截图.png"></p>
<p>​       切换到一个普通用户身份下，尝试删除这个由其他人创建的文件，就会发现，即便读、写、执行权限全开，但是由于SBIT<br>特殊权限位的缘故，依然无法删除该文件：</p>
<p><img src="/media/47c196cb2d6829f3eb621eaa0111eaa8.png" alt="截图.png"></p>
<p>使用chmod命令设置特 殊权限的参数如下：</p>
<p><img src="/media/15ee38529aeb91d27fe6ca0f11044f6b.png" alt="截图.png"></p>
<p>切回root管理员身份，在家目录中创建一个名为linux的新目录，随后为其设置SBIT权限：</p>
<p><img src="/media/b0e2a6dcc96b75e6470ace5572324e97.png" alt="截图.png"></p>
<p>上述代码中的o+t参数是在一般权限已经设置完毕的前提下，又新增了一项特殊权限。</p>
<p>如果想将一般权限和特殊权限一起设置，有什么高效率的方法么？</p>
<p>​     SUID、SGID与SBIT也有对应的数字表示法，分别为4、2、1。也就是说777还不是最大权限，最大权限应该是7777，其中第1个数字代表的是特殊权限位。既然知道了数字表示法是由”特殊权限+一般权限”构成的，以上面linux目录的权限为例，梳理一下计算方法：</p>
<p>​     在rwxr-xr-t权限中，最后一位是t，说明该文件的一般权限为rwxr-xr-x，并带有SBIT特殊权限。对于可读（r）、可写（w）、可执行（x）权限计算即—rwxr-xr-x，即755，而SBIT特殊权限位是1，则合并后的结果为1755</p>
<p>​     如果权限是”rwsrwSr–”呢？大写S表示原先没有执行权限，因此一般权限为rwxrw-r–，将其转换为数字表示法后结果是764。带有的SUID和SGID<br>特殊权限的数字法表示是4和2，得出结果是6，合并后的结果为6764</p>
<p>​      以5537为例。首先，特殊权限的5由4+1组成，意味着有SUID和SBIT。SUID和SGID的写法是，原先有执行权限则是小写s，如果没有执行权限则是大写S；而SBIT的写法则是，原先有执行权限是小写t，没有执行权限是大写T。一般权限的537进行字符转换后应为r-x-wxrwx，然后在此基础上增加SUID和SBIT特殊权限，合并后的结果是r-s-wxrwt</p>
<p><img src="/media/da414efdab31f7102e2c408da4d26482.png" alt="截图.png"></p>
<h2 id="4-4-文件的隐藏属性"><a href="#4-4-文件的隐藏属性" class="headerlink" title="4.4 文件的隐藏属性"></a>4.4 文件的隐藏属性</h2><p>​          Linux系统中的文件除了具备一般权限和特殊权限外，还有一种隐藏权限，默认情况下不能直接被用户发觉。有用户曾经在生产环境和RHCE考试题目中碰到过明明权限充足但却无法删除某个文件的情况，或者仅能在日志文件中追加内容而不能修改或删除内容的情况，这在一定程度上阻止了黑客篡改系统日志的图谋，因此这种”奇怪”的文件权限也保障了Linux系统的安全性</p>
<p>​        隐藏权限的专用设置命令是chattr，专用查看命令是lsattr</p>
<h3 id="chattr命令"><a href="#chattr命令" class="headerlink" title="chattr命令"></a>chattr命令</h3><p>用于设置文件的隐藏权限，语法格式为”chattr [参 数] 文件名称”</p>
<p>如果想要把某个隐藏功能添加到文件上，需要在命令后面追加”+参数”，如果想要把某个隐藏功能移出文件，则需要追加”-参数”</p>
<p>chattr命令中可供选择的隐藏权限参数如下：</p>
<p><img src="/media/316204577c56efe2c87f535526ff2043.png" alt="截图.png"></p>
<p>先创建一个普通文件，然后立即尝 试删除(这个操作肯定会成功)：</p>
<p><img src="/media/ff42dfcddcdd546b9b7bc70cfd624a3c.png" alt="截图.png"></p>
<p>再次新建一个普通文件，并设置”不允许 删除与覆盖”(+a参数)权限，然后再尝试删除文件：</p>
<p><img src="/media/365d5ece82f3c1f0921e5350496f128d.png" alt="截图.png"></p>
<h3 id="lsattr命令"><a href="#lsattr命令" class="headerlink" title="lsattr命令"></a>lsattr命令</h3><p>用于查看文件的隐藏权限，语法格式为”lsattr [参 数] 文件名称”</p>
<p>Linux系统中文件的隐藏权限必须使用lsattr命令查看：</p>
<p><img src="/media/4fc571d2a03c01cd8f22023a5cb862a9.png" alt="截图.png"></p>
<p>按照显示的隐藏权限的类型(字母)，使用chattr命令将其去掉：</p>
<p><img src="/media/ab6e9f5590fd7c9b9c573f6fa3ac0854.png" alt="截图.png"></p>
<p>​      一般会将-a参数设置到日志文件(&#x2F;var&#x2F;log&#x2F;messages)上，这样可在不影响系统正常写入日志的前提下，防止黑客擦除自己的作案证据。如果希望彻底保护某个文件，不允许任何人修改和删除它的话，不妨加上-i参数试试</p>
<p>​      要想彻底删除某个文件，可以使用-s参数保证其被删除后不可恢复—硬盘上的文件数据会被用零块重新填充，那就更保险了</p>
<h2 id="4-5-文件访问控制列表"><a href="#4-5-文件访问控制列表" class="headerlink" title="4.5 文件访问控制列表"></a>4.5 文件访问控制列表</h2><p>​      一般权限、特殊权限、隐藏权限都有一个共性：权限是针对某一类用户设置的，能够对很多人同时生效</p>
<p>​     如果希望对某个指定的用户进行单独的权限控制，就需要用到文件的访问控制列表(ACL)了</p>
<p>​     基于普通文件或目录设置ACL其实就是针对指定的用户或用户组设置文件或目录的操作权限，更加精准地派发权限</p>
<p>​     如果针对某个目录设置了ACL，则目录中的文件会继承其ACL权限</p>
<p>​     若针对文件设置了ACL，则文件不再继承其所在目录的ACL权限</p>
<p>​     先切换到普通用户，然后尝试进入root管理员的家目录中。在没有针对普通用户为root管理员的家目录设置ACL之前，其<br>执行结果如下所示：</p>
<p><img src="/media/9c409d3ed2027031fca2bf1c38929358.png" alt="截图.png"></p>
<h3 id="setfacl命令"><a href="#setfacl命令" class="headerlink" title="setfacl命令"></a>setfacl命令</h3><p>用于管理文件的ACL权限规则，语法格式为 “setfacl [参数] 文件名称”</p>
<p>ACL权限提供的是在所有者、所属组、其他人的读&#x2F;写&#x2F;执行权限之外的特殊权限控制</p>
<p>​      使用setfacl命令可以针对单一用户或用户组、单一文件或目录来进行读&#x2F;写&#x2F;执行权限的控制。其中，针对目录文件需要使用-R递归参数；针对普通文件则使用-m参数；删除某个文件的ACL使用-b参数</p>
<p>setfacl命令的常用参数如下：</p>
<p><img src="/media/96bc08e96c00ef4d5586e2da5906c34d.png" alt="截图.png"></p>
<p>例如：本来是无法进入&#x2F;root目录的，现在为普通用户单独设置一下权限，随后切换到普通用户身份下，可以正常进入：</p>
<p><img src="/media/ab9f12c4eaf6d5129a11cbfa1d5348b2.png" alt="截图.png"></p>
<p>ls命令看不到ACL信息，但可以看到文件权限的最后一个点(.)变成了加号(+)，这意味着该文件已经设置了ACL</p>
<p><img src="/media/e0bc5654da9a4c3150a941aba6a1c4ef.png" alt="截图.png"></p>
<h3 id="getfacl命令"><a href="#getfacl命令" class="headerlink" title="getfacl命令"></a>getfacl命令</h3><p>用于查看文件的ACL权限规则，语法格式为 “getfacl [参数] 文件名称”</p>
<p>设置ACL用的是setfacl命令；查看ACL用的是getfacl命令</p>
<p>使用getfacl命令显示在root管理员家目录上设置的 所有ACL信息：</p>
<p><img src="/media/e6eff011bf5a97461c6b0806868edf9a.png" alt="截图.png"></p>
<p>ACL权限还可以针对某个用户组进行设置</p>
<p>例如，允许某个组的用户都可以读写&#x2F;etc&#x2F;fstab 文件：</p>
<p><img src="/media/0897a7216779c80f9da05947936229e2.png" alt="截图.png"></p>
<p>清空所有ACL权限使用-b参数；删除某一条指定的权 限用-x参数：</p>
<p><img src="/media/182eb725f492588475b2aee721718940.png" alt="截图.png"></p>
<p>​      ACL权限的设置都是立即且永久生效的，不需要再编辑什么配置文件，这一点特别方便。但是，这也带来了一个安全隐患。如果不小心设置错了权限，就会覆盖掉文件原始的权限信息，并且永远都找不回来了</p>
<p>​     在备份&#x2F;home目录上的ACL权限时，可使用-R递归参数，这样不仅能够把目录本身的权限进行备份，还能将里面的文件权限也自动备份</p>
<p>​     getfacl在备份目录权限时不能使用绝对路径的形式，先切换到最上层根目录，然后再进行操作</p>
<p><img src="/media/73d6d81163d448542ccd81aab87a38ce.png" alt="截图.png"></p>
<p>ACL权限的恢复使用的是–restore参数。由于在备份时已经指定是对&#x2F;home目录进行操作，所以不需要写对应的目录名称，它能够自动找到要恢复的对象：</p>
<p><img src="/media/ae1829a937fa6b33876dea5d1b7d44b6.png" alt="截图.png"></p>
<h2 id="4-6-su命令与sudo服务"><a href="#4-6-su命令与sudo服务" class="headerlink" title="4.6 su命令与sudo服务"></a>4.6 su命令与sudo服务</h2><p>​      su命令可以解决切换用户身份的需求，使得当前用户在不退出登录的情况下，顺畅地切换到其他用户，比如从root管理员切换至普通用户：</p>
<p><img src="/media/030099c0e990c507eb98a58ab9921fc8.png" alt="截图.png"></p>
<p>​       上面的su命令与用户名之间有一个减号(-)，意味着完全切换到新的用户，即把环境变量信息也变更为新用户的相应信息，而不是保留原始的信息。建议在切换用户身份时添加减号(-)</p>
<p>​        当从root管理员切换到普通用户时是不需要密码验证的，而从普通用户切换成root管理员需要进行密码验证；这也是一个必要的安全检查：</p>
<p><img src="/media/108cb132dfbceb980c84a064faec2e25.png" alt="截图.png"></p>
<p>​      像上面这样使用su命令后，普通用户可以完全切换到root管理员的身份来完成相应工作，但这将暴露root管理员的密码，从而增大了系统密码被黑客获取的概率，这并不是最安全的方案。</p>
<p>​       使用sudo命令把特定命令的执行权限赋予指定用户，既可保证普通用户能够完成特定的工作，也可以避免泄露root管理员密码     </p>
<p>​       授权原则:在保证普通用户完成相应工作的前提下，尽可能少地赋予额外的权限</p>
<p>​       sudo命令用于给普通用户提供额外的权限，语法格式为”sudo [参数] 用户名”</p>
<p>​       使用sudo命令可以给普通用户提供额外的权限来完成原本只有root管理员才能完成的任务，可以限制用户执行指定的命令，记录用户执行过的每一条命令，集中管理用户与权限(&#x2F;etc&#x2F;sudoers），以及可以在验证密码后的一段时间无须让用户再次验证密码</p>
<p>​       常见的sudo命令的可用参数如下：</p>
<p><img src="/media/b0d301208a3bfebb72f13378fdbc04b1.png" alt="截图.png"></p>
<p>​       可使用sudo命令提供的visudo命令来配置用户权限：</p>
<p>​       visudo命令用于编辑、配置用户sudo的权限文件，语法格式为”visudo [参数]“</p>
<p>​       这是一条会自动调用vi编辑器来配置&#x2F;etc&#x2F;sudoers权限文件的命令，能够解决多个用户同时修改权限而导致的冲突问题。不仅如此，visudo命令还可以对配置文件内的参数进行语法检查，并在发现参数错误时进行报错提醒。这要比用户直接修改文件更友好、安全、方便。</p>
<p><img src="/media/622646842ed6de5e03798d35f3da0055.png" alt="截图.png"></p>
<p>注明:使用<br>visudo命令配置权限文件时，其操作方法与Vim编辑器中用到的方法完全一致</p>
<p>谁可以使用：允许使用的主机 &#x3D; (以谁身份) 可执行命令的列表</p>
<p>谁可以使用：稍后要为哪位用户进行命令授权</p>
<p>允许使用的主机：可以填写ALL表示不限制来源的主机，亦可填写如192.168.10.0&#x2F;24这样的网段限制来源地址，使得只有从允许网段登录时才能使用sudo命令</p>
<p>以谁的身份：可以填写ALL表示系统最高权限，也可以是另外一位用户的名字</p>
<p>可执行命令的列表：可以填写ALL表示不限制命令，亦可填写如&#x2F;usr&#x2F;bin&#x2F;cat这样的文件名称限制命令列表，多个命令文件之间用逗号(,)间隔</p>
<p>​        在Linux系统中配置服务文件时，新增参数的位置不建议太靠上，以免新填写的参数在执行时失败，导致一些必要的服务功能没有成功加载。建议在配置文件中找一下相似的参数，然后在相邻位置进行新的修改，或者在文件的中下部位置进行添加后修改</p>
<p><img src="/media/88b44aa33d0d888c9f281b684b4a4d66.png" alt="截图.png"></p>
<p>​        填写完毕后记得要先保存再退出，然后切换至指定的普通用户身份，此时就可以用sudo -l命令查看所有可执行的命令(下面的命令中，验证的是普通用户的密码，而不是root管理员的密码)：</p>
<p><img src="/media/257a6669a3efa9d45409524c4dfe9b89.png" alt="截图.png"></p>
<p>​       普通用户肯定不能看到root管理员的家目录(&#x2F;root)中的文件信息，但只需要在想执行的命令前面加上sudo命令就行了：</p>
<p><img src="/media/25ef6f3ed750abed9bc34f04e1ab0f79.png" alt="截图.png"></p>
<p>​        如果让某个用户只能使用root管理员的身份执行指定的命令，需要给出该命令的绝对路径，否则系统会识别不出来。可以先使用whereis命令找出命令所对应的保存路径：</p>
<p><img src="/media/a038a5b5134710a45f569026f9150916.png" alt="截图.png"></p>
<p>​        使用visudo命令继续编辑权限文件，将原新增的参数作如下修改，多个命令之间用逗号(,)间隔：</p>
<p><img src="/media/a99e5202606fda17f02720fded164774.png" alt="截图.png"></p>
<p>​        再次切换到指定的普通用户，然后尝试正常查看某个系统文件的内容，此时系统提示没有权限(Permission denied)。再使用sudo命令就能顺 利地查看文件内容了：</p>
<p><img src="/media/83e2bdae83ec396274a8344edbd23b95.png" alt="截图.png"></p>
<p>​       每次执行sudo命令后都会要求验证一下密码。可以添加NOPASSWD参数，使用户下次再执行sudo命令时不用密码验证：</p>
<p><img src="/media/46f79d2d6c2854c712938437be7f037d.png" alt="截图.png"></p>
<p><img src="/media/740b5d1864e11eac79ebc5c1f1a9c8e3.png" alt="截图.png"></p>
<p>​       当切换到普通用户后再执行命令时，就不用再频繁地验证密码了：</p>
<p><img src="/media/65f8d9a839584c208500cd2b9dc9236e.png" alt="截图.png"></p>
<p>​      visudo命令只有root管理员才可以执行，普通用户使用时会提示权限不足</p>
<h1 id="5-存储结构与管理硬盘"><a href="#5-存储结构与管理硬盘" class="headerlink" title="5 存储结构与管理硬盘"></a>5 存储结构与管理硬盘</h1><h2 id="5-1-一切从”-“开始"><a href="#5-1-一切从”-“开始" class="headerlink" title="5.1 一切从”&#x2F;“开始"></a>5.1 一切从”&#x2F;“开始</h2><p>Linux系统中目录、字符设备、套接字、硬盘、光驱、打印机等都被抽象成文件形式，即”Linux 系统中一切都是文件”</p>
<p>在Windows操作系统中，想要找到一个文件，要依次进入该文件所在的磁盘分区(盘符)，然后再进入该分区下的具体目录，最终找到这个文件</p>
<p>​     Linux系统中并不存在C、D、E、F等盘符，Linux系统中的一切文件都是从”根”目录（&#x2F;）开始的，并按照文件系统层次标准(FHS)采用倒树状结构来存放文件，以及定义了常见目录的用途</p>
<p>​     Linux系统中的文件和目录名称是严格区分大小写的。root、rOOt、Root、rooT均代表不同的目录，并且文件名称中不得包含斜杠（&#x2F;）</p>
<p>​     Linux系统中的文件存储结构如下：</p>
<p><img src="/media/5df71c69e4ba67debb990c11066c4952.png" alt="截图.png"></p>
<p>​      FHS是用户在Linux系统中存储文件时需要遵守的规则，用于指导用户应该把文件保存到什么位置，以及告诉用户应该在何处找到所需的文件。</p>
<p>​      Linux系统中最常见的目录以及所对应的 存放内容如下：</p>
<p><img src="/media/4a526ce939a4a35864e06eead98ccd93.png" alt="截图.png"></p>
<p>路径指的是如何定位到某个文件：</p>
<p>​      分为绝对路径与相对路径。绝对路径指的是从根目录（&#x2F;）开始写起的文件或目录名称，而相对路径则指的是相对于当前路径的写法</p>
<h2 id="5-2-物理设备的命名规则"><a href="#5-2-物理设备的命名规则" class="headerlink" title="5.2 物理设备的命名规则"></a>5.2 物理设备的命名规则</h2><p>Linux系统中一切都是文件，硬件设备也不例外。既然是文件，就必须有文件名称</p>
<p>系统内核中的udev设备管理器会自动把硬件名称规范起来，目的是让用户通过设备文件的名字可以猜出设备大致的属性以及分区信息等</p>
<p>udev设备管理器的服务会一直以守护进程的形式运行并侦听内核发出的信号来管理&#x2F;dev目录下的设备文件</p>
<p>Linux系统中常见的硬件设备及其文件名称如下：</p>
<p><img src="/media/0daf77f7fcde67d838cd7ffda1b1820a.png" alt="截图.png"></p>
<p>​      一般的硬盘设备都是以”&#x2F;dev&#x2F;sd”开头。而一台主机上可以有多块硬盘，因此系统采用a～z来代表26块不同的硬盘(默认从a开始分配)</p>
<p>​      硬盘的分区编号也很有讲究：主分区或扩展分区的编号从1开始，到4结束、逻辑分区从编号5开始</p>
<p>​      &#x2F;dev目录中sda设备之所以是a并不是由插槽决定的，而是由系统内核的识别顺序来决定的，恰巧很多主板的插槽顺序就是系统内核的识别顺序，因此才会被命名为&#x2F;dev&#x2F;sda</p>
<p>​      使用iSCSI网络存储设备时就会发现主板上第二个插槽是空着的，但系统却能识别到&#x2F;dev&#x2F;sdb这个设备就是这个道理</p>
<p>​      分区的数字编码不一定是强制顺延下来的，也有可能是手工指定的。因此sda3只能表示是编号为3的分区，不能判断sda设备上已经存在了3个分区</p>
<p>​      &#x2F;dev&#x2F;sda5这个设备文件名称包含的些信息如下所示：</p>
<p><img src="/media/257cb2ba2c51a1dc4137bc32f6d5f1dc.png" alt="截图.png"></p>
<p>​       &#x2F;dev&#x2F;目录中保存的是硬件设备文件、sd表示的是存储设备、a表示系统中同类接口中第一个被识别到的设备、5表示这个设备是一个逻辑分区。”&#x2F;dev&#x2F;sda5”表示的是”这是系统中第一块被识别到的硬件设备中分区编号为5的逻辑分区的设备文件”</p>
<p>​      硬盘设备是由大量的扇区组成的，每个扇区的容量为512字节。其中第一个扇区最重要，它里面保存着主引导记录与分区表信息。就第一个扇区来讲，主引导记录需要占用446字节，分区表占用64字节，结束符占用2字节；分区表中每记录一个分区信息就需要16字节，这样一来最多只有4个分区信息可以写到第一个扇区中，这4个分区 就是4个主分区</p>
<p>​      第一个扇区中的数据信息如下所示：</p>
<p><img src="/media/e9f99064e97bef62b9f2748b96213aa3.png" alt="截图.png"></p>
<p>​       每块硬盘最多只能创建出4个分区明显不合情理也不够用。为了解决分区个数不够的问题，可以将第一个扇区的分区表中16字节(原本要写入主分区信息)的空间(扩展分区)拿出来指向另外一个分区。也就是说，扩展分区其实并不是一个真正的分区，而更像是一个占用16字节分区表空间的指针(指向另外一个分区的指针)。这样一来，用户一般会选择使用3个主分区加1个扩展分区的方法，然后在扩展分区中创建出数个逻辑分区，从而来满足多分区(大于4个)的需求</p>
<p>​       主分区、扩展分区、逻辑分区可以如下去规划：</p>
<p><img src="/media/9f7156122ed006350c12f999d9f289c7.png" alt="截图.png"></p>
<p>​      注明:扩展分区严格地讲不是一个实际意义的分区，而仅仅是一个指向其他分区的指针，这种指针结构将形成一个单向链表。因此扩展分区自身不能存储数据，用户需要在其指向的对应分区(逻辑分区)上进行操作</p>
<p>​      &#x2F;dev&#x2F;hdc8代表这是第3块IDE设备(现在比较少见)中编号为8的逻辑分区</p>
<p>​      云主机中还会看到类似于&#x2F;dev&#x2F;vda、&#x2F;dev&#x2F;vdb这样的设备。以vd开头的设备叫作Virtio设备，简单来说就是一种虚拟化设备。像KVM、Xen这种虚拟机监控器(Hypervisor)默认就都是这种设备</p>
<h2 id="5-3-文件系统与数据资料"><a href="#5-3-文件系统与数据资料" class="headerlink" title="5.3 文件系统与数据资料"></a>5.3 文件系统与数据资料</h2><p>​        用户在硬件存储设备中执行的文件建立、写入、读取、修改、转存与控制等操作都是依靠文件系统来完成的。文件系统的作用是合理规划硬盘，以保证用户正常的使用需求</p>
<p>Linux系统支持数十种文件系统，最常见的文件系统如下所示：</p>
<p>​      1.Ext2:Linux系统的第一个商业级文件系统，基本沿袭了UNIX文件系统的设计标准。但由于不包含日志读写功能，数据丢失的可能性很大，因此能不用就不用，顶多建议用于SD存储卡或U盘</p>
<p>​      2.Ext3:一款日志文件系统，能够在系统异常宕机时避免文件系统资料丢失，并能自动修复数据的不一致与错误。然而，当硬盘容量较大时，所需的修复时间也会很长，也不能100%保证资料不会失  </p>
<p>​      3.Ext4:Ext3的改进版本，RHEL 6系统中默认的文件管理系统，支持的存储容量高达1EB（1EB&#x3D;1,073,741,824GB），且能够有无限多的子目录。Ext4文件系统能够批量分配block(块)，从而极大地提高了读写效率。现在很多主流服务器也会使用Ext4文件系统</p>
<p>​      4.XFS:高性能的日志文件系统，RHEL 7&#x2F;8中默认的文件管理系统。它的优势在发生意外宕机后尤其明显，即可以快速地恢复可能被破坏的文件，而且强大的日志功能只需花费极低的计算和存储性能，支持的最大存储容量为18EB</p>
<p>​         RHEL 7&#x2F;8系统比较大的变化就是使用了XFS作为文件系统，XFS虽然在性能方面比Ext4有所提升，但绝不是压倒性的，因此XFS文件系统最卓越的亮点当属可支持高达18EB的存储容量</p>
<p>​      拿到一块新的硬盘存储设备后，先需要分区，然后再格式化文件系统，最后才能挂载并正常使用。硬盘的分区操作取决于需求和硬盘大小；也可以不进行分区，但是必须对硬盘进行格式化处理</p>
<p>​     日常需要保存在硬盘中的数据太多了，因此Linux系统中有一个名为superblock的”硬盘地图”。Linux并不是把文件内容直接写入到这个”硬盘地图”里面，而是在里面记录着整个文件系统的信息。如果把所有的文件内容都写入到这里面，它的体积将变得非常大，而且文件内容的查询与写入速度也会变得很慢。Linux只是把每个文件的权限与属性记录在inode中，每个文件占用一个独立的inode表格，该表格的大小默认为128字节，里面记录着如下信息：</p>
<p><img src="/media/2425c6c73b26f68ba5e71c1ccd675ba8.png" alt="截图.png"></p>
<p>​         文件的实际内容保存在block块中(大小一般是1KB、2KB或4KB)，一个inode的默认大小仅为128字节，记录一个block消耗4字节。当文件的inode被写满后，Linux系统会自动分配出一个block，专门用于像inode那样记录其他block块的信息，这样把各个block块的内容串到一起，就能够让用户读到完整的文件内容了。对于存储文件内容的block块，有下面两种常见的情况(以4KB大小的block 为例进行说明)：</p>
<p>​        1.情况1：文件很小(1KB)，但依然会占用一个block，因此会潜在地浪费3KB</p>
<p>​        2.情况2：文件很大(5KB)，会占用两个block(5KB−4KB后剩下的1KB也要占用一个block)</p>
<p>​        Linux内核中的软件层为用户程序提供了一个虚拟文件系统（Virtual FileSystem，VFS）接口，用户实际上在操作文件时就是统一对这个虚拟文件系统进行操作了</p>
<p>​        下图为VFS的架构示意图。从中可见，实际文件系统在VFS下隐藏了自己的特性和细节，这样用户在日常使用时会觉得”文件系统都是一样的”，也就可以随意使用各种命令在任何文件系统中进行各种操作了(如使用cp命令复制文件)：</p>
<p><img src="/media/2d2ad41afa3083f93b67fadeeeb84107.png" alt="截图.png"></p>
<p>​       VFS像一个翻译官。不需要知道对方的情况，只要告诉VFS想进行的操作是什么，它就会自动判断对方能够听得懂什么指令，然后翻译并交代下去。这可以让用户不用操心这些”小事情”，专注于自己的操作</p>
<h2 id="5-4-挂载硬件设备"><a href="#5-4-挂载硬件设备" class="headerlink" title="5.4 挂载硬件设备"></a>5.4 挂载硬件设备</h2><h3 id="mount命令"><a href="#mount命令" class="headerlink" title="mount命令"></a>mount命令</h3><p>​    用于挂载文件系统，格式为”mount 文件系统 挂载目录”。可用的参数及作用如下所示：</p>
<p><img src="/media/b0a7dfc3f6f24454c65fadad0471e62e.png" alt="截图.png"></p>
<p>​      挂载是在使用硬件设备前所执行的最后一步操作。只需使用mount命令把硬盘设备或分区与一个目录文件进行关联，然后就能在这个目录中看到硬件设备中的数据了</p>
<p>​      新的Linux系统一般不需要使用-t参数来指定文件系统的类型，Linux系统会自动进行判断</p>
<p>​      mount中的-a参数会在执行后自动检查&#x2F;etc&#x2F;fstab文件中有无被疏漏挂载的设备文件，如果有，则进行自动挂载操作</p>
<p>​       把设备&#x2F;dev&#x2F;sdb2挂载到&#x2F;backup目录，只需要在mount命令中填写设备与挂载目录参数就行，系统会自动判断要挂载文件的类型，命令如下：</p>
<p><img src="/media/99a18957bdb3e65b4fb45fac346ca811.png" alt="截图.png"></p>
<p>​      工作中挂载一块网络存储设备，该设备的名字可能会变来变去，再写为sdb就不太合适了。推荐用UUID(通用唯一识别码)进行挂载操作。UUID是一串用于标识每块独立硬盘的字符串，具有唯一性及稳定性，特别适合用来挂载网络设备，使用blkid命令可得知独立硬盘的UUID</p>
<h3 id="blkid命令"><a href="#blkid命令" class="headerlink" title="blkid命令"></a>blkid命令</h3><p>blkid命令用于显示设备的属性信息，语法格式为”blkid [设备 名]“</p>
<p>blkid命令查询设备UUID的示例如下：</p>
<p><img src="/media/ada15bc2196fecdd0d82f4a29a637ed8.png" alt="截图.png"></p>
<p>有了设备的UUID值之后，就可以用它挂载网络设备：</p>
<p><img src="/media/256f65f7dc800aaef62953a8ce6bd657.png" alt="截图.png"></p>
<p>​         执行mount命令后就能立即使用文件系统了，但系统在重启后挂载就会失效，如果想让硬件设备和目录永久地进行自动关联，就必须把挂载信息按照指定的填写格式”设备文件 挂载目录 格式类型 权限选项 是否备份 是否自检”(各字段的意义如下)写入到&#x2F;etc&#x2F;fstab文件中</p>
<p><img src="/media/1f73ab6ef4e4c4026fb8b65b15bc36d7.png" alt="截图.png"></p>
<p>将文件系统为xfs的硬件设备&#x2F;dev&#x2F;sdb1在开机后自动挂载到&#x2F;backup目录上，并保持默认权限且无须开机自检，需要在&#x2F;etc&#x2F;fstab文件中写入下面的信息：</p>
<p><img src="/media/feb436006d9ea770ff9b64b58ea9cda0.png" alt="截图.png"></p>
<p>由于后面需要使用系统镜像制作Yum&#x2F;DNF软件仓库，我提前把光盘设备挂载到&#x2F;media&#x2F;cdrom目录中。光盘设备的文件系统格式是iso9660：</p>
<p><img src="/media/feb436006d9ea770ff9b64b58ea9cda0.png" alt="截图.png"></p>
<p>写入到&#x2F;etc&#x2F;fstab文件中的设备信息并不会立即生效，需使用mount-a参数进行自动 挂载：</p>
<p><img src="/media/b8f214bb26f1cc15743c99d27fb47698.png" alt="截图.png"></p>
<h3 id="df命令"><a href="#df命令" class="headerlink" title="df命令"></a>df命令</h3><p>用于查看已挂载的磁盘空间使用情况，语法格式为 “df -h”</p>
<p>​     查看当前系统中设备的挂载情况可使用df命令，不仅能列出系统中正在使用的设备有哪些，还可以用-h参数便捷地对存储容量进行”进位”操作。例如，<br>在遇到10240K的时候会自动进位写成10M</p>
<p><img src="/media/af60ac5dd45cdc4cf574f90ae2d6d0af.png" alt="截图.png"></p>
<p>​      网络存储设备建议在fstab文件挂载信息中加上_netdev参数。加上后系统会等联网成功后再尝试挂载这块网络存储设备，从而避免了开机时间过长或失败的情况：</p>
<p><img src="/media/23b5f2f5aee44114503f42704b17c1d9.png" alt="截图.png"></p>
<h3 id="umount命令"><a href="#umount命令" class="headerlink" title="umount命令"></a>umount命令</h3><p>​      挂载文件系统是为了使用硬件资源，卸载文件系统则意味不再使用硬件的设备资源。既然挂载操作就是把硬件设备与目录两者进行关联的动作，那么卸载操作只需要说明想要取消关联的设备文件或挂载目录的其中一项即可，一般不需要加其他额外的参数。</p>
<p>​      umount命令用于卸载设备或文件系统，语法格式为”umount [设备文件&#x2F;挂载目录]“</p>
<p><img src="/media/aa8e172e2dcfabc8d079150f8d2bda7c.png" alt="截图.png"></p>
<p>​      如果当前处于设备所挂载的目录，系统会提示该设备繁忙，此时只需退出到其他目录后再尝试一次就行了</p>
<p><img src="/media/c8fa71c6087ea4a0fcdb0a4950286987.png" alt="截图.png"></p>
<p>​       如果系统中硬盘特别多，分区特别多，就可以用lsblk命令以树状图的形式列举一下了<br>​       lsblk命令用于查看已挂载的磁盘的空间使用情况，输入该命令后按回车键执行即可。</p>
<p><img src="/media/0effcfc4e3446b79bb3687020083b356.png" alt="截图.png"></p>
<h2 id="5-5-添加硬盘设备"><a href="#5-5-添加硬盘设备" class="headerlink" title="5.5 添加硬盘设备"></a>5.5 添加硬盘设备</h2><p>​        首先需要在虚拟机中模拟添加入一块新的硬盘存储设备，然后再进行分区、格式化、挂载等操作，最后通过检查系统的挂载状态并真实地使用硬盘来验证硬盘设备是否成功添加</p>
<p>具体的操作步骤如下：</p>
<p>​       1.首先把虚拟机系统关机，稍等几分钟会自动返回到虚拟机管理主界面，然后单击”编辑虚拟机设置”选项，在弹出的界面中单击”添加”按钮，新增一块硬件设备</p>
<p>​       2.选择想要添加的硬件类型为”硬盘”，然后单击”下一步”按钮就可以了</p>
<p>​       3.选择虚拟硬盘的类型为SATA，并单击”下一步”按钮，这样虚拟机中的设备名称过一会儿后应该为&#x2F;dev&#x2F;sdb</p>
<p>​       4.选中”创建新虚拟磁盘”单选按钮，再次单击”下一步”按钮</p>
<p>​       5.将”最大磁盘大小”设置为默认的20GB。这个数值是限制这台虚拟机所使用的最大硬盘空间，而不是立即将其填满，因此默认20GB就很合适了。单击”下一步”按钮**</p>
<p>​       6.设置磁盘文件的文件名和保存位置(默认设置即可，无须修改)，直接单击”完成”按钮</p>
<p>​       7.将新硬盘添加好后就可以看到设备信息了。不需要做任何修改，直接单击”确定”按钮后就可以启虚拟机了</p>
<p>​          在虚拟机中模拟添加了硬盘设备后就应该能看到抽象后的硬盘设备文件了。按照udev服务命名规则，第二个被识别的SATA设备应该会被保存为&#x2F;dev&#x2F;sdb、第三个为&#x2F;dev&#x2F;sdc，这个就是硬盘设备文件了。但在开始使用该硬盘之前还需要进行分区操作，例如从中取出一个2GB的分区设备以供后面的操作使用</p>
<h3 id="fdisk命令"><a href="#fdisk命令" class="headerlink" title="fdisk命令"></a>fdisk命令</h3><p>用于新建、修改及删除磁盘的分区表信息，语法格 式为”fdisk 磁盘名称”</p>
<p>​     在Linux系统中，管理硬盘设备最常用的方法就当属fdisk命令。提供了集添加、删除、转换分区等功能于一身的”一站式分区服务”。不过与前面讲解的直接写到命令后面的参数不同，这条命令的参数(如下)是交互式的一问一答的形式，因此在管理硬盘设备时特别方便，可根据需求动态调整。</p>
<p><img src="/media/294a5296dfc95ae6e97d5ac69d23e677.png" alt="截图.png"></p>
<p>使用fdisk命令管理&#x2F;dev&#x2F;sdc硬盘设备</p>
<p>在看到提示信息后输入参数p来查看硬盘设备内已有的分区信息，其中包括了硬盘的容量大小、扇区个数等信息：</p>
<p><img src="/media/7e2246b710c596755114e2dee4e8f6ce.png" alt="截图.png"></p>
<p><img src="/media/30d306fd2928e91dec98de956763e2a4.png" alt="截图.png"></p>
<p>输入参数n尝试添加新的分区</p>
<p>系统会要求用户是选择继续输入参数p来创建主分区，还是输入参数e来创建扩展分区。这里输入参数p来创建一个主分区：</p>
<p><img src="/media/9d4da188dd1b01756715c82478c9954b.png" alt="截图.png"></p>
<p>​       在确认创建一个主分区后，系统要求用户先输入主分区的编号。主分区的编号范围是1～4，因此这里输入1即可。接下来系统会提示定义起始的扇区位置，这不需要改动，敲击回车键保留默认设置即可，系统会自动计算出最靠前的空闲扇区的位置。最后，系统会要求定义分区的结束扇区位置，这其实就是要去定义整个分区的大小是多少。不用去计算扇区的个数，只需要输入+2G即可创建出一个容量为2GB的硬盘分区。</p>
<p><img src="/media/c71398a63f68e646cc1ba39ae95ec8b0.png" alt="截图.png"></p>
<p>​     再次使用参数p查看硬盘设备中的分区信息。就能看到一个名称为&#x2F;dev&#x2F;sdc1、起始扇区位置为2048、结束扇区位置为4196351的主分区了。敲击参数w后按回车键，分区信息写入成功</p>
<p><img src="/media/1fa3a58bc8b12e1cfe0cd37f995e0e3b.png" alt="截图.png"></p>
<p>分区信息中第6个字段的Id值是一个编码，用于标识该分区的作用，可帮助用户快速了解该分区的作用，一般没必要修改</p>
<p>使用l参数查看一下磁盘编码都有哪些，在6.6节进行SWAP操作时再修改：</p>
<p><img src="/media/311728f7536d36787af46617c77f76b9.png" alt="截图.png"></p>
<p>​      上述步骤执行完后，Linux系统会自动把这个硬盘主分区抽象成&#x2F;dev&#x2F;sdc1设备文件。可以使用file命令查看该文件的属性，但有些时候系统并没有自动把分区信息同步给Linux内核，而且这种情况似乎还比较常见(但不能算作严重的bug)</p>
<p>​      输入partprobe命令手动将分区信息同步到内核，而且一般推荐连续两次执行该命令，效果会更好。如果使用这个命令都无法解决问题，那么就重启计算机吧</p>
<p><img src="/media/40161062f3ca9d43566ab94e6742bb5c.png" alt="截图.png"></p>
<p><img src="/media/13d9185070cf15f14576dab06078d214.png" alt="截图.png"></p>
<pre><code>    如果硬件存储设备没有进行格式化，则Linux系统无法得知怎么在其上写入数据。因此，在对存储设备进行分区后还需要进行格式化操作。在Linux系统中用于格式化操作的命令是mkfs。这条命令很有意思，因为在Shell终端中输入mkfs名后再敲击两下用于补齐命令的Tab键，会有如下的效果：\*\*
</code></pre>
<p><img src="/media/e60ff5f5d5051cc086286147a3084527.png" alt="截图.png"></p>
<p>​       mkfs命令把常用的文件系统名称用后缀的方式保存成了多个命令文件，用起来也非常简单—mkfs.文件类型名称。将分区为xfs的文件系统进行格式化，则命令应为mkfs.xfs &#x2F;dev&#x2F;sdc1</p>
<p><img src="/media/f068fc469159da8916ce742e9d5064d5.png" alt="截图.png"></p>
<p>​        创建一个用于挂载设备的挂载点目录，使用mount命令将存储设备与挂载点进行关联，最后使用df -h命令来查看挂载状态和硬盘使用量 信息</p>
<p><img src="/media/5da5aefd184ecc3a716cb79def395caa.png" alt="截图.png"></p>
<h3 id="du命令"><a href="#du命令" class="headerlink" title="du命令"></a>du命令</h3><p>查看分区或目录所占用的磁盘容量大小，语法格式 为”du -sh 目录名称”</p>
<p>在Linux系统中可以使用du -sh &#x2F;*命令查看在Linux系统根目录下所有一级目录分别占用的空间大小，在1s之内就能找到哪个目录占用的空间最多：</p>
<p><img src="/media/2dc447da67713040362f39ecd690906a.png" alt="截图.png"></p>
<p>先从某些目录中复制过来一批文件，然后查看这些文件总共占用了多大的容量：</p>
<p><img src="/media/73ba9fd381a9b5469903379d78061c79.png" alt="截图.png"></p>
<p><img src="/media/3e98eec2e0953af31dffeb4a4ebc6e18.png" alt="截图.png"></p>
<p>使用mount命令挂载的设备文件会在系统下一次重启的时候失效。如果想让这个设备文件的挂载永久有效，则需要把挂载的信息写入配置文件中：</p>
<p><img src="/media/5a5ba391fcbae1706834f52482723bfd.png" alt="截图.png"></p>
<h2 id="5-6-添加交换分区"><a href="#5-6-添加交换分区" class="headerlink" title="5.6 添加交换分区"></a>5.6 添加交换分区</h2><p>​        交换(SWAP)分区是通过在硬盘中预先划分一定的空间，然后把内存中暂时不常用的数据临时存放到硬盘中，以便腾出物理内存空间让更活跃的程序服务来使用的技术，设计目的是为了解决真实物理内存不足的问题。通俗来讲就是让硬盘帮内存分担压力。但由于交换分区毕竟是通过硬盘设备读写数据的，速度肯定要比物理内存慢，所以只有当真实的物理内存耗尽后才会调用交换分区的资源。</p>
<p>​        交换分区的创建与挂载与使用存储设备的过程非常相似。交换分区的划分建议：在生产环境中，交换分区的大小一般为真实物理内存的1.5～2倍。此处取一个大小为5GB的主分区作为交换分区资源：</p>
<p><img src="/media/042cfb251a96c10648a0ec2e4d9b2b8c.png" alt="截图.png"></p>
<p>在上面的操作结束后，就得到了一个容量为5GB的新分区。然后修改硬盘的标识码，将其改成82(Linux swap)以方便以后知道它的作用：</p>
<p>备注:敲击w参数退出分区表编辑工具</p>
<p><img src="/media/ed6b693024f17837dd48e589b17df31e.png" alt="截图.png"></p>
<p>mkswap命令用于对新设备进行交换分区格式化，语法格式为 “mkswap 设备名称”</p>
<p><img src="/media/f212f28aeaded787fc9dd128301131ba.png" alt="截图.png"></p>
<p>swapon命令用于激活新的交换分区设备，语法格式为”swapon 设备名称”</p>
<p>使用swapon命令把准备好的SWAP硬盘设备正式挂载到系统中。使用free -m命令查看交换分区的大小变化(由2047MB增加到7167MB)：</p>
<p><img src="/media/a90d27b3413499ba1aec168da535591b.png" alt="截图.png"></p>
<p>为了让新的交换分区设备在重启后依然生效，需按下面的格式将相关信息写入配置文件中：</p>
<p><img src="/media/811b1ef129237def05fa987a669ae49e.png" alt="截图.png"></p>
<h2 id="5-7-磁盘容量配额"><a href="#5-7-磁盘容量配额" class="headerlink" title="5.7 磁盘容量配额"></a>5.7 磁盘容量配额</h2><p>​           root管理员使用磁盘容量配额服务来限制某位用户或某个用户组针对特定文件夹可以使用的最大硬盘空间或最大文件个数，一旦达到这个最大值就不再允许继续使用。使用quota技术进行磁盘容量配额管理，从而限制用户的硬盘可用容量或所能创建的最大文件个数。quota技术还有软限制和硬限制的功能</p>
<p>​         软限制:当达到软限制时会提示用户，但仍允许用户在限定的额度内继续使用</p>
<p>​         硬限制:当达到硬限制时会提示用户，且强制终止用户的操作</p>
<p>​          RHEL 8系统中已经安装了quota磁盘容量配额服务程序包，但存储设备却默认没有开启对quota技术的支持，需要手动编辑配置文件(&#x2F;etc&#x2F;fstab)并重启(reboot)一次系统，让系统中的启动目录(&#x2F;boot)能支持quota磁盘配额技术</p>
<p><img src="/media/e3f2cb7ecdca31f29d1d4bc64c6252c1.png" alt="截图.png"></p>
<p>​        早期的Linux系统想让硬盘设备支持quota磁盘容量配额服务，使用的是usrquota参数，RHEL 7&#x2F;8系统使用的是uquota参数。在重启系统后使用mount命令查看，即可发现&#x2F;boot目录已经支持quota磁盘配额技术了：</p>
<p><img src="/media/184da0e6d5e4d80cd93dbcce0d41b74a.png" alt="截图.png"></p>
<p>​       创建一个用于检查quota磁盘容量配额效果的用户tom，并针对&#x2F;boot目录增加其他人的写权限，保证用户能够正常写入数据：</p>
<p><img src="/media/7ecf71aeffefabcfd62b24449782c6ba.png" alt="截图.png"></p>
<h3 id="xfs-quota命令"><a href="#xfs-quota命令" class="headerlink" title="xfs_quota命令"></a>xfs_quota命令</h3><p>用于管理设备的磁盘容量配额，语法格式为”xfs_quota [参数] 配额 文件系统”</p>
<p>​      这是专门针对XFS文件系统来管理quota磁盘容量配额服务而设计的命令。-c参数用于以参数的形式设置要执行的命令；-x参数是专家模式，让运维人员能够对quota服务进行更多复杂的配置</p>
<p>​      使用xfs_quota命令设置用户tom对&#x2F;boot目录的quota磁盘容量配额。具体的限额控制包括：</p>
<p>1.硬盘使用量的软限制和硬限制分别为3MB和6MB</p>
<p>2.创建文件数量的软限制和硬限制分别为3个和6个</p>
<p><img src="/media/4bdf663fdc0d51197fdd44510453a29c.png" alt="截图.png"></p>
<p>​       上面使用的参数分为两组，分别是isoft&#x2F;ihard与bsoft&#x2F;bhard，Linux系统中每个文件都会使用一个独立的inode信息块来保存属性信息，一个文件对应一个inode信息块，所以isoft和ihard就是通过限制系统最大使用的inode个数来限制文件数量。bsoft和bhard则是代表文件所占用的block大小，也就是文件占用的最大容量的总统计</p>
<p>​       soft是软限制，超过该限制后也只是将操作记录写到日志中，不对用户行为进行限制。hard是硬限制，一旦超过系统就会马上禁止，用户再也不能创建或新占任何的硬盘容量</p>
<p>​       当配置好上述各种软硬限制后，尝试切换到一个普通用户，分别尝试创建一个体积为5MB和8MB 的文件。可以发现，在创建8MB的文件时受到了系统限制：</p>
<p><img src="/media/85dc8a04782da899b34ab6a0988bf024.png" alt="截图.png"></p>
<h3 id="edquota命令"><a href="#edquota命令" class="headerlink" title="edquota命令"></a>edquota命令</h3><p>用于管理系统的磁盘配额，语法格式为”edquota [参 数] 用户名”</p>
<p>​       为用户设置了quota磁盘容量配额限制后，可使用edquota命令按需修改限额的数值。其中，-u参数表示要针对哪个用户进行设置；-g参数表示要针对哪个用户组进行设置，如下所示：</p>
<p><img src="/media/6f64b06bd5c732f43ab18755c1b068d7.png" alt="截图.png"></p>
<p>​       edquota命令会调用Vi或Vim编辑器来让root管理员修改要限制的具体细节</p>
<p>​       把用户tom的硬盘使用量的硬限额从5MB提升到8MB：</p>
<p><img src="/media/0c4dc9275dafc289fc209ab0991982df.png" alt="截图.png"></p>
<p><img src="/media/b86efbe15a6fae47f610586f8c5788ea.png" alt="截图.png"></p>
<p><img src="/media/41a525f1098d6fce47f85580bb02c00e.png" alt="截图.png"></p>
<h2 id="5-8-VDO-虚拟数据优化"><a href="#5-8-VDO-虚拟数据优化" class="headerlink" title="5.8 VDO(虚拟数据优化)"></a>5.8 VDO(虚拟数据优化)</h2><p>​        一种通过压缩或删除存储设备上的数据来优化存储空间的技术。VDO是红帽公司收购了Permabit公司后获取的新技术，2019-2020年前后，多次在RHEL 7.5&#x2F;7.6&#x2F;7.7上进行测试，最终随RHEL8系统正式公布。VDO技术的关键就是对硬盘内原有的数据进行删重操作，类似于使用的网盘服务，第一次正常上传文件时速度特别慢，第二次上传相同的文件时仅作为一个数据指针，几乎可以达到”秒传”的效果，无须再多占用一份空间，也不用再漫长等待。除了删重操作，VDO技术还可以对日志和数据库进行自动压缩，进一步减少存储浪费的情况</p>
<p>VDO针对各种类型文件的压缩效果如下所示：</p>
<p><img src="/media/cf15ff9ee2c268bed8c47a4e83f77644.png" alt="截图.png"></p>
<p>​      VDO技术支持本地存储和远程存储，可作为本地文件系统、iSCSI或Ceph存储下的附加存储层使用。红帽公司在VDO介绍页面中提到，在部署虚拟机或容器时，建议采用逻辑存储与物理存储为10∶1的比例进行配置，即1TB物理存储对应10TB逻辑存储；而部署对象存储时(如使用Ceph)则采用逻辑存储与物理存储为3∶1的比例进行配置，即使用1TB物理存储对应3TB逻辑存！简而言之，VDO技术能省空间！</p>
<p>​        其一，公司服务器上已有的dm-crypt之类的技术是可以与VDO技术兼容的，但记得要先对卷进行加密再使用VDO。因为加密会使重复的数<br>据变得有所不同，因此删重操作无法实现。要始终记得把加密层放到VDO之下，如下图所示：</p>
<p><img src="/media/2c1729e4bd5ac935e58e666e8388e9da.png" alt="截图.png"></p>
<p>​       其二，VDO技术不可叠加使用，1TB的物理存储提升成10TB的逻辑存储没问题，但是再用10TB翻成100TB就不行了</p>
<p>​       把虚拟机关闭，添加一块容量为20GB的新SATA硬盘进来，开机后就能看到这块名称为&#x2F;dev&#x2F;sdd 的新硬盘了：</p>
<p><img src="/media/786e8570a2da81821d1884277b401c79.png" alt="截图.png"></p>
<p>​       RHEL&#x2F;CentOS8系统中默认启用了VDO技术。VDO技术是红帽公司自己的技术，兼容性自然没得说。如果所用的系统没有安装VDO，用dnf命令即可<br>完成安装：</p>
<p><img src="/media/0d11ec4c37adb4575cc0bc4aa9a01089.png" alt="截图.png"></p>
<p>首先，创建一个全新的VDO卷</p>
<p>​       新添加进来的物理设备就是使用vdo命令管理的，其中name参数代表新的设备卷的名称；device参数代表由哪块磁盘进行制作；vdoLogicalSize参数代表制作后的设备大小。依据红帽公司推荐的原则，20GB硬盘将翻成200GB的逻辑存储：</p>
<p><img src="/media/7b0a1e9e14c1121e3d6e95992d363684.png" alt="截图.png"></p>
<p>​      创建成功后，使用status参数查看新建卷的概述信息：</p>
<p><img src="/media/e8513e4affa6b3da7b0370182c434413.png" alt="截图.png"></p>
<p>​       由上可见，输出信息中包含了VDO卷创建的时间、主机名、版本、是否压缩(Compression)及是否删重(Deduplication)等关键信息。</p>
<p>​       接下来，对新建卷进行格式化操作并挂载使用。</p>
<p>​       新建的VDO卷设备会被存放在&#x2F;dev&#x2F;mapper目录下，并以设备名称命名，对它操作就行。另外，挂载前可以用udevadm settle命令对设备进行一次刷新操作，避免刚才的配置没有生效：</p>
<p><img src="/media/2617dc7a97f5f9cb837aebb57b81a906.png" alt="截图.png"></p>
<p>如果想查看设备的实际使用情况，使用vdostats命令即可。human-readable参数的作用是将存储容量自动进位(比如，显示20G而不是20971520K)：</p>
<p><img src="/media/de15404d9ea08019a824ce20cf2c1584.png" alt="截图.png"></p>
<p>这里显示的Size是实际物理存储的空间大小(即20.0GB是硬盘大小)，如果想看逻辑存储空间，可以用df命令进行查看：</p>
<p><img src="/media/57e94a5ba9b5421fe94b4d596db4424b.png" alt="截图.png"></p>
<p>随便复制一个大文件过来，看看占用了多少容量，以及空间节省率(Space saving)是多少：</p>
<p><img src="/media/7179c44b01b986baa4e769eaafe33f32.png" alt="截图.png"></p>
<p>原先448MB的文件这次只占用了不到100MB 的容量，空间节省率也从18%提升到了55%</p>
<p>​       VDO设备卷在创建后会一直存在，但需要手动编辑&#x2F;etc&#x2F;fstab文件后才能在下一次重启后自动挂载生效，为我们所用。对于这种逻辑存储设备，其实不太建议使用&#x2F;dev&#x2F;mapper&#x2F;storage作为设备名进行挂载。不如试试前面所说的UUID：</p>
<p><img src="/media/c9e7ada0032a7b73b5d131a586e0b0e6.png" alt="截图.png"></p>
<p>​       打开&#x2F;etc&#x2F;fstab文件，把对应的字段填写完整。建议再加上_netdev参数，表示等系统及网络都启动后再挂载VDO设备卷，以保证万无一失。</p>
<p><img src="/media/a2e42bcec6bfe79bcf00471ed9be7720.png" alt="截图.png"></p>
<h2 id="5-9-软硬方式链接"><a href="#5-9-软硬方式链接" class="headerlink" title="5.9 软硬方式链接"></a>5.9 软硬方式链接</h2><p>​       在Windows系统中，快捷方式是指向原始文件的一个链接文件，可以让用户从不同的位置来访问原始的文件；原文件一旦被删除或剪切到其他地方，<br>会导致链接文件失效。但在Linux系统中可不太一样。</p>
<p>​        Linux系统中存在软链接和硬链接两种不同的类型：</p>
<p>​       软链接:(符号链接)，仅仅包含所链接文件的名称和路径，很像一个记录地址的标签。当原始文件被删除或移动后，新的链接文件也会随之失效，不能被访问。可以针对文件、目录设置软链接，跨文件系统进行链接也不是问题。从这一点来看，它与Windows系统的”快捷方式”具有一样的性质。</p>
<p>​       硬链接:可将它理解为一个”指向原始文件block的指针”，系统会创建出一个与原来一模一样的inode信息块。所以，硬链接文件与原始文件其实是一模<br>一样的，只是名字不同。每添加一个硬链接，该文件的inode个数就会增加1；而且只有当该文件的inode个数为0时，才算彻底将它删除。换言之，由于硬链接实际上是指向原文件block的指针，因此即便原始文件被删除，依然可以通过硬链接文件来访问。由于技术的局限性，不能跨分区对目录文件进行硬链接。</p>
<p><img src="/media/7cece9d9e0e493a4cf9d27971b1a410e.png" alt="截图.png"></p>
<h3 id="ln命令"><a href="#ln命令" class="headerlink" title="ln命令"></a>ln命令</h3><p>用于创建文件的软硬链接，语法格式为”ln [参数]原始文件 名 链接文件名”</p>
<p>ln命令的可用参数以及作用如下所示。在使用ln命令时，是否添加-s参数，将创建出性质不同的两种”快捷方式”</p>
<p><img src="/media/f6067cb53e15afbdb091ae99172cd0d1.png" alt="截图.png"></p>
<p>为了更好地理解软链接、硬链接的不同性质，先创建出一个文件，为其创建一个软链接：</p>
<p><img src="/media/27c0da57a7995b75c60ebf1feb3af027.png" alt="截图.png"></p>
<p>原始文件名为old，新的软链接文件名为new。删掉原始文件后，软链接文件立刻就无法读取了：</p>
<p><img src="/media/0c721aa5e5af6badb7df6430a2397474.png" alt="截图.png"></p>
<p>​       对原始文件old创建一个硬链接，相当于针对原始文件的硬盘存储位置创建了一个指针。这样一来，新创建的这个硬链接就不再依赖于原始文件的名称等信息，也不会因为原始文件的删除而导致无法读取了。同时可以看到创建硬链接后，原始文件的硬盘链接数量增加到了2</p>
<p><img src="/media/02fc7e9720a758e2eab119aa83ebc793.png" alt="截图.png"></p>
<p>​        创建的硬链接文件竟然会让文件属性第二列的数字变成了2，这个数字表示的是文件的inode信息块的数量。已经非常肯定地知道，即便删除了原始文件，新的文件也会一如既往地可以读取，因为只有当文件inode数量被”清零”时，才真正代表这个文件被删除了</p>
<p><img src="/media/325bcfce41ef234b35408f4f6c1fe849.png" alt="截图.png"></p>
<h1 id="6-使用RAID与LVM磁盘阵列技术"><a href="#6-使用RAID与LVM磁盘阵列技术" class="headerlink" title="6 使用RAID与LVM磁盘阵列技术"></a>6 使用RAID与LVM磁盘阵列技术</h1><h2 id="6-1-RAID-独立冗余磁盘阵列"><a href="#6-1-RAID-独立冗余磁盘阵列" class="headerlink" title="6.1 RAID(独立冗余磁盘阵列)"></a>6.1 RAID(独立冗余磁盘阵列)</h2><p>​          RAID技术通过把多个硬盘设备组合成一个容量更大、安全性更好的磁盘阵列，并把数据切割成多个区段后分别存放在各个不同的物理硬盘设备上，利用分散读写技术来提升磁盘阵列整体的性能，同时把多个重要数据的副本同步到不同的物理硬盘设备上，从而起到了非常好的数据冗余备份效果</p>
<p>​         现代企业更看重的是RAID技术所具备的冗余备份机制以及带来的硬盘吞吐量的提升。也就是说，RAID不仅降低了硬盘设备损坏后丢失数据的几率，还提升了硬盘设备的读写速度，所以它在绝大多数运营商或大中型企业中得到了广泛部署和应用     </p>
<p>​        出于成本和技术的考虑，需要针对不同的需求在数据可靠性及读写性能上做出权衡，制定出满足各自需求的不同方案。目前已有的RAID磁盘阵列的方案至少有十几种，RAID0、RAID 1、RAID 5 与RAID 10是4种最常见的方案。这4种方案的对比如下所示，其中 n 代表硬盘总数。</p>
<p><img src="/media/e3004912c5bd6bebad34f3dfed8792e0.png" alt="截图.png"></p>
<h3 id="RAID-0"><a href="#RAID-0" class="headerlink" title="RAID 0"></a>RAID 0</h3><p>​      RAID0技术把多块物理硬盘设备(至少两块)通过硬件或软件的方式串联在一起，组成一个大的卷组，并将数据依次写入各个物理硬盘中。这样一来，在最理想的状态下，硬盘设备的读写性能会提升数倍，但是若任意一块硬盘发生故障，将导致整个系统的数据都受到破坏。通俗来说，RAID 0技术能够有效地提升硬盘数据的吞吐速度，但是不具备数据备份和错误修复能力。如下图所示，数据被分别写入到不同的硬盘设备中，即硬盘A和硬盘B设备会分别保存数据资料，最终实现提升读取、写入速度的效果。</p>
<p><img src="/media/bd7ef2c8b0f9395c1efbe2e44951a93c.png" alt="截图.png"></p>
<h3 id="RAID-1"><a href="#RAID-1" class="headerlink" title="RAID 1"></a>RAID 1</h3><p>​       尽管RAID 0技术提升了硬盘设备的读写速度，但它是将数据依次写入到各个物理硬盘中。也就是说，它的数据是分开存放的，其中任何一块硬盘发生故障都会损坏整个系统的数据。因此，如果生产环境对硬盘设备的读写速度没有要求，而是希望增加数据的安全性时，就需要用到RAID 1技术了</p>
<p>​       在下图RAID 1技术示意图中可以看到，它是把两块以上的硬盘设备进行绑定，在写入数据时，是将数据同时写入到多块硬盘设备上(可以将其视为数据的镜像或备份)。当其中某一块硬盘发生故障后，一般会立即自动以热交换的方式来恢复数据的正常使用</p>
<p><img src="/media/6ad3fff1105baa9f2b9aefa7d76242a6.png" alt="截图.png"></p>
<p>​     考虑到在进行写入操作时因硬盘切换带来的开销，因此RAID 1的速度会比RAID 0有微弱地降低。但在读取数据的时候，操作系统可以分别从两块硬盘中读取信息，因此理论读取速度的峰值可以是硬盘数量的倍数。只要保证有一块硬盘稳定运行，数据就不会出现损坏的情况，可靠性较高</p>
<p>​     RAID1技术虽然十分注重数据的安全性，但是因为是在多块硬盘设备中写入了相同的数据，因此硬盘设备的利用率得以下降。从理论上来说，图中所示的硬盘空间的真实可用率只有50%，由3块硬盘设备组成的RAID 1磁盘阵列的可用率只有33%左右；以此类推。而且，由于需要把数据同时写入到两块以上的硬盘设备，这无疑也在一定程度上增大了系统计算功能的负载</p>
<h3 id="RAID-5"><a href="#RAID-5" class="headerlink" title="RAID 5"></a>RAID 5</h3><p>​      如下图所示，RAID5技术是把硬盘设备的数据奇偶校验信息保存到其他硬盘设备中。RAID 5磁盘阵列中数据的奇偶校验信息并不是单独保存到某一块硬盘设备中，而是存储到除自身以外的其他每一块硬盘设备上。这样的好处是，其中任何一设备损坏后不至于出现致命缺陷。图中Parity部分存放的就是数据的奇偶校验信息。RAID 5技术实际上没有备份硬盘中的真实数据信息，而是当硬盘设备出现问题后通过奇偶校验信息来尝试重建损坏的数据。RAID这样的技术特性”妥协”地兼顾了硬盘设备的读写速度、数据安全性与存储成本问题</p>
<p><img src="/media/daedf3b375d1fb057c1c49a14553f0ec.png" alt="截图.png"></p>
<p>​       RAID 5最少由3块硬盘组成，使用的是硬盘切割(Disk Striping)技术。相较于RAID 1级别，好处就在于保存的是奇偶校验信息而不是一模一样的文件内容，所以当重复写入某个文件时，RAID 5级别的磁盘阵列组只需要对应一个奇偶校验信息就可以，效率更高，存储成本也会随之降低</p>
<h3 id="RAID-10"><a href="#RAID-10" class="headerlink" title="RAID 10"></a>RAID 10</h3><p>​       RAID 5技术是出于硬盘设备的成本问题对读写速度和数据的安全性能有了一定的妥协，但是大部分企业更在乎的是数据本身的价值而非硬盘价格，因此在生产环境中主要使用RAID 10技术</p>
<p>​       RAID 10技术是RAID 1+RAID 0技术的一个”组合体”。如图所示，RAID 10技术需要至少4块硬盘来组建，其中先分别两两制作成RAID 1磁盘阵列，以保证数据的安 全性；然后再对两个RAID 1磁盘阵列实施RAID 0技术，进一步提高硬盘设备的读写速度。这样从理论上来讲，只要坏的不是同一阵列中的所有硬盘，那么最多可以损坏50%的硬盘设备而不丢失数据。由于RAID 10技术继承了RAID 0的高读写速度和RAID1的数据安全性，在不 考虑成本的情况下RAID 10的性能也超过了RAID 5，因此当前成为广泛使用的一种存储技术</p>
<p><img src="/media/fff5bd10f00957a72a71e3bdba0300df.png" alt="截图.png"></p>
<p>​       由于RAID 10是由RAID 1和RAID 0组成的，因此正确的叫法是”RAID 一零”，而不是”RAID 十”</p>
<p>​        RAID 10是先对信息进行分割，然后再两两一组制作镜像。 也就是先将RAID 1作为最低级别的组合，然后再使用RAID 0技术将RAID 1磁盘阵列组合<br>到一起，将它们视为”一整块”硬盘。而 RAID 01则相反，它是先将硬盘分为两组，然后使用RAID 0作为最低级别的组合，再将这两组RAID 0硬盘通过RAID 1技术组合到一起</p>
<p>​       RAID 10技术和RAID 01技术的区别非常明显。在RAID 10中，任何一块硬盘损坏都不会影响到数据安全性，其余硬盘均会正常运作。但在RAID<br>01中，只要有任何一块硬盘损坏， 最低级别的RAID 0磁盘阵列马上会停止运作，这可能造成严重隐患。所以RAID 10远比RAID 01常见，很多主板甚至不支持RAID 01</p>
<h3 id="部署磁盘阵列"><a href="#部署磁盘阵列" class="headerlink" title="部署磁盘阵列"></a>部署磁盘阵列</h3><p>​      首先，在虚拟机中添加4块硬盘设备来制作一个RAID 10磁盘阵列，硬盘要用SCSI或SATA接口的类型， 大小默认20GB</p>
<p><img src="/media/cfd254fad8d8a3ff21ff6a3b5951a965.png" alt="截图.png"></p>
<p>​     mdadm命令用于创建、调整、监控和管理RAID设备，语法格式为”mdadm 参数硬盘名称”</p>
<p>​     mdadm命令常用参数及作用如下：</p>
<p><img src="/media/5323530d07448da6344aad17a7062128.png" alt="截图.png"></p>
<p>使用mdadm命令创建RAID 10，名称为”&#x2F;dev&#x2F;md0”</p>
<p>udev是Linux系统内核中用来给硬件命名的服务，通过命名规则猜测到第二个SCSI存储设备的名称会是&#x2F;dev&#x2F;sdb，然后依此类推</p>
<p><img src="/media/1fcdd7fe7a9a221d1c3fe2eee0805f38.png" alt="截图.png"></p>
<p>​        如果使用10、50、100个硬盘来部署RAID磁盘阵列呢？<br>​        此时，就需要使用mdadm中的参数了。其中，-C参数代表创建一个RAID阵列卡；-v参数显示创建的过程，同时在后面追加一个设备名称&#x2F;dev&#x2F;md0，这样&#x2F;dev&#x2F;md0就是创建后的RAID 磁盘阵列的名称；-n 4参数代表使用4块硬盘来部署这个RAID磁盘阵列；而-l 10参数 则代表RAID 10方案；最后再加上4块硬盘设备的名称就搞定了</p>
<p><img src="/media/4207559845e11d053d0fb5d921759e09.png" alt="截图.png"></p>
<p>​        初始化过程大约需要1分钟左右，可以用-D 参数进行查看。也可以用-Q参数查看简要信息：</p>
<p><img src="/media/4eb64c27b319ce7f2275055d4041bb7d.png" alt="截图.png"></p>
<p>​        4块20GB大小的硬盘组成的磁盘阵列组，可用空间只有 39.97GB</p>
<p>​         RAID 10技术通过两两一组硬盘组成的RAID 1磁盘阵列保证了数据的可靠性，每一份数据都会被保存两次，导致硬盘存在50%的使用率和50%的冗余率。这样一来，80GB的硬盘容量也就只有一半了</p>
<p>​         等两三分钟后，把制作好的RAID磁盘阵列格式化为Ext4格式：</p>
<p><img src="/media/48bf5b1410dd639e0b2ad8cb7a3b1b8e.png" alt="截图.png"></p>
<p>​         创建挂载点，将硬盘设备进行挂载操作：</p>
<p><img src="/media/097e73298f0404574cd992886a62361e.png" alt="截图.png"></p>
<p>​      查看&#x2F;dev&#x2F;md0磁盘阵列设备的详细信息，确认RAID级别(Raid Level)、阵列大小(Array Size)和总硬盘数(Total Devices)都是否正确：</p>
<p><img src="/media/eaee0825d0a1dcc6545eab7e7b903fb6.png" alt="截图.png"></p>
<p><img src="/media/595963c1398cd70bdfcab9242c551728.png" alt="截图.png"></p>
<p>​     如果想让创建好的RAID磁盘阵列一直提供服务，需将信息添加到&#x2F;etc&#x2F;fstab文件中，确保每次重启后RAID磁盘阵列都是有效的。</p>
<p><img src="/media/5a79ae2324f73055f68b805c3b214e5f.png" alt="截图.png"></p>
<h3 id="损坏磁盘阵列及修复"><a href="#损坏磁盘阵列及修复" class="headerlink" title="损坏磁盘阵列及修复"></a>损坏磁盘阵列及修复</h3><p>​        生产环境中部署RAID10磁盘阵列是为了提高存储设备的IO读写速度及数据的安全性，但因为我们的硬盘设备是在虚拟机中模拟出来的，所以对于读写速度的改善可能并不直观</p>
<p>​      在确认有一块物理硬盘设备出现损坏而不能再继续正常使用后，应该使用mdadm命令将其移除，然后查看RAID磁盘阵列的状态，可以发现状态已经改变：</p>
<p><img src="/media/4e72799d4959101bb5f783c1d8e4198a.png" alt="截图.png"></p>
<p><img src="/media/162823ee62547017661afd88a81b9bfc.png" alt="截图.png"></p>
<p>使用-f参数是让硬盘模拟损坏的效果。为了能够彻底地将故障盘移除，还要再执行一步操作：</p>
<p><img src="/media/7f25cc856480a0c4102e3221f771067e.png" alt="截图.png"></p>
<p><img src="/media/2df6fd3065eb45b3300b8e23db9eb178.png" alt="截图.png"></p>
<p><img src="/media/edf62b2bc8f6d1a88e6f2dea85ff1c72.png" alt="截图.png"></p>
<p>​       在RAID 10级别的磁盘阵列中，当RAID 1磁盘阵列中存在一个故障盘时并不影响RAID 10磁盘阵列的使用。当购买了新的硬盘设备后再使用mdadm命令予以替换即可，在此期间可以在&#x2F;RAID目录中正常地创建或删除文件。由于我们是在虚拟机中模拟硬盘，所以先重启系统，然后再把新的硬盘添加到<br>RAID磁盘阵列中</p>
<p>​       更换硬盘后再次使用-a参数进行添加操作，系统默认会自动开始数据的同步工作。使用-D参数即可看到整个过程和进度(用百分比表示)：</p>
<p><img src="/media/bbecf1433278a265b6603e5c02292ccb.png" alt="截图.png"></p>
<p><img src="/media/5265d976f3704d07d851c3e8564d598b.png" alt="截图.png"></p>
<h3 id="磁盘阵列-备份盘"><a href="#磁盘阵列-备份盘" class="headerlink" title="磁盘阵列+备份盘"></a>磁盘阵列+备份盘</h3><p>​        RAID 10磁盘阵列中最多允许50%的硬盘设备发生故障，但极端情况是同一RAID 1磁盘阵列中的硬盘设备若全部损坏，也会导致数据丢失。在RAID 10磁盘阵列中，如果RAID 1中的某一块硬盘出现了故障，而我们正在前往修复的路上，恰巧该 RAID1磁盘阵列中的另一块硬盘设备也出现故障，那么数据就被彻底丢失了。可以使用RAID备份盘技术来预防这类事故。该技术的核心理念就是准备一块足够大的硬盘，这块硬盘平时处于闲置状态，一旦RAID磁盘阵列中有硬盘出现故障后则会马上自动顶替上去</p>
<p>​         为了避免多个实验之间相互发生冲突，需要保证每个实验的相对独立性，需要将虚拟机还原到初始状态。由于刚才已经演示了RAID 10磁盘阵列的部署方法，现在来看一下RAID 5的部署效果。部署RAID 5磁盘阵列时，至少需要用到3块硬盘，还需要再加一块备份硬盘(也叫热备盘)，所以总计需要在虚拟机中模拟4块硬盘设备</p>
<p>​        创建一个RAID 5磁盘阵列+备份盘。在下面的命令中，参数-n 3代表创建这个RAID 5磁盘阵列所需的硬盘数，参数-l 5代表RAID的级别，而参数-x<br>1则代表有一块备份盘</p>
<p>​       当查看&#x2F;dev&#x2F;md0(RAID 5磁盘阵列名称)磁盘阵列的时候，能看到有一块备份盘在等待中了</p>
<p><img src="/media/3995920a6a5c06ef0050afa9c32177d2.png" alt="截图.png"></p>
<p><img src="/media/52c1dde50efac8b316dd002a5ddd20c8.png" alt="截图.png"></p>
<p><img src="/media/6800d2d8a6c7845f85a1ea354b1bf2aa.png" alt="截图.png"></p>
<p>将部署好的RAID 5磁盘阵列格式化为Ext4文件格式，然后挂载到目录上，之后就能够使用了：</p>
<p><img src="/media/21ff8651dd3535f135d92a59fdfab901.png" alt="截图.png"></p>
<p><img src="/media/b8dac5055c4a407ed332694b26ca6c80.png" alt="截图.png"></p>
<p>由3块硬盘组成的RAID<br>5磁盘阵列，其对应的可用空间是n-1，也就是40GB。热备盘的空间不计算进来，平时完全就是在”睡觉”，只有在意外出现时才会开始工作</p>
<p><img src="/media/242ba042e910d818c899024c8c93a0a0.png" alt="截图.png"></p>
<p>​      把硬盘设备&#x2F;dev&#x2F;sde移出磁盘阵列，然后迅速查看 &#x2F;dev&#x2F;md0磁盘阵列的状态，就会发现备份盘已经被自动顶替上去并开始了数据同步。RAID中的这种备份盘技术非常实用，可以在保证RAID磁盘阵列数据安全性的基础上进一步提高数据可靠性</p>
<p><img src="/media/92741a5abc77f0a6ce1d519cb404ce03.png" alt="截图.png"></p>
<p><img src="/media/077e3c69d85ed1b7076e30f2e79888cd.png" alt="截图.png"></p>
<p>如果后面想再添加一块热备盘进来，使用-a参数就可以了</p>
<h3 id="删除磁盘阵列"><a href="#删除磁盘阵列" class="headerlink" title="删除磁盘阵列"></a>删除磁盘阵列</h3><p>生产环境中RAID磁盘阵列部署后一般不会被轻易停用，但还是可能会遇到。</p>
<p>1.将所有的磁盘都设置成停用状态：</p>
<p><img src="/media/5e25d227c9ffd84300f816557d5520f4.png" alt="截图.png"></p>
<p>2.逐一移除出去</p>
<p><img src="/media/c06b06e4563a8bfbad0b60fd4d3e7d87.png" alt="截图.png"></p>
<p>3.如果着急，也可以用”mdadm &#x2F;dev&#x2F;md0 -f &#x2F;dev&#x2F;sde -r &#x2F;dev&#x2F;sde”这一条命令搞定</p>
<p>​    在早期版本的服务器中，命令中的-f和-r不能一起使用，保守起见，还是一步步地操作吧。<br>​    将所有的硬盘都移除后，再来查看磁盘阵列组的状态：</p>
<p><img src="/media/dfce253fb10e975eafea2b738130f27c.png" alt="截图.png"></p>
<p>4.继续停用整个RAID磁盘阵列，工作就彻底完成了</p>
<p><img src="/media/faf49706bbfb8fc4dfb8f0e7678c4562.png" alt="截图.png"></p>
<p>在老版本的服务器中，使用–stop参数后依然会保留设备文件。这很明显是没有处理干净，再执行”mdadm -remove &#x2F;dev&#x2F;md0”命令即可</p>
<h2 id="6-2-LVM-逻辑卷管理器"><a href="#6-2-LVM-逻辑卷管理器" class="headerlink" title="6.2 LVM(逻辑卷管理器)"></a>6.2 LVM(逻辑卷管理器)</h2><p>​          随着实际需求的变化调整硬盘分区的大小时，会受到硬盘”灵活性”的限制。这时就需要用另外一项硬盘设备资源管理技术了—逻辑卷管理器<br>(Logical Volume Manager，LVM)。LVM允许用户对硬盘资源进行动态调整</p>
<p>​          LVM是Linux系统用于对硬盘分区进行管理的一种机制，理论性较强，创建初衷是为了解决硬盘设备在创建分区后不易修改分区大小的缺陷。尽管对传统的硬盘分区进行强制扩容或缩容从理论上来讲是可行的，但是却可能造成数据的丢失。LVM是在硬盘分区和文件系统之间添加了一个逻辑层，它提供了一个抽象的卷组，可以把多块硬盘进行卷组合并。这样一来，用户不必关心物理硬盘设备的底层架构和布局，就可以实现对硬盘分区的动态调整。<br>​         LVM的技术架构如下图所示</p>
<p>​         举例说明:  比如小明家里想吃馒头，但是面粉不够了，于是妈妈从隔壁老王家、老李家、老张家分别借来一些面粉，准备蒸馒头吃。首先需要把这些面粉(物理卷[Physical Volume，PV])揉成一个大面团(卷组[Volume Group]，VG)，然后再把这个大面团分割成一个个小馒头(逻辑卷[Logical Volume，LV])，而且每个小馒头的重量必须是每勺面粉(基本单元[Physical Extent，PE])的倍数</p>
<p>​        在日常使用中，如果卷组(VG)的剩余容量不足，可以随时将新的物理卷(PV)加入到里面，进行不断地扩容。逻辑卷管理器使用流程示意图，如下图所示：</p>
<p><img src="/media/84e7c94c123296d0b3580fbea2999135.png" alt="截图.png"></p>
<p><img src="/media/42189d7a87082bb7a5d5cfb0dd1ca7c7.png" alt="截图.png"></p>
<pre><code>     物理卷处于LVM中的最底层，可以将其理解为物理硬盘、硬盘分区或者RAID磁盘阵列。卷组建立在物理卷之上，一个卷组能够包含多个物理卷，而且在卷组创建之后也可以继续向其中添加新的物理卷。逻辑卷是用卷组中空闲的资源建立的，并且逻辑卷在建立后可以动态地扩展或缩小空间。这就是 LVM的核心理念
</code></pre>
<h3 id="部署逻辑卷"><a href="#部署逻辑卷" class="headerlink" title="部署逻辑卷"></a>部署逻辑卷</h3><p>​         在生产环境中无法在最初时就精确地评估每个硬盘分区在日后的使用情况，因此会导致原先分配的硬盘分区不够用。比如，伴随着业务量的增加，用于存放交易记录的数据库目录的体积也随之增加；因为分析并记录用户的行为从而导致日志目录的体积不断变大，这些都会导致原有的硬盘分区在使用上捉襟见肘。而且，还存在对较大的硬盘分区进行精简缩容的情况</p>
<p>​         可以通过部署LVM来解决上述问题。部署时，需要逐个配置物理卷、卷组和逻辑卷</p>
<p>​         常用的部署命令如下表所示：</p>
<p><img src="/media/8901e3443359c5e8aca47c082bbdf7f1.png" alt="截图.png"></p>
<p>​       为避免多个实验之间相互发生冲突，请将虚拟机还原到初始状态，并重新添加两块新硬盘设备，如下图所示。然后开机。</p>
<p>​        在虚拟机中添加两块新硬盘设备的目的是为了更好地演示LVM理念中用户无须关心底层物理硬盘设备的特性。先对这两块新硬盘进行创建物理卷的操作，可将该操作简单理解成让硬盘设备支持LVM技术，或者理解成是把硬盘设备加入到LVM技术可用的硬件资源池中，然后对这两块硬盘进行卷组合并，卷组的名称允许由用户自定义。接下来，根据需求把合并后的卷组切割出一个约为150MB的逻辑卷设备，最后把这个逻辑卷设备格式化成Ext4文件系统后挂载使用。下文将对每一个步骤做一些简单的描述：</p>
<p>第一步:让新添加的两块硬盘设备支持LVM技术</p>
<p><img src="/media/7daa8dca8a41e57a02bb8d9f8ee10fd4.png" alt="截图.png"></p>
<p>第二步:把两块硬盘设备加入到storage卷组中，然后查看卷组的状态</p>
<p><img src="/media/25461fe579e7c47c0d611bf6714bd9d8.png" alt="截图.png"></p>
<p><img src="/media/2227b25b71fc97664c614d8619e5a933.png" alt="截图.png"></p>
<p>第三步:切割出一个约为150MB的逻辑卷设备</p>
<p>​      对逻辑卷进行切割时有两种计量单位。第一种是以容量为单位，所使用的参数为-L。例如，使用-L 150M生成一个大小为150MB的逻辑卷。另外<br>一种是以基本单元的个数为单位，所使用的参数为-l。每个基本单元的大小默认为4MB。例如，使用-l 37可以生成一个大小为37×4MB&#x3D;148MB的逻辑卷。</p>
<p><img src="/media/a6bd64bf45acec951c7a615311844d81.png" alt="截图.png"></p>
<p>第四步:把生成好的逻辑卷进行格式化，然后挂载使用</p>
<p>​        Linux系统会把LVM中的逻辑卷设备存放在&#x2F;dev设备目录中(实际上是个快捷方式)，同时会以卷组的名称来建立一个目录，其中保存了逻辑卷的设备映射文件(即&#x2F;dev&#x2F;卷组名称&#x2F;逻辑卷名称)</p>
<p><img src="/media/754188f31815be5e2ee199a4a31ead49.png" alt="截图.png"></p>
<p>​         如果使用了逻辑卷管理器，则不建议用XFS文件系统，因为XFS文件系统自身就可以使用xfs_growfs命令进行磁盘扩容。虽然不比LVM灵活，但起码也够用。在实测阶段发现，在有一些服务器上，XFS与LVM的兼容性并不好</p>
<p>第五步:查看挂载状态，并写入配置文件，使其永久生效</p>
<p><img src="/media/1b8256f9d170c48126d636141e57c8bb.png" alt="截图.png"></p>
<p><img src="/media/cb98d3496368e60b4fbfc97e84460731.png" alt="截图.png"></p>
<p>一个小问题:刚刚明明写的是148MB，怎么这里只有140MB了呢？因为硬件厂商的制造标准是 1GB&#x3D;1,000MB、1MB＝1,000KB、1KB<br>＝1,000B，而计算机系统的算法是1GB&#x3D;1,024MB、1MB＝1,024KB、1KB＝1,024B，因此有3%左右的”缩水”是正常情况</p>
<h3 id="扩容逻辑卷"><a href="#扩容逻辑卷" class="headerlink" title="扩容逻辑卷"></a>扩容逻辑卷</h3><p>​       卷组是由两块硬盘设备共同组成的。用户在使用存储设备时感知不到设备底层的架构和布局，更不用关心底层是由多少块硬盘组成的，只要卷组中有足够的资源，就可以一直为逻辑卷扩容。扩容前记得卸载设备和挂载点的关联</p>
<p><img src="/media/7195c043aba93ac3e05f7093672973d3.png" alt="截图.png"></p>
<p>第1步:把上一个实验中的逻辑卷vo扩展至290MB</p>
<p><img src="/media/04551370abd6b97206a296e369955bb6.png" alt="截图.png"></p>
<p>第2步:检查硬盘的完整性，确认目录结构、内容和文件内容没有丢失。一般情况下没有报错，均为正常情况</p>
<p><img src="/media/9da9b7a28a5985bd21aad6364aa46196.png" alt="截图.png"></p>
<p>第3步:重置设备在系统中的容量。刚刚是对LV(逻辑卷)设备进行了扩容操作，但系统内核还没有同步到这部分新修改的信息，需要手动进行同步</p>
<p><img src="/media/cebb65eb0e5d5a8bf4f635bee37f8e3d.png" alt="截图.png"></p>
<p>第4步:重新挂载硬盘设备并查看挂载状态</p>
<p><img src="/media/ced622f3f73b1ca75af217e15121f99c.png" alt="截图.png"></p>
<p>查看卷组大小：</p>
<p><img src="/media/36477a1893ec24189f4e6f1e806a1501.png" alt="截图.png"></p>
<h3 id="缩小逻辑卷"><a href="#缩小逻辑卷" class="headerlink" title="缩小逻辑卷"></a>缩小逻辑卷</h3><pre><code>  相较于扩容逻辑卷，在对逻辑卷进行缩容操作时，数据丢失的风险更大。在生产环境中执行相应操作时，一定要提前备份好数据。另外，Linux系统规定，在对LVM逻辑卷进行缩容操作之前，要先检查文件系统的完整性(保证数据的安全)。在执行缩容操作前先把文件系统卸载掉
</code></pre>
<p><img src="/media/b87b81e42a478adae38061226ba989c5.png" alt="截图.png"></p>
<p>第1步:检查文件系统的完整性</p>
<p><img src="/media/0342c3033369827083298efd7f8ec184.png" alt="截图.png"></p>
<p>第2步:通知系统内核将逻辑卷vo的容量减小到120MB</p>
<p><img src="/media/4f2f9c9d92a3ff8cd41b3f565dbb4bbe.png" alt="截图.png"></p>
<p>第3步:将LV(逻辑卷)的容量修改为120MB</p>
<p>缩容操作是先通知系统内核自己想缩小逻辑卷，如果在执行resize2fs命令后系统没有报错，再正式操作</p>
<p><img src="/media/3cb5311f66208537ecd41e57e45d9126.png" alt="截图.png"></p>
<p>第4步:重新挂载文件系统并查看系统状态</p>
<p><img src="/media/4d2ba094d41665ed77eca273e597df1a.png" alt="截图.png"></p>
<h3 id="逻辑卷快照"><a href="#逻辑卷快照" class="headerlink" title="逻辑卷快照"></a>逻辑卷快照</h3><p>​        LVM具备”快照卷”功能，该功能类似于虚拟机软件的还原时间点功能。例如，对某一个逻辑卷设备做一次快照，如果日后发现数据被改错了，就可以利用之前做好的快照卷进行覆盖还原。LVM的快照卷功能有两个特点：</p>
<p>1.快照卷的容量必须等同于逻辑卷的容量</p>
<p>2.快照卷仅一次有效，一旦执行还原操作后则会被立即自动删除</p>
<p>在正式操作前，先看看VG(卷组)中的容量是否够用：</p>
<p><img src="/media/a97a3e304a84b1965eecd7cb6ea1dbee.png" alt="截图.png"></p>
<p>通过卷组输出信息可以看到，卷组中已经使用了120MB的容量，空闲容量还有39.88GB。用重定向往逻辑卷设备所挂载的目录中写入一个文件：</p>
<p><img src="/media/b3a146fcd10b46ab6617fea0472fe894.png" alt="截图.png"></p>
<p>​       第1步:使用-s参数生成一个快照卷，使用-L参数指定切割的大小，需要与要做快照的设备容量保持一致。另外，还需要在命令后面写上是针对哪个逻辑卷执行的快照操作，稍后数据也会还原到这个相应的设备上</p>
<p><img src="/media/ef0762c9e5dfa5447418ce8f81cdd86f.png" alt="截图.png"></p>
<p><img src="/media/7eb266ef3c90c2bd1f69041dcc26c060.png" alt="截图.png"></p>
<p>第2步:在逻辑卷所挂载的目录中创建一个100MB的垃圾文件，然后再查看快照卷的状态。可以发现存储空间的占用量上升了</p>
<p><img src="/media/1a6141347ba99aa4229407531ed1ad47.png" alt="截图.png"></p>
<p><img src="/media/552509d56eb7a4d83725d4d4dd960d4a.png" alt="截图.png"></p>
<p>第3步:为了校验快照卷的效果，需要对逻辑卷进行快照还原操作。在此之前记得先卸载掉逻辑卷设备与目录的挂载</p>
<p>lvconvert命令用于管理逻辑卷的快照，语法格式为”lvconvert [参数]快照卷名称”</p>
<p>使用lvconvert命令能自动恢复逻辑卷的快照，在早期的RHEL&#x2F;CentOS 5版本中要写全格 式:”–mergesnapshot”，从RHEL 6到RHEL<br>8，已经允许用户只输入–merge参数进行操作 了，系统会自动分辨设备的类型</p>
<p><img src="/media/69aeaa6dd10014e8a6c4326e708e74b3.png" alt="截图.png"></p>
<p>第4步:快照卷会被自动删除掉，并且刚刚在逻辑卷设备被执行快照操作后再创建出来的100MB的垃圾文件也被清除了</p>
<p><img src="/media/ea1f644540b54835e2df3b699e880c84.png" alt="截图.png"></p>
<h3 id="删除逻辑卷"><a href="#删除逻辑卷" class="headerlink" title="删除逻辑卷"></a>删除逻辑卷</h3><p>​      生产环境中重新部署LVM或不再需要使用LVM时，需要执行LVM的删除操作。为此，需要提前备份好重要的数据信息，然后依次删除逻辑卷、卷组、物理卷设备，这个顺序不可颠倒</p>
<p>第1步:取消逻辑卷与目录的挂载关联，删除配置文件中永久生效的设备参数</p>
<p><img src="/media/e3b647525d5b9d69a94662e2d9bdbe3c.png" alt="截图.png"></p>
<p><img src="/media/15a501a7fd02837c2658a5a91cc6415e.png" alt="截图.png"></p>
<p>第2步:删除逻辑卷设备，需要输入y来确认操作</p>
<p><img src="/media/0147f7d3f2102d4e3907ef49c1743444.png" alt="截图.png"></p>
<p>第3步:删除卷组，此处只写卷组名称即可，不需要设备的绝对路径</p>
<p><img src="/media/8af955b6f8c607c742fe2432e521c9e8.png" alt="截图.png"></p>
<p>第4步:删除物理卷设备</p>
<p><img src="/media/d524a7f16cd8c9bb09eeca67b2e4ca1f.png" alt="截图.png"></p>
<p>上述操作执行完毕之后，再执行lvdisplay、vgdisplay、pvdisplay命令查看LVM的信息时就不会再看到相关信息了(前提是上述步骤的操作是正确的)</p>
<h1 id="7-使用iptables与firewalld防火墙"><a href="#7-使用iptables与firewalld防火墙" class="headerlink" title="7 使用iptables与firewalld防火墙"></a>7 使用iptables与firewalld防火墙</h1><h2 id="7-1-防火墙管理工具"><a href="#7-1-防火墙管理工具" class="headerlink" title="7.1 防火墙管理工具"></a>7.1 防火墙管理工具</h2><p>​       相较于企业内网，外部的公网环境更加恶劣，罪恶丛生。公网与企业内网之间充当保护屏障的防火墙(下图)虽然有软件或硬件之分，但主要功能都是依据策略对穿越防火墙自身的流量进行过滤。防火墙策略可以基于流量的源目地址、端口号、协议、应用等信息来定制，防火墙使用预先定制的策略规则监控出入的流量，若流量与某一条策略规则相匹配，则执行相应的处理，反之则丢弃。这样一来，就能够保证仅有合法的流量在企业内网和外部公网之间流动了</p>
<p><img src="/media/8f89bd2b5983175c9c2d54dcee87c1b8.png" alt="截图.png"></p>
<p>​      从RHEL 7系统开始，firewalld防火墙正式取代了iptables防火墙。iptables与firewalld都不是真正<br>的防火墙，都只是用来定义防火墙策略的防火墙管理工具而已；或者说，只是一种服务。iptables服务会把配置好的防火墙策略交由内核层面的netfilter网络过滤器来处理，而firewalld服务则是把配置好的防火墙策略交由内核层面的nftables包过滤框架来处理。当前在Linux系统中其实存在多个防火墙管理工具，旨在方便运维人员管理Linux系统中的防火墙策略</p>
<h2 id="7-2-iptables"><a href="#7-2-iptables" class="headerlink" title="7.2 iptables"></a>7.2 iptables</h2><p>​     早期的Linux系统默认使用的是iptables防火墙管理服务来配置防火墙。尽管新型的firewalld防火墙管理服务已被投入使用多年，但是大量的企业在生产环境中依然出于各种原因而继续使用 iptables</p>
<h3 id="策略与规则链"><a href="#策略与规则链" class="headerlink" title="策略与规则链"></a>策略与规则链</h3><p>​      防火墙按照从上到下的顺序来读取配置的策略规则，在找到匹配项后立即结束匹配工作并去执行匹配项中定义的行为(即放行或阻止)。如果在读取完所有的策略规则之后没有匹配项，就去执行默认的策略。防火墙策略规则的设置一般有两种：”通”(放行)和”堵”(阻止)。当防火墙的默认策略为拒绝时(堵)，就要设置允许规则(通)，否则谁都进不来；如果防火墙的默认策略为允许，就要设置拒绝规则，否则谁都能进来，防火墙也就失去了防范的作用</p>
<p>​      iptables服务把用于处理或过滤流量的策略条目称之为规则，多条规则可以组成一个规则链，而规则链则依据数据包处理位置的不同进行分类，具体如下：</p>
<p>1.在进行路由选择前处理数据包(PREROUTING)</p>
<p>2.处理流入的数据包(INPUT)</p>
<p>3.处理流出的数据包(OUTPUT)</p>
<p>4.处理转发的数据包(FORWARD)</p>
<p>5.在进行路由选择后处理数据包(POSTROUTING)</p>
<p>从内网向外网发送的流量一般都是可控且良性的，因此使用最多的就是INPUT规则链，该规则链可以增大黑客人员从外网入侵内网的难度。</p>
<p>​      iptables服务的术语中分别有ACCEPT（允许流量通过）、REJECT（拒绝流量通过）、LOG（记录日志信息）、DROP（拒绝流量通过）。”允许流量通过”和”记录日志信息”都比较好理解，就DROP来说，它是直接将流量丢弃而且不响应；REJECT则会在拒绝流量后再回复一条”信息已经收到，但是被扔掉了”信息，从而让流量发送方清晰地看到数据被拒绝的响应信息。</p>
<p>注明:在红帽认证考试中必须用REJECT进行拒绝，好让用于判分的脚本得到反应，以获得分值。而在工作中更多建议用DROP进行拒绝，这可以隐藏服务器的运行状态。</p>
<p>​      把Linux系统中的防火墙策略设置为REJECT动作后，流量发送方会看到端口不可达的响应：</p>
<p><img src="/media/5a9b203106332508d7e4844e79ead4e8.png" alt="截图.png"></p>
<p>​      把Linux系统中的防火墙策略修改成DROP动作后，流量发送方会看到响应超时的提醒。但是流量发送方无法判断流量是被拒绝，还是接收方主机当前不在线：</p>
<p><img src="/media/7707d02b61107dd967981c0fcf7893c7.png" alt="截图.png"></p>
<h3 id="基本命令参数"><a href="#基本命令参数" class="headerlink" title="基本命令参数"></a>基本命令参数</h3><p>​       根据OSI七层模型的定义，iptables属于数据链路层的服务，所以可以根据流量的源地址、目的地址、传输协议、服务类型等信息进行匹配；一旦匹配成功，iptables就会根据策略规则所预设的动作来处理这些流量。防火墙策略规则的匹配顺序是从上到下的，因此要把较为严格、优先级较高的策略规则放到前面，以免发生错误。</p>
<p>常用的iptables命令参数如下：</p>
<p><img src="/media/b640ee302b892a1d485a8f522340a563.png" alt="截图.png"></p>
<p>实验1:在iptables命令后添加-L参数查看已有的防火墙规则链</p>
<p><img src="/media/5c4bf81faf78f7e1c3ea4faba4bdd04d.png" alt="截图.png"></p>
<p>实验2:在iptables命令后添加-F参数清空已有的防火墙规则链</p>
<p><img src="/media/6c021b9a07bf87ec773275102bfa4bc9.png" alt="截图.png"></p>
<p>实验3:把INPUT规则链的默认策略设置为拒绝</p>
<p><img src="/media/3e8e1ebba74251a5dc2c94efd1861b8f.png" alt="截图.png"></p>
<p>防火墙策略规则的设置无非有两种方式：”通”和”堵”。当把INPUT链设置为默认拒绝后，就要往里面写入允许策略了，否则所有流入的数据包都会被默认拒绝掉。规则链的默认策略拒绝动作只能是DROP，而不能是REJECT</p>
<p>实验4:向INPUT链中添加允许ICMP流量进入的策略规则</p>
<p>运维工作中，经常会使用ping命令来检查对方主机是否在线，而向防火墙的INPUT规则链中添加一条允许ICMP流量进入的策略规则就默认允许了这种ping命令检测行为</p>
<p><img src="/media/ccdaad8a986f5c79ad75bb493e920b20.png" alt="截图.png"></p>
<p>实验5:删除INPUT规则链中刚刚加入的那条策略(允许ICMP流量)，并把默认策略设置为允许</p>
<p>使用-F参数会清空已有的所有防火墙策略；使用-D参数可以删除某一条指定的策略，因此更加安全和准确</p>
<p><img src="/media/1b53515b048a4e1a1b4064f2f05c4c84.png" alt="截图.png"></p>
<p>实验6:将INPUT规则链设置为只允许指定网段的主机访问本机的22端口，拒绝来自其他所有主机的流量</p>
<p>要对某台主机进行匹配，可直接写出它的IP地址；如需对网段进行匹配，则需要写为子网掩码的形式(比如192.168.10.0&#x2F;24)</p>
<p><img src="/media/719cf110b2c591e1e621b0171ca818b1.png" alt="截图.png"></p>
<p>防火墙策略规则是按照从上到下的顺序匹配的，因此一定要把允许动作放到拒绝动作前面，否则所有的流量就将被拒绝掉，从而导致任何主机都无法访问我们的服务。这里提到的22号端口是ssh服务使用的</p>
<p>在设置完上述INPUT规则链之后，使用IP地址在192.168.10.0&#x2F;24网段内的主机访问服务器的22端口，效果如下：</p>
<p><img src="/media/27e325ac4955c11295482cb6f1af67b8.png" alt="截图.png"></p>
<p>使用IP地址在192.168.20.0&#x2F;24网段内的主机访问服务器的22端口（虽网段不同，但已确认可以相互通信），效果如下：</p>
<p><img src="/media/2d6eadb2d27a8c2a7e05178b01755233.png" alt="截图.png"></p>
<p>由上可以看到，提示连接请求被拒绝了(Connection failed)</p>
<p>实验7:向INPUT规则链中添加拒绝所有人访问本机12345端口的策略规则</p>
<p><img src="/media/ce678e5d00178a92ab1f95dbf8beaf4c.png" alt="截图.png"></p>
<p>实验8:向INPUT规则链中添加拒绝192.168.10.5主机访问本机80端口(Web服务)的策略规则</p>
<p><img src="/media/285b988bb0177891d2963eddba08ec93.png" alt="截图.png"></p>
<p>实验9:向INPUT规则链中添加拒绝所有主机访问本机1000～1024端口的策略规则</p>
<p>​          添加防火墙策略时，使用的是-I参数，默认会把规则添加到最上面的位置，因此优先级是最高的。如果需要添加一条最后”兜底”的规则，就用-A参数。这两个参数的效果差别还是很大的：</p>
<p><img src="/media/837510824cc267b9791c54b5d8235d78.png" alt="截图.png"></p>
<p>使用iptables命令配置的防火墙规则默认会在系统下一次重启时失效，如果想让配置的防火墙策略永久生效，还要执行保存命令：</p>
<p><img src="/media/dfa62fe1e917dc04387ab0a68c21ffa5.png" alt="截图.png"></p>
<p>如果服务器是5&#x2F;6&#x2F;7版本的话，对应的保存命令应该是：</p>
<p><img src="/media/c9bd8a93be5bd5dc676ffb594684e484.png" alt="截图.png"></p>
<h2 id="7-3-firewalld"><a href="#7-3-firewalld" class="headerlink" title="7.3 firewalld"></a>7.3 firewalld</h2><p>​        RHEL 8系统中集成了多款防火墙管理工具，其中firewalld(动态防火墙管理器)服务是默认的防火墙配置管理工具，拥有基于CLI(命令行界面)和基于GUI(图形用户界面)的两种管理方式</p>
<p>​        firewalld支持动态更新技术并加入了区域(zone)的概念。区域就是firewalld预先准备了几套防火墙策略集合(策略模板)，用户可以根据生产场景的不同而选择合适的策略集合，从而实现防火墙策略之间的快速切换</p>
<p>​        firewalld中常见的区域名称(默认为public)以及相应的策略规则如表：</p>
<p><img src="/media/2c9f3a827a11df0ea233fda21494410a.png" alt="截图.png"></p>
<h3 id="终端管理工具"><a href="#终端管理工具" class="headerlink" title="终端管理工具"></a>终端管理工具</h3><p>命令行终端是一种极富效率的工作方式，firewall-cmd是firewalld防火墙配置管理工具的CLI(命令行界面)版本。参数一般都是以”长格式”来提供的</p>
<p>firewall-cmd命令中使用的参数以及作用：</p>
<p><img src="/media/89c611c5899ef27e7f47a7a5b20e970a.png" alt="截图.png"></p>
<p>使用firewalld配置的防火墙策略默认为运行时(Runtime)模式，又称为当前生效模式，会随着系统的重启而失效。想让配置策略一直存在，需要使用永久(Permanent)模式了，方法是在用firewall-cmd命令正常设置防火墙策略时添加–permanent参数，这样配置的防火墙策略就可以永久生效了。但永久生效模式设置的策略只有在系统重启之后才能自动生效。如果想让配置的策略立即生效，需要手动执行firewall-cmd –reload命令</p>
<p>Runtime:当前立即生效，重启后失效</p>
<p>Permanent:当前不生效，重启后生效</p>
<p>配置时需注意是Runtime模式还是Permanent 模式</p>
<p>实验1：查看firewalld服务当前所使用的区域</p>
<p>配置防火墙策略前，必须查看当前生效的是哪个区域，否则配置的防火墙策略将不会立即生效</p>
<p><img src="/media/da5fa55fee03c28ffffb87bdae2fca17.png" alt="截图.png"></p>
<p>实验2：查询指定网卡在firewalld服务中绑定的区域</p>
<p>服务器大多不止有一块网卡</p>
<p>一般充当网关的服务器有对公网和对内网两块网卡，两块网卡在审查流量时所用的策略也不一致</p>
<p>根据网卡针对的流量来源，为网卡绑定不同的区域，实现对防火墙策略的灵活管控</p>
<p><img src="/media/5af1bdd76921ae6288ef964f984d8e2d.png" alt="截图.png"></p>
<p>实验3:把网卡默认区域修改为external，并在系统重启后生效</p>
<p><img src="/media/abb1ff453fdf5e8cf3db53ca330240f4.png" alt="截图.png"></p>
<p>实验4:把firewalld服务的默认区域设置为public</p>
<p>默认区域也叫全局配置，指对所有网卡都生效的配置，优先级较低</p>
<p>当前默认区域为public，而ens160网卡的区域为external。此时便是以网卡的区域名称为准</p>
<p>默认区域是一种通用的政策</p>
<p><img src="/media/1aaca41ade0ed139f1ed08bdb0328dfc.png" alt="截图.png"></p>
<p>实验5:启动和关闭firewalld防火墙服务的应急状况模式</p>
<p>如果想在1s的时间内阻断一切网络连接，有什么好办法呢？</p>
<p>“拔掉网线”是一个物理级别的高招。但是，如果人在北京，服务器在异地呢？panic紧急模式在这个时候就派上用场了。</p>
<p>使用–panic-on 参数会立即切断一切网络连接，而使用–panic-off则会恢复网络连接。</p>
<p>紧急模式会切断一切网络连接，因此在远程管理服务器时，在按下回车键前一定要三思</p>
<p><img src="/media/776c27d06da4ab82f535451ee5170c91.png" alt="截图.png"></p>
<p>实验6:查询SSH和HTTPS协议的流量是否允许放行</p>
<p>工作中可不使用–zone参数指定区域名称，firewall-cmd命令会自动依据默认区域进行查询，从而减少用户输入量。</p>
<p>但如果默认区域与网卡所绑定的不一致时，就会发生冲 突，因此规范写法的zone参数是一定要加的**</p>
<p><img src="/media/653f4c9162c7fe5869e819fc65302f33.png" alt="截图.png"></p>
<p>实验7:把HTTPS协议的流量设置为永久允许放行，并立即生效</p>
<p>默认情况下进行的修改都属于Runtime模式，即当前生效而重启后失效，因此在工作和考试中尽量避免使用</p>
<p>在使用–permanent参数时，则是当前不会立即看到效果，而在重启或重新加载后方可生效</p>
<p>在添加了允许放行 HTTPS 流量的策略后，查询当前模式策略，发现依然是不允许放行HTTPS协议的流量：</p>
<p><img src="/media/85a1d0ff9df3f14a6b9872b06cdfa2cb.png" alt="截图.png"></p>
<p>不重启服务器的话，就用–reload参数：</p>
<p><img src="/media/e294bc1e9e67b00b850e3a48a7518a79.png" alt="截图.png"></p>
<p>实验8:把HTTP协议的流量设置为永久拒绝，并立即生效</p>
<p>由于在默认情况下HTTP协议的流量就没有被允许，所以会有”Warning:NOT_ENABLED: http”这样的提示信息，因此对实际操作没有影响</p>
<p><img src="/media/5e61081d959fd13783e0b0c305915c49.png" alt="截图.png"></p>
<p>实验9:把访问8080和8081端口的流量策略设置为允许，但仅限当前生效</p>
<p><img src="/media/847ba131605b44a419bb49c8c8a42cca.png" alt="截图.png"></p>
<p>实验10:把原本访问本机888端口的流量转发到22端口，要且求当前和长期均有效</p>
<p>第9章介绍的SSH远程控制协议是基于TCP&#x2F;22端口传输控制指令的，如果想让用户通过其他端口号也能访问ssh服务，就可以试试端口转发技术了</p>
<p>通过这项技术，新的端口号在收到用户请求后会自动转发到原本服务的端口上，使得用户能够通过新的端口访问到原本的服务</p>
<p>使用firewall-cmd命令实现端口转发的格式有点长：</p>
<p><img src="/media/61281b2171130e49fd1b27a89839e46d.png" alt="截图.png"></p>
<p>上述命令中的目标IP地址一般是服务器本机的IP地址：</p>
<p><img src="/media/3d1c9990e327c834467734a767c4d34d.png" alt="截图.png"></p>
<p>在客户端使用ssh命令尝试访问192.168.10.10主机的888端口，访问成功：</p>
<p><img src="/media/2cbd57d24817128dbb31d221fe0c2932.png" alt="截图.png"></p>
<p>实验11:富规则的设置。它的优先级在所有的防火墙策略中也是最高的</p>
<p>富规则也叫复规则，表示更细致、更详细的防火墙策略配置，可以针对系统服务、端口号、源地址和目标地址等诸多信息进行更有针对性的策略配置</p>
<p>优先级在所有的防火墙策略中也是最高的。在firewalld服务中配置一条富规则，使其拒绝192.168.10.0&#x2F;24网段的所有用户访问本机的ssh服务(22<br>端口)：</p>
<p><img src="/media/b0477fd34f197d90d806599cd7a0cc23.png" alt="截图.png"></p>
<p>在客户端使用ssh命令尝试访问192.168.10.10主机的ssh服务(22端口)：</p>
<p><img src="/media/ce0b435c3d4421d826e867bd1dacab7a.png" alt="截图.png"></p>
<h3 id="图形管理工具"><a href="#图形管理工具" class="headerlink" title="图形管理工具"></a>图形管理工具</h3><p>firewall-config是firewalld防火墙配置管理工具的GUI(图形用户界面)版本，几乎可以实现所有以命令行来执行的操作。</p>
<p>默认情况下系统并没有提供firewall-config命令，需要自行用dnf命令进行安装，所以需要先配置软件仓库。</p>
<p>首先将虚拟机的”CD&#x2F;DVD(SATA)光盘选项设置为”使用ISO映像文件”，然后选择已经下载好的系统镜像，下图所示：</p>
<p><img src="/media/6538be872d831b4d81a379556191e61c.png" alt="截图.png"></p>
<p>把光盘设备中的系统镜像挂载到&#x2F;media&#x2F;cdrom目录：</p>
<p><img src="/media/761675b7cd2b0306adcfc8fa19377ca9.png" alt="截图.png"></p>
<p>为了软件仓库一直为用户提供服务，严谨的做法是将系统镜像文件的挂载信息写到&#x2F;etc&#x2F;fstab文件中：</p>
<p><img src="/media/da6a015f3e20a682516f9d509b6efe1c.png" alt="截图.png"></p>
<p>最后，使用Vim文本编辑器创建软件仓库的配置文件。与之前版本的系统不同，RHEL 8需要配置两个软件仓库([BaseOS]与[AppStream])，且缺一不可：</p>
<p><img src="/media/68d96714d159b37223f1429c1c829a53.png" alt="截图.png"></p>
<p>正确配置完软件仓库文件后，可以开始用yum或dnf命令安装软件了</p>
<p>这两个命令在实际操作中除了名字不同外，执行方法完全一致，可随时用yum替代dnf</p>
<p>安装firewalld图形用户界面工具：</p>
<p><img src="/media/1db29f81f305e9054b078e172c487bee.png" alt="截图.png"></p>
<p>终端执行firewall-config打开firewall-config工具的界面如下图所示，其功能具体如下：</p>
<p><img src="/media/a3367336610c3616eeed8f46a8a62277.png" alt="截图.png"></p>
<p>1：选择运行时（Runtime）或永久（Permanent）模式的配置</p>
<p>2：可选的策略集合区域列表</p>
<p>3：常用的系统服务列表</p>
<p>4：主机地址的黑白名单</p>
<p>5：当前正在使用的区域</p>
<p>6：管理当前被选中区域中的服务</p>
<p>7：管理当前被选中区域中的端口</p>
<p>8：设置允许被访问的协议</p>
<p>9：设置允许被访问的端口</p>
<p>10：开启或关闭SNAT（源网络地址转换）技术</p>
<p>11：设置端口转发策略</p>
<p>12：控制请求icmp服务的流量</p>
<p>13：管理防火墙的富规则</p>
<p>14：被选中区域的服务，若勾选了相应服务前面的复选框，则表示允许与之相关的流量</p>
<p>15：firewall-config工具的运行状态</p>
<p>除上图中列出的功能，还有用于将网卡与区域绑定的Interfaces选项，以及用于将IP地址与区域绑定的Sources选项</p>
<p>在使用firewall-config工具配置完防火墙策略之后，无须进行二次确认，只要有修改内容，就自动进行保存：</p>
<p><img src="/media/564f25570a64fd45f93a9d21fb263aa5.png" alt="截图.png"></p>
<p>1.将当前区域中请求http服务的流量设置为允许放行，但仅限当前生效。具体配置如下图所示：</p>
<p><img src="/media/699646d73f0c11a5dafd1a99ca23a68e.png" alt="截图.png"></p>
<p>2.添加一条防火墙策略规则，使其放行访问8080～8088端口(TCP协议)的流量，并将其设置为永久生效，以达到系统重启后防火墙策略依然生效的目的。在按照下图1所示的界面配置完毕之后，还需要在Options菜单中单击Reload Firewalld命令，让配置的防火墙策略立即生效(见图2)。这与在命令行中使用–reload 参数的效果一样。讲解firewall-config工具的功能时，提到了SNAT(Source Network Address Translation，源网络地址转换)技术</p>
<p>SNAT是一种为解决IP地址匮乏而设计的技术，可以使得多个内网中的用户通过同一个外网IP接入Internet</p>
<p>该技术的应用非常广泛，比如，当通过家中的网关设备（无线路由器）</p>
<p>访问本书配套站点<a target="_blank" rel="noopener" href="http://www.linuxprobe.com时,就用到了snat技术./">www.linuxprobe.com时，就用到了SNAT技术。</a></p>
<p>放行访问8080～8088端口的流量：</p>
<p><img src="/media/80470b1e492d0006056a4a368d2ede19.png" alt="截图.png"></p>
<p>让配置的防火墙策略规则立即生效：</p>
<p><img src="/media/3c78bd86a7a54b4929ff8e81ca95c4ee.png" alt="截图.png"></p>
<p>网络中不使用SNAT技术(图1)和使用SNAT技术(图2)时的情况。在图1所示的局域网中有多台PC，如果网关服务器没有应用SNAT技术，则互联网中的网站服务器在收到PC的请求数据包，并回送响应数据包时，将无法在网络中找到这个私有网络的IP地址，所以PC也就收不到响应数据包了。在图2所示的局域网中，由于网关服务器应用了SNAT技术，所以互联网中的网站服务器会将响应数据包发给网关服务器，再由后者转发给局域网中的PC</p>
<p>没有使用SNAT技术的网络：</p>
<p><img src="/media/64f2313af86e359d06f6ea53a5992b41.png" alt="截图.png"></p>
<p>使用SNAT技术处理过的网络：</p>
<p><img src="/media/fd5b3a8a6637a8b6117de464a4d08bb5.png" alt="截图.png"></p>
<p>使用iptables命令实现SNAT技术是一件很麻烦的事情，但是在firewall-config中却很简单。用户只需按照下图进行配置，并选中Masquerade<br>zone复选框，就自动开启了SNAT 技术。</p>
<p><img src="/media/e4e60f6d76e53ea969de6e5358e8dda6.png" alt="截图.png"></p>
<p>为了直观查看不同工具在实现相同功能时的区别，针对前面使用firewall-cmd配置的防火墙策略规则，使用firewall-config工具进行了重新演示：将本机888端口的流量转发到22端口，且要求当前和长期均有效，具体如下面图1和图2所示。</p>
<p>配置本地端口转发：</p>
<p><img src="/media/64617bf533c8e5ca91f94c7c9321cf67.png" alt="截图.png"></p>
<p>让防火墙策略规则立即生效：</p>
<p><img src="/media/61ec735e558be385d467051cff4d438c.png" alt="截图.png"></p>
<p>用命令配置富规则可真辛苦，幸好现在有了图形用户界面的工具。让192.168.1.31主机访问本机的1234端口号，如下图所示。其中Element选项能够根据服务名称、端口号、协议等信息进行匹配；Source与Destination选项后的inverted复选框代表反选功能，将其选中则代表对已填写信息进行反选，即选中填写信息以外的主机地址；Log复选框在选中后，日志不仅会被记录到日志文件中，而且还可以在设置日志的级别(Level)后，再将日志记录<br>到日志文件中，以方便后续的筛查。</p>
<p><img src="/media/78bc2da4b3eea80cef8e3f8f73728647.png" alt="截图.png"></p>
<p>如果生产环境中的服务器有多块网卡在同时提供服务，则对内网和对外网提供服务的网卡要选择的防火墙策略区域也是不一样的。也就是说，可以把网卡与防火墙策略区域进行绑定(下图)，这样就可以使用不同的防火墙区域策略，对源自不同网卡的流量进行有针对性的监控，效果会更好。</p>
<p><img src="/media/cdc8ca22159442075fd9131e2870e156.png" alt="截图.png"></p>
<h2 id="7-4-服务的访问控制列表"><a href="#7-4-服务的访问控制列表" class="headerlink" title="7.4 服务的访问控制列表"></a>7.4 服务的访问控制列表</h2><p>​      TCP Wrapper是RHEL 6&#x2F;7系统中默认启用的一款流量监控程序，根据来访主机的地址与本机的目标服务程序做出允许或拒绝的操作</p>
<p>​      在RHEL 8中，已被firewalld正式替代。换句话说，Linux系统中其实有两个层面的防火墙，第一种是前面讲到的基于TCP&#x2F;IP协议的流量过滤工具，而TCP Wrapper服务则是能允许或禁止Linux系统提供服务的防火墙，从而在更高层面保护了Linux系统的安全运行</p>
<p>​      TCP Wrapper服务的防火墙策略由两个控制列表文件所控制，用户可以编辑允许控制列表文件来放行对服务的请求流量，也可以编辑拒绝控制列表文件来阻止对服务的请求流量</p>
<p>​     控制列表文件修改后会立即生效，系统将会先检查允许控制列表文件(&#x2F;etc&#x2F;hosts.allow)，如果匹配到相应的允许策略则放行流量；如果没有匹配，则会进一步匹配拒绝控制列表文件(&#x2F;etc&#x2F;hosts.deny)，若找到匹配项则拒绝该流量。如果这两个文件都没有匹配到，则默认放行流量</p>
<p>​     由于RHEL 8版本已不再支持TCP Wrapper服务程序，因此我们接下来选择在一台老版本的服务器上进行实验</p>
<p>​     TCP Wrapper服务的控制列表文件配置起来并不复杂，常用的参数 如下表所示：</p>
<p><img src="/media/3304ebc829db2f48841a2039f4830f6f.png" alt="截图.png"></p>
<p>在配置TCP Wrapper服务时需要遵循两个原则：</p>
<p>1.编写拒绝策略规则时，填写的是服务名称，而非协议名称</p>
<p>2.建议先编写拒绝策略规则，再编写允许策略规则，以便直观地看到相应的效果</p>
<p>下面编写拒绝策略规则文件，禁止访问本机sshd服务的所有流量(无须修改&#x2F;etc&#x2F;hosts.deny文件中原有的注释信息)：</p>
<p><img src="/media/55c2495c045c8ecd4f74b5fb72519292.png" alt="截图.png"></p>
<p><img src="/media/e5c1ae1cc1aa79163a6db250e6698b7f.png" alt="截图.png"></p>
<p><img src="/media/447696bd43d1c27f205d4cd980430cfc.png" alt="截图.png"></p>
<p>​       在允许策略规则文件中添加一条规则，使其放行源自192.168.10.0&#x2F;24网段，且访问本机sshd服务的所有流量。可以看到，服务器立刻就放行了访问sshd服务的流量，效果非常直观：</p>
<p><img src="/media/db5713e58f163eef27471066dfc8c325.png" alt="截图.png"></p>
<p><img src="/media/5ba98a859df553154a1032f948a3469b.png" alt="截图.png"></p>
<h2 id="7-5-Cockpit驾驶舱管理工具"><a href="#7-5-Cockpit驾驶舱管理工具" class="headerlink" title="7.5 Cockpit驾驶舱管理工具"></a>7.5 Cockpit驾驶舱管理工具</h2><p>Cockpit在默认情况下就已经被安装到系统中。执行dnf命令对此进行确认：</p>
<p><img src="/media/4a667e0461ab02671e3a8c83054fe1ea.png" alt="截图.png"></p>
<p>Cockpit服务程序在RHEL<br>8版本中没有自动运行，将它开启并加入到开机启动项中：</p>
<p><img src="/media/b0981c20a614c98c854720137fb448c6.png" alt="截图.png"></p>
<p>备注:Cookpit其他知识见书籍即可</p>
<h1 id="8-提高命令行生产率"><a href="#8-提高命令行生产率" class="headerlink" title="8 提高命令行生产率"></a>8 提高命令行生产率</h1><h2 id="8-1-脚本的分类"><a href="#8-1-脚本的分类" class="headerlink" title="8.1 脚本的分类"></a>8.1 脚本的分类</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 系统      </span></span><br><span class="line">--------- --------------------------------</span><br><span class="line">Windows   *.bat,*.cmd,.vbd</span><br><span class="line">Linux     <span class="comment">#!/bin/bash , chmod +x file.sh</span></span><br></pre></td></tr></table></figure>

<h2 id="8-2-创建和执行脚本"><a href="#8-2-创建和执行脚本" class="headerlink" title="8.2 创建和执行脚本"></a>8.2 创建和执行脚本</h2><h3 id="指定命令解释器"><a href="#指定命令解释器" class="headerlink" title="指定命令解释器"></a><strong>指定命令解释器</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@foundation0 ~]# vim /test.sh     <span class="comment">#掌握</span></span><br><span class="line"><span class="comment">#!/bin/bash                            #指定解释器为/bin/bash</span></span><br><span class="line"><span class="built_in">date</span></span><br><span class="line"><span class="built_in">echo</span>  <span class="string">&quot;hello world&quot;</span></span><br><span class="line"></span><br><span class="line">[root@foundation0 ~]# <span class="built_in">chmod</span> +x test.sh  <span class="comment">#赋予脚本执行权限</span></span><br><span class="line">[root@foundation0 ~]# <span class="built_in">cd</span> /</span><br><span class="line">[root@foundation0 ~]# ./test.sh          <span class="comment">#可以通过./这种相对路径方式执行脚本</span></span><br><span class="line">[root@foundation0 ~]# /root/test.sh      <span class="comment">#或通过绝对路径方式执行脚本</span></span><br><span class="line"></span><br><span class="line">[root@foundation0 bin]# first.sh </span><br><span class="line">hello world</span><br><span class="line">[root@foundation0 bin]# sh first.sh </span><br><span class="line">hello world</span><br><span class="line">[root@foundation0 bin]# bash first.sh </span><br><span class="line">hello world</span><br><span class="line">[root@foundation0 bin]# <span class="built_in">source</span> first.sh </span><br><span class="line">hello world</span><br><span class="line">[root@foundation0 bin]# . first.sh    </span><br><span class="line">hello world</span><br><span class="line"></span><br><span class="line">脚本中需要书写解释器#!/bin/bash，脚本内容可以是linux命令。linux系统可以通过/etc/shells查看支持的shell类型。也可以通过<span class="built_in">echo</span> <span class="variable">$SHELL</span>来查看当前系统正在使用的shell类型</span><br></pre></td></tr></table></figure>

<h3 id="执行Bash-Shell"><a href="#执行Bash-Shell" class="headerlink" title="执行Bash Shell"></a><strong>执行Bash Shell</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@foundation0 /]# <span class="built_in">which</span> <span class="built_in">ls</span></span><br><span class="line"></span><br><span class="line">[root@foundation0 /]# <span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</span><br><span class="line"></span><br><span class="line">练习:</span><br><span class="line">[root@servera ~]# <span class="built_in">ls</span></span><br><span class="line">findfiles  test.sh</span><br><span class="line">[root@servera opt]# <span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line">/root/.local/bin:/root/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin</span><br><span class="line">[root@servera opt]# <span class="built_in">mkdir</span> /root/bin</span><br><span class="line"> [root@servera opt]# <span class="built_in">mv</span> /root/test.sh /root/bin/</span><br><span class="line">[root@servera opt]# <span class="built_in">ls</span> /root/bin/</span><br><span class="line">test.sh</span><br><span class="line">[root@servera opt]# test.sh</span><br><span class="line">Sat Jul 13 09:49:11 PM EDT 2024</span><br></pre></td></tr></table></figure>

<h3 id="对特殊字符加引号"><a href="#对特殊字符加引号" class="headerlink" title="对特殊字符加引号"></a><strong>对特殊字符加引号</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">\, <span class="string">&#x27;&#x27;</span> , <span class="string">&quot;&quot;</span>   <span class="comment">#掌握</span></span><br><span class="line"></span><br><span class="line">[root@servera /]# <span class="built_in">echo</span> <span class="variable">$SHELL</span></span><br><span class="line">/bin/bash</span><br><span class="line">[root@servera /]# <span class="built_in">echo</span> <span class="string">&#x27;$SHELL&#x27;</span></span><br><span class="line"><span class="variable">$SHELL</span></span><br><span class="line">[root@servera /]# <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$SHELL</span>&quot;</span></span><br><span class="line">/bin/bash</span><br><span class="line">[root@servera /]# <span class="built_in">echo</span> <span class="string">&#x27;$SHELL world&#x27;</span> <span class="comment">#单引号内容是普通字符串，变量不生效</span></span><br><span class="line"><span class="variable">$SHELL</span> world</span><br><span class="line">[root@servera /]# <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$SHELL</span> world&quot;</span> <span class="comment">#双引号内变量生效</span></span><br><span class="line">/bin/bash world</span><br><span class="line"></span><br><span class="line">【f0】</span><br><span class="line">[kiosk@foundation0 ~]$ <span class="built_in">echo</span> <span class="variable">$HOSTNAME</span></span><br><span class="line">[kiosk@foundation0 ~]$ ssh root@bastion <span class="string">&#x27;touch /tmp/$HOSTNAME&#x27;</span>     </span><br><span class="line">[kiosk@foundation0 ~]$ ssh root@bastion <span class="string">&#x27;ls /tmp&#x27;</span></span><br><span class="line">-rw-r--r--. 1 root root  0 Jul 13 22:13 bastion.lab.example.com</span><br><span class="line"></span><br><span class="line">[kiosk@foundation0 ~]$ ssh root@bastion <span class="string">&quot;touch /tmp/<span class="variable">$HOSTNAME</span>&quot;</span>     </span><br><span class="line">[kiosk@foundation0 ~]$ ssh root@bastion <span class="string">&#x27;ls -l /tmp&#x27;</span></span><br><span class="line">total 16</span><br><span class="line">-rw-r--r--. 1 root root  0 Jul 13 22:13 bastion.lab.example.com</span><br><span class="line">-rw-r--r--. 1 root root  0 Jul 13 22:15 foundation0.ilt.example.com</span><br></pre></td></tr></table></figure>

<h3 id="与"><a href="#与" class="headerlink" title="``与$()"></a><strong>``与$()</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">`命令`   <span class="comment">#掌握  优先执行</span></span><br><span class="line">$(命令)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">在shell中设置一个变量暂时使用</span><br><span class="line">[root@servera /]# var=`<span class="built_in">date</span>`</span><br><span class="line">[root@servera /]# var=$(<span class="built_in">date</span>)</span><br><span class="line">[root@servera /]# <span class="built_in">echo</span> <span class="string">&#x27;to day $var&#x27;</span></span><br><span class="line">to day <span class="variable">$var</span></span><br><span class="line">[root@servera /]# <span class="built_in">touch</span> $(<span class="built_in">date</span> +%H%M%S).txt</span><br><span class="line">取消一个变量</span><br><span class="line">[root@servera /]# <span class="built_in">unset</span> var</span><br><span class="line">[root@servera /]# <span class="built_in">echo</span> <span class="variable">$var</span></span><br><span class="line"></span><br><span class="line">第二个例子</span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line"><span class="built_in">echo</span> <span class="built_in">whoami</span></span><br><span class="line"><span class="built_in">echo</span> `<span class="built_in">whoami</span>`</span><br><span class="line"><span class="built_in">echo</span> $(<span class="built_in">whoami</span>)</span><br><span class="line"><span class="built_in">date</span></span><br><span class="line"><span class="built_in">echo</span> `<span class="built_in">date</span>`</span><br><span class="line">man <span class="built_in">date</span></span><br><span class="line"><span class="built_in">date</span> +%y%m%d</span><br><span class="line"><span class="built_in">date</span> +%Y%m%d</span><br><span class="line"><span class="built_in">date</span> +%Y-%m-%d</span><br><span class="line"><span class="built_in">echo</span> $(<span class="built_in">date</span> +%Y-%m-%d)</span><br><span class="line"><span class="built_in">touch</span> $(<span class="built_in">date</span> +%Y-%m-%d).txt</span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">tar -zcvf $(<span class="built_in">date</span> +%Y-%m-%d).tar.gz /etc/</span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line"><span class="built_in">cd</span> /</span><br><span class="line"></span><br><span class="line">既然可以通过``和$()的结果，通过<span class="built_in">echo</span>来通过标准输出打印到屏幕上，那么我们也可以将其应用到脚本。</span><br><span class="line">vim os.current</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">// <span class="built_in">echo</span>的<span class="string">&quot;-e&quot;</span>参数是启用反斜杠转义: </span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;User:\t&quot;</span> $(<span class="built_in">whoami</span>)</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;HOST:\t&quot;</span> `hostname`</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;ipv4:\t&quot;</span> $(ip a s eth0 | awk <span class="string">&#x27;/inet / &#123;print $2&#125;&#x27;</span>)</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;Memory:\t&quot;</span> $(free -h | awk <span class="string">&#x27;/Mem/ &#123;print $2&#125;&#x27;</span>) </span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;Disk:\t&quot;</span> $(<span class="built_in">df</span> -ht xfs | awk <span class="string">&#x27;/dev/ &#123;print $4&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> +x os.current </span><br><span class="line">./os.current </span><br></pre></td></tr></table></figure>

<h2 id="8-3-使用循环更高效的命令"><a href="#8-3-使用循环更高效的命令" class="headerlink" title="8.3 使用循环更高效的命令"></a><strong>8.3 使用循环更高效的命令</strong></h2><h3 id="for语句"><a href="#for语句" class="headerlink" title="for语句"></a><strong>for语句</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line"><span class="keyword">for</span> variable <span class="keyword">in</span> list</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">command</span> variable</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">例子：</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> 1 2 3    </span><br><span class="line">    <span class="keyword">do</span> </span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">例子2：</span><br><span class="line"><span class="keyword">for</span>  i <span class="keyword">in</span> 1 2 3;<span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># echo &#123;1..10&#125;</span></span><br><span class="line"><span class="comment"># echo $(seq 1 10)</span></span><br><span class="line"></span><br><span class="line">[root@servera ~]# <span class="built_in">echo</span> &#123;1..10&#125;      <span class="comment">#掌握</span></span><br><span class="line">1 2 3 4 5 6 7 8 9 10</span><br><span class="line">[root@servera ~]# <span class="built_in">echo</span> $(<span class="built_in">seq</span> 1 10)</span><br><span class="line">1 2 3 4 5 6 7 8 9 10</span><br><span class="line"></span><br><span class="line">[root@servera ~]# <span class="keyword">for</span> i <span class="keyword">in</span> host1 host2 host3;<span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$i</span>;<span class="keyword">done</span>    <span class="comment">#掌握</span></span><br><span class="line">host1</span><br><span class="line">host2</span><br><span class="line">host3</span><br><span class="line">[root@servera ~]# <span class="keyword">for</span> num <span class="keyword">in</span> host&#123;1..3&#125;;<span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$num</span>;<span class="keyword">done</span>         <span class="comment">#掌握</span></span><br><span class="line">host1</span><br><span class="line">host2</span><br><span class="line">host3</span><br><span class="line">[root@servera ~]# <span class="keyword">for</span> num <span class="keyword">in</span> `<span class="built_in">ls</span> /`;<span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$num</span>;<span class="keyword">done</span>             <span class="comment">#掌握</span></span><br><span class="line"></span><br><span class="line">[root@servera ~]# <span class="built_in">cd</span> /opt/</span><br><span class="line">[root@servera opt]# <span class="built_in">ls</span></span><br><span class="line">[root@servera opt]# <span class="built_in">touch</span> file&#123;1..3&#125;</span><br><span class="line">[root@servera opt]# <span class="built_in">ls</span></span><br><span class="line">file1  file2  file3</span><br><span class="line">[root@servera opt]# <span class="keyword">for</span> i <span class="keyword">in</span> file*;<span class="keyword">do</span> <span class="built_in">ls</span> <span class="variable">$i</span>;<span class="keyword">done</span></span><br><span class="line">file1</span><br><span class="line">file2</span><br><span class="line">file3</span><br><span class="line"></span><br><span class="line">[root@servera opt]# vim for.sh   <span class="comment">#(考点)</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> 1 2 3;<span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">[root@foundation0]#<span class="keyword">for</span> i <span class="keyword">in</span> bastion  workstation utility servera serverb;<span class="keyword">do</span> rht-vmctl start <span class="variable">$i</span>;<span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">小技巧</span><br><span class="line">[root@servera ~]# <span class="built_in">echo</span> <span class="variable">$&#123;HOSTNAME&#125;</span>O</span><br><span class="line">servera.lab.example.comO</span><br><span class="line">[root@servera ~]# <span class="built_in">echo</span> <span class="variable">$HOSTNAME</span>\O</span><br><span class="line">servera.lab.example.comO</span><br><span class="line"></span><br><span class="line">练习：</span><br><span class="line">[root@bastion /]# vim user_list.txt </span><br><span class="line">user1</span><br><span class="line">user2</span><br><span class="line">user3</span><br><span class="line"></span><br><span class="line">[root@servera ~]# vim user.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">cat</span> user_list.txt`;<span class="keyword">do</span></span><br><span class="line">        useradd testuser2 </span><br><span class="line">        <span class="built_in">echo</span> P@ssw0rduser2a | passwd --stdin testuser2</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">[root@servera ~]# sh user.sh</span><br></pre></td></tr></table></figure>

<h3 id="在脚本中使用退出代码"><a href="#在脚本中使用退出代码" class="headerlink" title="在脚本中使用退出代码"></a><strong>在脚本中使用退出代码</strong></h3><p>​      处理完所有内容后，脚本会退出到调用它的进程。但是，有时候可能需要加载完成之前退出脚本，比如加载遇到错误条件时。可以通过加载脚本中使用exit命令来实现这一目的。<br>​     当脚本遇到exit命令时，脚本将立即退出且不会对脚本的其余内容进行处理。<br>​     可以使用可选的整数参数（0到255之间，表示退出代码）来执行exit命令。退出代码进程完成后返回的代码。退出代码值0表示没有错误。所有其他非零值都表示存在错误的退出代码。<br>​      尽可以使用不同的非零值来区分遇到的不同类型错误。此退出代码传回到父进程，后这将它存储在？变量中，并可通过$?进行访问。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@servera /]# vim hello.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;hello world&quot;</span></span><br><span class="line"><span class="built_in">exit</span> 1</span><br><span class="line">[root@servera /]# <span class="built_in">echo</span> $?</span><br></pre></td></tr></table></figure>

<h3 id="使用运算符执行测试"><a href="#使用运算符执行测试" class="headerlink" title="使用运算符执行测试"></a><strong>使用运算符执行测试</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test与[]:</span></span><br><span class="line"><span class="built_in">test</span> 0 -ne 1 </span><br><span class="line">   36  <span class="built_in">echo</span> $?</span><br><span class="line">   37  <span class="built_in">test</span> 0 -ge 0 </span><br><span class="line">   38  <span class="built_in">echo</span> $?</span><br><span class="line">   39  <span class="built_in">test</span> 0 -ge 1 </span><br><span class="line">   40  <span class="built_in">echo</span> $?</span><br><span class="line">   41  <span class="built_in">test</span> 8 -gt 4</span><br><span class="line">   42  <span class="built_in">echo</span> $?</span><br><span class="line">   43  [ 0 -ge 0 ]</span><br><span class="line">   44  <span class="built_in">echo</span> $?</span><br><span class="line"></span><br><span class="line">-eq 等于则为真</span><br><span class="line">-ne 不等于则为真</span><br><span class="line">-gt 大于则为真</span><br><span class="line">-lt 小于则为真</span><br><span class="line">-ge 大于等于则为真</span><br><span class="line">-le 小于等于则为真</span><br><span class="line"></span><br><span class="line">字符串判断</span><br><span class="line">= ==  != </span><br><span class="line">[ 字符 == 字符 ]</span><br><span class="line">[ 字符 != 字符 ]</span><br><span class="line"></span><br><span class="line">单目，双目</span><br><span class="line">-e 文件和文件夹</span><br><span class="line">-f 普通文件</span><br><span class="line">-d 目录</span><br><span class="line">-c 设备文件</span><br></pre></td></tr></table></figure>

<h3 id="exit、if、elif、else"><a href="#exit、if、elif、else" class="headerlink" title="exit、if、elif、else"></a><strong>exit、if、elif、else</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ 条件 ]</span><br><span class="line">  <span class="keyword">then</span></span><br><span class="line">       声明</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ xx ];<span class="keyword">then</span></span><br><span class="line">     <span class="built_in">command</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"> </span><br><span class="line">一、</span><br><span class="line">vim if.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">if</span> [ 0 -ge 0 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> ok</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">二、</span><br><span class="line">vim test.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">if</span> [ -e /file1 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> one</span><br><span class="line">        <span class="built_in">exit</span> 10</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">三、</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">if</span> [ -e /file1 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> one</span><br><span class="line">        <span class="built_in">exit</span> 10</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> two</span><br><span class="line">        <span class="built_in">exit</span> 20</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">四、</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">if</span> [ -e /file1 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> one</span><br><span class="line">        <span class="built_in">exit</span> 10</span><br><span class="line"><span class="keyword">elif</span> [ -e /opt/file1 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> two</span><br><span class="line">        <span class="built_in">exit</span> 20</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> three</span><br><span class="line">        <span class="built_in">exit</span> 30</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h3 id="位置变量"><a href="#位置变量" class="headerlink" title="位置变量"></a><strong>位置变量</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $0、$1、$2..$9、$#:</span></span><br><span class="line">vim ping.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">ping -c <span class="variable">$2</span> 172.25.254.<span class="variable">$1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;$0: &#x27;</span> <span class="variable">$0</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;$1: &#x27;</span> <span class="variable">$1</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;$2: &#x27;</span> <span class="variable">$2</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;$3: &#x27;</span> <span class="variable">$3</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;$#: &#x27;</span> <span class="variable">$#</span></span><br><span class="line">[root@servera ~]# <span class="built_in">chmod</span> +x ping.sh</span><br><span class="line">[root@servera ~]# ./ping.sh 254 5</span><br><span class="line">PING 172.25.254.254 (172.25.254.254) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.25.254.254: icmp_seq=1 ttl=63 <span class="keyword">time</span>=3.02 ms</span><br><span class="line">64 bytes from 172.25.254.254: icmp_seq=2 ttl=63 <span class="keyword">time</span>=0.976 ms</span><br><span class="line">64 bytes from 172.25.254.254: icmp_seq=3 ttl=63 <span class="keyword">time</span>=1.03 ms</span><br><span class="line">64 bytes from 172.25.254.254: icmp_seq=4 ttl=63 <span class="keyword">time</span>=1.09 ms</span><br><span class="line">64 bytes from 172.25.254.254: icmp_seq=5 ttl=63 <span class="keyword">time</span>=2.16 ms</span><br><span class="line"></span><br><span class="line">--- 172.25.254.254 ping statistics ---</span><br><span class="line">5 packets transmitted, 5 received, 0% packet loss, <span class="keyword">time</span> 12ms</span><br><span class="line">rtt min/avg/max/mdev = 0.976/1.654/3.015/0.808 ms</span><br><span class="line"><span class="variable">$0</span>:  ./ping.sh       脚本名</span><br><span class="line"><span class="variable">$1</span>:  254             执行脚本时赋予脚本的第一个值</span><br><span class="line"><span class="variable">$2</span>:  5               执行脚本时赋予脚本的第二个值</span><br><span class="line"><span class="variable">$3</span>: </span><br><span class="line"><span class="variable">$#</span>:  2               一共赋予多少个值</span><br><span class="line"></span><br><span class="line">补充:</span><br><span class="line"><span class="variable">$@</span>                    具体赋予了什么值</span><br><span class="line">$？                    看上一条命令的返回值0为正常执行，非0是非正常执行</span><br><span class="line">$$                    查看子进程进程号</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">创建一个添加用户的脚本</span><br><span class="line">在system1上创建一个脚本，名为/root/makeusers，此脚本能实现为系统system1创建本地用户，并且这些用户的用户名来自一个包含列表的文件。用户满足下列要求：</span><br><span class="line">（1） 此脚本要求提供一个参数，此参数就是包含用户名列表的文件</span><br><span class="line">（2） 如果没有提供参数，此脚本应该给出下面的提示信息 Usage: /root/makeusers userfile然后退出并返回相应的值</span><br><span class="line">（3） 如果提供一个不存在的文件名，此脚本应该给出下面的提示信息 Input file not found然后退出并返回相应的值</span><br><span class="line">（4） 创建的用户登录shell为/bin/false</span><br><span class="line">（5） 此脚本不需要为用户设置密码</span><br><span class="line">[root@servera ~]# <span class="built_in">cd</span> /root/</span><br><span class="line">[root@servera ~]# <span class="built_in">cat</span> /root/userfile</span><br><span class="line">testuser1</span><br><span class="line">testuser2</span><br><span class="line">testuser3</span><br><span class="line"></span><br><span class="line">[root@servera ~]# vim /root/makeusers</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -lt 1 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Usage: <span class="variable">$0</span> userfile&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">elif</span> [ ! -f <span class="variable">$1</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Input file not found&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">cat</span> <span class="variable">$1</span>`;<span class="keyword">do</span></span><br><span class="line">                /usr/sbin/useradd -s /bin/false <span class="variable">$i</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">[root@servera ~]# ./root/makeusers /root/userlist</span><br></pre></td></tr></table></figure>

<h2 id="8-4-cut"><a href="#8-4-cut" class="headerlink" title="8.4 cut"></a><strong>8.4 cut</strong></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">grep root /etc/passwd   <span class="comment">#重要 grep将文本中包含关键字的行打印出来，默认是从上到下的查询顺序。查文件内容用的</span></span><br><span class="line">grep root /etc/passwd | <span class="built_in">cut</span>  -d :  -f 1,3-5      <span class="comment">#截取文本中的列 -d 指定分隔符号 -f 指定列     </span></span><br><span class="line">grep root /etc/passwd | <span class="built_in">cut</span> -c 1,3-5           <span class="comment">#-c 指定字符        </span></span><br><span class="line">grep ^root /etc/passwd</span><br><span class="line">grep nologin$ /etc/passwd</span><br><span class="line"><span class="built_in">cat</span> -n /etc/passwd                                   </span><br><span class="line">grep -n ^# /etc/selinux/config   </span><br><span class="line">grep ^$ /etc/selinux/config  | <span class="built_in">wc</span> -l</span><br><span class="line">grep -n ^$ /etc/selinux/config   // 过滤空行  </span><br><span class="line">grep -v ^$ /etc/selinux/config   // 过滤非空行 </span><br><span class="line">grep -vn ^# /etc/selinux/config  // 过滤非#开头的行</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> /etc/selinux/config | grep -v ^# | grep -v ^$</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@foundation0 /]# grep ng /usr/share/xml/iso-codes/iso_639_3.xml &gt; /1.txt</span><br><span class="line">[root@foundation0 /]# </span><br><span class="line">[root@foundation0 /]# </span><br><span class="line">[root@foundation0 /]# grep ^$ /1.txt</span><br><span class="line">[root@foundation0 /]# grep ^$ /1.txt | <span class="built_in">wc</span> -l</span><br><span class="line">额外：</span><br><span class="line"><span class="comment"># grep -e root -e 0 /etc/passwd       grep -e可以在一个文件内单独匹配多个参数</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line"><span class="built_in">sync</span>:x:5:0:<span class="built_in">sync</span>:/sbin:/bin/sync</span><br><span class="line">shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown</span><br><span class="line"><span class="comment"># grep -E &#x27;root|0&#x27; /etc/passwd</span></span><br><span class="line"></span><br><span class="line">[root@foundation0 ~]# grep <span class="string">&#x27;kiosk|root&#x27;</span> /etc/passwd</span><br><span class="line">[root@foundation0 ~]# egrep <span class="string">&#x27;kiosk|root&#x27;</span> /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line">kiosk:x:1000:1000::/home/kiosk:/bin/bash</span><br><span class="line">[root@foundation0 ~]# grep  -E <span class="string">&#x27;kiosk|root&#x27;</span> /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line">kiosk:x:1000:1000::/home/kiosk:/bin/bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">grep -A  2 root <span class="comment">#查看root关键字后两行</span></span><br><span class="line">grep -B         <span class="comment">#前x行</span></span><br><span class="line">grep -C         <span class="comment">#前后x行</span></span><br><span class="line"></span><br><span class="line">grep -A 2 daemon   /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="built_in">head</span> -5 /etc/passwd</span><br><span class="line"><span class="built_in">head</span> -5 /etc/passwd &gt; /opt/passwd.tst</span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line"><span class="built_in">cat</span> passwd.tst </span><br><span class="line">grep -A 2 daemon </span><br><span class="line">grep -A 2 daemon passwd.tst </span><br><span class="line">grep -B  2 daemon passwd.tst </span><br><span class="line">grep -C  2 daemon passwd.tst </span><br><span class="line"></span><br><span class="line">// 正则表达式:</span><br><span class="line">[root@foundation0 /]# <span class="built_in">cat</span> testfile </span><br><span class="line"><span class="built_in">cat</span></span><br><span class="line">cot</span><br><span class="line"><span class="built_in">cut</span></span><br><span class="line"><span class="built_in">cut</span></span><br><span class="line"><span class="built_in">cut</span></span><br><span class="line">dog</span><br><span class="line">dog</span><br><span class="line">concatenate</span><br><span class="line">dogma</span><br><span class="line">category</span><br><span class="line">educated</span><br><span class="line">boondoggle</span><br><span class="line">vindication</span><br><span class="line">chilidog</span><br><span class="line">aacat</span><br><span class="line">caaaaaaaat</span><br><span class="line"></span><br><span class="line">匹配行首和行尾</span><br><span class="line">[root@foundation0 /]# grep ^<span class="built_in">cat</span> testfile </span><br><span class="line"><span class="built_in">cat</span></span><br><span class="line">category </span><br><span class="line">[root@foundation0 /]# grep <span class="built_in">cat</span>$ testfile </span><br><span class="line"><span class="built_in">cat</span></span><br><span class="line">aacat</span><br><span class="line">[root@foundation0 /]# grep ^<span class="built_in">cat</span>$ testfile </span><br><span class="line"><span class="built_in">cat</span></span><br><span class="line"></span><br><span class="line">向正则表达式中添加通配符和倍数</span><br><span class="line">1、.匹配换行符以外的任何“单”个字符</span><br><span class="line">[root@servera opt]# grep c.t testfile </span><br><span class="line"></span><br><span class="line">2、选择[]内的一个字符。搜索结果应为c开头、中间a或o或u、结尾t</span><br><span class="line">[root@servera opt]# grep c[aou]t testfile     <span class="built_in">cat</span> cot <span class="built_in">cut</span></span><br><span class="line"></span><br><span class="line">3、倍数* 匹配前面的子表达式零次或多次</span><br><span class="line">[root@servera opt]# grep c*t testfile  </span><br><span class="line"></span><br><span class="line">4、倍数通常与通配符一起使用，如.*  这将匹配任何以包含c和t中间有0个或多个任意字符的行</span><br><span class="line">[root@servera opt]# grep c.*t testfile </span><br></pre></td></tr></table></figure>

<h1 id="9-Linux计划任务"><a href="#9-Linux计划任务" class="headerlink" title="9 Linux计划任务"></a><strong>9 Linux计划任务</strong></h1><h2 id="9-1-at"><a href="#9-1-at" class="headerlink" title="9.1 at"></a><strong>9.1 at</strong></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">[root@servera /]# rpm -q at</span><br><span class="line">at-3.1.20-11.el8.x86_64</span><br><span class="line">[root@servera /]# systemctl status atd.service </span><br><span class="line">[root@servera /]# rpm -qc at</span><br><span class="line">/etc/at.deny</span><br><span class="line">/etc/pam.d/atd</span><br><span class="line">/etc/sysconfig/atd</span><br><span class="line"></span><br><span class="line">语法：</span><br><span class="line">at 选项 参数</span><br><span class="line">at 时间  <span class="comment">#设置一个任务</span></span><br><span class="line">atq 查询</span><br><span class="line">atrm 删除任务</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">创建</span><br><span class="line">13:49分时候执行<span class="built_in">touch</span>指令</span><br><span class="line">[root@servera /]# at 13:49</span><br><span class="line">warning: commands will be executed using /bin/sh</span><br><span class="line">at&gt; <span class="built_in">touch</span> /at.txt</span><br><span class="line">at&gt; &lt;EOT&gt;          ctrl+d退出</span><br><span class="line"></span><br><span class="line">3分钟后执行</span><br><span class="line"><span class="built_in">echo</span> `<span class="built_in">date</span>` &gt;&gt; /home/student/myjob.txt | at now +3min</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">明天17:20点执行<span class="built_in">echo</span></span><br><span class="line">at 17:20 tomorrow</span><br><span class="line">at&gt; <span class="built_in">echo</span> hello</span><br><span class="line"></span><br><span class="line">三天后下午5:10分执行/bin/ls</span><br><span class="line">at 5:20pm+3days</span><br><span class="line">at&gt; /bin/ls</span><br><span class="line"></span><br><span class="line">使用时间，和月/日/年的方式指定任务</span><br><span class="line">at 17:20 5/20/2022</span><br><span class="line"></span><br><span class="line">在7月的31日上午10点</span><br><span class="line">at 10am Jul 31</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查看</span><br><span class="line">[root@servera /]# atq</span><br><span class="line">作业编号  执行日期和时间             队列a           运行作业所有者</span><br><span class="line">7        Sun Mar  8 13:51:00 2020 a              root</span><br><span class="line"></span><br><span class="line">[root@servera /]# at -l</span><br><span class="line"></span><br><span class="line">查看任务内容</span><br><span class="line">[root@servera /]# at -c 7</span><br><span class="line"></span><br><span class="line">删除</span><br><span class="line">[root@servera /]# at -d 9</span><br><span class="line">[root@servera /]# atrm 8</span><br><span class="line"></span><br><span class="line">systemctl status atd</span><br><span class="line">man at</span><br><span class="line">at 17:30</span><br><span class="line">man at</span><br><span class="line">at - 1</span><br><span class="line">at -c 1</span><br><span class="line">atq</span><br><span class="line">atrm 1</span><br><span class="line">atq</span><br><span class="line">at 17:20</span><br><span class="line">atq</span><br><span class="line">at 17:30 08/19/2022</span><br><span class="line">at 17:30 2022-7-24</span><br><span class="line">man at</span><br><span class="line">at now +3min</span><br><span class="line">at now +3hour</span><br><span class="line">at now +3days</span><br><span class="line">man at</span><br><span class="line">at 4pm +3days</span><br><span class="line">at 16:02 +3days</span><br><span class="line">man at</span><br><span class="line">at teatime</span><br><span class="line">man at</span><br><span class="line"><span class="built_in">history</span></span><br><span class="line"><span class="built_in">echo</span> 123 &gt; /root/backup | at 17:20</span><br><span class="line">atq</span><br><span class="line">at -c 11</span><br><span class="line">atq</span><br><span class="line"></span><br><span class="line">监控任务</span><br><span class="line">[root@servera ~]# watch atq      ctrl+c 退出监控模式</span><br><span class="line"></span><br><span class="line">一次性计划任务重启后，任务未执行依然会保存，直至删除或执行完毕后消失。</span><br><span class="line"></span><br><span class="line">黑白名单</span><br><span class="line">/etc/at.deny  哪个用户在黑名单里，哪个用户不能使用at，该文件默认存在</span><br><span class="line">/etc/at.allow 在白名单内的用户可以使用at，白名单以外的人不能使用，白名单和黑名单同时存在时优先于黑名单，该文件默认不存在，如使用需自己创建。</span><br></pre></td></tr></table></figure>

<h2 id="9-2-crontab"><a href="#9-2-crontab" class="headerlink" title="9.2 crontab"></a><strong>9.2 crontab</strong></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">[root@servera /]# systemctl status crond.service  <span class="comment">#重要</span></span><br><span class="line">[root@servera /]# systemctl  <span class="built_in">enable</span> crond</span><br><span class="line">[root@servera /]# systemctl is-enabled crond</span><br><span class="line">[root@servera /]# systemctl <span class="built_in">enable</span> --now crond</span><br><span class="line"></span><br><span class="line">[root@servera ~]# rpm -q crontab</span><br><span class="line">package crontab is not installed</span><br><span class="line">[root@servera ~]# rpm -qa | grep cron</span><br><span class="line">cronie-anacron-1.5.7-8.el9.x86_64</span><br><span class="line">cronie-1.5.7-8.el9.x86_64</span><br><span class="line">crontabs-1.11-27.20190603git.el9_0.noarch</span><br><span class="line">[root@servera ~]# rpm -qc crontabs</span><br><span class="line">/etc/crontab</span><br><span class="line">/etc/sysconfig/run-parts</span><br><span class="line">[root@servera ~]# vim /etc/crontab</span><br><span class="line">[root@servera ~]# </span><br><span class="line"></span><br><span class="line">crontab 选项 </span><br><span class="line">-e  编辑计划任务    crontab -e</span><br><span class="line">-u  指定用户          crontab -u student -e</span><br><span class="line">-r  删除所有任务       crontab -r              <span class="comment">#删除某个任务时利用-e选项进入编辑模式手动删除即可。</span></span><br><span class="line">-l  列出                crontab -l</span><br><span class="line"></span><br><span class="line">cron时间表示方法:</span><br><span class="line">前五个字段使用相同的语法规则</span><br><span class="line">规则          说明</span><br><span class="line">*             表示“无关紧要”，始终</span><br><span class="line">x-y           表示范围,x到y(含)</span><br><span class="line">x,y           表示列表，也可以包含范围，如5,10-13,15</span><br><span class="line">*/x           表示x的时间间隔</span><br><span class="line"></span><br><span class="line">*       *       *       *       *       <span class="built_in">command</span></span><br><span class="line">分       时     日      月       周       任务内容</span><br><span class="line">0-59    0-23   1-31    1-12    0-7</span><br><span class="line"></span><br><span class="line">1.每年2月2日上午9点执行<span class="built_in">echo</span>  hello</span><br><span class="line">0       9       2       2       *       /usr/bin/echo hello  <span class="comment">#which echo可以寻找命令绝对路径</span></span><br><span class="line"></span><br><span class="line">2.每天3到6点 第2分 执行一个脚本/root/1.sh</span><br><span class="line">2   3-6  *  *   * /bin/sh /root/1.sh</span><br><span class="line"></span><br><span class="line">3.每两个小时的第2分钟，执行一个脚本/root/1.sh</span><br><span class="line">2   */2   * *   *    /bin/sh /root/1.sh</span><br><span class="line"></span><br><span class="line">4.每年７月的第１天和第５天，两点２分，执行一个脚本/root/1.sh</span><br><span class="line">2   2   1,5  7  *    /bin/sh /root/1.sh</span><br><span class="line"></span><br><span class="line">5.配置cron任务，每隔2分钟运行logger “Ex200 <span class="keyword">in</span> progress”，以harry用户身份运行</span><br><span class="line">[root@servera /]# <span class="built_in">id</span> harry </span><br><span class="line">[root@servera /]# crontab -u harry -e</span><br><span class="line">[root@servera /]# crontab -u harry -l  (也可以su - harry切换到任务用户，运行crontab -l)</span><br><span class="line">*/2     *   *   *   *    /usr/bin/logger “Ex200 <span class="keyword">in</span> progress” </span><br><span class="line"></span><br><span class="line">删除某条可以crontab -e 进去编辑</span><br><span class="line">删除用户的所有任务 crontab -r    </span><br><span class="line"></span><br><span class="line">黑名单：</span><br><span class="line">vim /etc/cron.deny  限制用户使用crond服务</span><br><span class="line"></span><br><span class="line">白名单：</span><br><span class="line">mandb</span><br><span class="line">man -k cron</span><br><span class="line">man 1 crontab</span><br><span class="line"><span class="built_in">echo</span> harry &gt;&gt; /etc/cron.allow</span><br><span class="line">白名单启用后，就不用黑名单了，谁在白名单里谁能用该功能</span><br><span class="line">   </span><br><span class="line">测试：</span><br><span class="line">su - harry,crontab -e    <span class="comment">#可以使用</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">su - tom,crontab -e     <span class="comment">#不可使用</span></span><br><span class="line"></span><br><span class="line">// 练习:</span><br><span class="line">1、每年2月2日上午9点执行<span class="built_in">echo</span> hello任务</span><br><span class="line">   0    9   2   2  *  /usr/bin/echo hello</span><br><span class="line"></span><br><span class="line">2、七月每周5的,9点至下午5点，每5分钟执行<span class="built_in">echo</span> hi</span><br><span class="line">   */5  9-17  * 7   5  /usr/bin/echo hello</span><br><span class="line"></span><br><span class="line">3、执行一个任务,该任务每隔2分钟运行以下命令/usr/bin/logger <span class="string">&quot;hello&quot;</span>，给harry设定这个任务</span><br><span class="line">   */2 *    *   *   *  /usr/bin/logger <span class="string">&quot;hello&quot;</span></span><br><span class="line"></span><br><span class="line">4、使用root身份为用户tom设置一个计划任务，每天的下午2点43分执行/home/tom/tom.sh脚本</span><br><span class="line">   crontab -u tom -e</span><br><span class="line">   43  14  *  *  *  /bin/bash /home/tom/tom.sh</span><br><span class="line"></span><br><span class="line">5、每天的，1点，6点，9点整，将/var/log/messages文件进行归档，要求使用gzip工具，归档文件保存在/tmp/当前时间.tar.gz</span><br><span class="line">   0  1,6,9  *  *   *  tar -zcvf /tmp/$(<span class="built_in">date</span> +%Y-%m-%d).tar.gz /var/log/messages</span><br></pre></td></tr></table></figure>

<h2 id="9-3-管理临时文件"><a href="#9-3-管理临时文件" class="headerlink" title="9.3 管理临时文件"></a><strong>9.3 管理临时文件</strong></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">rhel6 tmpwatch</span><br><span class="line">systemd-tmpfiles</span><br><span class="line"></span><br><span class="line">1 手动清理临时文件</span><br><span class="line">[root@servera /]# systemctl status systemd-tmpfiles-setup   查看服务状态</span><br><span class="line">[root@servera /]# rpm -qf /usr/lib/tmpfiles.d/tmp.conf </span><br><span class="line">systemd-239-13.el8.x86_64</span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> /usr/lib/tmpfiles.d/tmp.conf /etc/tmpfiles.d/</span><br><span class="line"><span class="built_in">cd</span> /etc/tmpfiles.d/</span><br><span class="line">vim tmp.conf</span><br><span class="line">q /tmp 1777 root root 5d</span><br><span class="line">systemd-tmpfiles --clean /etc/tmpfiles.d/tmp.conf </span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">2 清理临时文件小实验</span><br><span class="line">创建一个存放临时文件的目录，并且设置相应权限/run/momentary 0700 root root</span><br><span class="line">[root@servera /]# vim /etc/tmpfiles.d/momentary.conf</span><br><span class="line">d /run/momentary 0700 root root 30s</span><br><span class="line">创建存放临时文件目录</span><br><span class="line">[root@servera /]# systemd-tmpfiles --create /etc/tmpfiles.d/momentary.conf </span><br><span class="line">[root@servera /]# ll /run/momentary/ -d</span><br><span class="line">drwx------. 2 root root 40 Mar  8 15:08 /run/momentary/</span><br><span class="line">在目录中创建一个文件叫做mom.txt，此文件模拟临时文件</span><br><span class="line">[root@servera /]# <span class="built_in">touch</span> /run/momentary/mom.txt</span><br><span class="line">[root@servera /]# <span class="built_in">sleep</span> 30</span><br><span class="line">[root@servera /]# ll /run/momentary/mom.txt </span><br><span class="line">-rw-r--r--. 1 root root 0 Mar  8 15:08 /run/momentary/mom.txt</span><br><span class="line">输入清除临时文件命令，清除所有的临时文件</span><br><span class="line">[root@servera /]# systemd-tmpfiles --clean /etc/tmpfiles.d/momentary.conf </span><br><span class="line">[root@servera /]# ll /run/momentary/mom.txt </span><br><span class="line"><span class="built_in">ls</span>: cannot access <span class="string">&#x27;/run/momentary/mom.txt&#x27;</span>: No such file or directory</span><br></pre></td></tr></table></figure>

<h1 id="10-系统性能调优"><a href="#10-系统性能调优" class="headerlink" title="10 系统性能调优"></a><strong>10 系统性能调优</strong></h1><h2 id="10-1-tuned"><a href="#10-1-tuned" class="headerlink" title="10.1 tuned"></a><strong>10.1 tuned</strong></h2><h3 id="查看状态"><a href="#查看状态" class="headerlink" title="查看状态"></a><strong>查看状态</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@servera tmp]# yum install -y tuned</span><br><span class="line">[root@servera tmp]# systemctl <span class="built_in">enable</span> --now tuned</span><br><span class="line">[root@servera tmp]# systemctl status tuned</span><br></pre></td></tr></table></figure>

<h3 id="tuned-adm管理指令"><a href="#tuned-adm管理指令" class="headerlink" title="tuned-adm管理指令"></a><strong>tuned-adm管理指令</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@servera tmp]# tuned-adm list  <span class="comment">#列出优化方案</span></span><br><span class="line">[root@servera tmp]# tuned-adm recommend   <span class="comment">#系统推荐的优化方案</span></span><br><span class="line">[root@servera tmp]# tuned-adm profile virtual-guest <span class="comment">#修改优化方案为virtual-guest</span></span><br><span class="line">[root@servera tmp]# tuned-adm off <span class="comment">#关闭优化，默认不关闭，考试时不要关闭</span></span><br></pre></td></tr></table></figure>

<h3 id="配置文件存储路径"><a href="#配置文件存储路径" class="headerlink" title="配置文件存储路径"></a><strong>配置文件存储路径</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">每个优化方案对应要给配置文件，其中描述了修改的内核参数</span><br><span class="line"></span><br><span class="line">路径：/usr/lib/tuned/</span><br></pre></td></tr></table></figure>

<h2 id="10-2-使用cockpit修改调优的方式"><a href="#10-2-使用cockpit修改调优的方式" class="headerlink" title="10.2 使用cockpit修改调优的方式"></a><strong>10.2 使用cockpit修改调优的方式</strong></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">【servera】</span><br><span class="line">systemctl start cockpit</span><br><span class="line">【foundation】</span><br><span class="line">打开浏览器输入：https://servera:9090--点击右侧高级选项---添加访问---账号密码：root redhat ----左边Overview---找到configure--找到调优</span><br></pre></td></tr></table></figure>

<h2 id="10-3-调节nice值"><a href="#10-3-调节nice值" class="headerlink" title="10.3 调节nice值"></a><strong>10.3 调节nice值</strong></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">进程有默认优先级，但是优先级默认不能更改，但是可以通过修改<span class="built_in">nice</span>值来影响进程优先级。</span><br><span class="line"><span class="built_in">nice</span>值+old优先级=new优先级</span><br><span class="line">Nice +  80   = 新优先级</span><br><span class="line"></span><br><span class="line">Nice值调节范围：</span><br><span class="line">    root：修改范围-20~19    调节优先级的工作由root来执行</span><br><span class="line">    user:   修改范围0~19        调节后无法降级</span><br><span class="line">    </span><br><span class="line">优先级：</span><br><span class="line">        数值越大优先度越低</span><br><span class="line">        数值越小优先级越高</span><br><span class="line"></span><br><span class="line"><span class="built_in">nice</span> 直接给一个新的指令设置优先级</span><br><span class="line">renice 给一个现有的进程调节优先</span><br></pre></td></tr></table></figure>

<h3 id="nice值管理"><a href="#nice值管理" class="headerlink" title="nice值管理"></a><strong>nice值管理</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line"><span class="built_in">nice</span> 选项  <span class="built_in">command</span></span><br><span class="line">选项：</span><br><span class="line">-n ： -n 后面添加优先级 </span><br><span class="line">例：</span><br><span class="line"><span class="built_in">nice</span> -n 10 vim 1.txt </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">语法：</span><br><span class="line">renice 选项 进程号</span><br><span class="line">-n：  -n 后面添加优先级 </span><br><span class="line">例：</span><br><span class="line">renice -n 10 pid</span><br></pre></td></tr></table></figure>

<h2 id="10-4-练习"><a href="#10-4-练习" class="headerlink" title="10.4 练习"></a><strong>10.4 练习</strong></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@clear ~]# <span class="built_in">cd</span> /opt/</span><br><span class="line">[root@clear opt]# <span class="built_in">ls</span></span><br><span class="line">dir1  file1</span><br><span class="line">[root@clear opt]# <span class="built_in">rm</span> -rf *</span><br><span class="line">[root@clear opt]# vim test.txt  &amp;   <span class="comment">#生成一个进程，&amp;放后台</span></span><br><span class="line">[1] 59090</span><br><span class="line">[root@clear opt]# ps -l</span><br><span class="line">F S   UID     PID    PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD</span><br><span class="line">4 S     0    1139    1138  0  80   0 - 59210 -      pts/2    00:00:03 bash</span><br><span class="line">0 T     0   59090    1139  1  80   0 - 60817 -      pts/2    00:00:00 vim  <span class="comment">#出现了</span></span><br><span class="line">0 R     0   59091    1139  0  80   0 - 63799 -      pts/2    00:00:00 ps</span><br><span class="line">[root@clear opt]# <span class="built_in">nice</span> -n 10 vim 1.txt &amp;  <span class="comment">#创建新进程 并且添加nice值为正10</span></span><br><span class="line">[2] 59097</span><br><span class="line">[root@clear opt]# ps -l</span><br><span class="line">F S   UID     PID    PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD</span><br><span class="line">4 S     0    1139    1138  0  80   0 - 59243 -      pts/2    00:00:03 bash</span><br><span class="line">0 T     0   59090    1139  0  80   0 - 60817 -      pts/2    00:00:00 vim</span><br><span class="line">0 T     0   59097    1139  2  90  10 - 60817 -      pts/2    00:00:00 vim  <span class="comment">#在这里</span></span><br><span class="line">0 R     0   59098    1139  0  80   0 - 63799 -      pts/2    00:00:00 ps</span><br><span class="line">[2]+  Stopped                 <span class="built_in">nice</span> -n 10 vim 1.txt</span><br><span class="line">[root@clear opt]# renice -n -5 59090         <span class="comment">#修改现有进程，nice值为负5，指定进程号</span></span><br><span class="line">59090 (process ID) old priority 0, new priority -5</span><br><span class="line">[root@clear opt]# ps -l</span><br><span class="line">F S   UID     PID    PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD</span><br><span class="line">4 S     0    1139    1138  0  80   0 - 59243 -      pts/2    00:00:03 bash</span><br><span class="line">0 T     0   59090    1139  0  75  -5 - 60817 -      pts/2    00:00:00 vim   <span class="comment">#已经改变了</span></span><br><span class="line">0 T     0   59097    1139  0  90  10 - 60817 -      pts/2    00:00:00 vim</span><br><span class="line">0 R     0   59100    1139  0  80   0 - 63799 -      pts/2    00:00:00 ps</span><br><span class="line">[root@clear opt]# </span><br></pre></td></tr></table></figure>

<h1 id="11-管理SELinux"><a href="#11-管理SELinux" class="headerlink" title="11 管理SELinux"></a><strong>11 管理SELinux</strong></h1><h2 id="11-1-介绍selinux"><a href="#11-1-介绍selinux" class="headerlink" title="11.1 介绍selinux"></a><strong>11.1 介绍selinux</strong></h2><h3 id="selinux简介"><a href="#selinux简介" class="headerlink" title="selinux简介"></a><strong>selinux简介</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELinux全称是Security Enhanced Linux (安全强化 Linux),是MAC (Mandatory Access Control，强制访问控制系统)的一个实现，在于明确的指明某个进程可以访问哪些资源(文件、网络端口等)</span><br><span class="line">强制访问控制系统的用途在于增强系统抵御0-Day攻击(利用尚未公开的漏洞实现的攻击行为)的能力</span><br><span class="line">它不是网络防火墙或FACL的替代品，在用途上也不重复。在目前的大多数发行版中，已经默认在内核集成了SELinux</span><br></pre></td></tr></table></figure>

<h3 id="selinux实现原理"><a href="#selinux实现原理" class="headerlink" title="selinux实现原理"></a><strong>selinux实现原理</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    普通权限和selinux权限对比：</span><br><span class="line">​    传统的Linux使用用户、文件权限的概念来限制资源的访问，通过对比进程的发起用户和文件权限以此来保证系统资源的安全，这是一种自由访问控制方式（DAC）</span><br><span class="line">    SELinux是​Linux下的一种安全强化机制，为进程和文件加入了除权限之外更多的限制来增强访问条件，这种方式为强制访问控制(MAC)</span><br><span class="line">    进程和文件都有相应的标签，称为上下文，只有进程上下文和文件上下文对应上，该进程才可以访问文件</span><br><span class="line">    ​何为对应？系统中大量的进程和文件上下文已经被定义，如http服务进程上下文为httpd_t域，/var/www/html/目录上下文为httpd_sys_content_t，后者归属于前者的匹配域内，即可匹配</span><br><span class="line">    </span><br><span class="line">  分类                  源               目的</span><br><span class="line">--------------------- ---------------- ----------------------------</span><br><span class="line">  传统文件系统权限DAC   用户             文件系统权限</span><br><span class="line">  SELinux权限MAC        用户进程上下文   文件（或目录端口等）上下文</span><br></pre></td></tr></table></figure>

<h3 id="selinux的限制范围"><a href="#selinux的限制范围" class="headerlink" title="selinux的限制范围"></a><strong>selinux的限制范围</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SElinux具有多种上下文类型，常见种类:  </span><br><span class="line">   ​安全上下文(限制文件的访问)：该种类上下文存在于内存和文件中，进程访问文件inode时读取到上下文类型进行对比</span><br><span class="line">​   布尔值(限制软件功能的访问)：该种类型上下文主要控制某些进程是否可以访问服务常用功能中出现的文件</span><br><span class="line">​   安全端口(限制服务的访问)：selinux会限制服务启用的非标准端口号</span><br><span class="line"> ID                                     SELinux</span><br><span class="line">---- ------------ --------------------- ---------------------------------------------</span><br><span class="line"> Filesystem   <span class="built_in">chmod</span>, <span class="built_in">chown</span>, setfacl semanage fcontext ... restorecon ... <span class="built_in">chcon</span></span><br><span class="line">                                          ... <span class="built_in">touch</span> /.autorelabel</span><br><span class="line"> Service      vim /etc/\*.conf      setsebool -P ...</span><br><span class="line"> Firewall     firewall-cmd ...      semanage port ...</span><br><span class="line"> SELinux      vim          /etc/selinux/config             </span><br></pre></td></tr></table></figure>

<h3 id="查看上下文"><a href="#查看上下文" class="headerlink" title="查看上下文"></a><strong>查看上下文</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@servera ~]# dnf install -y httpd</span><br><span class="line">[root@servera ~]# systemctl <span class="built_in">enable</span> --now httpd</span><br><span class="line"></span><br><span class="line">进程：              </span><br><span class="line">ps auxZ            </span><br><span class="line">ps -eZ</span><br><span class="line">[root@servera ~]# ps auxZ | grep httpd</span><br><span class="line">system_u:system_r:httpd_t:s0    root      1971  0.0  1.2 273800 10496 ?        Ss   04:58   0:00 /usr/sbin/httpd -DFOREGROUND</span><br><span class="line"></span><br><span class="line">文件：</span><br><span class="line"><span class="built_in">ls</span> -Z</span><br><span class="line">[root@servera ~]# ll -dZ /var/www/html/</span><br><span class="line">system_u:object_r:httpd_sys_content_t:s0 /var/www/html/</span><br><span class="line"></span><br><span class="line">只要进程和文件的安全上下文匹配，该进程就可以访问该文件资源</span><br></pre></td></tr></table></figure>

<h3 id="security-context介绍"><a href="#security-context介绍" class="headerlink" title="security context介绍"></a><strong>security context介绍</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">content一词是我们常说的上下文，安全上下文有5个字段，以：冒号分割，</span><br><span class="line">unconfined_u   :object_r:   httpd_sys_content_t:      s0           [类别]   </span><br><span class="line"></span><br><span class="line">身份 user -u    角色roles -r  类型 <span class="built_in">type</span>  -t                             灵敏度（级别）     类别     </span><br><span class="line"></span><br><span class="line">1) 身份字段（user)</span><br><span class="line">   用于标识该数据被哪个身份所拥有，相当于权限中的用户身份。这个字段并没有特别的作用，知道就好。常见的身份类型有以下 3 种：</span><br><span class="line">- root：表示安全上下文的身份是 root。</span><br><span class="line">- system_u：表示系统用户身份，其中“_u”代表 user。</span><br><span class="line">- user_u：表示与一般用户账号相关的身份，其中“_u”代表 user。</span><br><span class="line">- 以使用 seinfo 命令来进行查询</span><br><span class="line"></span><br><span class="line">2) 角色（role）</span><br><span class="line">主要用来表示此数据是进程还是文件或目录。这个字段在实际使用中也不需要修改，所以了解就好。</span><br><span class="line">常见的角色有以下两种：</span><br><span class="line">- object_r：代表该数据是文件或目录，这里的“_r”代表 role。</span><br><span class="line">- system_r：代表该数据是进程，这里的“_r”代表 role。</span><br><span class="line"></span><br><span class="line">3) 类型（<span class="built_in">type</span>）</span><br><span class="line">   类型字段是安全上下文中最重要的字段，进程是否可以访问文件，主要就是看进程的安全上下文类型字段是否和文件的安全上下文类型字段相匹配，如果匹配则可以访问。#（掌握重点）</span><br><span class="line"></span><br><span class="line">注意，类型字段在文件或目录的安全上下文中被称作类型（<span class="built_in">type</span>），但是在进程的安全上下文中被称作域（domain）。也就是说，在主体（Subject）的安全上下文中，这个字段被称为域；在目标（Object）的安全上下文中，这个字段被称为类型。域和类型需要匹配（进程的类型要和文件的类型相匹配），才能正确访问。</span><br><span class="line">context查询工具seinfo、sesearch</span><br><span class="line">    seinfo -u    <span class="comment"># 查询所有的user字段的种类</span></span><br><span class="line">    seinfo -r    <span class="comment"># 查询所有的role字段的种类</span></span><br><span class="line">    seinfo -t    <span class="comment"># 查询所有的type字段的种类 </span></span><br><span class="line"></span><br><span class="line">sesearch -A 可以查询什么类型进程可以读取什么<span class="built_in">type</span>类型的文件</span><br><span class="line">    sesearch -A -s 进程<span class="built_in">type</span>    <span class="comment"># 查询type类型的进程能够读取的文件type   </span></span><br><span class="line">    sesearch -A -b 规则（规则的boolean值，所以为-b选项，理解为bool规则）</span><br><span class="line">    </span><br><span class="line">[root@foundation0 ~]# sesearch -A -s httpd_t | grep <span class="string">&#x27;^allow httpd_t httpd_sys_content_t&#x27;</span></span><br><span class="line"></span><br><span class="line">4) 灵敏度</span><br><span class="line">   灵敏度一般是用 s0、s1、s2 来命名的，数字代表灵敏度的分级。数值越大，代表灵敏度越高。</span><br><span class="line"></span><br><span class="line">5) 类别</span><br><span class="line">   类别字段不是必须有的，所以我们使用 <span class="built_in">ls</span> 和 ps 命令查询的时候并没有看到类别字段。通过seinfo -u -x查看</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">-servera</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">setenforce 1</span><br><span class="line">yum install -y httpd</span><br><span class="line">systemctl <span class="built_in">enable</span> --now httpd</span><br><span class="line">ps auxZ | grep httpd     <span class="comment">#-Z 大写Z就表示上下文，发现http_t字段就是httpd服务进程上下文&#x27;类型&#x27;字段</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /var/www/html</span><br><span class="line">ll -dZ /var/www/html    <span class="comment">#发现上下文是httpd开头</span></span><br><span class="line"><span class="built_in">echo</span> <span class="built_in">test</span> &gt;  /var/www/html/index.html    <span class="comment">#创建测试页面</span></span><br><span class="line">ll -Z  /var/www/html/index.html <span class="comment">#发现所有文件类型字段上下文，都是httpd开头,看上下文的第三段 类型字段</span></span><br><span class="line"></span><br><span class="line">-foundation0 </span><br><span class="line">打开浏览器，网址位置输入 172.25.250.10/index.html   <span class="comment">#访问servera的网页</span></span><br><span class="line">发现可以访问到网页内容，证明上下文一致，不被限制，可以访问</span><br><span class="line"></span><br><span class="line">-servera</span><br><span class="line"><span class="built_in">chcon</span> -t default_t /var/www/html/index.html   <span class="comment">#更改了file3的上下文</span></span><br><span class="line">ll -Z  <span class="comment">#发现index.html上下文类型字段变成default_t</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-foundation0 </span><br><span class="line">打开浏览器，网址位置输入 172.25.250.10/index.html   <span class="comment">#访问servera的网页</span></span><br><span class="line">发现不可以访问到网页内容，证明上下文不一致，被限制，不可访问</span><br><span class="line"></span><br><span class="line">-servera</span><br><span class="line">ll -dZ /var/www/html/  <span class="comment">#查看到httpd相关上下文</span></span><br><span class="line"><span class="built_in">chcon</span> -t httpd_sys_content_t /var/www/html/index.html <span class="comment">#更改上下文改为httpd_sys_content_t</span></span><br><span class="line"></span><br><span class="line">-foundation0 </span><br><span class="line">打开浏览器，网址位置输入 172.25.250.10/index.html   <span class="comment">#访问servera的网页</span></span><br><span class="line">发现可以访问到网页内容，证明上下文一致，不被限制，可以访问</span><br></pre></td></tr></table></figure>

<h2 id="11-2-更改SElinux强制模式"><a href="#11-2-更改SElinux强制模式" class="headerlink" title="11.2 更改SElinux强制模式"></a><strong>11.2 更改SElinux强制模式</strong></h2><h3 id="临时开启或关闭selinux"><a href="#临时开启或关闭selinux" class="headerlink" title="临时开启或关闭selinux"></a><strong>临时开启或关闭selinux</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#临时修改意思是重启失效</span></span><br><span class="line">[root@clear /]# getenforce </span><br><span class="line">Enforcing</span><br><span class="line">[root@clear /]# setenforce </span><br><span class="line">usage:  setenforce [ Enforcing | Permissive | 1 | 0 ]    <span class="comment"># 强制 1|宽容 0</span></span><br><span class="line">[root@clear /]# setenforce 0</span><br><span class="line">[root@clear /]# getenforce </span><br><span class="line">Permissive</span><br><span class="line">[root@clear /]# setenforce Permissive</span><br><span class="line">[root@clear /]# getenforce </span><br><span class="line">Permissive</span><br><span class="line">[root@clear /]# setenforce 1</span><br><span class="line">[root@clear /]# getenforce </span><br><span class="line">Enforcing</span><br></pre></td></tr></table></figure>

<h3 id="永久开启或关闭selinux"><a href="#永久开启或关闭selinux" class="headerlink" title="永久开启或关闭selinux"></a><strong>永久开启或关闭selinux</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-RHEL&lt;=9</span><br><span class="line">[root@servera ~]# vim /etc/selinux/config</span><br><span class="line"><span class="comment">#     enforcing - SELinux security policy is enforced.</span></span><br><span class="line"><span class="comment">#     permissive - SELinux prints warnings instead of enforcing.</span></span><br><span class="line"><span class="comment">#     disabled - No SELinux policy is loaded.</span></span><br><span class="line">SELINUX=enforcing</span><br><span class="line"></span><br><span class="line">修改后，重启操作系统生效</span><br></pre></td></tr></table></figure>

<h3 id="继承特性"><a href="#继承特性" class="headerlink" title="继承特性"></a><strong>继承特性</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">继承：</span><br><span class="line">1、在父目录下创建文件会继承selinux上下文<span class="built_in">touch</span></span><br><span class="line">2、<span class="built_in">cp</span>时不继承，即<span class="built_in">cp</span>时不保留原来的父目录上下文关系</span><br><span class="line">   创建了文件并且移动(<span class="built_in">mv</span>)会保留原来的父目录上下文关系</span><br><span class="line">   <span class="built_in">cp</span> -a(rp)复制时会保留之前的上下文关系</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">【servera】 </span><br><span class="line">[root@servera /]# <span class="built_in">cd</span> /var/www/html/</span><br><span class="line">[root@servera html]# ll -dZ .</span><br><span class="line">drwxr-xr-x. 2 root root system_u:object_r:httpd_sys_content_t:s0 23 May 21 09:13 .</span><br><span class="line">[root@servera html]# <span class="built_in">touch</span> haha.txt</span><br><span class="line">[root@servera html]# ll -Z haha.txt </span><br><span class="line">-rw-r--r--. 1 root root unconfined_u:object_r:httpd_sys_content_t:s0 0 May 21 10:06 haha.txt</span><br><span class="line"></span><br><span class="line">[root@servera ~]# <span class="built_in">cd</span> /tmp/</span><br><span class="line">[root@servera tmp]# <span class="built_in">touch</span> file&#123;1..3&#125;</span><br><span class="line">[root@servera tmp]# <span class="built_in">ls</span> -Z /tmp/file*</span><br><span class="line">unconfined_u:object_r:user_tmp_t:s0 /tmp/file1 </span><br><span class="line">unconfined_u:object_r:user_tmp_t:s0 /tmp/file2 </span><br><span class="line">unconfined_u:object_r:user_tmp_t:s0 /tmp/file3</span><br><span class="line">[root@servera tmp]# <span class="built_in">cp</span> /tmp/file1 /var/www/html/</span><br><span class="line">[root@servera tmp]# <span class="built_in">cp</span> -a /tmp/file2 /var/www/html/</span><br><span class="line">[root@servera tmp]# <span class="built_in">mv</span> /tmp/file3 /var/www/html/</span><br><span class="line">[root@servera tmp]# <span class="built_in">cd</span> /var/www/html/</span><br><span class="line">[root@servera html]# <span class="built_in">ls</span> -Z *</span><br><span class="line">unconfined_u:object_r:httpd_sys_content_t:s0 file1           unconfined_u:object_r:user_tmp_t:s0 file3</span><br><span class="line">         unconfined_u:object_r:user_tmp_t:s0 file2</span><br><span class="line">[root@servera html]# <span class="built_in">touch</span> /var/www/html/file0</span><br><span class="line">[root@servera html]# ll -Z /var/www/html/file0</span><br><span class="line">-rw-r--r--. 1 root root unconfined_u:object_r:httpd_sys_content_t:s0 0 Apr 10 05:08 /var/www/html/file0</span><br></pre></td></tr></table></figure>

<h2 id="11-3-定义selinux默认文件上下文规则"><a href="#11-3-定义selinux默认文件上下文规则" class="headerlink" title="11.3 定义selinux默认文件上下文规则"></a><strong>11.3 定义selinux默认文件上下文规则</strong></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">方法1：永久设置，但不记录至数据库</span><br><span class="line">      <span class="built_in">chcon</span> 设置上下文关系</span><br><span class="line">方法2：永久设置，记录至数据库</span><br><span class="line">      semanage fcontext  添加、修改、查看、删除默认上下文</span><br><span class="line">      restorecon 恢复默认上下文 </span><br></pre></td></tr></table></figure>

<h3 id="chcon"><a href="#chcon" class="headerlink" title="chcon"></a><strong>chcon</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chcon</span> 选项 上下文类型  文件</span><br><span class="line"></span><br><span class="line">[root@servera html]# ll -Z </span><br><span class="line">total 0</span><br><span class="line">-rw-r--r--. 1 root root unconfined_u:object_r:httpd_sys_content_t:s0 0 Dec 11 05:36 file1</span><br><span class="line">-rw-r--r--. 1 root root unconfined_u:object_r:httpd_sys_content_t:s0 0 Dec 11 05:38 file2</span><br><span class="line">-rw-r--r--. 1 root root unconfined_u:object_r:user_tmp_t:s0          0 Dec 11 05:37 file3</span><br><span class="line">-rw-r--r--. 1 root root unconfined_u:object_r:user_tmp_t:s0          0 Dec 11 05:37 file4</span><br><span class="line">[root@servera html]# man <span class="built_in">chcon</span></span><br><span class="line">[root@servera html]# <span class="built_in">chcon</span> -t httpd_sys_content_t file3</span><br><span class="line">[root@servera html]# ll -Z </span><br><span class="line">total 0</span><br><span class="line">-rw-r--r--. 1 root root unconfined_u:object_r:httpd_sys_content_t:s0 0 Dec 11 05:36 file1</span><br><span class="line">-rw-r--r--. 1 root root unconfined_u:object_r:httpd_sys_content_t:s0 0 Dec 11 05:38 file2</span><br><span class="line">-rw-r--r--. 1 root root unconfined_u:object_r:httpd_sys_content_t:s0 0 Dec 11 05:37 file3</span><br><span class="line">-rw-r--r--. 1 root root unconfined_u:object_r:usexr_tmp_t:s0         0 Dec 11 05:37 file4</span><br></pre></td></tr></table></figure>

<h3 id="semanage-fcontext"><a href="#semanage-fcontext" class="headerlink" title="semanage fcontext"></a><strong>semanage fcontext</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">帮助中查看示例：</span><br><span class="line">man semanage</span><br><span class="line">man semanage fcontext</span><br><span class="line">选项：</span><br><span class="line">semanage fcontext </span><br><span class="line">-a  添加   添加至数据库</span><br><span class="line">-d  删除</span><br><span class="line">-l  查看</span><br><span class="line">-t  指定上下文</span><br><span class="line">-m  修改</span><br><span class="line"></span><br><span class="line">修改流程：</span><br><span class="line">1、查看selinux上下文类型数据库是否有记录？有就恢复I(restorecon)，没有就添加(semanage fcontext -a)</span><br><span class="line">2、man semanage fcontext添加文件标签类型至数据库. 添加后，文件并不会更改标签类型</span><br><span class="line">3、使用restorecon命令同步和数据库一致</span><br><span class="line"></span><br><span class="line">【servera】</span><br><span class="line">-l</span><br><span class="line">[root@clear /]# man semanage fcontext | grep \#</span><br><span class="line">root@servera ~]# yum provides sesearch</span><br><span class="line">Last metadata expiration check: 2:54:21 ago on Sat Mar  1 00:44:02 2025.</span><br><span class="line">setools-console-4.4.3-1.el9.x86_64 : Policy analysis command-line tools <span class="keyword">for</span> SELinux</span><br><span class="line">Repo        : rhel-9.3-for-x86_64-baseos-rpms</span><br><span class="line">Matched from:</span><br><span class="line">Filename    : /usr/bin/sesearch</span><br><span class="line"></span><br><span class="line">[root@clear /]# semanage  fcontext -l | grep /var/www  看第一行即可</span><br><span class="line">[root@clear /]# semanage  fcontext -l | grep /var/www/html/file3</span><br><span class="line">/var/www/html/file3                                all files          system_u:object_r:default_t:s0 </span><br><span class="line">[root@clear /]# semanage fcontext -a -t httpd_sys_content_t /var/www/html/file3 <span class="comment">#数据库没有上下文记录，用-a添加，如已存在则用-m修改数据库中错误的上下文</span></span><br><span class="line">[root@clear /]# semanage  fcontext -l | grep /var/www/html/file3</span><br><span class="line">/var/www/html/file1                                all files          system_u:object_r:httpd_sys_content_t:s0 </span><br><span class="line"></span><br><span class="line">restorecon  恢复文件上下文和数据库一致</span><br><span class="line">-v  显示修改标签内容</span><br><span class="line">-R  递归</span><br><span class="line">[root@clear /]# restorecon -R -v /var/www/html/file3</span><br><span class="line">Relabeled /var/www/html/file3 from system_u:object_r:default_t:s0 to system_u:object_r:httpd_sys_content_t:s0</span><br><span class="line"></span><br><span class="line">[root@clear /]# ll -Z /var/www/html/file3</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-<span class="built_in">chcon</span> </span><br><span class="line">chcont -t httpd_sys_content_t /var/www/html/index.html</span><br><span class="line">man semanage fcontext -l | grep \#</span><br><span class="line"></span><br><span class="line">-semanage fcontext</span><br><span class="line">man semanage fcontext -l | grep \#    </span><br><span class="line">semanage fcontext -a -t httpd_sys_content_t /var/www/html/index.html </span><br><span class="line">semanage fcontext -m -t httpd_sys_content_t /var/www/html/index.html</span><br><span class="line">semanage fcontext -d -t httpd_sys_content_t /var/www/html/index.html</span><br><span class="line">semanage fcontext -l  /var/www/html/index.html</span><br><span class="line">restorecon -R -v /var/www/html/index.html</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">课上练习：</span><br><span class="line">1.servera上安装httpd软件</span><br><span class="line">2.在/var/www/html目录创建3个文件file0、file1、file2、对应内容test0、test1、test2</span><br><span class="line">3.修改file0上下文为default_t</span><br><span class="line">4.开启httpd服务。关闭防火墙 systemctl stop firewalld</span><br><span class="line">5.在f0上用浏览器访问三个网页文件，测试发现，file0访问不到内容，而file1、file2可以</span><br><span class="line">6.回到servera上修改file0上下文为httpd_sys_content_t</span><br><span class="line">7.再测试</span><br></pre></td></tr></table></figure>

<h2 id="11-4-管理布尔值"><a href="#11-4-管理布尔值" class="headerlink" title="11.4 管理布尔值"></a>11.4 管理布尔值</h2><h3 id="管理布尔值"><a href="#管理布尔值" class="headerlink" title="管理布尔值"></a><strong>管理布尔值</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">布尔值主要对应的是应用的功能的开启或关闭</span><br><span class="line"></span><br><span class="line">getsebool       列出布尔值状态  user</span><br><span class="line">setsebool       设置布尔值开启或关闭on 开，off 关</span><br><span class="line">-P              更改布尔值永久生效 setsebool -p</span><br><span class="line">semanage boolean -l 查看布尔值是否永久</span><br><span class="line"></span><br><span class="line">[root@servera /]# yum install -y selinux-policy-doc</span><br><span class="line">[root@servera /]# mandb</span><br><span class="line">[root@servera /]# man -k <span class="string">&#x27;_selinux&#x27;</span> | grep httpd</span><br><span class="line">[root@servera /]# man 8 httpd_selinux</span><br><span class="line">[root@servera /]# man 8 httpd_selinux |  grep -B 1 homedir</span><br><span class="line">[root@servera /]# getsebool -a  </span><br><span class="line">[root@servera /]# getsebool -a |  grep httpd | grep homedir</span><br><span class="line"></span><br><span class="line">修改布尔值状态</span><br><span class="line">[root@servera /]# setsebool httpd_enable_homedirs on</span><br><span class="line">[root@servera /]# semanage boolean -l  | grep httpd_enable_home</span><br><span class="line">httpd_enable_homedirs          (off  ,  off)  Allow httpd to <span class="built_in">enable</span> homedirs</span><br><span class="line">[root@servera /]# setsebool -P httpd_enable_homedirs on  永久生效</span><br><span class="line">[root@servera /]# semanage boolean -l  | grep httpd_enable_home</span><br><span class="line">httpd_enable_homedirs          (on   ,   on)  Allow httpd to <span class="built_in">enable</span> homedirs</span><br><span class="line">[root@servera /]# setsebool -P httpd_enable_homedirs off</span><br></pre></td></tr></table></figure>

<h3 id="使用布尔值调整"><a href="#使用布尔值调整" class="headerlink" title="使用布尔值调整"></a><strong>使用布尔值调整</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">1.关闭selinux正常使用  apache发布页面托管在用户主页上的web内容功能</span><br><span class="line">1.关闭selinux</span><br><span class="line">[root@clear /]# setenforce 0;systemctl stop firewalld   </span><br><span class="line"></span><br><span class="line">2.编辑配置文件</span><br><span class="line">[root@clear /]# vim /etc/httpd/conf.d/userdir.conf </span><br><span class="line"><span class="comment">#UserDir disabled   #注释该行</span></span><br><span class="line">UserDir public_html  <span class="comment">#解除该行注释，启用该功能</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3.切换student用户，制作发布目录和网页</span><br><span class="line">[root@clear /]# su - student</span><br><span class="line">[student@clear ~]$ <span class="built_in">mkdir</span> public_html  <span class="comment">#创建发布目录</span></span><br><span class="line">[student@clear ~]$ <span class="built_in">echo</span>  test_web_page &gt; public_html/index.html <span class="comment">#制作网页</span></span><br><span class="line">[student@clear ~]$ <span class="built_in">logout</span>  <span class="comment">#退出</span></span><br><span class="line">[root@clear /]# <span class="built_in">chmod</span> 711 /home/student/  <span class="comment">#root用户身份，修改用户家目录权限为711，目的是为了让其他人有权限访问子目录及文件</span></span><br><span class="line">[root@clear /]# systemctl restart httpd</span><br><span class="line"></span><br><span class="line">4.在foundation上做访问测试</span><br><span class="line">firefox  http://172.25.250.10/~student/index.html</span><br><span class="line">test_web_page</span><br><span class="line"></span><br><span class="line">5.开启selinux再次访问</span><br><span class="line">【172.25.250.10】</span><br><span class="line">[root@clear /]# setenforce 1</span><br><span class="line">【foundation】</span><br><span class="line">firefox  http://172.25.250.10/~student/index.html</span><br><span class="line">Forbidden</span><br><span class="line">You don<span class="string">&#x27;t have permission to access /~student/index.html on this server.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">6.开启对应布尔值，允许该功能</span></span><br><span class="line"><span class="string">[root@clear /]# yum install -y selinux-policy-doc</span></span><br><span class="line"><span class="string">[root@clear /]# mandb</span></span><br><span class="line"><span class="string">[root@clear /]# man -k &#x27;</span>http<span class="string">&#x27;</span></span><br><span class="line"><span class="string">[root@clear /]# man 8 httpd_selinux    #文档里搜索homedirs，复制该命令，开启该功能</span></span><br><span class="line"><span class="string">[root@clear /]# setsebool -P httpd_enable_homedirs 1</span></span><br><span class="line"><span class="string">[root@clear /]# getsebool</span></span><br><span class="line"><span class="string">[root@clear /]# getsebool -a</span></span><br><span class="line"><span class="string">[root@clear /]# getsebool -a | grep http | grep homedir  #第一种查询方式</span></span><br><span class="line"><span class="string">root@clear /]# semanage boolean -l | grep homedirs   #第二种查询方式，查布尔值数据库</span></span><br><span class="line"><span class="string">httpd_enable_homedirs          (on   ,   on)  Allow httpd to enable homedirs</span></span><br><span class="line"><span class="string">                              （功能打开，永久生效）</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">7.在foundation上做访问测试</span></span><br><span class="line"><span class="string">firefox  http://172.25.250.10/~student/index.html</span></span><br><span class="line"><span class="string">test_web_page</span></span><br></pre></td></tr></table></figure>

<h2 id="11-5-安全端口"><a href="#11-5-安全端口" class="headerlink" title="11.5 安全端口"></a><strong>11.5 安全端口</strong></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">实验目标：当apache服务发布端口从80修改为82时，保证服务可以启动并开机自启动。</span><br><span class="line"></span><br><span class="line">【servera】</span><br><span class="line">[root@servera html]# systemctl stop firewalld</span><br><span class="line">[root@servera html]# yum install -y httpd</span><br><span class="line">[root@servera html]# setenforce 1</span><br><span class="line">[root@servera html]# systemctl <span class="built_in">enable</span> --now httpd   <span class="comment">#服务正常启动</span></span><br><span class="line">【f0】</span><br><span class="line">curl http://servera/file1 <span class="comment">#正常可以访问</span></span><br><span class="line"></span><br><span class="line">【servera】</span><br><span class="line">[root@servera html]# rpm -qc httpd   <span class="comment">#倒数第四行</span></span><br><span class="line">[root@servera html]# vim /etc/httpd/conf/httpd.conf  </span><br><span class="line">Listen 82      <span class="comment">#47行 练习时可以从80改为82</span></span><br><span class="line">[root@servera html]# systemctl restart httpd      <span class="comment">#服务起不来</span></span><br><span class="line">[root@servera html]# <span class="built_in">cat</span> /var/log/messages  <span class="comment">#看日志文件最后的部分</span></span><br><span class="line">*[root@servera html]# man semanage port | grep \#</span><br><span class="line">       <span class="comment"># semanage port -l</span></span><br><span class="line">       <span class="comment"># semanage port -a -t http_port_t -p tcp 81</span></span><br><span class="line">       <span class="comment"># semanage port -a -t ssh_port_t -p tcp 8991</span></span><br><span class="line">[root@servera html]# semanage port -l | grep http_port_t   </span><br><span class="line">http_port_t                    tcp      80, 81, 443, 488, 8008, 8009, 8443, 9000</span><br><span class="line">*[root@servera html]# semanage port -a -t http_port_t -p tcp 82  <span class="comment">#添加安全端口</span></span><br><span class="line">*[root@servera html]# semanage port -l | grep http_port_t   <span class="comment">#并查看是否有82</span></span><br><span class="line">http_port_t                    tcp      82, 80, 81, 443, 488, 8008, 8009, 8443, 9000</span><br><span class="line">pegasus_http_port_t            tcp      5988</span><br><span class="line">[root@servera html]# <span class="built_in">echo</span> haha &gt; /var/www/html/index.html  <span class="comment">#手动制作一个测试页</span></span><br><span class="line">[root@servera html]# systemctl restart httpd  <span class="comment">#可以启动服务</span></span><br><span class="line">[root@servera html]# systemctl <span class="built_in">enable</span> httpd <span class="comment">#开机自启动</span></span><br><span class="line">[root@servera html]# netstat -ntlp | grep 82</span><br><span class="line">[root@servera html]# localhost:82/index.html  <span class="comment">#本机测试82端口访问index.html网页文件</span></span><br><span class="line">【f0】</span><br><span class="line"><span class="comment"># curl http://servera:82/index.html  #再次访问</span></span><br></pre></td></tr></table></figure>

<h2 id="11-6-SElinux日志"><a href="#11-6-SElinux日志" class="headerlink" title="11.6 SElinux日志"></a><strong>11.6 SElinux日志</strong></h2><p>​         SELinux 会使用被称为 AVC（Access VectorCache，访问矢量缓存）的缓存，如果访问被拒绝（也被称为 AVC拒绝），则会在一个日志文件中记录下拒绝消息。</p>
<p>​         这些被拒绝的消息可以帮助诊断和解决常规的SELinux策略违规行为，至于这些拒绝消息到底被记录在什么位置，则取决于 auditd 和<br>rsyslogd 守护进程的状态： 若auditd守护进程正在运行，则拒绝消息将被记录与 &#x2F;var&#x2F;log&#x2F;audit&#x2F;audit.log 中。 </p>
<p>​        若 auditd 守护进程没有运行，但 rsyslogd守护进程正在运行，则拒绝消息会记录到 &#x2F;var&#x2F;log&#x2F;messages 中。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-a：分析指定的日志文件</span><br><span class="line">sealert -a /var/log/audit/audit.log  回显比较慢多等一会</span><br></pre></td></tr></table></figure>

<h1 id="12-管理基本存储"><a href="#12-管理基本存储" class="headerlink" title="12 管理基本存储"></a><strong>12 管理基本存储</strong></h1><h2 id="12-1-添加分区"><a href="#12-1-添加分区" class="headerlink" title="12.1 添加分区"></a><strong>12.1 添加分区</strong></h2><h3 id="分区方案-MBR-GPT"><a href="#分区方案-MBR-GPT" class="headerlink" title="分区方案-MBR&amp;GPT"></a><strong>分区方案-MBR&amp;GPT</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MBR分区方案:</span><br><span class="line">MBR叫做主引导记录，存在于磁盘的0柱面0磁道0扇区中，是磁盘的第一个扇区内，大小为512字节，446字节初始化程序加载器，64字节分区表，2字节校验码，每个分区16字节，所以最多4个分区，最大磁盘空间支持2T。主分区和扩展分区编号用1-4，逻辑分区编号5以上</span><br><span class="line"></span><br><span class="line">GPT分区方案:</span><br><span class="line">GPT是GUID Partition Table，全局唯一标识磁盘分区表。它由UEFI启动硬盘，这样就有了UEFI取代传动BIOS，而GPT则取代传统的MBR，windows支持最多128个GPT分区</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">MBR分区方案</span><br><span class="line">分区表=64字节</span><br><span class="line">1个分区=16字节</span><br><span class="line">4x16=64 最多只能记录4个分区 主分区</span><br><span class="line">4个分区不够用？比如5个以上？</span><br><span class="line"></span><br><span class="line">1.主分区最多4个，占分区编号1-4，可以格式化(可使用存放数据)</span><br><span class="line">2.扩展分区最多可以有1个，牺牲一个主分区来做扩展分区，它不能格式化（不能使用，不能存放数据），它的作用是装载逻辑分区用的，也就是用扩展分区的空间再划分多个逻辑分区</span><br><span class="line">3.逻辑分区-由扩展分区的空间划分而来的，约可以分15个左右。可以格式化（可以使用，可以存放数据），逻辑分区必定从5号开始</span><br><span class="line"></span><br><span class="line">分区方案:4P、3P+1E  </span><br></pre></td></tr></table></figure>

<h3 id="分区工具-fdisk-parted"><a href="#分区工具-fdisk-parted" class="headerlink" title="分区工具:fdisk&amp;parted"></a>分区工具:fdisk&amp;parted</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">使用新磁盘流程规划：</span><br><span class="line">1.分区（可选）fdisk   parted</span><br><span class="line">2.格式化     mkfs</span><br><span class="line">3.挂载       mount</span><br><span class="line">4.使用      </span><br><span class="line"></span><br><span class="line">fdisk是一个分区工具，既可以查看磁盘状况，也可以对磁盘进行分区:</span><br><span class="line">语法：fdisk  选项  设备名</span><br><span class="line">选项：-l 查看所有磁盘状态</span><br><span class="line">例：</span><br><span class="line">fdisk  -l            <span class="comment">#查所有磁盘信息</span></span><br><span class="line">fdisk  -l /dev/vdb   <span class="comment">#查某一个磁盘信息</span></span><br></pre></td></tr></table></figure>

<h3 id="分区方案练习"><a href="#分区方案练习" class="headerlink" title="分区方案练习"></a><strong>分区方案练习</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">1 MBR分区方案：</span><br><span class="line">5G磁盘，每个分区1G</span><br><span class="line">3P+1E ， 1E（L5、L6）</span><br><span class="line"></span><br><span class="line">[root@clear /]# fdisk -l</span><br><span class="line">[root@clear /]# fdisk -l /dev/vdb</span><br><span class="line">[root@clear /]# fdisk /dev/vdb</span><br><span class="line">n   <span class="comment">#创建分区</span></span><br><span class="line">p   <span class="comment">#选择p主  或  e扩展</span></span><br><span class="line">1   <span class="comment">#分区编号</span></span><br><span class="line">回车，不通过扇区范围分配        </span><br><span class="line">+1G:设置一个1G大小分区   p:查看分区状态    d:删除    w:保存退出</span><br><span class="line"></span><br><span class="line">-删除分区</span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): d</span><br><span class="line">Partition number (1-6, default 6): 6</span><br><span class="line">Partition 6 has been deleted.</span><br><span class="line"></span><br><span class="line"><span class="comment">#partprobe    磁盘分区正常结束后，此命令可以正常执行，不返回任何信息，主要做刷新分表信息通知内核</span></span><br><span class="line">[root@clear /]# fdisk -l /dev/vdb</span><br><span class="line">[root@servera ~]# lsblk</span><br><span class="line">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS</span><br><span class="line">vda    252:0    0   10G  0 disk </span><br><span class="line">├─vda1 252:1    0    1M  0 part </span><br><span class="line">├─vda2 252:2    0  200M  0 part /boot/efi</span><br><span class="line">├─vda3 252:3    0  600M  0 part /boot</span><br><span class="line">└─vda4 252:4    0  9.2G  0 part /</span><br><span class="line">vdb    252:16   0    5G  0 disk </span><br><span class="line">├─vdb1 252:17   0    1G  0 part </span><br><span class="line">├─vdb2 252:18   0    1G  0 part </span><br><span class="line">├─vdb3 252:19   0    1G  0 part </span><br><span class="line">├─vdb4 252:20   0    1K  0 part </span><br><span class="line">├─vdb5 252:21   0    1G  0 part </span><br><span class="line">└─vdb6 252:22   0 1021M  0 part </span><br><span class="line">vdc    252:32   0    5G  0 disk </span><br><span class="line">vdd    252:48   0    5G  0 disk </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2 GPT分区方案</span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): g</span><br><span class="line">Created a new GPT disklabel (GUID: 1BA96F11-6DA0-204D-82D6-0CD15E42851E).</span><br><span class="line">The old dos signature will be removed by a write <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): n</span><br><span class="line">Partition number (1-128, default 1):  回车</span><br><span class="line">First sector (2048-10485726, default 2048): 回车 </span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G,T,P&#125; (2048-10485726, default 10485726): +1G</span><br><span class="line"></span><br><span class="line">Created a new partition 1 of <span class="built_in">type</span> <span class="string">&#x27;Linux filesystem&#x27;</span> and of size 1 GiB.</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): n</span><br><span class="line">Partition number (2-128, default 2): </span><br><span class="line">First sector (2099200-10485726, default 2099200): </span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G,T,P&#125; (2099200-10485726, default 10485726): +2G</span><br><span class="line"></span><br><span class="line">Created a new partition 2 of <span class="built_in">type</span> <span class="string">&#x27;Linux filesystem&#x27;</span> and of size 2 GiB.</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): l   <span class="comment">#列出分区标识类型</span></span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): t   <span class="comment">#改变分区标识类型</span></span><br><span class="line">Partition number (1,2, default 2): 2</span><br><span class="line">Partition <span class="built_in">type</span> (<span class="built_in">type</span> L to list all types): 19</span><br><span class="line"></span><br><span class="line">Changed <span class="built_in">type</span> of partition <span class="string">&#x27;Linux filesystem&#x27;</span> to <span class="string">&#x27;Linux swap&#x27;</span>.</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): p</span><br><span class="line">Disk /dev/vdb: 5 GiB, 5368709120 bytes, 10485760 sectors</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disklabel <span class="built_in">type</span>: gpt</span><br><span class="line">Disk identifier: 1BA96F11-6DA0-204D-82D6-0CD15E42851E</span><br><span class="line"></span><br><span class="line">Device       Start     End Sectors Size Type</span><br><span class="line">/dev/vdb1     2048 2099199 2097152   1G Linux filesystem</span><br><span class="line">/dev/vdb2  2099200 6293503 4194304   2G Linux swap</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): w</span><br><span class="line">The partition table has been altered.</span><br><span class="line">Calling ioctl() to re-read partition table.</span><br><span class="line">Syncing disks.</span><br><span class="line"></span><br><span class="line"><span class="comment"># partprobe  同步数据至内核</span></span><br></pre></td></tr></table></figure>

<h3 id="parted使用MBR分区方案"><a href="#parted使用MBR分区方案" class="headerlink" title="parted使用MBR分区方案"></a>parted使用MBR分区方案</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">1.mbr方式</span><br><span class="line">定义分区方案</span><br><span class="line">分区</span><br><span class="line">分3个区 主、扩展 、逻辑。再用非交互式创建第二个逻辑</span><br><span class="line">[root@servera /]# parted /dev/vdc     <span class="comment">#直接指定设备，而不是分区</span></span><br><span class="line">(parted) mklabel        <span class="comment">#按回车键  定义分区方案                                                    </span></span><br><span class="line">New disk label <span class="built_in">type</span>? msdos     <span class="comment">#两一下tab键，填写                                             </span></span><br><span class="line">Number  Start  End  Size  Type  File system  Flags</span><br><span class="line">(parted) mkpart <span class="comment">#分区                                                          </span></span><br><span class="line">Partition <span class="built_in">type</span>?  primary/extended? p  <span class="comment">#主/扩展/逻辑                                    </span></span><br><span class="line">File system <span class="built_in">type</span>?  [ext2]? ext4   <span class="comment">#无用，不生效</span></span><br><span class="line">Start? 2048s#第一个分区，一定从1M或2048s开始                                                          </span><br><span class="line">End? 1000MB <span class="comment">#分1G分区，1000M、1G、（10G磁盘，可以写10%，完全使用就是100%）                                                              </span></span><br><span class="line">(parted) p          <span class="comment">#查看                                                      </span></span><br><span class="line"></span><br><span class="line">Number  Start   End     Size   Type     File system  Flags</span><br><span class="line"> 1      1049kB  1000MB  999MB  primary  ext4         lba</span><br><span class="line">(parted) quit        <span class="comment">#退出                                                    </span></span><br><span class="line">Information: You may need to update /etc/fstab.</span><br><span class="line">[root@servera ~]#udevadm  settle (更新通知内核，建议敲上，不是必要)</span><br><span class="line"></span><br><span class="line">非交互式方式</span><br><span class="line">命令：</span><br><span class="line">[root@servera /]# parted /dev/vdc mkpart p ext4 1000MB 2000MB</span><br></pre></td></tr></table></figure>

<h3 id="parted使用GPT方案"><a href="#parted使用GPT方案" class="headerlink" title="parted使用GPT方案"></a><strong>parted使用GPT方案</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@clear /]# parted  /dev/vdc  <span class="comment">#使用了上一个实验的同样的分区，重复使用了vdc</span></span><br><span class="line">(parted) mklabel                                                          </span><br><span class="line">New disk label <span class="built_in">type</span>? gpt  <span class="comment">#再更改分区方案时会抹掉之前的分区数据</span></span><br><span class="line">Warning: The existing disk label on /dev/vdc will be destroyed and all data on this disk will be lost. Do</span><br><span class="line">you want to <span class="built_in">continue</span>?</span><br><span class="line">Yes/No? <span class="built_in">yes</span>    <span class="comment">#yes                                                            </span></span><br><span class="line">(parted) p                                                                 B</span><br><span class="line">Partition Table: gpt  <span class="comment">#此处显示gpt分区方案</span></span><br><span class="line">(parted) mkpart                                                           </span><br><span class="line">Partition name?  []? part1   <span class="comment">#分区名字                                               </span></span><br><span class="line">File system <span class="built_in">type</span>?  [ext2]?     <span class="comment">#直接回车                                           </span></span><br><span class="line">Start? 1M                                                                 </span><br><span class="line">End? 10%                                                                  </span><br><span class="line">(parted) p                                                                </span><br><span class="line">Number  Start   End     Size    File system  Name   Flags</span><br><span class="line"> 1      1049kB  1074MB  1073MB  ext2         part1        <span class="comment">#注意Number和Name</span></span><br><span class="line">(parted) mkpart</span><br><span class="line">Partition name?  []? part2                                                </span><br><span class="line">File system <span class="built_in">type</span>?  [ext2]?                                                </span><br><span class="line">Start? 10%                                                                </span><br><span class="line">End? 20%</span><br><span class="line">(parted) p</span><br><span class="line">Number  Start   End     Size    File system  Name   Flags</span><br><span class="line"> 1      1049kB  1074MB  1073MB  ext2         part1</span><br><span class="line"> 2      1074MB  2147MB  1074MB  ext2         part2   <span class="comment">#第二个分区完成</span></span><br><span class="line">(parted) <span class="built_in">rm</span>                                                               </span><br><span class="line">Partition number? 2               <span class="comment">#选择第二个分区的Number                                      </span></span><br><span class="line">(parted) p                                                                </span><br><span class="line">Number  Start   End     Size    File system  Name   Flags</span><br><span class="line"> 1      1049kB  1074MB  1073MB  ext2         part1</span><br><span class="line">(parted) q                                                                </span><br><span class="line"><span class="comment">#非交互式方式重新分第二个分区</span></span><br><span class="line">[root@clear /]# parted /dev/vdc mkpart  part2 ext2 10% 20%                </span><br><span class="line">[root@clear /]# parted /dev/vdc p</span><br><span class="line">Number  Start   End     Size    File system  Name   Flags</span><br><span class="line"> 1      1049kB  1074MB  1073MB               part1</span><br><span class="line"> 2      1074MB  2147MB  1074MB               part2   <span class="comment">#成功分配</span></span><br></pre></td></tr></table></figure>

<pre><code>lsblk 
lsblk /dev/vdc
blkid 
</code></pre>
<h2 id="12-2-文件系统"><a href="#12-2-文件系统" class="headerlink" title="12.2 文件系统"></a><strong>12.2 文件系统</strong></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.分区后，会给分区定义文件系统类型</span><br><span class="line">windos: fat32 ntfs exfat </span><br><span class="line">linux : exfat 有ext2 ext3 ext4 xfs vfat </span><br><span class="line">MacOS : exfat </span><br><span class="line">2.为什么定义文件系统？给磁盘定义一种存储数据的方法，这样块存储设备才可以记录文件数据。</span><br><span class="line">3.每个分区都可以定义一个独立的文件系统，定义的方法就是格式化。设备有了文件系统后才可以存储数据。</span><br><span class="line">4.操作系统里分区很多，每个分区可能会有相同或不同的文件系统类型，彼此独立</span><br><span class="line">5.VFS  虚拟文件系统：作用，将用户发送的指令给任何文件系统做翻译，对于用户来说，我不必学习不同文件系统的操作方法，而是使用常用shell管理指令，就可以通过VFS传递给不同的文件系统了。</span><br></pre></td></tr></table></figure>

<h3 id="格式化"><a href="#格式化" class="headerlink" title="格式化"></a><strong>格式化</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line">mkfs  选项  文件系统类型  设备名</span><br><span class="line">mkfs  -t    ext4      /dev/vdb1</span><br><span class="line">选项：</span><br><span class="line">-t： 指定文件系统  -t ext4</span><br><span class="line">例：</span><br><span class="line">[root@servera /]# mkfs -t ext4 /dev/vdc1    </span><br><span class="line">例2：使用.点代替-t</span><br><span class="line">[root@servera /]# mkfs.ext4 /dev/vdc2</span><br></pre></td></tr></table></figure>

<h3 id="lsblk"><a href="#lsblk" class="headerlink" title="lsblk"></a><strong>lsblk</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@servera /]# lsblk --fs /dev/vdc   <span class="comment">#-f  --fs</span></span><br><span class="line">NAME   FSTYPE LABEL UUID                                 MOUNTPOINT</span><br><span class="line">vdc                                                      </span><br><span class="line">├─vdc1 ext4         af656cc6-80e3-4b05-abcf-a162907c2f0a </span><br><span class="line">└─vdc2 xfs          64237913-4937-48ff-8afa-28c6fc05124d </span><br><span class="line">[root@servera /]# parted /dev/vdc p</span><br><span class="line">Model: Virtio Block Device (virtblk)</span><br><span class="line">Disk /dev/vdc: 5369MB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: msdos</span><br><span class="line">Disk Flags: </span><br><span class="line"></span><br><span class="line">Number  Start   End     Size   Type     File system  Flags</span><br><span class="line"> 1      1049kB  1000MB  999MB  primary  ext4</span><br><span class="line"> 2      1000MB  2000MB  999MB  primary  xfs</span><br><span class="line"> </span><br><span class="line">查看文件系统</span><br><span class="line">lsblk  --fs /dev/vdc</span><br><span class="line"></span><br><span class="line">blkid 超级管理员可用 也可查文件系统类型</span><br><span class="line">[root@servera ~]# lsblk -f /dev/vdb1</span><br><span class="line">NAME FSTYPE FSVER LABEL UUID                                 FSAVAIL FSUSE% MOUNTPOINTS</span><br><span class="line">vdb1 xfs                e36c91a4-83a0-4dba-a015-3f62bdc32b60                </span><br><span class="line">[root@servera ~]# blkid /dev/vdb1</span><br><span class="line">/dev/vdb1: UUID=<span class="string">&quot;e36c91a4-83a0-4dba-a015-3f62bdc32b60&quot;</span> TYPE=<span class="string">&quot;xfs&quot;</span> PARTUUID=<span class="string">&quot;bd4097dc-01&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="12-3-挂载与永久挂载"><a href="#12-3-挂载与永久挂载" class="headerlink" title="12.3 挂载与永久挂载"></a><strong>12.3 挂载与永久挂载</strong></h2><h3 id="mount"><a href="#mount" class="headerlink" title="mount"></a><strong>mount</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mount挂载也称为手动挂载，或临时挂载，重启失效</span><br><span class="line">语法：</span><br><span class="line">mount 文件系统 挂载点      <span class="comment">#源设备需要格式化后，成为文件系统才可挂载   #挂载点需要是空目录</span></span><br><span class="line">例1：mount /dev/vdb1 /mnt/disk_vdb1</span><br><span class="line"></span><br><span class="line">选项：</span><br><span class="line">-t 指定文件系统类型（默认自动识别） mount  -t ext4 /dev/vdb1    /mnt/disk_vdb1</span><br><span class="line">-o 指定挂载权限卸载--》再指定权限  mount  -o ro /dev/vdb1    /mnt/disk_vdb1</span><br><span class="line">例2：</span><br><span class="line">remount 重新挂载 （不卸载的基础上重新挂载）</span><br><span class="line">mount -o remount,ro /dev/vdc2</span><br><span class="line"></span><br><span class="line">卸载：</span><br><span class="line">umount 文件系统/挂载点</span><br><span class="line">例：</span><br><span class="line">umount /dev/vdb1  <span class="comment">#或者 umount /mnt/disk_vdb1  #卸载时要退出/mnt/disk_vdb1目录</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">1.临时挂载 </span><br><span class="line">[root@clear dev]# <span class="built_in">mkdir</span> /mnt/disk1   <span class="comment">#创建挂载点</span></span><br><span class="line">[root@clear dev]# mount /dev/vdc1 /mnt/disk1   <span class="comment">#挂载</span></span><br><span class="line">[root@clear dev]# <span class="built_in">df</span> -Th</span><br><span class="line">Filesystem     Type      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/vdc1      ext4      991M  2.6M  922M   1% /mnt/disk1</span><br><span class="line">[root@clear dev]# <span class="built_in">cd</span> /mnt/disk1  <span class="comment">#进入目录  </span></span><br><span class="line">[root@clear disk1]# <span class="built_in">touch</span> haha   <span class="comment">#使用</span></span><br><span class="line">[root@clear disk1]# <span class="built_in">ls</span></span><br><span class="line">haha  lost+found</span><br><span class="line">[root@clear disk1]# <span class="built_in">cd</span> /</span><br><span class="line">卸载</span><br><span class="line">[root@clear /]# umount /dev/vdc1</span><br><span class="line">[root@clear /]# <span class="built_in">df</span> -Th  <span class="comment">#查看发现已经没有/dev/vdc1的挂载信息，就算成功了 。</span></span><br><span class="line"></span><br><span class="line">2.使用UUID方式挂载</span><br><span class="line">[root@clear /]# lsblk -f <span class="comment">#也可以查看UUID</span></span><br><span class="line">[root@clear /]# blkid</span><br><span class="line">[root@clear /]# blkid /dev/vdc1</span><br><span class="line">/dev/vdc1: UUID=<span class="string">&quot;9bdeba87-5ad0-4c52-b577-0234115df2e1&quot;</span> TYPE=<span class="string">&quot;ext4&quot;</span> PARTLABEL=<span class="string">&quot;part1&quot;</span> PARTUUID=<span class="string">&quot;28f6e868-cd04-434c-9fd3-618f17382797&quot;</span></span><br><span class="line">[root@clear /]# mount UUID=<span class="string">&quot;9bdeba87-5ad0-4c52-b577-0234115df2e1&quot;</span> /mnt/disk1 <span class="comment">#鼠标左键选定后按滑轮中间。</span></span><br><span class="line">[root@clear /]# <span class="built_in">df</span> -Th</span><br><span class="line">/dev/vdc1      ext4      991M  2.6M  922M   1% /mnt/disk1</span><br><span class="line"></span><br><span class="line">mount方式挂载，重启失效</span><br><span class="line">[root@clear /]# <span class="built_in">df</span> -Th</span><br><span class="line">[root@clear /]# reboot  <span class="comment">#重启后再查看挂载</span></span><br></pre></td></tr></table></figure>

<h3 id="etc-fstab"><a href="#etc-fstab" class="headerlink" title="&#x2F;etc&#x2F;fstab"></a><strong>&#x2F;etc&#x2F;fstab</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">mount临时挂载:</span><br><span class="line">mount /dev/vdb1 /mnt/disk1</span><br><span class="line">mount -t ext4 -o rw /dev/vdb1 /mnt/disk1    //指定参数以只读方式挂载</span><br><span class="line"></span><br><span class="line">2.开机自动挂载   永久</span><br><span class="line">[root@clear /]# <span class="built_in">df</span> -h</span><br><span class="line">/dev/vdc1       991M  2.6M  922M   1% /mnt/disk1</span><br><span class="line">[root@clear /]# umount /dev/vdc1</span><br><span class="line">[root@clear /]# <span class="built_in">df</span> -h</span><br><span class="line">[root@clear /]# vim /etc/fstab </span><br><span class="line">/dev/vdc1       /mnt/disk1      ext4    defaults    0     0</span><br><span class="line">设备ID或设备名称    挂载点    文件系统类型   选项（权限，认证设定，其他）   内核日志检测机制0不检测，1、2检测，1比2优先级高  磁盘检测机制0不检测、1、2检测，1比2优先级高</span><br><span class="line"></span><br><span class="line">[root@clear /]# mount -a <span class="comment">#挂载/etc/fstab中所有未挂载的设备</span></span><br><span class="line">[root@clear /]# <span class="built_in">df</span> -Th</span><br><span class="line">/dev/vdc1      ext4      991M  2.6M  922M   1% /mnt/disk1</span><br><span class="line"></span><br><span class="line"><span class="comment">#reboot   #模拟考试环境，没做完selinux安全端口别重启，会起不来</span></span><br><span class="line"></span><br><span class="line">`注意`</span><br><span class="line">如果/etc/fstab中配置错误导致不能启动系统，重启时会自动进入紧急模式.</span><br><span class="line">解决方案流程：</span><br><span class="line">1 此时输入管理员root密码</span><br><span class="line">2 编辑挂载权限 <span class="comment">#mount -o remount,rw / </span></span><br><span class="line">3 vi /etc/fstab更改正内容或将其用  <span class="comment">#井号注释挂载内容后，</span></span><br><span class="line">4 reboot即可</span><br></pre></td></tr></table></figure>

<h2 id="12-4-管理交换分区"><a href="#12-4-管理交换分区" class="headerlink" title="12.4 管理交换分区"></a><strong>12.4 管理交换分区</strong></h2><h3 id="创建交换分区swap"><a href="#创建交换分区swap" class="headerlink" title="创建交换分区swap"></a><strong>创建交换分区swap</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">创建swap </span><br><span class="line">流程：</span><br><span class="line">1. 分区---1G</span><br><span class="line">[root@clear /]# parted  /dev/vdc mkpart part3 ext2 20% 30% </span><br><span class="line">Information: You may need to update /etc/fstab.</span><br><span class="line">[root@clear /]# parted  /dev/vdc p</span><br><span class="line">Number  Start   End     Size    File system  Name   Flags</span><br><span class="line"> 1      1049kB  1074MB  1073MB  ext4         part1</span><br><span class="line"> 2      1074MB  2147MB  1074MB  xfs          part2</span><br><span class="line"> 3      2147MB  3221MB  1074MB               part3</span><br><span class="line"></span><br><span class="line">2. 查询系统中swap空间，使用free命令</span><br><span class="line">[root@servera ~]# free -m</span><br><span class="line">               total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:            1763         371        1398          13         144        1391</span><br><span class="line">Swap:              0           0           0</span><br><span class="line">[root@servera ~]# free -h</span><br><span class="line">               total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           1.7Gi       371Mi       1.4Gi        13Mi       144Mi       1.4Gi</span><br><span class="line">Swap:             0B          0B          0B</span><br><span class="line"></span><br><span class="line">3. 格式化为swap</span><br><span class="line">[root@servera ~]# mkswap /dev/vdb2</span><br><span class="line">Setting up swapspace version 1, size = 1024 MiB (1073737728 bytes)</span><br><span class="line">no label, UUID=2cc08ea9-26ea-4e28-9ff5-070c84366f91</span><br><span class="line"></span><br><span class="line">4. 给系统加载swap空间</span><br><span class="line">     4.1 临时加载与卸载，重启失效 </span><br><span class="line">[root@servera ~]# swapon /dev/vdb2</span><br><span class="line">[root@servera ~]# free -m</span><br><span class="line">               total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:            1763         372        1398          13         144        1391</span><br><span class="line">Swap:           1023           0        1023</span><br><span class="line">[root@servera ~]# swapoff /dev/vdb2</span><br><span class="line">[root@servera ~]# free -m</span><br><span class="line">               total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:            1763         372        1396          13         148        1391</span><br><span class="line">Swap:              0           0           0</span><br><span class="line"></span><br><span class="line">     4.2 写入/etc/fstab文件永久生效</span><br><span class="line">[root@servera ~]# vim /etc/fstab</span><br><span class="line">/dev/vdb2       swap            swap    defaults  0   0</span><br><span class="line">[root@servera ~]# swapon -a    <span class="comment">#swap空间用swapon -a挂载</span></span><br><span class="line">[root@servera ~]# free -m</span><br><span class="line">               total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:            1763         377        1390          13         149        1385</span><br><span class="line">Swap:           1023           0        1023</span><br></pre></td></tr></table></figure>

<h3 id="使用本地存储创建swap"><a href="#使用本地存储创建swap" class="headerlink" title="使用本地存储创建swap"></a><strong>使用本地存储创建swap</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">swap-file</span><br><span class="line"><span class="comment"># df -h</span></span><br><span class="line"><span class="comment"># dd if=/dev/zero of=/pagefile.sys bs=512M count=1</span></span><br><span class="line"><span class="comment"># mkswap /pagefile.sys </span></span><br><span class="line"><span class="comment"># chmod 0600 /pagefile.sys </span></span><br><span class="line"><span class="comment"># vim /etc/fstab </span></span><br><span class="line">...</span><br><span class="line">/pagefile.sys swap swap defaults 0 0 </span><br><span class="line"><span class="comment"># swapon -a</span></span><br><span class="line"><span class="comment"># free -h</span></span><br></pre></td></tr></table></figure>

<h1 id="13-逻辑卷管理LVM"><a href="#13-逻辑卷管理LVM" class="headerlink" title="13 逻辑卷管理LVM"></a><strong>13 逻辑卷管理LVM</strong></h1><h2 id="13-1-创建和扩展逻辑卷"><a href="#13-1-创建和扩展逻辑卷" class="headerlink" title="13.1 创建和扩展逻辑卷"></a><strong>13.1 创建和扩展逻辑卷</strong></h2><h3 id="逻辑卷管理概述"><a href="#逻辑卷管理概述" class="headerlink" title="逻辑卷管理概述"></a><strong>逻辑卷管理概述</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">逻辑卷(LVM):基于内核的一种逻辑卷管理器，LVM适合于管理大存储设备，并允许用户动态调整文件系统的大小</span><br><span class="line">物理卷(PV)：LVM的最底层概念，是LVM的逻辑存储块，物理卷与磁盘分区是逻辑的对应关系</span><br><span class="line">卷组(VG)：LVM逻辑概念上的磁盘设备，通过将单个或多个物理卷组合后生成卷组。卷组的大小取决于物理卷的容量以及个数</span><br><span class="line">物理长度(PE)：物理长度是将物理卷组合为卷组后，所划分的最小存储单位，即逻辑意义上磁盘的最小存储单元。LVM默认PE大小为4MB</span><br><span class="line">逻辑卷(LV):LVM逻辑意义上的分区，可以指定从卷组中提取多少容量来创建逻辑卷，最后对逻辑卷格式化并挂载使用</span><br></pre></td></tr></table></figure>

<h3 id="构建LVM存储"><a href="#构建LVM存储" class="headerlink" title="构建LVM存储"></a><strong>构建LVM存储</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1.分区或者添加物理硬盘               fdisk,parted (mbr,gpt)</span><br><span class="line">2.pv让物理磁盘或分区变成lvm可用的卷   pvcreate </span><br><span class="line">3.创建vg同时指定pe块大小             vgcreate -s </span><br><span class="line">4.在vg中划分lv空间                   lvcreate -L | -l  -n vgname</span><br><span class="line">5.格式化lv空间</span><br><span class="line">6.挂载或者永久挂载</span><br><span class="line"></span><br><span class="line">PV语法：pvcreate  /dev/vdb1  /dev/vdb   <span class="comment">#分区名称或磁盘名</span></span><br><span class="line">VG语法：vgcreate -s 16M vgname pvname   <span class="comment">#-s不写默认4M，扩大的话可以是2的次方，比如4、8、16、32...，vgname是vg名称自定义，pvname就是创建pv时的物理分区名，就是pv名称</span></span><br><span class="line">LV语法：lvcreate -L 容量 -n lvname vgname <span class="comment">#指定容量可以使用-L 容量 或 -l 块数</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line">1.分区     至少分3个分区，模拟物理磁盘，作为pv的底层物理块设备</span><br><span class="line">[root@clear ~]# fdisk -l /dev/vdb</span><br><span class="line">Device     Boot   Start      End  Sectors Size Id Type</span><br><span class="line">/dev/vdb1          2048  2099199  2097152   1G 83 Linux</span><br><span class="line">/dev/vdb2       2099200  4196351  2097152   1G 83 Linux</span><br><span class="line">/dev/vdb3       4196352  6293503  2097152   1G 83 Linux</span><br><span class="line">/dev/vdb4       6293504 20971519 14678016   7G  5 Extended</span><br><span class="line">/dev/vdb5       6295552  8392703  2097152   1G 83 Linux</span><br><span class="line"></span><br><span class="line">2.PV阶段</span><br><span class="line">[root@clear ~]# man pvcreate ,搜索/EXAMPLES</span><br><span class="line">[root@servera ~]# pvcreate /dev/vdb&#123;1,3,5&#125;</span><br><span class="line">  Physical volume <span class="string">&quot;/dev/vdb1&quot;</span> successfully created.</span><br><span class="line">  Physical volume <span class="string">&quot;/dev/vdb3&quot;</span> successfully created.</span><br><span class="line">  Physical volume <span class="string">&quot;/dev/vdb5&quot;</span> successfully created.</span><br><span class="line">[root@clear ~]# pvs 或者 pvscan 或者 pvdisplay进行查询</span><br><span class="line">[root@servera ~]# pvscan</span><br><span class="line">  PV /dev/vdb1                      lvm2 [1.00 GiB]</span><br><span class="line">  PV /dev/vdb3                      lvm2 [1.00 GiB]</span><br><span class="line">  PV /dev/vdb5                      lvm2 [1.00 GiB]</span><br><span class="line">  Total: 3 [3.00 GiB] / <span class="keyword">in</span> use: 0 [0   ] / <span class="keyword">in</span> no VG: 3 [3.00 GiB]</span><br><span class="line"></span><br><span class="line">3.VG阶段</span><br><span class="line">[root@clear ~]# man vgcreate ,搜索/myvg</span><br><span class="line">[root@clear ~]# man vgcreate | grep myvg</span><br><span class="line">[root@clear ~]# vgcreate -s 16M vg100 /dev/vdb&#123;1..3&#125;    <span class="comment"># -s指定物理扩展块16M一个</span></span><br><span class="line">Physical volume <span class="string">&quot;/dev/vdb2&quot;</span> successfully created.</span><br><span class="line">  Volume group <span class="string">&quot;vg100&quot;</span> successfully created</span><br><span class="line"></span><br><span class="line">[root@clear ~]# vgs         <span class="comment">#主要查看下vg的大小，拥有的pv和lv数量</span></span><br><span class="line">VG    <span class="comment">#PV #LV #SN Attr   VSize VFree</span></span><br><span class="line">  vg100   3   0   0 wz--n- 2.95g 2.95g</span><br><span class="line"></span><br><span class="line">[root@clear ~]# vgdisplay   <span class="comment">#vg名，容量，块大小，块的使用量</span></span><br><span class="line">--- Volume group ---</span><br><span class="line">  VG Name               vg100</span><br><span class="line">  System ID             </span><br><span class="line">  Format                lvm2</span><br><span class="line">  Metadata Areas        3</span><br><span class="line">  Metadata Sequence No  1</span><br><span class="line">  VG Access             <span class="built_in">read</span>/write</span><br><span class="line">  VG Status             resizable</span><br><span class="line">  MAX LV                0</span><br><span class="line">  Cur LV                0</span><br><span class="line">  Open LV               0</span><br><span class="line">  Max PV                0</span><br><span class="line">  Cur PV                3</span><br><span class="line">  Act PV                3</span><br><span class="line">  VG Size               2.95 GiB</span><br><span class="line">  PE Size               16.00 MiB</span><br><span class="line">  Total PE              189</span><br><span class="line">  Alloc PE / Size       0 / 0   </span><br><span class="line">  Free  PE / Size       189 / 2.95 GiB</span><br><span class="line">  VG UUID               mA8syS-SLSn-VO3X-VReN-Awik-2eVW-Geqqv2</span><br><span class="line"></span><br><span class="line">pv vg  pe 65535 固定 16M  x 65535 = 270G  2^2  </span><br><span class="line"></span><br><span class="line">4.LV阶段</span><br><span class="line">[root@clear ~]# man lvcreate ,搜索/64m</span><br><span class="line">[root@clear ~]# man lvcreate | grep 64m</span><br><span class="line">lvcreate -L 64m -n mylv vg00 /dev/sda:0-7 /dev/sdb:0-7</span><br><span class="line"></span><br><span class="line">[root@clear ~]# lvcreate -L 1G -n lv100 vg100　　　　//(-L:指定具体容量、-n:指定逻辑卷名称)</span><br><span class="line">Logical volume <span class="string">&quot;lv100&quot;</span> created.</span><br><span class="line"></span><br><span class="line">[root@clear ~]# lvs</span><br><span class="line">LV    VG    Attr       LSize Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span><br><span class="line">  lv100 vg100 -wi-a----- 1.00g </span><br><span class="line"></span><br><span class="line">[root@clear ~]# lvdisplay </span><br><span class="line">--- Logical volume ---</span><br><span class="line">  LV Path                /dev/vg100/lv100</span><br><span class="line">  LV Name                lv100</span><br><span class="line">  VG Name                vg100</span><br><span class="line">  LV UUID                zxJzck-SgUJ-1kBV-5rfo-aG2I-OHZ9-5KOLPt</span><br><span class="line">  LV Write Access        <span class="built_in">read</span>/write</span><br><span class="line">  LV Creation host, <span class="keyword">time</span> servera.lab.example.com, 2025-03-02 00:14:49 -0500</span><br><span class="line">  LV Status              available</span><br><span class="line">  <span class="comment"># open                 0</span></span><br><span class="line">  LV Size                1.00 GiB</span><br><span class="line">  Current LE             64</span><br><span class="line">  Segments               2</span><br><span class="line">  Allocation             inherit</span><br><span class="line">  Read ahead sectors     auto</span><br><span class="line">  - currently <span class="built_in">set</span> to     8192</span><br><span class="line">  Block device           253:0</span><br><span class="line"></span><br><span class="line">5.格式化</span><br><span class="line">[root@servera ~]# mkfs.xfs /dev/vg100/lv100</span><br><span class="line">meta-data=/dev/vg100/lv100       isize=512    agcount=4, agsize=65536 blks</span><br><span class="line">         =                       sectsz=512   attr=2, projid32bit=1</span><br><span class="line">         =                       crc=1        finobt=1, sparse=1, rmapbt=0</span><br><span class="line">         =                       reflink=1    bigtime=1 inobtcount=1 nrext64=0</span><br><span class="line">data     =                       bsize=4096   blocks=262144, imaxpct=25</span><br><span class="line">         =                       sunit=0      swidth=0 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0, ftype=1</span><br><span class="line"><span class="built_in">log</span>      =internal <span class="built_in">log</span>           bsize=4096   blocks=16384, version=2</span><br><span class="line">         =                       sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br><span class="line">Discarding blocks...Done.              </span><br><span class="line">[root@servera ~]# lsblk -f /dev/vg100/lv100</span><br><span class="line">NAME        FSTYPE FSVER LABEL UUID                                 FSAVAIL FSUSE% MOUNTPOINTS</span><br><span class="line">vg100-lv100 xfs                e665f339-9faf-4fc9-8cbd-d29468bed812</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">6.创建挂载点与临时挂载</span><br><span class="line"><span class="comment"># mkdir /mnt/lvm1</span></span><br><span class="line"><span class="comment"># mount /dev/vg100/lv100 /mnt/lvm1</span></span><br><span class="line"><span class="comment"># df -h</span></span><br><span class="line"><span class="comment"># cd /mnt/lvm/</span></span><br><span class="line"></span><br><span class="line">7.永久挂载</span><br><span class="line">[root@clear ~]# <span class="built_in">cd</span> /</span><br><span class="line">[root@clear /]# <span class="built_in">echo</span> <span class="string">&quot;/dev/vg100/lv100 /mnt/lvm1 xfs defaults 0 0&quot;</span> &gt;&gt; /etc/fstab    // <span class="string">&quot;&gt;&gt;&quot;</span>表示追加</span><br><span class="line">[root@clear /]# mount -a</span><br><span class="line">[root@servera ~]# <span class="built_in">df</span> -Th</span><br><span class="line">/dev/mapper/vg100-lv100 xfs       960M   39M  922M   5% /mnt/lvm1</span><br><span class="line"></span><br><span class="line">[root@servera ~]# ll /dev/mapper/vg100-lv100 /dev/vg100/lv100</span><br><span class="line">lrwxrwxrwx. 1 root root 7 Mar  2 00:24 /dev/mapper/vg100-lv100 -&gt; ../dm-0</span><br><span class="line">lrwxrwxrwx. 1 root root 7 Mar  2 00:24 /dev/vg100/lv100 -&gt; ../dm-0</span><br><span class="line"></span><br><span class="line">8.reboot重启验证</span><br><span class="line"></span><br><span class="line">9.删除逻辑卷思路：</span><br><span class="line">  创建顺序---分区--lv（pv-vg-lv）--格式化---挂载</span><br><span class="line">  卸载顺序---卸载--删lv--删vg--删pv--删分区</span><br><span class="line">  vgremove vg100</span><br></pre></td></tr></table></figure>

<h3 id="扩展逻辑卷"><a href="#扩展逻辑卷" class="headerlink" title="扩展逻辑卷"></a><strong>扩展逻辑卷</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">扩展流程：</span><br><span class="line">1、扩展lv大小增加容量</span><br><span class="line">2、重新定义文件系统大小</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">1 扩展语法：</span><br><span class="line">lvextend 【-L| -l】【size|PE】 lv_name</span><br><span class="line"></span><br><span class="line">选项：</span><br><span class="line">-L：指定容量   直接指定最终大小 -L 1500M ，或者在原有基础上增加多少容量 -L2</span><br><span class="line">-l：指定块数   -l 60     ， -l +30</span><br><span class="line">[root@servera ~]# lvextend -L 1500M /dev/vg100/lv100</span><br><span class="line">  Rounding size to boundary between physical extents: &lt;1.47 GiB.</span><br><span class="line">  Size of logical volume vg100/lv100 changed from 1.00 GiB (64 extents) to &lt;1.47 GiB (94 extents).</span><br><span class="line">  Logical volume vg100/lv100 successfully resized.</span><br><span class="line"></span><br><span class="line">[root@servera ~]# lvdisplay </span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/vg100/lv100</span><br><span class="line">  LV Name                lv100</span><br><span class="line">  VG Name                vg100</span><br><span class="line">  LV UUID                zxJzck-SgUJ-1kBV-5rfo-aG2I-OHZ9-5KOLPt</span><br><span class="line">  LV Write Access        <span class="built_in">read</span>/write</span><br><span class="line">  LV Creation host, <span class="keyword">time</span> servera.lab.example.com, 2025-03-02 00:14:49 -0500</span><br><span class="line">  LV Status              available</span><br><span class="line">  <span class="comment"># open                 1</span></span><br><span class="line">  LV Size                &lt;1.47 GiB</span><br><span class="line">  Current LE             94</span><br><span class="line">  Segments               2</span><br><span class="line">  Allocation             inherit</span><br><span class="line">  Read ahead sectors     auto</span><br><span class="line">  - currently <span class="built_in">set</span> to     8192</span><br><span class="line">  Block device           253:0</span><br><span class="line"></span><br><span class="line">$ lvextend -l 60 /dev/vg100/lv100</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">2 重新定义文件系统大小</span><br><span class="line"></span><br><span class="line">ext 文件系统 ”resize2fs  设备名/挂载点“   resize2fs /dev/vg100/lv100</span><br><span class="line">xfs 文件系统 “xfs_growfs 设备名/挂载点”   xfs_growfs /dev/vg100/lv100 或 xfs_growfs 挂载点</span><br><span class="line">    </span><br><span class="line">例：</span><br><span class="line">如果是xfs文件系统使用：</span><br><span class="line">[root@servera /]# xfs_growfs /mnt/lvm (挂载点)</span><br><span class="line">[root@servera ~]# <span class="built_in">df</span> -Th</span><br><span class="line">/dev/mapper/vg100-lv100 xfs       1.5G   43M  1.4G   3% /mnt/lvm1</span><br><span class="line"></span><br><span class="line">如果是ext4文件系统使用：</span><br><span class="line">[root@servera /]# resize2fs /dev/myvg/mylv （lv设备名）</span><br><span class="line">创建的lv名称为myly，属于myvg卷组，lv需要30个pe，每个pe16M，需要开机自动挂载到/mnt/mylvdir. 并且使用xfs文件系统</span><br></pre></td></tr></table></figure>

<h3 id="缩小逻辑卷-1"><a href="#缩小逻辑卷-1" class="headerlink" title="缩小逻辑卷"></a><strong>缩小逻辑卷</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">格式化:</span><br><span class="line">[root@servera ~]# mkfs.ext4 /dev/vg200/lv200</span><br><span class="line">mke2fs 1.46.5 (30-Dec-2021)</span><br><span class="line">Discarding device blocks: <span class="keyword">done</span>                            </span><br><span class="line">Creating filesystem with 385024 4k blocks and 96384 inodes</span><br><span class="line">Filesystem UUID: acc0ec9f-90af-4373-8daa-c9525954aeef</span><br><span class="line">Superblock backups stored on blocks: </span><br><span class="line">    32768, 98304, 163840, 229376, 294912</span><br><span class="line"></span><br><span class="line">Allocating group tables: <span class="keyword">done</span>                            </span><br><span class="line">Writing inode tables: <span class="keyword">done</span>                            </span><br><span class="line">Creating journal (8192 blocks): <span class="keyword">done</span></span><br><span class="line">Writing superblocks and filesystem accounting information: <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">永久挂载:</span><br><span class="line">[root@servera ~]# <span class="built_in">mkdir</span> /mnt/lvm2</span><br><span class="line">[root@servera ~]# <span class="built_in">echo</span> <span class="string">&quot;/dev/vg200/lv200 /mnt/lvm2 ext4 defaults 0 0&quot;</span> &gt;&gt; /etc/fstab</span><br><span class="line">[root@servera ~]# mount -a</span><br><span class="line">mount: (hint) your fstab has been modified, but systemd still uses</span><br><span class="line">       the old version; use <span class="string">&#x27;systemctl daemon-reload&#x27;</span> to reload.</span><br><span class="line">[root@servera ~]# systemctl daemon-reload</span><br><span class="line">[root@servera ~]# mount -a</span><br><span class="line">[root@servera ~]# <span class="built_in">df</span> -Th</span><br><span class="line">Filesystem              Type      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/vg100-lv100 xfs       1.5G   43M  1.4G   3% /mnt/lvm1</span><br><span class="line">/dev/mapper/vg200-lv200 ext4      1.5G   24K  1.4G   1% /mnt/lvm2</span><br><span class="line"></span><br><span class="line">ext文件系统可以缩小，xfs不支持:</span><br><span class="line">流程：</span><br><span class="line">1. 卸载</span><br><span class="line">[root@servera ~]# umount /mnt/lvm2</span><br><span class="line"></span><br><span class="line">2. resize2fs 定义缩小后的大小</span><br><span class="line">[root@servera ~]# resize2fs /dev/vg200/lv200 1G</span><br><span class="line">resize2fs 1.46.5 (30-Dec-2021)</span><br><span class="line">Please run <span class="string">&#x27;e2fsck -f /dev/vg200/lv200&#x27;</span> first.</span><br><span class="line"></span><br><span class="line">3. 磁盘检测</span><br><span class="line">[root@servera ~]# e2fsck -f /dev/vg200/lv200</span><br><span class="line">e2fsck 1.46.5 (30-Dec-2021)</span><br><span class="line">Pass 1: Checking inodes, blocks, and sizes</span><br><span class="line">Pass 2: Checking directory structure</span><br><span class="line">Pass 3: Checking directory connectivity</span><br><span class="line">Pass 4: Checking reference counts</span><br><span class="line">Pass 5: Checking group summary information</span><br><span class="line">/dev/vg200/lv200: 11/96384 files (0.0% non-contiguous), 15380/385024 blocks</span><br><span class="line"></span><br><span class="line">4. 重新执行resize2fs命令</span><br><span class="line">[root@servera ~]# resize2fs /dev/vg200/lv200 1G</span><br><span class="line">resize2fs 1.46.5 (30-Dec-2021)</span><br><span class="line">Resizing the filesystem on /dev/vg200/lv200 to 262144 (4k) blocks.</span><br><span class="line">The filesystem on /dev/vg200/lv200 is now 262144 (4k) blocks long.</span><br><span class="line"></span><br><span class="line">5.重新挂载并查看</span><br><span class="line">[root@servera ~]# mount -a</span><br><span class="line">[root@servera ~]# <span class="built_in">df</span> -Th</span><br><span class="line">Filesystem              Type      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/vg100-lv100 xfs       1.5G   43M  1.4G   3% /mnt/lvm1</span><br><span class="line">/dev/mapper/vg200-lv200 ext4      973M   24K  906M   1% /mnt/lvm2</span><br><span class="line"></span><br><span class="line">5. lvresize -L 1G 逻辑卷名</span><br><span class="line">[root@servera ~]# lvresize -L 1G /dev/vg200/lv200</span><br><span class="line">[root@servera ~]# lvdisplay</span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/vg200/lv200</span><br><span class="line">  LV Name                lv200</span><br><span class="line">  VG Name                vg200</span><br><span class="line">  LV UUID                0jTstG-VDnH-8IAu-ixXm-blym-tenp-d6t4Jt</span><br><span class="line">  LV Write Access        <span class="built_in">read</span>/write</span><br><span class="line">  LV Creation host, <span class="keyword">time</span> servera.lab.example.com, 2025-03-02 00:49:11 -0500</span><br><span class="line">  LV Status              available</span><br><span class="line">  <span class="comment"># open                 1</span></span><br><span class="line">  LV Size                1.00 GiB</span><br><span class="line">  Current LE             64</span><br><span class="line">  Segments               2</span><br><span class="line">  Allocation             inherit</span><br><span class="line">  Read ahead sectors     auto</span><br><span class="line">  - currently <span class="built_in">set</span> to     8192</span><br><span class="line">  Block device           253:1</span><br></pre></td></tr></table></figure>

<h2 id="13-2-管理分层存储"><a href="#13-2-管理分层存储" class="headerlink" title="13.2 管理分层存储"></a><strong>13.2 管理分层存储</strong></h2><h3 id="stratis"><a href="#stratis" class="headerlink" title="stratis"></a><strong>stratis</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">1.1 安装</span><br><span class="line"></span><br><span class="line">$ yum install -y stratis-cli stratisd</span><br><span class="line">$ systemctl <span class="built_in">enable</span> --now stratisd</span><br><span class="line">```</span><br><span class="line">1.2 部署存储池</span><br><span class="line"></span><br><span class="line">1.为磁盘分区(可选用磁盘或分区)，模拟块设备（磁盘）         </span><br><span class="line">[root@servera ~]# stratis pool create pool1 /dev/vdb    <span class="comment">#创建池名为pool1</span></span><br><span class="line">[root@servera ~]# stratis pool list    <span class="comment">#列出池信息包括大小</span></span><br><span class="line">[root@servera ~]# stratis blockdev list  <span class="comment">#列出池有哪些物理块设备组成</span></span><br><span class="line">[root@servera ~]# stratis pool add-data pool1 /dev/vdc <span class="comment">#添加额外存储</span></span><br><span class="line">[root@servera ~]# stratis pool list</span><br><span class="line">[root@servera ~]# stratis blockdev list </span><br><span class="line">ool Name   Device Node   Physical Size   Tier</span><br><span class="line">pool1       /dev/vdb              5 GiB   Data</span><br><span class="line">pool1       /dev/vdc              5 GiB   Data</span><br><span class="line"></span><br><span class="line">1.3 创建文件系统</span><br><span class="line"></span><br><span class="line">[root@servera ~]# man stratis   <span class="comment">#搜/example</span></span><br><span class="line">[root@servera ~]# stratis filesystem create pool1 fs1   <span class="comment">#在pool1中创建文件系统fs1</span></span><br><span class="line">[root@servera ~]# stratis filesystem list  <span class="comment">#列出文件系统信息</span></span><br><span class="line">Pool Name   Name   Used      Created             Device                   UUID                                </span><br><span class="line">pool1       fs1    546 MiB   Sep 16 2023 21:30   /dev/stratis/pool1/fs1   0e40b338-6178-4bee-87b3-6e13b8be5ad0</span><br><span class="line"> 6d1ed6e714a6428eb374549b4fdd8d2b  </span><br><span class="line">[root@servera ~]# <span class="built_in">mkdir</span> /mnt/stratisdisk   <span class="comment">#创建挂载点</span></span><br><span class="line">如何查看uuid</span><br><span class="line">[root@servera ~]# lsblk --output=UUID  /dev/stratis/pool1/fs1</span><br><span class="line">[root@servera ~]# mount /dev/stratis/pool1/fs1 /mnt/stratisdisk/   <span class="comment">#临时挂载</span></span><br><span class="line">```</span><br><span class="line">1.4 备份</span><br><span class="line">-创建测试文件</span><br><span class="line">[root@servera ~]# <span class="built_in">touch</span> /mnt/stratisdisk/haha.txt</span><br><span class="line"></span><br><span class="line">-备份</span><br><span class="line">[root@servera ~]# stratis filesystem snapshot pool1 fs1 fs1.bak</span><br><span class="line">[root@servera ~]# <span class="built_in">rm</span> -f /mnt/stratisdisk/haha.txt </span><br><span class="line">[root@servera ~]# umount /mnt/stratisdisk </span><br><span class="line"></span><br><span class="line">[root@servera ~]# mount /dev/stratis/pool1/fs1.bak /mnt/stratisdisk</span><br><span class="line">[root@servera ~]# <span class="built_in">ls</span> /mnt/stratisdisk</span><br><span class="line">haha.txt</span><br><span class="line"></span><br><span class="line">1.5 开机自动挂载</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">vim /etc/fstab</span><br><span class="line">/dev/stratis/pool1/fs1.bak /mnt/stratisdisk xfs _netdev 0 0 <span class="comment">#_netdev 延迟挂载，先连接网络再挂载文件系统</span></span><br><span class="line">mount -a</span><br><span class="line"></span><br><span class="line">[root@clear ~]# systemctl start stratis</span><br><span class="line">[root@clear ~]# stratis pool create mypool /dev/vdb1</span><br><span class="line">[root@clear ~]# stratis pool add-cache mypool /dev/vdb2</span><br><span class="line">[root@clear ~]# stratis blockdev list mypool </span><br><span class="line">Pool Name  Device Node  Physical Size   Tier</span><br><span class="line">mypool     /dev/vdb1            1 GiB   Data</span><br><span class="line">mypool     /dev/vdb2            1 GiB  Cache</span><br></pre></td></tr></table></figure>

<h3 id="VDO"><a href="#VDO" class="headerlink" title="VDO"></a><strong>VDO</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 2 VDO</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 1.1安装</span></span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">该实验需要在普通环境上做，恢复init快照，默认是294，要切换至rh134课程</span><br><span class="line">切换方法：</span><br><span class="line">【foundation】</span><br><span class="line">[kiosk@foundation0 ~]$ rht-clearcourse 0</span><br><span class="line">[kiosk@foundation0 ~]$ rht-setcourse rh134</span><br><span class="line">[kiosk@foundation0 ~]$ <span class="built_in">cat</span> /etc/rht | grep RHT_COURSE   </span><br><span class="line">RHT_COURSE=rh134        <span class="comment">#必须保证课程是rh134才可以</span></span><br><span class="line">[kiosk@foundation0 ~]$ <span class="keyword">for</span> i <span class="keyword">in</span> classroom bastion workstation servera;<span class="keyword">do</span> rht-vmctl start <span class="variable">$i</span>;<span class="keyword">done</span>  <span class="comment">#开这4台虚拟机，打开时稍等3分钟左右，让其保证都开启，然后ping一下测试连通性</span></span><br><span class="line">[kiosk@foundation0 ~]$ <span class="keyword">for</span> i <span class="keyword">in</span> classroom bastion workstation servera;<span class="keyword">do</span> ping -c 4  <span class="variable">$i</span>;<span class="keyword">done</span>  </span><br><span class="line">结果都是以下结果即可，应出现icmp_seq=1 ttl=64 <span class="keyword">time</span>=1.13 ms字样：</span><br><span class="line">PING bastion.lab.example.com (172.25.250.254) 56(84) bytes of data.</span><br><span class="line">64 bytes from bastion.lab.example.com (172.25.250.254): icmp_seq=1 ttl=64 <span class="keyword">time</span>=1.13 ms</span><br><span class="line">64 bytes from bastion.lab.example.com (172.25.250.254): icmp_seq=2 ttl=64 <span class="keyword">time</span>=0.180 ms</span><br><span class="line">64 bytes from bastion.lab.example.com (172.25.250.254): icmp_seq=3 ttl=64 <span class="keyword">time</span>=0.234 ms</span><br><span class="line">64 bytes from bastion.lab.example.com (172.25.250.254): icmp_seq=4 ttl=64 <span class="keyword">time</span>=0.265 m</span><br><span class="line"></span><br><span class="line">【foundation】</span><br><span class="line">ssh student@workstation</span><br><span class="line">【workstation】</span><br><span class="line">lab advstorage-vdo start   <span class="comment">#运行脚本，运行前，保证servera已打开</span></span><br><span class="line">ssh student@servera</span><br><span class="line">【servera】</span><br><span class="line">[root@servera ~]# <span class="built_in">sudo</span> -i</span><br><span class="line">[root@servera ~]# yum search vdo</span><br><span class="line">[root@servera ~]# yum install -y vdo.x86_64 kmod-kvdo.x86_64</span><br><span class="line">[root@servera ~]# systemctl <span class="built_in">enable</span> --now vdo</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line"><span class="comment">### 1.2 部署vdo</span></span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">[root@servera ~]# man vdo   <span class="comment">#/EXAMPLE</span></span><br><span class="line">*[root@servera ~]# vdo create --name=vdo1 --device=/dev/vdd --vdoLogicalSize=50G</span><br><span class="line">[root@servera ~]# vdo list</span><br><span class="line">[root@servera ~]# vdo status --name=vdo1</span><br><span class="line">[root@servera ~]# vdo status --name=vdo1 | grep Dedu</span><br><span class="line">[root@servera ~]# vdo status --name=vdo1 | grep Comp</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line"><span class="comment">### 1.3 格式化及临时挂载测试</span></span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">格式化</span><br><span class="line">*[root@servera ~]#  mkfs.xfs -K /dev/mapper/vdo1      <span class="comment">#-K让命令可以快速返回，效果类似快速格式化 ，如果已有文件系统 可以使用 -f强制执行 </span></span><br><span class="line"></span><br><span class="line">挂载</span><br><span class="line">*[root@servera ~]# <span class="built_in">mkdir</span> /mnt/vdo1</span><br><span class="line">[root@servera ~]# mount /dev/mapper/vdo1 /mnt/vdo1</span><br><span class="line">[root@servera ~]# <span class="built_in">df</span> -Th</span><br><span class="line">[root@servera ~]# vdostats --human-readable</span><br><span class="line">[root@servera ~]# <span class="built_in">cp</span> /root/install.img /mnt/vdo1/install.img.1</span><br><span class="line">[root@servera ~]# vdostats --human-readable</span><br><span class="line">[root@servera ~]# vdostats --human-readable</span><br><span class="line">[root@servera ~]# <span class="built_in">cp</span> /root/install.img /mnt/vdo1/install.img.2</span><br><span class="line">[root@servera ~]# vdostats --human-readable vdostats --human-readable</span><br><span class="line"><span class="built_in">ls</span> /mnt/vdo1/</span><br><span class="line">lab advstorage-vdo finish</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line"><span class="comment">### 1.4 开机自动挂载</span></span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">开机自动挂载方法：教材推荐</span><br><span class="line">*[root@servera ~]# man vdo- | grep x-systemd</span><br><span class="line">/dev/mapper/vdo1 /mnt/vdo1 xfs defaults,x-systemd.requires=vdo.service 0 0</span><br><span class="line"></span><br><span class="line">mount -a</span><br><span class="line"></span><br><span class="line">方法二：</span><br><span class="line">/dev/mapper/vdo1 /mnt/vdo1 xfs defaults,_netdev 0 0</span><br></pre></td></tr></table></figure>

<h1 id="14-访问网络存储"><a href="#14-访问网络存储" class="headerlink" title="14 访问网络存储"></a><strong>14 访问网络存储</strong></h1><h2 id="14-1-NFS挂载网络附加存储"><a href="#14-1-NFS挂载网络附加存储" class="headerlink" title="14.1 NFS挂载网络附加存储"></a><strong>14.1 NFS挂载网络附加存储</strong></h2><h3 id="查看NFS共享"><a href="#查看NFS共享" class="headerlink" title="查看NFS共享"></a><strong>查看NFS共享</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">普通环境</span><br><span class="line">[root@servera ~]# showmount -e 172.25.254.250  <span class="comment">#后面IP地址是NFS服务器的地址，环境默认已经部署好</span></span><br><span class="line">Export list <span class="keyword">for</span> 172.25.254.250:     <span class="comment">#来自250的共享</span></span><br><span class="line">/content 172.25.0.0/255.255.0.0     <span class="comment">#服务器共享的目录</span></span><br></pre></td></tr></table></figure>

<h3 id="客户端挂载-mount"><a href="#客户端挂载-mount" class="headerlink" title="客户端挂载 mount"></a><strong>客户端挂载 mount</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line">mount -t nfs  ip/域名:共享目录  本地挂载点</span><br><span class="line">练习：</span><br><span class="line">[root@servera ~]# <span class="built_in">mkdir</span> /mnt/nfs1</span><br><span class="line"><span class="comment">#mount -t nfs -o ro 172.25.254.250:/content  /mnt/nfs1  #-t nfs指定文件系统为nfs，-o ro指定挂载权限为只读，这两个选项是可选的。</span></span><br><span class="line">[root@servera ~]# mount 172.25.254.250:/content  /mnt/nfs1</span><br><span class="line">[root@servera ~]# <span class="built_in">df</span> -Th</span><br><span class="line">Filesystem              Type      Size  Used Avail Use% Mounted on</span><br><span class="line">172.25.254.250:/content nfs4      244G  102G  142G  42% /mnt/nfs1</span><br></pre></td></tr></table></figure>

<h3 id="开机自动挂载-etc-fstab"><a href="#开机自动挂载-etc-fstab" class="headerlink" title="开机自动挂载 &#x2F;etc&#x2F;fstab"></a><strong>开机自动挂载 &#x2F;etc&#x2F;fstab</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@servera ~]# umount /mnt/nfs1</span><br><span class="line">[root@servera ~]# vim /etc/fstab</span><br><span class="line">172.25.254.250:/content /mnt/nfs1 nfs defaults 0 0</span><br><span class="line">[root@servera ~]# mount -a</span><br><span class="line">[root@servera ~]# <span class="built_in">df</span> -Th</span><br><span class="line">Filesystem              Type      Size  Used Avail Use% Mounted on</span><br><span class="line">172.25.254.250:/content nfs4      244G  102G  142G  42% /mnt/nfs1</span><br><span class="line">[root@servera ~]# reboot  (重启后使用<span class="built_in">df</span> -Th查看挂载状态)模拟考试环境没做selinux题，先别重启，起不来</span><br></pre></td></tr></table></figure>

<h2 id="14-2-自动挂载网络附加存储autofs"><a href="#14-2-自动挂载网络附加存储autofs" class="headerlink" title="14.2 自动挂载网络附加存储autofs"></a><strong>14.2 自动挂载网络附加存储autofs</strong></h2><h3 id="自动挂载示例1"><a href="#自动挂载示例1" class="headerlink" title="自动挂载示例1"></a><strong>自动挂载示例1</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">servera上做该练习，挂载f0，172.25.254.250上的/content到servera上的/mnt/nfs10，读写权限</span><br><span class="line">-mount</span><br><span class="line"><span class="built_in">mkdir</span> /mnt/nfs10</span><br><span class="line">mount 172.25.254.250:/content /mnt/nfs10</span><br><span class="line"></span><br><span class="line">-fstab</span><br><span class="line"><span class="built_in">mkdir</span> /mnt/nfs10</span><br><span class="line">vim  /etc/fstab</span><br><span class="line">172.25.254.250:/content /mnt/nfs10  nfs4  defaults 0 0</span><br><span class="line"></span><br><span class="line">-autofs</span><br><span class="line">1.[root@clear home]# yum search autofs</span><br><span class="line">  [root@clear home]# yum install -y autofs</span><br><span class="line"></span><br><span class="line">2.[root@servera ~]# rpm -qc autofs</span><br><span class="line">  /etc/auto.master   <span class="comment"># 主配置文件</span></span><br><span class="line">  /etc/auto.misc     <span class="comment"># 映射文件</span></span><br><span class="line">  /etc/auto.net</span><br><span class="line">  /etc/auto.smb</span><br><span class="line">  /etc/autofs.conf</span><br><span class="line">  /etc/autofs_ldap_auth.conf</span><br><span class="line">  /etc/sysconfig/autofs</span><br><span class="line">  /usr/lib/systemd/system/autofs.service</span><br><span class="line"></span><br><span class="line">3.[root@servera ~]# vim /etc/auto.master</span><br><span class="line">   基础挂载点     映射文件</span><br><span class="line">   /data         /etc/auto.misc         <span class="comment"># /data是基础挂载点，表示挂载是从这里开始的，系统自动创建/data</span></span><br><span class="line"></span><br><span class="line">4.[root@servera ~]# vim /etc/auto.misc</span><br><span class="line">   映射挂载点         文件系统类型 权限          共享目录</span><br><span class="line">   nfs10             -fstype=nfs,rw         172.25.250.250:/content   <span class="comment"># auto.misc是映射文件，内容为映射挂载点、挂载权限、共享目录路径等</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5.[root@servera ~]# systemctl restart autofs   <span class="comment"># 重启让以上配置生效</span></span><br><span class="line"></span><br><span class="line">6.验证</span><br><span class="line">[root@servera ~]# <span class="built_in">ls</span> /data/nfs10   <span class="comment"># ls是使用挂载点目录</span></span><br><span class="line">boot  courses  ebook  ks  manifests  rhel7.0  rhel9.0  rhel9.3  rhtops  slides  ucf</span><br><span class="line">[root@servera ~]# <span class="built_in">df</span> -h | <span class="built_in">tail</span> -1</span><br><span class="line">172.25.254.250:/content  244G  102G  142G  42% /data/nfs10  <span class="comment"># 才会出现挂载项</span></span><br><span class="line"></span><br><span class="line">注明:autofs共享服务只有在访问时才会看到挂载信息</span><br></pre></td></tr></table></figure>

<h3 id="autofs-直接映射"><a href="#autofs-直接映射" class="headerlink" title="autofs 直接映射"></a><strong>autofs 直接映射</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@clear /]# umount /mnt/nfs10</span><br><span class="line">1.主配置文件</span><br><span class="line">[root@clear /]# vim /etc/auto.master.d/nfs.autofs  <span class="comment">#nfs.autofs 名称规则和上个实验一样</span></span><br><span class="line">/- /etc/auto.nfs     <span class="comment">#所有直接映射条目使用/-作为基础目录</span></span><br><span class="line">2.映射文件</span><br><span class="line">[root@clear /]# vim /etc/auto.nfs   <span class="comment">#固定文件名</span></span><br><span class="line">/mnt/nfs10  -rw 172.25.254.250:/content</span><br><span class="line">3.重启服务</span><br><span class="line">[root@clear /]# systemctl restart autofs</span><br><span class="line">4.测试</span><br><span class="line">[root@clear /]# ll /mnt/nfs1   <span class="comment">#cd或ll方式都可以访问共享目录内容，即可挂载</span></span><br><span class="line">[root@servera /]# <span class="built_in">df</span> -h</span><br><span class="line">Filesystem               Size  Used Avail Use% Mounted on</span><br><span class="line">172.25.254.250:/content  491G   66G  426G  14% /mnt/nfs1  </span><br></pre></td></tr></table></figure>

<h3 id="autofs-间接映射"><a href="#autofs-间接映射" class="headerlink" title="autofs 间接映射"></a><strong>autofs 间接映射</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1.主配置文件</span><br><span class="line">[root@clear /]# vim /etc/auto.master.d/nfs.autofs </span><br><span class="line">/mnt /etc/auto.nfs</span><br><span class="line"></span><br><span class="line">2.映射文件</span><br><span class="line">[root@clear /]# vim /etc/auto.nfs </span><br><span class="line">*   -rw  172.25.254.250:/&amp;   <span class="comment">#如果共享导出了多个子目录可以用&amp;代替子目录的名称，而星*号会自动匹配共享的目录名称</span></span><br><span class="line">*   -rw  172.25.254.250:/&amp;  /content /public  /share      </span><br><span class="line"></span><br><span class="line">3.重启服务</span><br><span class="line">[root@clear /]# systemctl restart autofs</span><br><span class="line">4.测试</span><br><span class="line">[root@clear /]# <span class="built_in">cd</span> /mnt/content;<span class="built_in">ls</span></span><br><span class="line">[root@clear remoteuser1]# <span class="built_in">df</span> -h  <span class="comment">#应该能看到挂载信息</span></span><br></pre></td></tr></table></figure>

<h1 id="15-启动流程"><a href="#15-启动流程" class="headerlink" title="15 启动流程"></a><strong>15 启动流程</strong></h1><h2 id="15-1-选择启动目标"><a href="#15-1-选择启动目标" class="headerlink" title="15.1 选择启动目标"></a><strong>15.1 选择启动目标</strong></h2><h3 id="Linux-9启动过程"><a href="#Linux-9启动过程" class="headerlink" title="Linux 9启动过程"></a><strong>Linux 9启动过程</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1、计算机接通电源。系统固件（现代UEFI或更旧的BIOS）运行开机自检（POST），并开始初始化部分硬件</span><br><span class="line">    使用系统BIOS或UEFI配置屏幕(早期按F2可进入设置)</span><br><span class="line">2、系统固件会搜索可启动设备，可能是在UEFI启动固件中配置的，也可能按照BIOS中配置的顺序搜索所有磁盘上的主引导记录（MBR）</span><br><span class="line">   使用系统BIOS或UEFI配置屏幕（早期按F2可进入设置）</span><br><span class="line">3、系统固件会从磁盘读取启动加载器，然后将系统控制权交给启动加载器。红帽企业版Linux8中，启动加载器为GRand Unified Bootloader version2（GRUB2）</span><br><span class="line">   使用grub2-install命令进行配置，它将安装GRUB2作为磁盘上的启动加载器。</span><br><span class="line">4、GRUB2将从/boot/grub2/grub.cfg文件加载配置并显示一个菜单，从中可以选择要启动的内核。</span><br><span class="line">   使用/etc/grub.d/目录、/etc/default/grub文件和grub2-mkconfig命令进行配置，以生成/boot/grub2/grub.cfg文件。</span><br><span class="line">5、选择内核超时到期后，启动加载器从磁盘中加载内核和initramfs，并将他们放入内存中。initramfs是一个存档，其中包含启动时所有必要硬件的内核模块、初始化脚本等等。在redhat8中，initramfs包含自身可用的整个系统。</span><br><span class="line">     使用/etc/dracut.conf.d/目录、dracut命令和lsinitrd命令进行配置，以检查initramfs文件。</span><br><span class="line">6、启动加载器将控制权交给内核，从而传递启动加载器的内核命令行中指定的任何选项，以及initramfs在内存中的位置</span><br><span class="line">7、对于内核可在initramfs中找到驱动程序的所有硬件，内核会初始化这些硬件，然后作为PID1从initramfs执行/sbin/init。在redhat8中/sbin/init是一个指向systemd的链接。</span><br><span class="line">8、initramfs中的systemd进程会执行initrd.target目标的所有单元。这包括将磁盘上的root文件系统挂载于/sysroot目录。</span><br><span class="line">    使用/etc/fstab进行配置</span><br><span class="line">9、内核将root文件系统从initramfs切换回/sysroot中的root文件系统。随后，systemd会使磁盘中安装的systemd副本来重新执行。</span><br><span class="line">10、systemd会查找从内核命令行传递或系统中配置的默认目标，然后启动或停止单元，以符合该目标的配置，从而自动解决单元之间依赖关系。本质上，systemd进程是一组系统应激活以达到所需状态的单元。这些进程通常启动一个基于文本的登录或图形登录屏幕</span><br><span class="line">     可使用/etc/systemd/system/default.target和/etc/systemd/system/进行配置。</span><br></pre></td></tr></table></figure>

<h3 id="重启和关机"><a href="#重启和关机" class="headerlink" title="重启和关机"></a><strong>重启和关机</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-RHEL9&lt;=</span><br><span class="line">关机：</span><br><span class="line">systemctl poweroff    </span><br><span class="line">init 0                </span><br><span class="line">重启：</span><br><span class="line">systemctl reboot     </span><br><span class="line">init 6</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure>

<h3 id="选择SYSTEND-TERGET"><a href="#选择SYSTEND-TERGET" class="headerlink" title="选择SYSTEND TERGET"></a><strong>选择SYSTEND TERGET</strong></h3><p><strong>下表列出了systemd启动达到的systemd单元</strong></p>
<p>  目标                用途</p>
<hr>
<p>  graphical.target    多用户、图形、文本登录<br>  multi-user.target   多用户、文本登录<br>  rescue.target       救援<br>  emergency.target    紧急，进入initramfs环境，root只读形式挂载于&#x2F;上</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl list-units --<span class="built_in">type</span>=target --all</span><br><span class="line">systemctl list-unit-files --state=enabled</span><br><span class="line">systemctl list-dependencies graphical.target | grep target</span><br></pre></td></tr></table></figure>

<h3 id="运行时选择target"><a href="#运行时选择target" class="headerlink" title="运行时选择target"></a><strong>运行时选择target</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">切换图形或字符</span><br><span class="line">[root@workstation ~]# systemctl isolate multi-user.target  或   init 3 </span><br><span class="line">[root@workstation ~]# systemctl isolate graphical.target   或   init 5  </span><br><span class="line">[root@workstation ~]# grep AllowIsolate /usr/lib/systemd/system/multi-user.target</span><br><span class="line">AllowIsolate=<span class="built_in">yes</span>    单元文件中包含AllowIsolate=<span class="built_in">yes</span>才可以进行切换</span><br></pre></td></tr></table></figure>

<h3 id="设置默认target"><a href="#设置默认target" class="headerlink" title="设置默认target"></a><strong>设置默认target</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">设置默认的启动目标</span><br><span class="line">[root@servera ~]# systemctl get-default </span><br><span class="line">[root@servera ~]# syetemctl set-default  multi-user.target</span><br><span class="line">[root@servera ~]# ll /etc/systemd/system/default.target</span><br></pre></td></tr></table></figure>

<h3 id="启动时选择其他目标"><a href="#启动时选择其他目标" class="headerlink" title="启动时选择其他目标"></a><strong>启动时选择其他目标</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">【f0】</span><br><span class="line">grub 账号：root</span><br><span class="line">grub 密码： Asimov</span><br><span class="line"></span><br><span class="line">reboot</span><br><span class="line">选择内核的位置按e</span><br><span class="line">linux.....&lt;按键end或者ctrl+e&gt; systemd.unit=emergency.target  <span class="comment">#multi-user.target 或graphical.target </span></span><br><span class="line">ctrl+x </span><br><span class="line">如果进入了紧急模式，需要输入root密码</span><br><span class="line">mount -o remount,rw /</span><br><span class="line">vim /etc/fstab</span><br><span class="line"><span class="built_in">exit</span> 或 reboot</span><br></pre></td></tr></table></figure>

<h2 id="15-2-重置root密码"><a href="#15-2-重置root密码" class="headerlink" title="15.2 重置root密码"></a><strong>15.2 重置root密码</strong></h2><h3 id="修改登录密码"><a href="#修改登录密码" class="headerlink" title="修改登录密码"></a><strong>修改登录密码</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">切换模拟考试环境，serverb</span><br><span class="line"></span><br><span class="line">-serverb</span><br><span class="line"><span class="comment">#打开serverb的视图模式，-Activites-所有应用-Virtaul Machine Manager-双击serverb-点击左上角三个小方块-ctrl+alt+del</span></span><br><span class="line">1.重新启动系统。</span><br><span class="line">$ reboot（Send key 选择ctrl+alt+del）</span><br><span class="line">2.按任意键(Enter除外)中断启动加载器倒计时。</span><br><span class="line">$ 按方向键 ↓ 下</span><br><span class="line">3.将光标移到要引导的救援内核条目 (名称中带有rescue一词的条目)。</span><br><span class="line">$ 光标停留第二个内核rescue位置</span><br><span class="line">4.按e编辑选定的条目。</span><br><span class="line">$ e</span><br><span class="line">5.将光标移到内核命令行 (以inux开头的行)。</span><br><span class="line">$ linux... 按ctrl+e移动光标至最后</span><br><span class="line">6.附加rd.break。利用该选项，就在系统从initramfs 向实际系统移交控制权前，系统将会中断。</span><br><span class="line">$ rd.break console=tty0</span><br><span class="line">7.按ctrl+x使用这些更改来启动。</span><br><span class="line">$ ctrl+x</span><br><span class="line">8.提示时，按Enter执行维护。</span><br><span class="line">$ 救援模式下回车</span><br><span class="line">9.给根目录设置rw权限</span><br><span class="line">$ mount -o remount,rw /sysroot/</span><br><span class="line">10.进入根目录</span><br><span class="line">$ <span class="built_in">chroot</span> /sysroot/      <span class="comment">#cd / ,ls -a /</span></span><br><span class="line">11.修改密码</span><br><span class="line">$ <span class="built_in">echo</span> redhat | passwd --stdin root</span><br><span class="line">12.添加/.autorelabel文件，刷新selinux标记</span><br><span class="line">$ <span class="built_in">touch</span> /.autorelabel   <span class="comment">#[root@servera ~]# systemctl status selinux-autorelabel</span></span><br><span class="line">13.退出当前shell，会自动重启</span><br><span class="line">$ <span class="built_in">exit</span></span><br><span class="line">$ <span class="built_in">exit</span></span><br></pre></td></tr></table></figure>

<h2 id="15-3-诊断和修复文件系统"><a href="#15-3-诊断和修复文件系统" class="headerlink" title="15.3 诊断和修复文件系统"></a>15.3 诊断和修复文件系统</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">当/etc/fstab中挂载信息写错可能会导致系统起不来，会自动进入紧急模式</span><br><span class="line">下表为常见错误：</span><br><span class="line"> 问题                          结果</span><br><span class="line">----------------------------- ---------------------------------------------------------------</span><br><span class="line"> 文件系统损坏                  systemd尝试修复，无法修复进入紧急(emergency)模式</span><br><span class="line"> /etc/fstab                    systemd等待一定时间，等设备变得可用。如不可用，则进入紧急模式</span><br><span class="line"> 引用的设备/UUID不存在         </span><br><span class="line"> /etc/fstab 挂载点不存在       直接进入紧急模式</span><br><span class="line"> /etc/fstab挂载点错误          直接进入紧急模</span><br></pre></td></tr></table></figure>

<h2 id="文件系统、选项错误-权限-直接进入紧急模式"><a href="#文件系统、选项错误-权限-直接进入紧急模式" class="headerlink" title="  文件系统、选项错误(权限) 直接进入紧急模式"></a>  文件系统、选项错误(权限) 直接进入紧急模式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">版本建议：编辑/etc/fstab后使用systemd daemon-reload加载。否则systemd可能会继续使用用旧版本。</span><br><span class="line">解决方法：</span><br><span class="line"><span class="comment">#当进入紧急模式后</span></span><br><span class="line">Give root password <span class="keyword">for</span> maintenance</span><br><span class="line">(or pressControl-D to <span class="built_in">continue</span>): redhat     <span class="comment">#输入root密码后按回车进入系统</span></span><br><span class="line">1 输入root密码</span><br><span class="line">2 mount -o remount,rw /                     <span class="comment">#RHEL9中/根目录权限是可写的，所以无需敲该指令</span></span><br><span class="line">3 vim /etc/fstab                            <span class="comment">#可将错误字段需改，或在挂载行前，直接添加#井号注释掉该行。然后reboot重启</span></span><br><span class="line">或者将之前编写的挂载项注释掉，让系统先正常启动，然后再修改调试。</span><br></pre></td></tr></table></figure>

<h1 id="16-firewalld"><a href="#16-firewalld" class="headerlink" title="16 firewalld"></a>16 firewalld</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">firewalld、iptables   策略限制MAC、IP、PORT、APP</span><br><span class="line">selinux                  上下文、布尔值，端口</span><br><span class="line">软件权限                  读写执行等</span><br><span class="line">文件系统                  rwx，隐藏权限，acl</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="16-1-防火墙架构概念"><a href="#16-1-防火墙架构概念" class="headerlink" title="16.1 防火墙架构概念"></a><strong>16.1 防火墙架构概念</strong></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1 现代的计算机环境不仅需要流畅的网络连通，更需要具备安全性的网络，所以我们除了及时更新系统补丁以外事件，可以针对自己的计算机环境设置接收哪些数据和不接收哪些数据。我们可以使用软件来实现这一目的，这种软件就叫做防火墙。防火墙这种软件会制定一些规则，我们也叫做策略，管理数据包的通过。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">2 firewalld优点  iptables</span><br><span class="line">在于可使用zone、service简化配置任务，易于管理。而且属于动态管理（修改规则后不必重启整个防火墙服务）。</span><br><span class="line"></span><br><span class="line">3.zone区域</span><br><span class="line">firewalld预先提供了多个区域，不同区域拥有不同设置好的规则，类似不同的管理方案。系统默认区域为public。</span><br><span class="line">所有区域默认在系统中会同时开启但是 如何判断我们的数据包在哪个区域中实现了数据限制，通过以下三种方法来判断：</span><br><span class="line">- <span class="built_in">source</span>，源地址</span><br><span class="line">- interface，接收请求的网卡（ 一个网卡，只能绑定一个区域。多个网卡，可以绑定同一区域）</span><br><span class="line">- firewalld.conf中配置的默认zone</span><br><span class="line">三个优先级按次序降低。匹配后不再向下匹配。</span><br></pre></td></tr></table></figure>

<h3 id="nftables增强了netfilter"><a href="#nftables增强了netfilter" class="headerlink" title="nftables增强了netfilter"></a><strong>nftables增强了netfilter</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nftables---&gt;替代---&gt;netfilter</span><br></pre></td></tr></table></figure>

<h3 id="firewalld简介"><a href="#firewalld简介" class="headerlink" title="firewalld简介"></a><strong>firewalld简介</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rhel7之前---iptables（静态）</span><br><span class="line">rhel7之后---firewalld（动态）</span><br></pre></td></tr></table></figure>

<h3 id="预定义区域"><a href="#预定义区域" class="headerlink" title="预定义区域"></a><strong>预定义区域</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@foundation0 ~]# firewall-cmd --get-zones</span><br><span class="line">block dmz drop external home internal libvirt public trusted work</span><br></pre></td></tr></table></figure>

<h3 id="预定义服务"><a href="#预定义服务" class="headerlink" title="预定义服务"></a><strong>预定义服务</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@foundation0 ~]# firewall-cmd --get-service</span><br></pre></td></tr></table></figure>

<h2 id="16-2-配置防火墙"><a href="#16-2-配置防火墙" class="headerlink" title="16.2 配置防火墙"></a><strong>16.2 配置防火墙</strong></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">管理方法                            解释</span><br><span class="line">----------------------------------- ---------------------</span><br><span class="line"> /etc/firewalld                    直接修改配置文件</span><br><span class="line"> Web控制台图形界面                  通过cockpit</span><br><span class="line"> firewalld-cmd命令行               shell命令行直接执行</span><br><span class="line"> firewall-config                    图形</span><br></pre></td></tr></table></figure>


<h3 id="Web控制台配置防火墙"><a href="#Web控制台配置防火墙" class="headerlink" title="Web控制台配置防火墙"></a><strong>Web控制台配置防火墙</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">【servera】</span><br><span class="line">[root@servera ~]# systemctl start cockpit  <span class="comment">#开启cockpit功能</span></span><br><span class="line">[root@servera ~]# netstat -ntlp            <span class="comment">#查看是否开启了9090端口</span></span><br><span class="line">[root@servera ~]# firewall-cmd --list-all  <span class="comment">#查看防火墙策略</span></span><br><span class="line">services: cockpit dhcpv6-client http ssh   <span class="comment">#策略中包含了cockpit，表示允许访问cockpit</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">【f0】</span><br><span class="line">firefox https://172.25.250.10:9090         <span class="comment">#可以访问</span></span><br><span class="line"></span><br><span class="line">【servera】</span><br><span class="line">[root@servera ~]# firewall-cmd --permanent --remove-service=cockpit</span><br><span class="line">success</span><br><span class="line">[root@servera ~]# firewall-cmd --reload</span><br><span class="line">success</span><br><span class="line">[root@servera ~]# firewall-cmd --list-all</span><br><span class="line"></span><br><span class="line">【f0】</span><br><span class="line">firefox https://172.25.250.10:9090         <span class="comment">#不可以访问</span></span><br><span class="line"></span><br><span class="line">【servera】</span><br><span class="line">[root@servera ~]# firewall-cmd --permanent --add-service=cockpit  <span class="comment">#添加cockpit服务，客户端再次访问即可</span></span><br><span class="line">success</span><br><span class="line">[root@servera ~]# firewall-cmd --reload</span><br><span class="line">success</span><br><span class="line">[root@servera ~]# firewall-cmd --list-all</span><br></pre></td></tr></table></figure>

<h3 id="命令行配置防火墙"><a href="#命令行配置防火墙" class="headerlink" title="命令行配置防火墙"></a><strong>命令行配置防火墙</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">防火墙命令                         说明</span><br><span class="line">---------------------------------- -------------------------------------------------------------</span><br><span class="line">  --get-default-zone                 查看默认区域</span><br><span class="line">  --set-default-zone=public          设置默认区域为public，永久设置</span><br><span class="line">  --get-zones                        列出所有可用区域</span><br><span class="line">  --get-active-zones                 列出当前正在使用所有区域</span><br><span class="line">  --add-source=CIDR \[--zone=ZONE\]  将IP或网络到指定区域，如果未提供--zone=选项，则使用默认区域</span><br><span class="line">  --remove-source=CIDR               删除IP或网络.....，如果未提供--zone=选项，...则删除默认区域</span><br><span class="line">  \[--zone=ZONE\]                    </span><br><span class="line">  --add-interface=                   在某个区域中添加端口</span><br><span class="line">  --change-interface=                改变端口至某个区域</span><br></pre></td></tr></table></figure>

<h3 id="–list-all-zones"><a href="#–list-all-zones" class="headerlink" title="–list-all-zones"></a>–list-all-zones</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> 防火墙命令                          解释</span><br><span class="line">----------------------------------- ------------------</span><br><span class="line">  --list-all \[--zone=ZONE\]          查看区域所有策略</span><br><span class="line">  --add-service= \[--zone=ZONE\]      允许一个服务</span><br><span class="line">  --add-port= \[--zone=ZONE\]         允许一个端口</span><br><span class="line">  --remove-service= \[--zone=ZONE\]   移除一个服务</span><br><span class="line">  --remove-port= \[--zone=ZONE\]      移除一个端口</span><br><span class="line">  --permanent                         永久生效</span><br><span class="line">  --reload                            立即加载</span><br></pre></td></tr></table></figure>

<h3 id="配置防火墙练习"><a href="#配置防火墙练习" class="headerlink" title="配置防火墙练习"></a><strong>配置防火墙练习</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1、管理防火墙服务状态</span><br><span class="line">systemctl status firewalld </span><br><span class="line">systemctl start firewalld </span><br><span class="line">systemctl stop firewalld </span><br><span class="line">systemctl restart firewalld </span><br><span class="line">systemctl <span class="built_in">enable</span> --now firewalld </span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">2、查看与设置默认区域</span><br><span class="line">man firewall-cmd <span class="comment">#/Ex</span></span><br><span class="line">firewall-cmd --get-service</span><br><span class="line">firewall-cmd --get-zones</span><br><span class="line">firewall-cmd --get-default-zone </span><br><span class="line">firewall-cmd --set-default-zone=home     设置默认区域，了解就可以，不是必须要设置</span><br><span class="line">firewall-cmd --list-all</span><br><span class="line">man 5 firewalld.zones</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">3.配置防火墙（考）</span><br><span class="line">允许服务</span><br><span class="line">[root@servera ~]# firewall-cmd --list-all  <span class="comment">#查看区域所有配置</span></span><br><span class="line">[root@servera ~]# firewall-cmd --permanent --add-service=http <span class="comment">#允许http服务永久生效，要结合reload</span></span><br><span class="line">[root@servera ~]# firewall-cmd --reload</span><br><span class="line">[root@servera ~]# firewall-cmd --list-all</span><br><span class="line">移除服务</span><br><span class="line">[root@servera ~]# firewall-cmd --permanent --remove-service=http</span><br><span class="line">[root@servera ~]# firewall-cmd --reload</span><br><span class="line">[root@servera ~]# firewall-cmd --list-all</span><br><span class="line">允许端口</span><br><span class="line">[root@servera ~]# firewall-cmd --permanent --add-port=8000/tcp</span><br><span class="line">[root@servera ~]# firewall-cmd --reload</span><br><span class="line">[root@servera ~]# firewall-cmd --list-all</span><br><span class="line">移除端口</span><br><span class="line">[root@servera ~]# firewall-cmd --permanent --remove-port=8000/tcp</span><br><span class="line">[root@servera ~]# firewall-cmd --reload</span><br><span class="line">[root@servera ~]# firewall-cmd --list-all</span><br><span class="line">允许源地址到某个区域（了解）</span><br><span class="line">firewall-cmd --add-source=172.25.250.100 --zone=trusted --permanent</span><br><span class="line">firewall-cmd --reload</span><br><span class="line">  </span><br><span class="line">firewall-cmd --add-interface=enp2s0 --zone=trusted --permanent</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<h3 id="典型举例"><a href="#典型举例" class="headerlink" title="典型举例"></a><strong>典型举例</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">允许apache服务</span><br><span class="line">foundation-----访问-----servera的web服务</span><br><span class="line">思路</span><br><span class="line"></span><br><span class="line">【servera】</span><br><span class="line">$ firewall-cmd --permanent --remove-service=http  </span><br><span class="line">$ firewall-cmd --reload  <span class="comment">#立即生效</span></span><br><span class="line">$ firewall-cmd --list-all</span><br><span class="line"></span><br><span class="line">$ yum install -y httpd</span><br><span class="line">$ <span class="built_in">echo</span> test_page &gt; /var/www/html/index.html</span><br><span class="line">$ systemctl <span class="built_in">enable</span> --now httpd</span><br><span class="line"></span><br><span class="line">$ curl localhost     访问成功后，证明本地可以正常访问</span><br><span class="line">test_page</span><br><span class="line"></span><br><span class="line">【foundation】</span><br><span class="line">$ curl http://servera  发现不能访问</span><br><span class="line"></span><br><span class="line">【servera】</span><br><span class="line">systemctl <span class="built_in">enable</span> --now firewalld</span><br><span class="line">systemctl status firewalld</span><br><span class="line"></span><br><span class="line">firewall-cmd --permanent --add-service=http    <span class="comment">#--permanent 永久生效，必须添加</span></span><br><span class="line">firewall-cmd --reload  <span class="comment">#立即生效</span></span><br><span class="line">firewall-cmd --list-all</span><br><span class="line"></span><br><span class="line">【foundation】</span><br><span class="line">curl http://servera  发现可以访问</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">练习：允许ftp服务</span><br><span class="line">servera端：</span><br><span class="line">yum install -y vsftpd    <span class="comment">#安装vsftpd软件</span></span><br><span class="line">systemctl <span class="built_in">enable</span> --now vsftpd</span><br><span class="line"></span><br><span class="line">vim /etc/vsftpd/vsftpd.conf   <span class="comment">#进入配置文件 </span></span><br><span class="line">anonymou_enable=NO  改为YES    <span class="comment">#开启匿名访问</span></span><br><span class="line"></span><br><span class="line">systemctl restart vsftpd</span><br><span class="line"></span><br><span class="line">yum install -y ftp     <span class="comment">#安装ftp可客户端</span></span><br><span class="line"></span><br><span class="line">$ ftp localhost     <span class="comment">#访问本机ftp服务器</span></span><br><span class="line">Trying ::1...</span><br><span class="line">Connected to localhost (::1).</span><br><span class="line">220 (vsFTPd 3.0.3)</span><br><span class="line">Name (localhost:root): ftp          <span class="comment">#ftp表示匿名用户登录</span></span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password: 直接回车</span><br><span class="line"></span><br><span class="line">f0充当client端测试：</span><br><span class="line">yum install -y ftp</span><br><span class="line">ftp localhost   发现不能登录，需要在server端允许ftp服务。</span><br></pre></td></tr></table></figure>

<h2 id="16-3-SElinux安全端口"><a href="#16-3-SElinux安全端口" class="headerlink" title="16.3 SElinux安全端口"></a><strong>16.3 SElinux安全端口</strong></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">【servera】</span><br><span class="line">[root@servera ~]# setenforce 1</span><br><span class="line">[root@servera ~]# vim /etc/httpd/conf/httpd.conf </span><br><span class="line">Listen 80 改成了Listen 82</span><br><span class="line">[root@servera ~]# systemctl restart httpd   重启不了，因为selinux</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@servera ~]# man semanage port    <span class="comment">#/EX</span></span><br><span class="line">[root@servera ~]# semanage port -a -t http_port_t -p tcp 82  <span class="comment">#数据库没有标签内容则-a，有则-m</span></span><br><span class="line">[root@servera ~]# semanage port -l | grep http</span><br><span class="line">重启web服务</span><br><span class="line">[root@servera ~]# systemctl restart httpd</span><br><span class="line">[root@servera ~]# systemctl <span class="built_in">enable</span> --now httpd</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@servera ~]# firewall-cmd --permanent --add-port=82/tcp   <span class="comment">#本地访问无须配置，远端主机访问需要配置</span></span><br><span class="line">[root@servera ~]# firewall-cmd --reload</span><br><span class="line">[root@servera ~]# firewall-cmd --list-all</span><br><span class="line"></span><br><span class="line">测试</span><br><span class="line">[serverb curl http://servea:82] </span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">富规则参考</span><br><span class="line">[root@servera ~]# man 5 firewalld.richlanguage</span><br></pre></td></tr></table></figure>

<h1 id="17-kickstart"><a href="#17-kickstart" class="headerlink" title="17 kickstart"></a><strong>17 kickstart</strong></h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  安装方式    简介</span><br><span class="line">----------- --------------------------------</span><br><span class="line">  DVD 光盘    物理系统光盘</span><br><span class="line">  ISO镜像     光盘制作成为的镜像.iso文件</span><br><span class="line">  QCOW2镜像   云环境或虚拟环境中部署为虚拟机</span><br></pre></td></tr></table></figure>

<h2 id="17-1-KICKSTART自动安装系统"><a href="#17-1-KICKSTART自动安装系统" class="headerlink" title="17.1 KICKSTART自动安装系统"></a>17.1 KICKSTART自动安装系统</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">P293 Kickstart练习</span><br><span class="line">[kiosk@foundation0 ~]$ ssh workstation</span><br><span class="line">[student@workstation ~]$ lab start installing kickstart</span><br><span class="line">....</span><br><span class="line">[student@workstation ~]$ ssh servera</span><br><span class="line">[student@workstation ~]$ <span class="built_in">sudo</span> -i </span><br><span class="line">redhat</span><br><span class="line"></span><br><span class="line">1.后面按照教材要求进行配置</span><br><span class="line">[root@servera ks-config]# vim /var/www/html/ks-config/kickstart.cfg</span><br><span class="line">bootloader --append=<span class="string">&quot;console=ttyS0 console=ttyS0,115200n8 no_timer_check net.ifnames=0  crashkernel=auto&quot;</span> --location=mbr --<span class="built_in">timeout</span>=1 --boot-drive=vda</span><br><span class="line">graphical</span><br><span class="line">keyboard --vckeymap=us</span><br><span class="line">lang en_US.UTF-8</span><br><span class="line">repo --name=<span class="string">&quot;BaseOS&quot;</span> --baseurl=<span class="string">&quot;http://classroom.example.com/content/rhel9.0/x86_64/dvd/BaseOS/&quot;</span></span><br><span class="line">repo --name=<span class="string">&quot;Appstream&quot;</span> --baseurl=<span class="string">&quot;http://classroom.example.com/content/rhel9.0/x86_64/dvd/AppStream&quot;</span></span><br><span class="line">url --url=<span class="string">&quot;http://classroom.example.com/content/rhel9.0/x86_64/dvd/&quot;</span></span><br><span class="line">rootpw --plaintext redhat</span><br><span class="line">authselect <span class="keyword">select</span> sssd</span><br><span class="line">selinux --enforcing</span><br><span class="line">services --disabled=<span class="string">&quot;kdump,rhsmcertd&quot;</span> --enabled=<span class="string">&quot;sshd,rngd,chronyd&quot;</span></span><br><span class="line">timezone America/New_York --utc</span><br><span class="line">ignoredisk --only-use=vda</span><br><span class="line">autopart</span><br><span class="line">%pre --erroronfail </span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Kickstarted on <span class="subst">$(date)</span>&quot;</span> &gt;&gt; /etc/issue</span><br><span class="line">%end</span><br><span class="line">%post --erroronfail</span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">&quot;Setting default runlevel to multiuser text mode&quot;</span></span><br><span class="line"><span class="built_in">rm</span> -f /etc/systemd/system/default.target</span><br><span class="line"><span class="built_in">ln</span> -s /lib/systemd/system/multi-user.target /etc/systemd/system/default.target</span><br><span class="line"><span class="built_in">echo</span> .</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Removing linux-firmware package.&quot;</span></span><br><span class="line">dnf -C -y remove linux-firmware</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;virtual-guest&quot;</span> &gt; /etc/tuned/active_profile</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/hosts &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span></span><br><span class="line"><span class="string">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">%end</span><br><span class="line">%packages</span><br><span class="line">@core </span><br><span class="line">chrony</span><br><span class="line">dracut-config-generic</span><br><span class="line">dracut-norescue</span><br><span class="line">firewalld</span><br><span class="line">grub2</span><br><span class="line">kernel</span><br><span class="line">rsync</span><br><span class="line">tar </span><br><span class="line">httpd</span><br><span class="line">-plymouth</span><br><span class="line">%end</span><br><span class="line"></span><br><span class="line">2.重启httpd服务，并开机自启动。</span><br><span class="line">3.关闭防火墙，selinux。</span><br></pre></td></tr></table></figure>

<h3 id="dhcp设置"><a href="#dhcp设置" class="headerlink" title="dhcp设置"></a><strong>dhcp设置</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">【root@servera】</span><br><span class="line">[root@servera ~]# systemctl stop firewalld;setenforce 0</span><br><span class="line"></span><br><span class="line">一、dhcp</span><br><span class="line">1 安装</span><br><span class="line">[root@servera ~]# yum install -y dhcp-server</span><br><span class="line">2 建立配置文件</span><br><span class="line">[root@servera ~]# <span class="built_in">cp</span> /usr/share/doc/dhcp-server/dhcpd.conf.example /etc/dhcp/dhcpd.conf</span><br><span class="line"><span class="built_in">cp</span>: overwrite <span class="string">&#x27;/etc/dhcp/dhcpd.conf&#x27;</span>? y</span><br><span class="line">[root@servera ~]# vim /etc/dhcp/dhcpd.conf   <span class="comment">#man 5 dhcpd.conf   /next-server</span></span><br><span class="line">3 配置服务</span><br><span class="line">[root@servera ~]# vim /etc/dhcp/dhcpd.conf</span><br><span class="line">allow bootp;</span><br><span class="line">allow booting;</span><br><span class="line">subnet 172.25.250.0 netmask 255.255.255.0 &#123;</span><br><span class="line">  range 172.25.250.100 172.25.250.200;</span><br><span class="line">  option routers 172.25.250.254;</span><br><span class="line">  default-lease-time 600;</span><br><span class="line">  max-lease-time 7200;</span><br><span class="line">  filename <span class="string">&quot;/pxelinux.0&quot;</span>;</span><br><span class="line">  next-server 172.25.250.10;</span><br><span class="line">&#125;</span><br><span class="line">4 启动并测试</span><br><span class="line">[root@servera ~]# systemctl <span class="built_in">enable</span> --now dhcpd</span><br><span class="line"></span><br><span class="line">5 测试dhcp功能：设置serverb开机启动为网卡启动，当做客户端，测试能够获取ip即可</span><br></pre></td></tr></table></figure>

<h3 id="tftp-and-syslinux"><a href="#tftp-and-syslinux" class="headerlink" title="tftp and syslinux"></a><strong>tftp and syslinux</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">1、安装tftp服务</span><br><span class="line">[root@servera ~]# yum install -y tftp-server tftp</span><br><span class="line">[root@servera ~]# rpm -ql tftp-server</span><br><span class="line"></span><br><span class="line">2、安装syslinux-tftpboot该软件后提供了/tftpboot目录其中包含了一些引导文件、内核文件及pxelinux.0文件等，建立pxelinux.cfg目录，准备存放default文件。</span><br><span class="line">[root@servera ~]# yum install -y syslinux-tftpboot.noarch</span><br><span class="line">[root@servera ~]# rpm -ql syslinux-tftpboot</span><br><span class="line">[root@servera ~]# <span class="built_in">mkdir</span> /tftpboot/pxelinux.cfg/</span><br><span class="line"></span><br><span class="line">3、将254.250上的光盘镜像相关文件挂载至本机</span><br><span class="line">[root@servera ~]# <span class="built_in">mkdir</span> /content</span><br><span class="line">[root@servera ~]# mount 172.25.254.250:/content /content/</span><br><span class="line">[root@servera ~]# <span class="built_in">df</span> -h</span><br><span class="line">[root@serveran ~]# <span class="built_in">cp</span> /content/rhel9.0/x86_64/dvd/images/pxeboot/&#123;initrd.img,vmlinuz&#125; /tftpboot/</span><br><span class="line">[root@servera ~]# <span class="built_in">cp</span> /content/rhel9.0/x86_64/dvd/isolinux/boot.msg /tftpboot/</span><br><span class="line">[root@servera ~]# <span class="built_in">cp</span> /content/rhel9.0/x86_64/dvd/isolinux/isolinux.cfg /tftpboot/pxelinux.cfg/default</span><br><span class="line">[root@servera ~]# vim /tftpboot/pxelinux.cfg/default </span><br><span class="line">default vesamenu.c32 </span><br><span class="line"><span class="built_in">timeout</span> 60  可以改为60，就是6秒</span><br><span class="line">display boot.msg</span><br><span class="line"></span><br><span class="line">label linux</span><br><span class="line">  menu label ^Install Red Hat Enterprise Linux 9.0.0</span><br><span class="line">  menu default</span><br><span class="line">  kernel vmlinuz</span><br><span class="line">  append initrd=initrd.img inst.stage2=ftp://172.25.250.10/dvd  inst.ks=http://172.25.250.10/ks-config/kickstart.cfg quiet</span><br><span class="line"></span><br><span class="line">4、修改tftp发布目录，并启动服务及测试</span><br><span class="line">[root@servera ~]# vim /usr/lib/systemd/system/tftp.service </span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/sbin/in.tftpd -s /tftpboot  (将-s /var/lib/tftpboot，更成-s /tftpboot)</span><br><span class="line"></span><br><span class="line">[root@servera ~]# systemctl <span class="built_in">enable</span> --now tftp</span><br><span class="line">测试：</span><br><span class="line">登录servera，yum install -y tftp ,tftp 172.25.250.10,get ls.c32 quit</span><br></pre></td></tr></table></figure>

<h3 id="ftp"><a href="#ftp" class="headerlink" title="ftp"></a><strong>ftp</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">1、安装</span><br><span class="line">[root@servera ~]# yum install -y vsftpd.x86_64 ftp</span><br><span class="line">[root@servera ~]# rpm -qc vsftpd</span><br><span class="line"></span><br><span class="line">2、配置服务</span><br><span class="line">[root@servera ~]# vim /etc/vsftpd/vsftpd.conf </span><br><span class="line">anonymous_enable=YES</span><br><span class="line"></span><br><span class="line">[root@servera ~]# <span class="built_in">mkdir</span> /var/ftp/dvd</span><br><span class="line">[root@servera ~]# mount /content/rhel9.0/x86_64/isos/rhel-baseos-9.0-x86_64-dvd.iso /var/ftp/dvd/</span><br><span class="line"></span><br><span class="line">3、启动及测试</span><br><span class="line"><span class="built_in">df</span> -h</span><br><span class="line">[root@servera ~]# systemctl <span class="built_in">enable</span> --now vsftpd</span><br><span class="line"></span><br><span class="line">4 从serverb上测试一下tftp功能是否正常（可选）</span><br><span class="line">【serverb】cleint</span><br><span class="line">以网卡方式启动--安装1、指定ftp路径172.25.250.9/dvd 2 最小化 3 设置lvm分区</span><br><span class="line">进度条走完-重启，添加硬盘启动 ， 从本地硬盘启动。</span><br></pre></td></tr></table></figure>

<h3 id="保证所有服务测试正常"><a href="#保证所有服务测试正常" class="headerlink" title="保证所有服务测试正常"></a><strong>保证所有服务测试正常</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.dhcpd   分配IP，指导访问tftp</span><br><span class="line">2.tftp    分配启动所需文件及pxelinux安装程序</span><br><span class="line">3.vsftpd  共享光盘镜像</span><br><span class="line">4.httpd   共享ks文件</span><br><span class="line"></span><br><span class="line">其实vsftpd和httpd可以二选一，例如只用httpd服务共享光盘镜像、ks文件。</span><br></pre></td></tr></table></figure>

<h2 id="17-2-cockpit安装虚拟机"><a href="#17-2-cockpit安装虚拟机" class="headerlink" title="17.2 cockpit安装虚拟机"></a><strong>17.2 cockpit安装虚拟机</strong></h2><pre><code>[root@servera ~]# yum install -y cockpit-machines

以服务的形式启动http，一旦启动就会长期运行，在内存中产生相应的进程systemct start httpd

容器以进程的方式运行http，一旦运行完毕容器就会自动关闭，自动退出，结束运行。当再想运行http的时候需要新开启一个容器

rhel8查看一个文件，
容器

容器：1个应用  -- 好管理    apache   php   mysql +linux= lamp -- 支持php网站
容器：多个应用 -- 不好管理   （apache   php   mysql）
</code></pre>
</div><div class="article-licensing box"><div class="licensing-title"><p>Linux进阶</p><p><a href="http://example.com/2025/04/20/Linux/Linux进阶/">http://example.com/2025/04/20/Linux/Linux进阶/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><a href="http://example.com"><p>罗宇</p></a></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2025-04-20 13:50:42</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2025-05-11 22:51:27</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="recommend-area"><div class="recommend-post"><span class="is-size-6 has-text-grey has-mr-7"># 相关文章</span><br><span>  1.<a class="is-size-6" href="/2025/05/11/Linux/Linux%E5%91%BD%E4%BB%A4/" target="_blank">Linux命令</a><br></span><span>  2.<a class="is-size-6" href="/2025/04/19/Linux/Linux%E7%9A%84%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1/" target="_blank">Linux的基础服务</a><br></span><span>  3.<a class="is-size-6" href="/2025/04/18/Linux/Linux%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" target="_blank">Linux的基本使用</a><br></span></div></div><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/social-share.js/1.0.16/css/share.min.css"><div class="social-share"></div><script src="https://cdnjs.loli.net/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2025/04/21/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/Ansible%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Ansible的基本使用</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2025/04/19/Linux/Linux%E7%9A%84%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1/"><span class="level-item">Linux的基础服务</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="is-flex is-mobile" href="#1-必须掌握的Linux命令"><span>1 必须掌握的Linux命令</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#1-1-强大好用的Shell"><span>1.1 强大好用的Shell</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#系统内核"><span>系统内核</span></a></li><li><a class="is-flex is-mobile" href="#用户与硬件"><span>用户与硬件</span></a></li><li><a class="is-flex is-mobile" href="#Shell"><span>Shell</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#1-2-常用系统工作命令"><span>1.2 常用系统工作命令</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#echo命令"><span>echo命令</span></a></li><li><a class="is-flex is-mobile" href="#date命令"><span>date命令</span></a></li><li><a class="is-flex is-mobile" href="#timedatectl命令"><span>timedatectl命令</span></a></li><li><a class="is-flex is-mobile" href="#reboot命令"><span>reboot命令</span></a></li><li><a class="is-flex is-mobile" href="#poweroff命令"><span>poweroff命令</span></a></li><li><a class="is-flex is-mobile" href="#wget命令"><span>wget命令</span></a></li><li><a class="is-flex is-mobile" href="#ps命令"><span>ps命令</span></a></li><li><a class="is-flex is-mobile" href="#pstree命令"><span>pstree命令</span></a></li><li><a class="is-flex is-mobile" href="#top命令"><span>top命令</span></a></li><li><a class="is-flex is-mobile" href="#nice命令"><span>nice命令</span></a></li><li><a class="is-flex is-mobile" href="#pidof命令"><span>pidof命令</span></a></li><li><a class="is-flex is-mobile" href="#kill命令"><span>kill命令</span></a></li><li><a class="is-flex is-mobile" href="#killall命令"><span>killall命令</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#1-3-系统状态检测命令"><span>1.3 系统状态检测命令</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#ifconfig命令"><span>ifconfig命令</span></a></li><li><a class="is-flex is-mobile" href="#uname命令"><span>uname命令</span></a></li><li><a class="is-flex is-mobile" href="#uptime命令"><span>uptime命令</span></a></li><li><a class="is-flex is-mobile" href="#free命令"><span>free命令</span></a></li><li><a class="is-flex is-mobile" href="#who命令"><span>who命令</span></a></li><li><a class="is-flex is-mobile" href="#last命令"><span>last命令</span></a></li><li><a class="is-flex is-mobile" href="#ping命令"><span>ping命令</span></a></li><li><a class="is-flex is-mobile" href="#tracepath命令"><span>tracepath命令</span></a></li><li><a class="is-flex is-mobile" href="#netstat命令"><span>netstat命令</span></a></li><li><a class="is-flex is-mobile" href="#history命令"><span>history命令</span></a></li><li><a class="is-flex is-mobile" href="#sosreport命令"><span>sosreport命令</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#1-4-查找定位文件命令"><span>1.4 查找定位文件命令</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#pwd命令"><span>pwd命令</span></a></li><li><a class="is-flex is-mobile" href="#cd命令"><span>cd命令</span></a></li><li><a class="is-flex is-mobile" href="#ls命令"><span>ls命令</span></a></li><li><a class="is-flex is-mobile" href="#tree命令"><span>tree命令</span></a></li><li><a class="is-flex is-mobile" href="#find命令"><span>find命令</span></a></li><li><a class="is-flex is-mobile" href="#locate命令"><span>locate命令</span></a></li><li><a class="is-flex is-mobile" href="#whereis命令"><span>whereis命令</span></a></li><li><a class="is-flex is-mobile" href="#which命令"><span>which命令</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#1-5-文本文件编辑命令"><span>1.5 文本文件编辑命令</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#cat命令"><span>cat命令</span></a></li><li><a class="is-flex is-mobile" href="#more命令"><span>more命令</span></a></li><li><a class="is-flex is-mobile" href="#head命令"><span>head命令</span></a></li><li><a class="is-flex is-mobile" href="#tail命令"><span>tail命令</span></a></li><li><a class="is-flex is-mobile" href="#tr命令"><span>tr命令</span></a></li><li><a class="is-flex is-mobile" href="#wc命令"><span>wc命令</span></a></li><li><a class="is-flex is-mobile" href="#stat命令"><span>stat命令</span></a></li><li><a class="is-flex is-mobile" href="#grep命令"><span>grep命令</span></a></li><li><a class="is-flex is-mobile" href="#cut命令"><span>cut命令</span></a></li><li><a class="is-flex is-mobile" href="#diff命令"><span>diff命令</span></a></li><li><a class="is-flex is-mobile" href="#uniq命令"><span>uniq命令</span></a></li><li><a class="is-flex is-mobile" href="#sort命令"><span>sort命令</span></a></li><li><a class="is-flex is-mobile" href="#tee命令"><span>tee命令</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#1-6-文件目录管理命令"><span>1.6 文件目录管理命令</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#touch命令"><span>touch命令</span></a></li><li><a class="is-flex is-mobile" href="#mkdir命令"><span>mkdir命令</span></a></li><li><a class="is-flex is-mobile" href="#cp命令"><span>cp命令</span></a></li><li><a class="is-flex is-mobile" href="#mv命令"><span>mv命令</span></a></li><li><a class="is-flex is-mobile" href="#rm命令"><span>rm命令</span></a></li><li><a class="is-flex is-mobile" href="#dd命令"><span>dd命令</span></a></li><li><a class="is-flex is-mobile" href="#file命令"><span>file命令</span></a></li><li><a class="is-flex is-mobile" href="#tar命令"><span>tar命令</span></a></li></ul></li></ul></li><li><a class="is-flex is-mobile" href="#2-管道符、重定向与环境变量"><span>2 管道符、重定向与环境变量</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#2-1-输入输出重定向"><span>2.1 输入输出重定向</span></a></li><li><a class="is-flex is-mobile" href="#2-2-管道命令符"><span>2.2 管道命令符</span></a></li><li><a class="is-flex is-mobile" href="#2-3-命令行的通配符"><span>2.3 命令行的通配符</span></a></li><li><a class="is-flex is-mobile" href="#2-4-常用的转义字符"><span>2.4 常用的转义字符</span></a></li><li><a class="is-flex is-mobile" href="#2-5-重要的环境变量"><span>2.5 重要的环境变量</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#3-Vim编辑器与Shell命令脚本"><span>3 Vim编辑器与Shell命令脚本</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#3-1-Vim文本编辑器"><span>3.1 Vim文本编辑器</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#编写简单文档"><span>编写简单文档</span></a></li><li><a class="is-flex is-mobile" href="#配置主机名称"><span>配置主机名称</span></a></li><li><a class="is-flex is-mobile" href="#配置网卡信息"><span>配置网卡信息</span></a></li><li><a class="is-flex is-mobile" href="#配置软件仓库"><span>配置软件仓库</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#3-2-编写Shell脚本"><span>3.2 编写Shell脚本</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#编写简单的脚本"><span>编写简单的脚本</span></a></li><li><a class="is-flex is-mobile" href="#接收用户的参数"><span>接收用户的参数</span></a></li><li><a class="is-flex is-mobile" href="#判断用户的参数"><span>判断用户的参数</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#3-3-流程控制语句"><span>3.3 流程控制语句</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#if条件测试语句"><span>if条件测试语句</span></a></li><li><a class="is-flex is-mobile" href="#for条件循环语句"><span>for条件循环语句</span></a></li><li><a class="is-flex is-mobile" href="#while条件循环语句"><span>while条件循环语句</span></a></li><li><a class="is-flex is-mobile" href="#case条件测试语句"><span>case条件测试语句</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#3-4-计划任务服务程序"><span>3.4 计划任务服务程序</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#一次性计划任务"><span>一次性计划任务</span></a></li><li><a class="is-flex is-mobile" href="#长期性计划任务"><span>长期性计划任务</span></a></li></ul></li></ul></li><li><a class="is-flex is-mobile" href="#4-用户身份与文件权限"><span>4 用户身份与文件权限</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#4-1-用户身份与能力"><span>4.1 用户身份与能力</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#用户身份"><span>用户身份</span></a></li><li><a class="is-flex is-mobile" href="#用户组"><span>用户组</span></a></li><li><a class="is-flex is-mobile" href="#id命令"><span>id命令</span></a></li><li><a class="is-flex is-mobile" href="#useradd命令"><span>useradd命令</span></a></li><li><a class="is-flex is-mobile" href="#groupadd命令"><span>groupadd命令</span></a></li><li><a class="is-flex is-mobile" href="#usermod命令"><span>usermod命令</span></a></li><li><a class="is-flex is-mobile" href="#passwd命令"><span>passwd命令</span></a></li><li><a class="is-flex is-mobile" href="#userdel命令"><span>userdel命令</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#4-2-文件权限与归属"><span>4.2 文件权限与归属</span></a></li><li><a class="is-flex is-mobile" href="#4-3-文件的特殊权限"><span>4.3 文件的特殊权限</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#SUID"><span>SUID</span></a></li><li><a class="is-flex is-mobile" href="#SGID"><span>SGID</span></a></li><li><a class="is-flex is-mobile" href="#SBIT"><span>SBIT</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#4-4-文件的隐藏属性"><span>4.4 文件的隐藏属性</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#chattr命令"><span>chattr命令</span></a></li><li><a class="is-flex is-mobile" href="#lsattr命令"><span>lsattr命令</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#4-5-文件访问控制列表"><span>4.5 文件访问控制列表</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#setfacl命令"><span>setfacl命令</span></a></li><li><a class="is-flex is-mobile" href="#getfacl命令"><span>getfacl命令</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#4-6-su命令与sudo服务"><span>4.6 su命令与sudo服务</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#5-存储结构与管理硬盘"><span>5 存储结构与管理硬盘</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#5-1-一切从”-“开始"><span>5.1 一切从”/“开始</span></a></li><li><a class="is-flex is-mobile" href="#5-2-物理设备的命名规则"><span>5.2 物理设备的命名规则</span></a></li><li><a class="is-flex is-mobile" href="#5-3-文件系统与数据资料"><span>5.3 文件系统与数据资料</span></a></li><li><a class="is-flex is-mobile" href="#5-4-挂载硬件设备"><span>5.4 挂载硬件设备</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#mount命令"><span>mount命令</span></a></li><li><a class="is-flex is-mobile" href="#blkid命令"><span>blkid命令</span></a></li><li><a class="is-flex is-mobile" href="#df命令"><span>df命令</span></a></li><li><a class="is-flex is-mobile" href="#umount命令"><span>umount命令</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#5-5-添加硬盘设备"><span>5.5 添加硬盘设备</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#fdisk命令"><span>fdisk命令</span></a></li><li><a class="is-flex is-mobile" href="#du命令"><span>du命令</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#5-6-添加交换分区"><span>5.6 添加交换分区</span></a></li><li><a class="is-flex is-mobile" href="#5-7-磁盘容量配额"><span>5.7 磁盘容量配额</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#xfs-quota命令"><span>xfs_quota命令</span></a></li><li><a class="is-flex is-mobile" href="#edquota命令"><span>edquota命令</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#5-8-VDO-虚拟数据优化"><span>5.8 VDO(虚拟数据优化)</span></a></li><li><a class="is-flex is-mobile" href="#5-9-软硬方式链接"><span>5.9 软硬方式链接</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#ln命令"><span>ln命令</span></a></li></ul></li></ul></li><li><a class="is-flex is-mobile" href="#6-使用RAID与LVM磁盘阵列技术"><span>6 使用RAID与LVM磁盘阵列技术</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#6-1-RAID-独立冗余磁盘阵列"><span>6.1 RAID(独立冗余磁盘阵列)</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#RAID-0"><span>RAID 0</span></a></li><li><a class="is-flex is-mobile" href="#RAID-1"><span>RAID 1</span></a></li><li><a class="is-flex is-mobile" href="#RAID-5"><span>RAID 5</span></a></li><li><a class="is-flex is-mobile" href="#RAID-10"><span>RAID 10</span></a></li><li><a class="is-flex is-mobile" href="#部署磁盘阵列"><span>部署磁盘阵列</span></a></li><li><a class="is-flex is-mobile" href="#损坏磁盘阵列及修复"><span>损坏磁盘阵列及修复</span></a></li><li><a class="is-flex is-mobile" href="#磁盘阵列-备份盘"><span>磁盘阵列+备份盘</span></a></li><li><a class="is-flex is-mobile" href="#删除磁盘阵列"><span>删除磁盘阵列</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#6-2-LVM-逻辑卷管理器"><span>6.2 LVM(逻辑卷管理器)</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#部署逻辑卷"><span>部署逻辑卷</span></a></li><li><a class="is-flex is-mobile" href="#扩容逻辑卷"><span>扩容逻辑卷</span></a></li><li><a class="is-flex is-mobile" href="#缩小逻辑卷"><span>缩小逻辑卷</span></a></li><li><a class="is-flex is-mobile" href="#逻辑卷快照"><span>逻辑卷快照</span></a></li><li><a class="is-flex is-mobile" href="#删除逻辑卷"><span>删除逻辑卷</span></a></li></ul></li></ul></li><li><a class="is-flex is-mobile" href="#7-使用iptables与firewalld防火墙"><span>7 使用iptables与firewalld防火墙</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#7-1-防火墙管理工具"><span>7.1 防火墙管理工具</span></a></li><li><a class="is-flex is-mobile" href="#7-2-iptables"><span>7.2 iptables</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#策略与规则链"><span>策略与规则链</span></a></li><li><a class="is-flex is-mobile" href="#基本命令参数"><span>基本命令参数</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#7-3-firewalld"><span>7.3 firewalld</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#终端管理工具"><span>终端管理工具</span></a></li><li><a class="is-flex is-mobile" href="#图形管理工具"><span>图形管理工具</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#7-4-服务的访问控制列表"><span>7.4 服务的访问控制列表</span></a></li><li><a class="is-flex is-mobile" href="#7-5-Cockpit驾驶舱管理工具"><span>7.5 Cockpit驾驶舱管理工具</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#8-提高命令行生产率"><span>8 提高命令行生产率</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#8-1-脚本的分类"><span>8.1 脚本的分类</span></a></li><li><a class="is-flex is-mobile" href="#8-2-创建和执行脚本"><span>8.2 创建和执行脚本</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#指定命令解释器"><span>指定命令解释器</span></a></li><li><a class="is-flex is-mobile" href="#执行Bash-Shell"><span>执行Bash Shell</span></a></li><li><a class="is-flex is-mobile" href="#对特殊字符加引号"><span>对特殊字符加引号</span></a></li><li><a class="is-flex is-mobile" href="#与"><span>``与$()</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#8-3-使用循环更高效的命令"><span>8.3 使用循环更高效的命令</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#for语句"><span>for语句</span></a></li><li><a class="is-flex is-mobile" href="#在脚本中使用退出代码"><span>在脚本中使用退出代码</span></a></li><li><a class="is-flex is-mobile" href="#使用运算符执行测试"><span>使用运算符执行测试</span></a></li><li><a class="is-flex is-mobile" href="#exit、if、elif、else"><span>exit、if、elif、else</span></a></li><li><a class="is-flex is-mobile" href="#位置变量"><span>位置变量</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#8-4-cut"><span>8.4 cut</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#9-Linux计划任务"><span>9 Linux计划任务</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#9-1-at"><span>9.1 at</span></a></li><li><a class="is-flex is-mobile" href="#9-2-crontab"><span>9.2 crontab</span></a></li><li><a class="is-flex is-mobile" href="#9-3-管理临时文件"><span>9.3 管理临时文件</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#10-系统性能调优"><span>10 系统性能调优</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#10-1-tuned"><span>10.1 tuned</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#查看状态"><span>查看状态</span></a></li><li><a class="is-flex is-mobile" href="#tuned-adm管理指令"><span>tuned-adm管理指令</span></a></li><li><a class="is-flex is-mobile" href="#配置文件存储路径"><span>配置文件存储路径</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#10-2-使用cockpit修改调优的方式"><span>10.2 使用cockpit修改调优的方式</span></a></li><li><a class="is-flex is-mobile" href="#10-3-调节nice值"><span>10.3 调节nice值</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#nice值管理"><span>nice值管理</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#10-4-练习"><span>10.4 练习</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#11-管理SELinux"><span>11 管理SELinux</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#11-1-介绍selinux"><span>11.1 介绍selinux</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#selinux简介"><span>selinux简介</span></a></li><li><a class="is-flex is-mobile" href="#selinux实现原理"><span>selinux实现原理</span></a></li><li><a class="is-flex is-mobile" href="#selinux的限制范围"><span>selinux的限制范围</span></a></li><li><a class="is-flex is-mobile" href="#查看上下文"><span>查看上下文</span></a></li><li><a class="is-flex is-mobile" href="#security-context介绍"><span>security context介绍</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#11-2-更改SElinux强制模式"><span>11.2 更改SElinux强制模式</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#临时开启或关闭selinux"><span>临时开启或关闭selinux</span></a></li><li><a class="is-flex is-mobile" href="#永久开启或关闭selinux"><span>永久开启或关闭selinux</span></a></li><li><a class="is-flex is-mobile" href="#继承特性"><span>继承特性</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#11-3-定义selinux默认文件上下文规则"><span>11.3 定义selinux默认文件上下文规则</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#chcon"><span>chcon</span></a></li><li><a class="is-flex is-mobile" href="#semanage-fcontext"><span>semanage fcontext</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#11-4-管理布尔值"><span>11.4 管理布尔值</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#管理布尔值"><span>管理布尔值</span></a></li><li><a class="is-flex is-mobile" href="#使用布尔值调整"><span>使用布尔值调整</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#11-5-安全端口"><span>11.5 安全端口</span></a></li><li><a class="is-flex is-mobile" href="#11-6-SElinux日志"><span>11.6 SElinux日志</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#12-管理基本存储"><span>12 管理基本存储</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#12-1-添加分区"><span>12.1 添加分区</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#分区方案-MBR-GPT"><span>分区方案-MBR&amp;GPT</span></a></li><li><a class="is-flex is-mobile" href="#分区工具-fdisk-parted"><span>分区工具:fdisk&amp;parted</span></a></li><li><a class="is-flex is-mobile" href="#分区方案练习"><span>分区方案练习</span></a></li><li><a class="is-flex is-mobile" href="#parted使用MBR分区方案"><span>parted使用MBR分区方案</span></a></li><li><a class="is-flex is-mobile" href="#parted使用GPT方案"><span>parted使用GPT方案</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#12-2-文件系统"><span>12.2 文件系统</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#格式化"><span>格式化</span></a></li><li><a class="is-flex is-mobile" href="#lsblk"><span>lsblk</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#12-3-挂载与永久挂载"><span>12.3 挂载与永久挂载</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#mount"><span>mount</span></a></li><li><a class="is-flex is-mobile" href="#etc-fstab"><span>/etc/fstab</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#12-4-管理交换分区"><span>12.4 管理交换分区</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#创建交换分区swap"><span>创建交换分区swap</span></a></li><li><a class="is-flex is-mobile" href="#使用本地存储创建swap"><span>使用本地存储创建swap</span></a></li></ul></li></ul></li><li><a class="is-flex is-mobile" href="#13-逻辑卷管理LVM"><span>13 逻辑卷管理LVM</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#13-1-创建和扩展逻辑卷"><span>13.1 创建和扩展逻辑卷</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#逻辑卷管理概述"><span>逻辑卷管理概述</span></a></li><li><a class="is-flex is-mobile" href="#构建LVM存储"><span>构建LVM存储</span></a></li><li><a class="is-flex is-mobile" href="#扩展逻辑卷"><span>扩展逻辑卷</span></a></li><li><a class="is-flex is-mobile" href="#缩小逻辑卷-1"><span>缩小逻辑卷</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#13-2-管理分层存储"><span>13.2 管理分层存储</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#stratis"><span>stratis</span></a></li><li><a class="is-flex is-mobile" href="#VDO"><span>VDO</span></a></li></ul></li></ul></li><li><a class="is-flex is-mobile" href="#14-访问网络存储"><span>14 访问网络存储</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#14-1-NFS挂载网络附加存储"><span>14.1 NFS挂载网络附加存储</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#查看NFS共享"><span>查看NFS共享</span></a></li><li><a class="is-flex is-mobile" href="#客户端挂载-mount"><span>客户端挂载 mount</span></a></li><li><a class="is-flex is-mobile" href="#开机自动挂载-etc-fstab"><span>开机自动挂载 /etc/fstab</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#14-2-自动挂载网络附加存储autofs"><span>14.2 自动挂载网络附加存储autofs</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#自动挂载示例1"><span>自动挂载示例1</span></a></li><li><a class="is-flex is-mobile" href="#autofs-直接映射"><span>autofs 直接映射</span></a></li><li><a class="is-flex is-mobile" href="#autofs-间接映射"><span>autofs 间接映射</span></a></li></ul></li></ul></li><li><a class="is-flex is-mobile" href="#15-启动流程"><span>15 启动流程</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#15-1-选择启动目标"><span>15.1 选择启动目标</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#Linux-9启动过程"><span>Linux 9启动过程</span></a></li><li><a class="is-flex is-mobile" href="#重启和关机"><span>重启和关机</span></a></li><li><a class="is-flex is-mobile" href="#选择SYSTEND-TERGET"><span>选择SYSTEND TERGET</span></a></li><li><a class="is-flex is-mobile" href="#运行时选择target"><span>运行时选择target</span></a></li><li><a class="is-flex is-mobile" href="#设置默认target"><span>设置默认target</span></a></li><li><a class="is-flex is-mobile" href="#启动时选择其他目标"><span>启动时选择其他目标</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#15-2-重置root密码"><span>15.2 重置root密码</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#修改登录密码"><span>修改登录密码</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#15-3-诊断和修复文件系统"><span>15.3 诊断和修复文件系统</span></a></li><li><a class="is-flex is-mobile" href="#文件系统、选项错误-权限-直接进入紧急模式"><span>  文件系统、选项错误(权限) 直接进入紧急模式</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#16-firewalld"><span>16 firewalld</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#16-1-防火墙架构概念"><span>16.1 防火墙架构概念</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#nftables增强了netfilter"><span>nftables增强了netfilter</span></a></li><li><a class="is-flex is-mobile" href="#firewalld简介"><span>firewalld简介</span></a></li><li><a class="is-flex is-mobile" href="#预定义区域"><span>预定义区域</span></a></li><li><a class="is-flex is-mobile" href="#预定义服务"><span>预定义服务</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#16-2-配置防火墙"><span>16.2 配置防火墙</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#Web控制台配置防火墙"><span>Web控制台配置防火墙</span></a></li><li><a class="is-flex is-mobile" href="#命令行配置防火墙"><span>命令行配置防火墙</span></a></li><li><a class="is-flex is-mobile" href="#–list-all-zones"><span>–list-all-zones</span></a></li><li><a class="is-flex is-mobile" href="#配置防火墙练习"><span>配置防火墙练习</span></a></li><li><a class="is-flex is-mobile" href="#典型举例"><span>典型举例</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#16-3-SElinux安全端口"><span>16.3 SElinux安全端口</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#17-kickstart"><span>17 kickstart</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#17-1-KICKSTART自动安装系统"><span>17.1 KICKSTART自动安装系统</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#dhcp设置"><span>dhcp设置</span></a></li><li><a class="is-flex is-mobile" href="#tftp-and-syslinux"><span>tftp and syslinux</span></a></li><li><a class="is-flex is-mobile" href="#ftp"><span>ftp</span></a></li><li><a class="is-flex is-mobile" href="#保证所有服务测试正常"><span>保证所有服务测试正常</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#17-2-cockpit安装虚拟机"><span>17.2 cockpit安装虚拟机</span></a></li></ul></li></ul></div></div><style>.menu-list > li > a.is-active + .menu-list { display: block; }.menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/avatar.png" alt="罗宇"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">罗宇</p><p class="is-size-6 is-block">用开放的思维，解决封闭的问题</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国-四川-成都</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives/"><p class="title">10</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories/"><p class="title">4</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags/"><p class="title">10</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://luovip.github.io" target="_blank" rel="noopener">关注我</a></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://www.iloveimg.com/zh-cn/compress-image" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">图片压缩</span></span><span class="level-right"><span class="level-item tag">www.iloveimg.com</span></span></a></li><li><a class="level is-mobile" href="https://mirrors.nju.edu.cn/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">南京大学镜像站</span></span><span class="level-right"><span class="level-item tag">mirrors.nju.edu.cn</span></span></a></li><li><a class="level is-mobile" href="https://developer.aliyun.com/mirror/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">阿里云镜像站</span></span><span class="level-right"><span class="level-item tag">developer.aliyun.com</span></span></a></li><li><a class="level is-mobile" href="https://docs.docker.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">docker官网</span></span><span class="level-right"><span class="level-item tag">docs.docker.com</span></span></a></li><li><a class="level is-mobile" href="https://hub.docker.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">docker官方仓库</span></span><span class="level-right"><span class="level-item tag">hub.docker.com</span></span></a></li><li><a class="level is-mobile" href="https://containerd.io/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">containerd官网</span></span><span class="level-right"><span class="level-item tag">containerd.io</span></span></a></li><li><a class="level is-mobile" href="https://goharbor.io/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">harbor官网</span></span><span class="level-right"><span class="level-item tag">goharbor.io</span></span></a></li><li><a class="level is-mobile" href="https://kubernetes.io/zh-cn/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">kubernetes官网</span></span><span class="level-right"><span class="level-item tag">kubernetes.io</span></span></a></li></ul></div></div></div><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><figure class="media-left"><a class="image" href="/2025/05/12/Kubernetes/%E5%AE%B9%E5%99%A8&amp;K8S/"><img src="/img/docker&amp;k8s.jpg" alt="容器&amp;K8S"></a></figure><div class="media-content"><p class="date"><time dateTime="2025-05-12T07:21:42.000Z">2025-05-12 15:21:42</time></p><p class="title"><a href="/2025/05/12/Kubernetes/%E5%AE%B9%E5%99%A8&amp;K8S/">容器&amp;K8S</a></p><p class="categories"><a href="/categories/Kubernetes/">Kubernetes</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2025/05/11/Linux/Linux%E5%91%BD%E4%BB%A4/"><img src="/img/Linux.jpg" alt="Linux命令"></a></figure><div class="media-content"><p class="date"><time dateTime="2025-05-11T14:36:42.000Z">2025-05-11 22:36:42</time></p><p class="title"><a href="/2025/05/11/Linux/Linux%E5%91%BD%E4%BB%A4/">Linux命令</a></p><p class="categories"><a href="/categories/Linux/">Linux</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2025/05/10/Kubernetes/Kubernetes%E7%BD%91%E7%BB%9C%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/"><img src="/img/K8S.jpg" alt="Kubernetes网络系统原理"></a></figure><div class="media-content"><p class="date"><time dateTime="2025-05-10T11:29:42.000Z">2025-05-10 19:29:42</time></p><p class="title"><a href="/2025/05/10/Kubernetes/Kubernetes%E7%BD%91%E7%BB%9C%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/">Kubernetes网络系统原理</a></p><p class="categories"><a href="/categories/Kubernetes/">Kubernetes</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2025/05/10/Kubernetes/Kubernetes%E4%BC%81%E4%B8%9A%E7%BA%A7%E8%BF%90%E7%BB%B4/"><img src="/img/K8S.jpg" alt="Kubernetes企业级运维"></a></figure><div class="media-content"><p class="date"><time dateTime="2025-05-10T11:28:42.000Z">2025-05-10 19:28:42</time></p><p class="title"><a href="/2025/05/10/Kubernetes/Kubernetes%E4%BC%81%E4%B8%9A%E7%BA%A7%E8%BF%90%E7%BB%B4/">Kubernetes企业级运维</a></p><p class="categories"><a href="/categories/Kubernetes/">Kubernetes</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2025/05/10/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/Shell%E8%84%9A%E6%9C%AC/"><img src="/img/shell.jpg" alt="Shell脚本"></a></figure><div class="media-content"><p class="date"><time dateTime="2025-05-10T09:55:42.000Z">2025-05-10 17:55:42</time></p><p class="title"><a href="/2025/05/10/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/Shell%E8%84%9A%E6%9C%AC/">Shell脚本</a></p><p class="categories"><a href="/categories/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/">自动化运维</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/Kubernetes/"><span class="level-start"><span class="level-item">Kubernetes</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF/"><span class="level-start"><span class="level-item">容器技术</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/"><span class="level-start"><span class="level-item">自动化运维</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2025/05/"><span class="level-start"><span class="level-item">五月 2025</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2025/04/"><span class="level-start"><span class="level-item">四月 2025</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Ansible%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"><span class="tag">Ansible的基本使用</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Kubernetes%E4%BC%81%E4%B8%9A%E7%BA%A7%E8%BF%90%E7%BB%B4/"><span class="tag">Kubernetes企业级运维</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Kubernetes%E7%BD%91%E7%BB%9C%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/"><span class="tag">Kubernetes网络系统原理</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux%E5%91%BD%E4%BB%A4/"><span class="tag">Linux命令</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"><span class="tag">Linux的基本使用</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux%E7%9A%84%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1/"><span class="tag">Linux的基础服务</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux%E8%BF%9B%E9%98%B6/"><span class="tag">Linux进阶</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Shell%E8%84%9A%E6%9C%AC/"><span class="tag">Shell脚本</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/podman%E5%AE%B9%E5%99%A8/"><span class="tag">podman容器</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%AE%B9%E5%99%A8-K8S/"><span class="tag">容器&amp;K8S</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div><!--!--><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Linux技术博客</a><p class="size-small"><span>&copy; 2021-2025</span>  Powered by 罗宇 <br><span>© <a href="http://www.beian.miit.gov.cn/" target="_blank">川ICP备88888888号</a><br></span><span>© 版权说明:本网站所有内容均自己创作,方便用于技术交流和日常总结!<br /></span><span><span id="statistic-times">loading...</span><script>function createTime(time) {
            var n = new Date(time);
            now.setTime(now.getTime() + 250),
                days = (now - n) / 1e3 / 60 / 60 / 24,
                dnum = Math.floor(days),
                hours = (now - n) / 1e3 / 60 / 60 - 24 * dnum,
                hnum = Math.floor(hours),
            1 == String(hnum).length && (hnum = "0" + hnum),
                minutes = (now - n) / 1e3 / 60 - 1440 * dnum - 60 * hnum,
                mnum = Math.floor(minutes),
            1 == String(mnum).length && (mnum = "0" + mnum),
                seconds = (now - n) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum,
                snum = Math.round(seconds),
            1 == String(snum).length && (snum = "0" + snum),
                document.getElementById("statistic-times").innerHTML = "❤️本站自 <strong>"+time.split(" ")[0].replace(/\//g,".")+"</strong> 已运行 <strong>" + dnum + "</strong> 天 <strong>" + hnum + "</strong> 小时 <strong>" + mnum + "</strong> 分 <strong>" + snum + "</strong> 秒！❤️";
        }var now = new Date();setInterval("createTime('2021/12/17 00:00:00')", 250,"");</script><br></span></p></div><div class="level-end"></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script data-pjax src="/js/insight.js" defer></script><script data-pjax>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script><script type="text/javascript">var pjax = new Pjax({
            elements: "a",//代表点击链接就更新
            selectors: [  //代表要更新的节点
                ".section",
                "title"
            ],
            cache: true,
            cacheBust:false
        })

        function loadBusuanzi(){
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js", function () {});
        }

        function loadMathJax() { //加载mathjax
            $.getScript("//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML", function () {
                MathJax.Hub.Config({ tex2jax: { inlineMath: [['$', '$'], ['\(', '\)']] } });
                var math = document.getElementsByClassName("entry-content")[0];
                MathJax.Hub.Queue(["Typeset", MathJax.Hub, math]);
            });
        };

        // 开始 PJAX 执行的函数
        document.addEventListener('pjax:send', function () {
        });
        
        // PJAX 完成之后执行的函数，可以和上面的重载放在一起
        document.addEventListener('pjax:complete', function () {
            $(".section").css({opacity:1});
            if(false){
                $.getScript('/js/comment-issue-data.js',function(){loadIssueData('undefined','undefined','undefined','undefined',undefined);});
            }
            if(false){
                loadMathJax();
            }
            loadMainJs(jQuery, window.moment, window.ClipboardJS, window.IcarusThemeSettings);
            loadBackTop();
            loadBusuanzi();
            if(typeof loadBanner == 'function'){
                loadBanner();
            }
        });</script></body></html>